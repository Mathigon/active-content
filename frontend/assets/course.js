/* (c) Mathigon, generated by Mathigon Studio */
(()=>{var bu=Object.defineProperty;var Pu=Object.getOwnPropertyDescriptor;var lh=Object.assign;var b=(i,t,e,s)=>{for(var n=s>1?void 0:s?Pu(t,e):t,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=(s?o(t,e,n):o(n))||n);return s&&n&&bu(t,e,n),n};var S=(i,t,e)=>new Promise((s,n)=>{var r=h=>{try{a(e.next(h))}catch(l){n(l)}},o=h=>{try{a(e.throw(h))}catch(l){n(l)}},a=h=>h.done?s(h.value):Promise.resolve(h.value).then(r,o);a((e=e.apply(i,t)).next())});function ch(i=10){return Math.random().toString(36).substr(2,i)}function R(i,...t){return t.includes(i)}function os(i,t=0){return t?+setTimeout(i,t):(i(),0)}function ie(i){return new Promise(t=>setTimeout(t,i))}function ki(){let i=()=>{},t=()=>{},e=new Promise((s,n)=>{i=s,t=n});return e.catch(s=>s),{promise:e,resolve:i,reject:t}}function Li(i){let t=new Map;return function(...e){let s=e.join("--");return t.has(s)||t.set(s,i(...e)),t.get(s)}}function Oi(i,t=0,e=!1){let s=!1,n=!1;return(...r)=>{s?n=!0:(e?n=!0:i(...r),s=!0,setTimeout(()=>{n&&i(...r),s=n=!1},t))}}function Ae(i,t){return new Array(t).fill(i)}function Wn(i,t,e){let s=[];for(let n=0;n<t;++n)s.push(Ae(i,e));return s}function z(i,t){let e=[];for(let s=0;s<t;++s)e.push(i(s));return e}function ph(i,t,e){let s=[];for(let n=0;n<t;++n){let r=[];for(let o=0;o<e;++o)r.push(i(n,o));s.push(r)}return s}function as(i,t,e=1){let s=[];if(t===void 0&&i>=0)for(let n=0;n<i;n+=e)s.push(n);else if(t===void 0)for(let n=0;n>i;n-=e)s.push(n);else if(i<=t)for(let n=i;n<=t;n+=e)s.push(n);else for(let n=i;n>=t;n-=e)s.push(n);return s}function N(i,t=0){return i[i.length-1-t]}function U(i){return i.reduce((t,e)=>t+e,0)}function Ce(i,t,e=!1){return i.slice(0).sort((s,n)=>{let r=t(s),o=t(n);return r<o?e?1:-1:r>o?e?-1:1:0})}function ke(i){let t=0;return()=>i[t++%i.length]}function Ht(i){return i.filter((t,e)=>i.indexOf(t)===e)}function Yt(i){return i.reduce((t,e)=>t.concat(Array.isArray(e)?Yt(e):e),[])}function uh(i){let t=0;return i.map(e=>t+=e)}function Ii(...i){return i.reduce((t,e)=>t.concat(e),[])}function wt(i,t=/\s+/){return i?i.trim().split(t):[]}function dh(i){return i.toLowerCase().replace(/^-/,"").replace(/-(.)/g,(t,e)=>e.toUpperCase())}function Mu(i,t,e=!1){let s=Wn(0,i.length+1,t.length+1);for(let n=0;n<=i.length;n++)s[n][0]=n;for(let n=0;n<=t.length;n++)s[0][n]=n;for(let n=1;n<=i.length;n++)for(let r=1;r<=t.length;r++)s[n][r]=Math.min(s[n-1][r-1]+(i.charAt(n-1)===t.charAt(r-1)?0:1),s[n-1][r]+1,s[n][r-1]+1);return e?Math.min(...s[i.length]):s[i.length][t.length]}function fh(i,t){let e=i.length/2,s=t.map(r=>({w:r,d:Mu(i,r)})).filter(({d:r})=>r<e),n=Ce(s,r=>r.d)[0];return n?n.w:void 0}var hs=class{constructor(){this.events=new Map}on(t,e){for(let s of wt(t))this.events.has(s)||this.events.set(s,[]),this.events.get(s).push(e)}one(t,e){let s=n=>{this.off(t,s),e(n)};this.on(t,s)}off(t,e){for(let s of wt(t))this.events.has(s)&&this.events.set(s,this.events.get(s).filter(n=>n!==e))}trigger(t,e){for(let s of wt(t))if(this.events.has(s))for(let n of this.events.get(s))n(e)}},Su=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,Tu=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,Vu=/rgba?\(([0-9,]+), ?([0-9,]+), ?([0-9,]+)(, ?([0-9,]+))?\)/,Eu=["#22ab24","#009ea6","#0f82f2","#6d3bbf","#cd0e66","#eb4726","#fd8c00"];function Au(i){return i.length===1?"0"+i:i}function mh(i,t){if(t<=0)return q.from(i[0]);if(t>=1)return q.from(N(i));let e=Math.floor(t*(i.length-1)),s=t*(i.length-1)-e;return q.mix(i[e+1],i[e],s)}function Zn(i,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?i+(t-i)*6*e:e<1/2?t:e<2/3?i+(t-i)*(2/3-e)*6:i}var q=class{constructor(t,e,s,n=1){this.r=t,this.g=e,this.b=s,this.a=n}get hex(){let t=[this.r,this.g,this.b].map(e=>Au(Math.round(e).toString(16)));return"#"+t.join("")}get rgb(){let t=[this.r,this.g,this.b].map(e=>Math.round(e)).join(",");return"rgba("+t+","+this.a+")"}get hsl(){let t=this.r/255,e=this.g/255,s=this.b/255,n=Math.max(t,e,s),r=Math.min(t,e,s),o=(r+n)/2,a=n-r;if(n===r)return[0,0,Math.round(o*100)];let h=t===n?(e-s)/a:e===n?2+(s-t)/a:4+(t-e)/a;h=Math.min(h*60,360),h<0&&(h+=360);let l=o<=.5?a/(n+r):a/(2-n-r);return[Math.round(h),Math.round(l*100),Math.round(o*100)]}get chroma(){return Math.max(this.r,this.g,this.b)-Math.min(this.r,this.g,this.b)}toString(){return this.rgb}copy(){return new q(this.r,this.g,this.b,this.a)}static from(t){return typeof t!="string"?t:t.startsWith("#")?q.fromHex(t):q.fromRgb(t)}static fromRgb(t){let e=t.match(Vu);if(!e)return new q(0,0,0);let s=e[4]?+e[5]||0:1;return new q(+e[1],+e[2],+e[3],s)}static fromHex(t){t=t.replace(Su,function(s,n,r,o){return n+n+r+r+o+o});let e=Tu.exec(t);return e?new q(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)):new q(0,0,0)}static fromHsl(t,e,s){if(t/=360,e/=100,s/=100,e===0){let l=Math.round(s*255);return new q(l,l,l)}let n=s<.5?s*(1+e):s+e-s*e,r=2*s-n,o=Zn(r,n,t+1/3),a=Zn(r,n,t),h=Zn(r,n,t-1/3);return new q(Math.round(o*255),Math.round(a*255),Math.round(h*255))}static rainbow(t){return z(e=>mh(Eu,e/(t-1)),t)}static gradient(t,e){return z(s=>mh(t,s/(e-1)),e)}static shades(t,e,s=.5){let n=q.mix("#fff",t,s),r=q.mix("#000",t,s);return q.gradient([n,t,r],e)}static mix(t,e,s=.5){return t=q.from(t),e=q.from(e),new q(s*t.r+(1-s)*e.r,s*t.g+(1-s)*e.g,s*t.b+(1-s)*e.b,s*t.a+(1-s)*e.a)}static mixMany(t,e){e||(e=t.map(()=>1));let s=U(e),n=t.map(y=>y.hsl),r=n.map(y=>y[0]),o=r.map(y=>y<180?y+360:y),a=e.map((y,v)=>y*Math.sqrt(t[v].chroma)),h=U(a),l=U(r.map((y,v)=>y*a[v]))/h,u=U(o.map((y,v)=>y*a[v]))/h,d=U(r.map((y,v)=>Math.abs(y-l)*a[v])),m=U(o.map((y,v)=>Math.abs(y-u)*a[v])),$=d<=m?l:u%360,k=U(n.map((y,v)=>e[v]*y[1]))/s,g=U(n.map((y,v)=>e[v]*y[2]))/s;return q.fromHsl($,k,g)}};function gh(i,t){for(let e of i)if(!t(e))return!1;return!0}var ls=class{constructor(...t){this.values=t}map(t){let e=this.values;return new ls(function*(){let s=0;for(let n of e)for(let r of n)yield t(r,s),s+=1}())}every(t){let e=0;for(let s of this.values)for(let n of s){if(!t(n,e))return!1;e+=1}return!0}some(t){let e=0;for(let s of this.values)for(let n of s){if(t(n,e))return!0;e+=1}return!1}slice(t,e){let s=this.values;return new ls(function*(){let n=0;for(let r of s)for(let o of r)n<t||e!==void 0&&n>t+e||(yield o,n+=1)}())}filter(t){let e=this.values;return new ls(function*(){let s=0;for(let n of e)for(let r of n)t(r,s)&&(yield r),s+=1}())}concat(t){this.values.push(t)}[Symbol.iterator](){let t=this.values;return function*(){for(let e of t)for(let s of e)yield s}()}static make(t,e){return new ls(function*(){let s=0;for(;e===void 0||s<e;)yield t(s),s+=1}())}};function wh(i=10){return Math.random().toString(36).substr(2,i)}function Le(i,...t){return t.includes(i)}function Fn(i,t){for(let e of Object.keys(t))Object.prototype.hasOwnProperty.call(i,e)||(i[e]=t[e]);return i}var Cu=(i,t)=>i.concat(t);function jn(i,t,e=Cu){for(let s of Object.keys(t))s in i&&Array.isArray(i[s])&&Array.isArray(t[s])?i[s]=e(i[s],t[s]):s in i&&i[s]instanceof Object&&t[s]instanceof Object?jn(i[s],t[s]):i[s]=t[s]}function Gi(i,t=0){return t?+setTimeout(i,t):(i(),0)}function Kn(){let i=()=>{},t=()=>{},e=new Promise((s,n)=>{i=s,t=n});return e.catch(s=>s),{promise:e,resolve:i,reject:t}}function Xn(i,t=0,e=!1){let s=!1,n=!1;return(...r)=>{s?n=!0:(e?n=!0:i(...r),s=!0,setTimeout(()=>{n&&i(...r),s=n=!1},t))}}function Yn(i,t={}){if(!i)return t;try{return JSON.parse(i)||t}catch(e){return t}}function yh(i,t){return new Array(t).fill(i)}function vh(i,t){let e=[];for(let s=0;s<t;++s)e.push(i(s));return e}function Rs(i,t=0){return i[i.length-1-t]}function Oe(i){return i.reduce((t,e)=>t+e,0)}function Jn(i){return i.filter((t,e)=>i.indexOf(t)===e)}function Qn(i){return i.reduce((t,e)=>t.concat(Array.isArray(e)?Qn(e):e),[])}function tr(i,t){let e=[];for(let s=0;s<i.length;s+=t)e.push(i.slice(s,s+t));return e}function Lt(i,t=/\s+/){return i?i.trim().split(t):[]}function xh(i){return i.toLowerCase().replace(/^-/,"").replace(/-(.)/g,(t,e)=>e.toUpperCase())}var Ri=class{constructor(){this.events=new Map}on(t,e){for(let s of Lt(t))this.events.has(s)||this.events.set(s,[]),this.events.get(s).push(e)}one(t,e){let s=n=>{this.off(t,s),e(n)};this.on(t,s)}off(t,e){for(let s of Lt(t))this.events.has(s)&&this.events.set(s,this.events.get(s).filter(n=>n!==e))}trigger(t,e){for(let s of Lt(t))if(this.events.has(s))for(let n of this.events.get(s))n(e)}};var cs=class{constructor(...t){this.values=t}map(t){let e=this.values;return new cs(function*(){let s=0;for(let n of e)for(let r of n)yield t(r,s),s+=1}())}every(t){let e=0;for(let s of this.values)for(let n of s){if(!t(n,e))return!1;e+=1}return!0}some(t){let e=0;for(let s of this.values)for(let n of s){if(t(n,e))return!0;e+=1}return!1}slice(t,e){let s=this.values;return new cs(function*(){let n=0;for(let r of s)for(let o of r)n<t||e!==void 0&&n>t+e||(yield o,n+=1)}())}filter(t){let e=this.values;return new cs(function*(){let s=0;for(let n of e)for(let r of n)t(r,s)&&(yield r),s+=1}())}concat(t){this.values.push(t)}[Symbol.iterator](){let t=this.values;return function*(){for(let e of t)for(let s of e)yield s}()}static make(t,e){return new cs(function*(){let s=0;for(;e===void 0||s<e;)yield t(s),s+=1}())}};var $h=1e-6;function rt(i,t,e=$h){return isNaN(i)||isNaN(t)?!1:Math.abs(i-t)<e}function Ut(i,t,e,s=$h){return t>e&&([t,e]=[e,t]),i>t+s&&i<e-s}function de(i,t=1){return Math.round(i/t)*t}function fe(i,t=-Infinity,e=Infinity){return Math.min(e,Math.max(t,i))}function er(i,t,e=.5){return i+(t-i)*e}function Dt(i){return i*i}function bh(i,t){return(i%t+t)%t}function Mh(i,t=0){let e=i.slice(0),s=Ph(e);return t?s.filter(n=>n.length===t):s}function Ph(i){if(i.length===1)return[[],i];let t=i.pop(),e=Ph(i),s=[];for(let n of e)s.push(n,[...n,t]);return s}function ku(i){i=i.slice(0);for(let t=i.length-1;t>0;--t){let e=Math.floor(Math.random()*(t+1));[i[t],i[e]]=[i[e],i[t]]}return i}function Lu(i,t){let e=t===void 0?0:i,s=t===void 0?i:t-i+1;return e+Math.floor(s*Math.random())}function Sh(i){let t=Math.random()*Oe(i),e=0;return i.findIndex(s=>(e+=s)>=t)}function Ou(i){return i[Math.floor(i.length*Math.random())]}var Ni=new Map;function Iu(i,t){t||(t=wh()),Ni.has(t)||Ni.set(t,yh(1,i));let e=Ni.get(t),s=Sh(e.map(n=>n*n));return e[s]-=1,e[s]<=0&&Ni.set(t,e.map(n=>n+1)),s}function Th(i=.5){return Math.random()<i?1:0}function Gu(i=1,t=.5){let e=0;for(let s=0;s<i;++s)e+=Th(t);return e}function Ru(i=1){if(i<=0)return 0;let t=Math.exp(-i),e=1,s=0;for(;e>t;++s)e*=Math.random();return s-1}function Nu(i=0,t=1){return i+(t-i)*Math.random()}function Du(i=0,t=1){let e=Math.random(),s=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*s)*Math.sqrt(t)+i}function qu(i=1){return i<=0?0:-Math.log(Math.random())/i}function zu(i=.5){if(!(i<=0||i>1))return Math.floor(Math.log(Math.random())/Math.log(1-i))}function Bu(){let i,t,e;do t=2*Math.random()-1,e=2*Math.random()-1,i=t*t+e*e;while(i>=1);return t/e}function _u(i,t=1,e=0){return Math.exp(-((i-t)**2)/(2*e))/Math.sqrt(2*Math.PI*e)}var Vh=7,Eh=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];function Ah(i){if(i<.5)return Math.PI/(Math.sin(Math.PI*i)*Ah(1-i));i-=1;let t=Eh[0];for(let s=1;s<Vh+2;s++)t+=Eh[s]/(i+s);let e=i+Vh+.5;return Math.sqrt(2*Math.PI)*Math.pow(e,i+.5)*Math.exp(-e)*t}function Ch(i,t,e,s=1){let n=0;for(let r=t;r<e;r+=s)n+=i(r)*s||0;return n}function Hu(i,t){let e=Ch(s=>Math.pow(s,(t-2)/2)*Math.exp(-s/2),0,i);return 1-e/Math.pow(2,t/2)/Ah(t/2)}var sr=Object.freeze({__proto__:null,shuffle:ku,integer:Lu,weighted:Sh,find:Ou,smart:Iu,bernoulli:Th,binomial:Gu,poisson:Ru,uniform:Nu,normal:Du,exponential:qu,geometric:zu,cauchy:Bu,normalPDF:_u,integrate:Ch,chiCDF:Hu});var ir=2*Math.PI;function kh(i,t){let e=Math.atan2(i.y-(t?t.y:0),i.x-(t?t.x:0));return bh(e,ir)}var x=class{constructor(t=0,e=0){this.x=t,this.y=e,this.type="point"}get unitVector(){return rt(this.length,0)?new x(1,0):this.scale(1/this.length)}get length(){return Math.sqrt(this.x**2+this.y**2)}get inverse(){return new x(-this.x,-this.y)}get flip(){return new x(this.y,this.x)}get perpendicular(){return new x(-this.y,this.x)}get array(){return[this.x,this.y]}distanceFromLine(t){return x.distance(this,t.project(this))}clamp(t,e=0){let s=fe(this.x,t.xMin+e,t.xMax-e),n=fe(this.y,t.yMin+e,t.yMax-e);return new x(s,n)}changeCoordinates(t,e){let s=e.xMin+(this.x-t.xMin)/t.dx*e.dx,n=e.yMin+(this.y-t.yMin)/t.dy*e.dy;return new x(s,n)}add(t){return x.sum(this,t)}subtract(t){return x.difference(this,t)}round(t=1){return new x(de(this.x,t),de(this.y,t))}floor(){return new x(Math.floor(this.x),Math.floor(this.y))}mod(t,e=t){return new x(this.x%t,this.y%e)}angle(t=Ns){return kh(this,t)}snap(t,e=5){return rt(this.x,t.x,e)?new x(t.x,this.y):rt(this.y,t.y,e)?new x(this.x,t.y):this}static average(...t){let e=Oe(t.map(n=>n.x))/t.length,s=Oe(t.map(n=>n.y))/t.length;return new x(e,s)}static dot(t,e){return t.x*e.x+t.y*e.y}static sum(t,e){return new x(t.x+e.x,t.y+e.y)}static difference(t,e){return new x(t.x-e.x,t.y-e.y)}static distance(t,e){return Math.sqrt(Dt(t.x-e.x)+Dt(t.y-e.y))}static manhattan(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}static interpolate(t,e,s=.5){return new x(er(t.x,e.x,s),er(t.y,e.y,s))}static interpolateList(t,e=.5){let s=t.length-1,n=Math.floor(fe(e,0,1)*s);return x.interpolate(t[n],t[n+1],s*e-n)}static fromPolar(t,e=1){return new x(e*Math.cos(t),e*Math.sin(t))}static random(t){let e=sr.uniform(t.xMin,t.xMax),s=sr.uniform(t.yMin,t.yMax);return new x(e,s)}transform(t){let e=t[0][0]*this.x+t[0][1]*this.y+t[0][2],s=t[1][0]*this.x+t[1][1]*this.y+t[1][2];return new x(e,s)}rotate(t,e=Ns){if(rt(t,0))return this;let s=this.x-e.x,n=this.y-e.y,r=Math.cos(t),o=Math.sin(t),a=s*r-n*o+e.x,h=s*o+n*r+e.y;return new x(a,h)}reflect(t){let e=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y,n=this.x-t.p1.x,r=this.y-t.p1.y,o=(e*r-s*n)/(e*e+s*s),a=this.x+2*o*s,h=this.y-2*o*e;return new x(a,h)}scale(t,e=t){return new x(this.x*t,this.y*e)}shift(t,e=t){return new x(this.x+t,this.y+e)}translate(t){return this.shift(t.x,t.y)}equals(t,e){return rt(this.x,t.x,e)&&rt(this.y,t.y,e)}},Ns=new x(0,0);var Jt=class{constructor(t,e){this.p1=t,this.p2=e,this.type="line"}make(t,e){return new Jt(t,e)}get length(){return x.distance(this.p1,this.p2)}get lengthSquared(){return(this.p1.x-this.p2.x)**2+(this.p1.y-this.p2.y)**2}get midpoint(){return x.average(this.p1,this.p2)}get slope(){return(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)}get intercept(){return this.p1.y+this.slope*this.p1.x}get angle(){return kh(this.p2,this.p1)}get unitVector(){return this.p2.subtract(this.p1).unitVector}get perpendicularVector(){return new x(this.p2.y-this.p1.y,this.p1.x-this.p2.x).unitVector}parallel(t){let e=x.sum(t,x.difference(this.p2,this.p1));return new Jt(t,e)}perpendicular(t){return new Jt(t,x.sum(t,this.perpendicularVector))}get perpendicularBisector(){return this.perpendicular(this.midpoint)}distanceSquared(t){let e=this.project(t);return(t.x-e.x)**2+(t.y-e.y)**2}offset(t){let e=x.difference(this.p2,this.p1),s=x.difference(t,this.p1);return x.dot(e,s)/this.lengthSquared}project(t){return this.at(this.offset(t))}side(t,e){let s=x.difference(this.p2,this.p1),n=x.difference(t,this.p1),r=n.x*s.y-n.y*s.x;return rt(r,0,e)?0:Math.sign(r)}contains(t,e){return this.side(t,e)===0}at(t){return x.interpolate(this.p1,this.p2,t)}transform(t){return new this.constructor(this.p1.transform(t),this.p2.transform(t))}rotate(t,e=Ns){return rt(t,0)?this:new this.constructor(this.p1.rotate(t,e),this.p2.rotate(t,e))}reflect(t){return new this.constructor(this.p1.reflect(t),this.p2.reflect(t))}scale(t,e=t){return this.make(this.p1.scale(t,e),this.p2.scale(t,e))}shift(t,e=t){return this.make(this.p1.shift(t,e),this.p2.shift(t,e))}translate(t){return this.shift(t.x,t.y)}equals(t,e){return this.contains(t.p1,e)&&this.contains(t.p2,e)}};var Ie=class extends Jt{constructor(){super(...arguments);this.type="segment"}contains(t,e){return Jt.prototype.contains.call(this,t,e)?this.p1.equals(t,e)||this.p2.equals(t,e)?!0:rt(this.p1.x,this.p2.x,e)?Ut(t.y,this.p1.y,this.p2.y):Ut(t.x,this.p1.x,this.p2.x):!1}make(t,e){return new Ie(t,e)}project(t){let e=x.difference(this.p2,this.p1),s=x.difference(t,this.p1),n=fe(x.dot(e,s)/this.lengthSquared,0,1);return x.sum(this.p1,e.scale(n))}contract(t){return new Ie(this.at(t),this.at(1-t))}equals(t,e,s=!1){return t.type!=="segment"?!1:this.p1.equals(t.p1,e)&&this.p2.equals(t.p2,e)||!s&&this.p1.equals(t.p2,e)&&this.p2.equals(t.p1,e)}},sg=180/Math.PI,ig=Math.PI/180;function Lh(i){return["polygon","polyline","rectangle","triangle"].includes(i.type)}function Oh(i){return["polygon","triangle"].includes(i.type)}function Ih(i){return i.type==="polyline"}function Uu(i){return i.type==="rectangle"}function Ds(i){return["line","ray","segment"].includes(i.type)}function Wu(i){return i.type==="line"}function Zu(i){return i.type==="ray"}function Gh(i){return i.type==="segment"}function ps(i){return i.type==="circle"}function Fu(i){return i.type==="arc"}function ju(i){return i.type==="sector"}function Ku(i){return i.type==="angle"}function Xu(i,t){return rt(i.p1.x,i.p2.x)?Ut(t.y,i.p1.y,i.p2.y):Ut(t.x,i.p1.x,i.p2.x)}function Yu(i,t){return rt(i.p1.x,i.p2.x)?(t.y-i.p1.y)/(i.p2.y-i.p1.y)>0:(t.x-i.p1.x)/(i.p2.x-i.p1.x)>0}function Ju(i,t){let e=i.p1.x-i.p2.x,s=i.p1.y-i.p2.y,n=t.p1.x-t.p2.x,r=t.p1.y-t.p2.y,o=e*r-s*n;if(rt(o,0))return[];let a=i.p1.x*i.p2.y-i.p1.y*i.p2.x,h=t.p1.x*t.p2.y-t.p1.y*t.p2.x,l=a*n-e*h,u=a*r-s*h;return[new x(l/o,u/o)]}function Qu(i,t){let e=x.distance(i.c,t.c);if(e>i.r+t.r)return[];if(e<Math.abs(i.r-t.r))return[];if(rt(e,0)&&rt(i.r,t.r))return[];if(rt(e,i.r+t.r))return[new Jt(i.c,t.c).midpoint];let s=(Dt(i.r)-Dt(t.r)+Dt(e))/(2*e),n=Math.sqrt(Dt(i.r)-Dt(s)),r=(t.c.x-i.c.x)*s/e+(t.c.y-i.c.y)*n/e+i.c.x,o=(t.c.y-i.c.y)*s/e-(t.c.x-i.c.x)*n/e+i.c.y,a=(t.c.x-i.c.x)*s/e-(t.c.y-i.c.y)*n/e+i.c.x,h=(t.c.y-i.c.y)*s/e+(t.c.x-i.c.x)*n/e+i.c.y;return[new x(r,o),new x(a,h)]}function Rh(i,t){let e=i.p2.x-i.p1.x,s=i.p2.y-i.p1.y,n=Dt(e)+Dt(s),r=t.c.x,o=t.c.y,a=(i.p1.x-r)*(i.p2.y-o)-(i.p2.x-r)*(i.p1.y-o),h=Dt(t.r)*n-Dt(a);if(h<0)return[];let l=a*s/n,u=-a*e/n;if(rt(h,0))return[t.c.shift(l,u)];let d=e*(s<0?-1:1)*Math.sqrt(h)/n,m=Math.abs(s)*Math.sqrt(h)/n;return[t.c.shift(l+d,u+m),t.c.shift(l-d,u-m)]}function td(i,t){let e=[];Ds(i)&&Ds(t)?e=Ju(i,t):Ds(i)&&ps(t)?e=Rh(i,t):ps(i)&&Ds(t)?e=Rh(t,i):ps(i)&&ps(t)&&(e=Qu(i,t));for(let s of[i,t])s.type==="segment"&&(e=e.filter(n=>Xu(s,n))),s.type==="ray"&&(e=e.filter(n=>Yu(s,n)));return e}function us(...i){if(i.length<2)return[];if(i.length>2)return Qn(Mh(i,2).map(s=>us(...s)));let[t,e]=i;if(Lh(e)&&([t,e]=[e,t]),Lh(t)){let s=Ds(e)?t.points.filter(n=>e.contains(n)):[];for(let n of t.edges)s.push(...us(n,e));return s}return td(t,e)}var ds=class{constructor(...t){this.type="polygon",this.points=t}get circumference(){if(this.points.length<=1)return 0;let t=x.distance(this.points[0],Rs(this.points));for(let e=1;e<this.points.length;++e)t+=x.distance(this.points[e-1],this.points[e]);return t}get signedArea(){let t=this.points,e=t.length,s=t[e-1].x*t[0].y-t[0].x*t[e-1].y;for(let n=1;n<e;++n)s+=t[n-1].x*t[n].y-t[n].x*t[n-1].y;return s/2}get area(){return Math.abs(this.signedArea)}get centroid(){let t=this.points,e=t.length,s=0;for(let r=0;r<e;++r)s+=t[r].x;let n=0;for(let r=0;r<e;++r)n+=t[r].y;return new x(s/e,n/e)}get edges(){let t=this.points,e=t.length,s=[];for(let n=0;n<e;++n)s.push(new Ie(t[n],t[(n+1)%e]));return s}get radius(){let t=this.centroid,e=this.points.map(s=>x.distance(s,t));return Math.max(...e)}get oriented(){if(this.signedArea>=0)return this;let t=[...this.points].reverse();return new this.constructor(...t)}cut(t){let e=[],s=[];for(let h of this.edges){let l=t.side(h.p1),u=t.side(h.p2);if(l&&u&&l!==u){let d=us(h,t)[0];e.push(new Ie(h.p1,d));let m=new Ie(d,h.p2);m.flag=u,e.push(m),s.push(m)}else l===0&&u&&(s.push(h),h.flag=u),e.push(h)}if(s.length<2)return[this];s.sort((h,l)=>t.offset(h.p1)-t.offset(l.p1));let n=(h,l)=>{let u=e.length,d=[];l<h&&(l+=u);for(let m=h;m<=l;m++)d.push(e[m%u]);return d},r=h=>{let l=e.length,u=e[h].flag,d=h;for(;;)if(d=(d+1)%l,e[d].flag===u&&(e[d].flag=void 0,s.splice(s.indexOf(e[d]),1)),d===h||e[d].flag)return d},o=[],a=0;for(;s.length>=2;){let h=s[0],l=s[1],u=e.indexOf(h),d=e.indexOf(l),m=!1;if(r(u)===d?m=!0:([h,l]=[l,h],[u,d]=[d,u],r(u)===d&&(m=!0)),m?(a--,o.push(n(u,d)),e=n(d,u),h.flag=l.flag=void 0,s.splice(0,2),s.length<2&&o.push(e)):(a++,s.reverse()),a>1)break}return o.map(h=>new ds(...h.map(l=>l.p1)))}static collision(t,e){if(t.points.some(s=>e.contains(s))||e.points.some(s=>t.contains(s)))return!0;for(let s of t.edges)for(let n of e.edges)if(us(s,n)[0])return!0;return!1}static regular(t,e=1){let s=ir/t,n=Math.PI/2-s/2,r=vh(o=>x.fromPolar(n+s*o,e),t);return new ds(...r)}static interpolate(t,e,s=.5){let n=t.points.map((r,o)=>x.interpolate(r,e.points[o],s));return new ds(...n)}contains(t){let e=!1;for(let s of this.edges){if(s.p1.equals(t)||s.contains(t))return!1;if(s.p1.y>t.y==s.p2.y>t.y)continue;let n=(s.p2.x-s.p1.x)/(s.p2.y-s.p1.y);t.x<n*(t.y-s.p1.y)+s.p1.x&&(e=!e)}return e}at(t){return x.interpolateList([...this.points,this.points[0]],t)}project(t){let e,s=Infinity;for(let n of this.edges){let r=n.project(t),o=x.distance(t,r);o<s&&(e=r,s=o)}return e||this.points[0]}transform(t){return new this.constructor(...this.points.map(e=>e.transform(t)))}rotate(t,e=Ns){if(rt(t,0))return this;let s=this.points.map(n=>n.rotate(t,e));return new this.constructor(...s)}reflect(t){let e=this.points.map(s=>s.reflect(t));return new this.constructor(...e)}scale(t,e=t){let s=this.points.map(n=>n.scale(t,e));return new this.constructor(...s)}shift(t,e=t){let s=this.points.map(n=>n.shift(t,e));return new this.constructor(...s)}translate(t){return this.shift(t.x,t.y)}equals(t){return!1}};var me=class{constructor(t,e=1,s=e){this.p=t,this.w=e,this.h=s,this.type="rectangle"}static aroundPoints(t){let e=Infinity,s=-Infinity,n=Infinity,r=-Infinity;for(let o of t)e=e<o.x?e:o.x,s=s>o.x?s:o.x,n=n<o.y?n:o.y,r=r>o.y?r:o.y;return new me(new x(e,n),s-e,r-n)}get center(){return new x(this.p.x+this.w/2,this.p.y+this.h/2)}get centroid(){return this.center}get circumference(){return 2*Math.abs(this.w)+2*Math.abs(this.h)}get area(){return Math.abs(this.w*this.h)}get edges(){return this.polygon.edges}get points(){return this.polygon.points}get polygon(){let t=new x(this.p.x+this.w,this.p.y),e=new x(this.p.x+this.w,this.p.y+this.h),s=new x(this.p.x,this.p.y+this.h);return new ds(this.p,t,e,s)}collision(t){return this.p.x<t.p.x+t.w&&this.p.x+this.w>t.p.x&&this.p.y<t.p.y+t.h&&this.p.y+this.h>t.p.y}contains(t,e){return Ut(t.x,this.p.x,this.p.x+this.w,e)&&Ut(t.y,this.p.y,this.p.y+this.h,e)}project(t){let e;for(let s of this.edges){let n=s.project(t);(!e||x.distance(t,n)<x.distance(t,e))&&(e=n)}return e}at(t){return this.p}transform(t){return this.polygon.transform(t)}rotate(t,e=Ns){return rt(t,0)?this:this.polygon.rotate(t,e)}reflect(t){return this.polygon.reflect(t)}scale(t,e=t){return new me(this.p.scale(t,e),this.w*t,this.h*e)}shift(t,e=t){return new me(this.p.shift(t,e),this.w,this.h)}translate(t){return this.shift(t.x,t.y)}equals(t){return!1}},fs=class{constructor(t,e,s,n){this.xMin=t,this.xMax=e,this.yMin=s,this.yMax=n}contains(t){return this.containsX(t)&&this.containsY(t)}containsX(t){return Ut(t.x,this.xMin,this.xMax)}containsY(t){return Ut(t.y,this.yMin,this.yMax)}resize(t,e){return new fs(this.xMin,this.xMax+t,this.yMin,this.yMax+e)}get dx(){return this.xMax-this.xMin}get dy(){return this.yMax-this.yMin}get xRange(){return[this.xMin,this.xMax]}get yRange(){return[this.yMin,this.yMax]}get rect(){return new me(new x(this.xMin,this.yMin),this.dx,this.dy)}get center(){return new x(this.xMin+this.dx/2,this.yMin+this.dy/2)}get flip(){return new fs(this.yMin,this.yMax,this.xMin,this.xMax)}};function Nh(i,t,e={}){if(e.fill&&(i.fillStyle=e.fill),e.opacity&&(i.globalAlpha=e.opacity),e.stroke&&(i.strokeStyle=e.stroke,i.lineWidth=e.strokeWidth||1,e.lineCap&&(i.lineCap=e.lineCap),e.lineJoin&&(i.lineJoin=e.lineJoin)),i.beginPath(),Gh(t))i.moveTo(t.p1.x,t.p1.y),i.lineTo(t.p2.x,t.p2.y);else if(ps(t))i.arc(t.c.x,t.c.y,t.r,0,ir);else if(Oh(t)){i.moveTo(t.points[0].x,t.points[0].y);for(let s of t.points.slice(1))i.lineTo(s.x,s.y);i.closePath()}else if(Ih(t)){i.moveTo(t.points[0].x,t.points[0].y);for(let s of t.points.slice(1))i.lineTo(s.x,s.y)}e.fill&&i.fill(),e.stroke&&i.stroke()}function nr(i,t,e){let n=t.x*(e.y-i.y)+i.x*(t.y-e.y)+e.x*(i.y-t.y)>0?1:0,r=x.distance(t,i);return[i.x,i.y+"A"+r,r,0,n,1,e.x,e.y].join(",")}function ed(i,t={}){return i.isRight&&!t.round?20:24+20*(1-fe(i.rad,0,Math.PI)/Math.PI)}function sd(i,t={}){let e=i.a,s=i.b,n=i.c,r=t.size||ed(i,t),o=x.difference(e,s).unitVector,a=x.difference(n,s).unitVector;e=x.sum(s,o.scale(r)),n=x.sum(s,a.scale(r));let h=t.fill?`M${s.x},${s.y}L`:"M";if(i.isRight&&!t.round){let l=x.sum(e,a.scale(r));h+=`${e.x},${e.y}L${l.x},${l.y}L${n.x},${n.y}`}else h+=nr(e,s,n);return t.fill&&(h+="Z"),h}function Ot(...i){return"M"+i.map(t=>t.x+","+t.y).join("L")}function Dh(i,t){let e=i.perpendicularVector.scale(6),s=i.unitVector.scale(3),n=i.midpoint;switch(t){case"bar":return Ot(n.add(e),n.add(e.inverse));case"bar2":return Ot(n.add(s).add(e),n.add(s).add(e.inverse))+Ot(n.add(s.inverse).add(e),n.add(s.inverse).add(e.inverse));case"arrow":return Ot(n.add(s.inverse).add(e),n.add(s),n.add(s.inverse).add(e.inverse));case"arrow2":return Ot(n.add(s.scale(-2)).add(e),n,n.add(s.scale(-2)).add(e.inverse))+Ot(n.add(e),n.add(s.scale(2)),n.add(e.inverse));default:return""}}function Di(i,t){if(!i||!t)return"";let e=t.perpendicular,s=i.add(t.scale(9)).add(e.scale(9)),n=i.add(t.scale(9)).add(e.scale(-9));return Ot(s,i,n)}function id(i,t){let e="";return Le(t,"start","both")&&(e+=Di(i.p1,i.unitVector)),Le(t,"end","both")&&(e+=Di(i.p2,i.unitVector.inverse)),e}function nd(i,t){let e="";if(Le(t,"start","both")){let s=new Jt(i.c,i.start).perpendicularVector.inverse;e+=Di(i.start,s)}if(Le(t,"end","both")){let s=new Jt(i.c,i.end).perpendicularVector;e+=Di(i.end,s)}return e}function rr(i,t={}){if(Ku(i))return sd(i,t);if(Gh(i)){if(i.p1.equals(i.p2))return"";let e=Ot(i.p1,i.p2);return t.mark&&(e+=Dh(i,t.mark)),t.arrows&&(e+=id(i,t.arrows)),e}if(Zu(i)){if(!t.box)return"";let e=us(i,t.box)[0];return e?Ot(i.p1,e):""}if(Wu(i)){if(!t.box)return"";let e=us(i,t.box);if(e.length<2)return"";let s=Ot(e[0],e[1]);return t.mark&&(s+=Dh(i,t.mark)),s}if(ps(i))return`M ${i.c.x-i.r} ${i.c.y} a ${i.r},${i.r} 0 1 0 ${2*i.r} 0 a ${i.r} ${i.r} 0 1 0 ${-2*i.r} 0`;if(Fu(i)){let e="M"+nr(i.start,i.c,i.end);return t.arrows&&(e+=nd(i,t.arrows)),e}return ju(i)?`M ${i.c.x} ${i.c.y} L ${nr(i.start,i.c,i.end)} Z`:Ih(i)?Ot(...i.points):Oh(i)?Ot(...i.points)+"Z":Uu(i)?Ot(...i.polygon.points)+"Z":""}function Qt(i,t,e,s){function n(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function a(u){try{l(s.next(u))}catch(d){o(d)}}function h(u){try{l(s.throw(u))}catch(d){o(d)}}function l(u){u.done?r(u.value):n(u.value).then(a,h)}l((s=s.apply(i,t||[])).next())})}function rd(i){let t=[];for(let e of Object.keys(i)){let s=i[e];if(e=encodeURIComponent(e),s==null){t.push(e);continue}s=Array.isArray(s)?s.join(","):""+s,s=s.replace(/(\r)?\n/g,`\r
`),s=encodeURIComponent(s),s=s.replace(/%20/g,"+"),t.push(e+"="+s)}return t.join("&")}function qh(i){i=i.replace(/^[?,&]/,"");let t=decodeURIComponent(i).split("&"),e={};return t.forEach(s=>{let n=s.split("=");e[n[0]]=n[1]}),e}function ne(i,t){return Qt(this,void 0,void 0,function*(){let e=t instanceof FormData,s={method:"POST",body:e?t:t?rd(t):void 0,headers:{"X-CSRF-Token":window.csrfToken||""}};e||(s.headers["Content-Type"]="application/x-www-form-urlencoded");let n=i.includes("?")?"&xhr=1":"?xhr=1",r=yield fetch(i+n,s);if(!r.ok)throw new Error(`Fetch error ${r.status}: ${i}`);return r.text()})}function qi(i,t=!1){return new Promise(e=>{let s=new Image;t||(s.crossOrigin="Anonymous"),s.onload=()=>e(s),s.src=i})}var qs=new Map;function zh(i,t){qs.has(i)?jn(qs.get(i),t,(e,s)=>Jn(e.concat(s))):qs.set(i,t)}function Bh(){if(!!window.navigator.onLine)for(let[i,t]of qs)qs.delete(i),ne(i,{data:JSON.stringify(t)}).catch(e=>{console.error("Failed to send POST request:",e),zh(i,t)})}var _h=Xn(Bh,5e3);window.addEventListener("online",_h);window.onbeforeunload=Bh;function Hh(i,t){zh(i,t),_h()}var nt;(function(i){i[i.Array=0]="Array",i[i.BinaryOp=1]="BinaryOp",i[i.Call=2]="Call",i[i.Conditional=3]="Conditional",i[i.Identifier=4]="Identifier",i[i.Literal=5]="Literal",i[i.Member=6]="Member",i[i.UnaryOp=7]="UnaryOp"})(nt||(nt={}));var Uh={"===":(i,t)=>i===t,"!==":(i,t)=>i!==t,"||":(i,t)=>i||t,"&&":(i,t)=>i&&t,"==":(i,t)=>i==t,"!=":(i,t)=>i!=t,"<=":(i,t)=>i<=t,">=":(i,t)=>i>=t,"**":(i,t)=>Math.pow(i,t),"<":(i,t)=>i<t,">":(i,t)=>i>t,"+":(i,t)=>i+t,"-":(i,t)=>i-t,"*":(i,t)=>i*t,"/":(i,t)=>i/t,"%":(i,t)=>i%t},Wh={"-":i=>-i,"+":i=>+i,"!":i=>!i},Zh={"||":1,"&&":2,"==":3,"!=":3,"===":3,"!==":3,"<":4,">":4,"<=":4,">=":4,"+":5,"-":5,"*":6,"/":6,"%":6,"**":7},Fh={true:!0,false:!1,undefined:void 0},od=/\s/,or=/[0-9]/,ar=/[a-zA-Zα-ωΑ-Ω$_]/,ad=/[0-9a-zA-Zα-ωΑ-Ω$_]/;function hd(i){let t=i.length,e=0;function s(g){throw new Error(`${g} at character ${e} of "${i}"`)}function n(){for(;od.test(i[e]);)e+=1}function r(){let g="";for(;or.test(i[e]);)g+=i[e++];if(i[e]===".")for(g+=i[e++];or.test(i[e]);)g+=i[e++];let y=i[e];if(y&&ar.test(y)){let v=g+i[e];s(`Variable names cannot start with a number (${v})`)}else y==="."&&s("Unexpected period");return{type:nt.Literal,value:parseFloat(g)}}function o(){let g=i[e];e+=1;let y=!1,v="";for(;e<t;){let B=i[e++];if(B===g){y=!0;break}v+=B}return y||s(`Unclosed quote after "${v}"`),{type:nt.Literal,value:v}}function a(){let g=i[e];for(ar.test(i[e])||s("Unexpected "+g),e+=1;e<t&&ad.test(i[e]);)g+=i[e++];return g in Fh?{type:nt.Literal,value:Fh[g]}:{type:nt.Identifier,name:g}}function h(g){let y=[],v=!1,B;for(;e<t;)if(i[e]===g){B&&y.push(B),v=!0,e+=1;break}else i[e]===","?(y.push(B||{type:nt.Literal,value:void 0}),e+=1):B=$();return v||s("Expected "+g),y}function l(){let g;if(i[e]==="("){if(e+=1,g=$(),n(),i[e]===")")return e+=1,g;s("Unclosed (")}else g=a();for(n();".[(".includes(i[e]);)i[e]==="."?(e++,n(),g={type:nt.Member,object:g,computed:!1,property:a()}):i[e]==="["?(e++,g={type:nt.Member,object:g,computed:!0,property:$()},n(),i[e]!=="]"&&s("Unclosed ["),e++):i[e]==="("&&(e++,g={type:nt.Call,args:h(")"),callee:g}),n();return g}function u(){n();for(let g of[3,2,1]){let y=i.substr(e,g);if(y in Uh)return e+=g,y}}function d(){n();let g=i[e];if(or.test(g)||g===".")return r();if(g==="'"||g==='"')return o();if(g==="[")return e+=1,{type:nt.Array,elements:h("]")};if(g in Wh)return e+=1,{type:nt.UnaryOp,operator:g,argument:d()};if(ar.test(g)||g==="(")return l();s("Expression parsing error")}function m(){let g=d(),y=u();if(!y)return g;let v=d();v||s("Expected expression after "+y);let B,Y=[g,y,v];for(;y=u();){let Ai=Zh[y],Is=y;for(;Y.length>2&&Ai<=Zh[Y[Y.length-2]];)v=Y.pop(),y=Y.pop(),g=Y.pop(),B={type:nt.BinaryOp,operator:y,left:g,right:v},Y.push(B);B=d(),B||s("Expected expression after "+Is),Y.push(Is,B)}let ue=Y.length-1;for(B=Y[ue];ue>1;)B={type:nt.BinaryOp,operator:Y[ue-1],left:Y[ue-2],right:B},ue-=2;return B}function $(){let g=m();if(n(),g&&i[e]==="?"){e+=1;let y=$();if(y||s("Expected expression"),n(),i[e]===":"){e++;let v=$();return v||s("Expected expression"),{type:nt.Conditional,test:g,consequent:y,alternate:v}}else s("Expected :")}else return g}let k=$();return e<i.length&&s(`Unexpected "${i[e]}"`),k}var zi=[void 0,void 0];function qt(i,t){switch(i.type){case nt.Array:let e=i.elements.map($=>qt($,t)[0]);return e.some($=>$===void 0)?zi:[e,void 0];case nt.BinaryOp:let s=qt(i.left,t)[0],n=qt(i.right,t)[0];return"+-**/%".includes(i.operator)&&(s===void 0||n===void 0)?zi:[Uh[i.operator](s,n),void 0];case nt.Call:let[r,o]=qt(i.callee,t),a=i.args.map($=>qt($,t)[0]);return a.some($=>$===void 0)||typeof r!="function"?zi:[r.apply(o,a),void 0];case nt.Conditional:let h=qt(i.consequent,t),l=qt(i.alternate,t);return qt(i.test,t)[0]?h:l;case nt.Identifier:return[t[i.name],void 0];case nt.Literal:return[i.value,void 0];case nt.Member:let u=qt(i.object,t)[0],d=i.computed?qt(i.property,t)[0]:i.property.name;return u?[u[d],u]:[void 0,void 0];case nt.UnaryOp:let m=qt(i.argument,t)[0];return m===void 0&&i.operator!=="!"?zi:[Wh[i.operator](m),void 0]}}function ot(i){let t=hd(i);return t?(e={})=>qt(t,e)[0]:(e={})=>{}}var ld=/\${([^}]+)}/g;function Bi(i){let t=i.split(ld),e=t.map((s,n)=>n%2?ot(s.replace(/×/g,"*")):void 0);return s=>t.map((n,r)=>{if(!(r%2))return n;let o=e[r](s);return typeof o=="number"&&o<0?"\u2013"+-o:o}).join("")}var zs="ontouchstart"in window,ms="onpointerdown"in window;function It(i){if(i.touches){let t=i.targetTouches.length?i.targetTouches:i.changedTouches;return new x(t[0].clientX,t[0].clientY)}else return new x(i.clientX||0,i.clientY||0)}function cd(i){return i.touches||[]}function zt(i,t){return It(i).transform(t.inverseTransformMatrix)}function jh(i,t){let e=It(i),s=t.bounds,n=(e.x-s.left)*t.canvasWidth/s.width,r=(e.y-s.top)*t.canvasHeight/s.height;return new x(n,r)}function pd(i){if(i instanceof PointerEvent&&i.pointerType==="mouse")return E(i.target);let t=It(i);return E(document.elementFromPoint(t.x,t.y)||void 0)}function ud(i){if(i._data.tapEvent)return;i._data.tapEvent=!0;let t;i.on("pointerdown",e=>t=It(e)),i.on("pointerup",e=>{if(!t)return;let s=It(e);x.distance(t,s)<6&&i.trigger("tap",e),t=void 0}),i.on("pointercancel",()=>t=void 0)}function dd(i){i._data.clickOutsideEvent||(i._data.clickOutsideEvent=!0,G.on("pointerdown",t=>{let e=E(t.target);e&&(e.equals(i)||e.hasParent(i))||i.trigger("clickOutside",t)}))}function Ge(i,t){let e=t.$box||i,s=It;e.type==="svg"?s=m=>zt(m,e.$ownerSVG):e.type==="canvas"&&(s=m=>jh(m,e));let n=t.justInside?i:G,r,o,a=!1,h=0;i.css("touch-action")==="auto"&&i.css("touch-action","none"),i.addClass("noselect");function l(m){m.handled||cd(m).length>1||(m.preventDefault(),a=!1,h=m.pointerId||0,n.on("pointermove",u),n.on("pointerstop",d),r=o=s(m),t.down&&t.down(r))}function u(m){if(!r||h&&m.pointerId!==h)return;m.preventDefault();let $=s(m);x.distance($,o)<.5||(!a&&t.start&&t.start(r),t.move&&t.move($,r,o),o=$,a=!0)}function d(m,$=!1){!r||h&&m.pointerId!==h||(m.preventDefault(),n.off("pointermove",u),n.off("pointerstop",d),t.up&&t.up(o,r),a&&t.end&&t.end(o,r),!a&&t.click&&!$&&t.click(r),r=void 0)}w.onKey("escape",()=>{if(!r)return;a&&t.move&&t.move(r,r,o),o=r;let m=document.createEvent("MouseEvent");m.pointerId=h,d(m,!0)}),i.on("pointerdown",l),t.justInside&&i.on("mouseleave",d),t.accessible&&(i.setAttr("tabindex","0"),document.addEventListener("keydown",m=>{if(![37,38,39,40].includes(m.keyCode)||i!==w.getActiveInput())return;let $=i.boxCenter,k=s({clientX:$.x,clientY:$.y}),g=m.keyCode===37?-25:m.keyCode===39?25:0,y=m.keyCode===38?-25:m.keyCode===40?25:0,v=k.shift(g,y);t.down&&t.down(k),t.start&&t.start(k),t.move&&t.move(v,k,k),t.end&&t.end(v,k)}))}function Kh(i,t){let e=It;i.type==="svg"?e=n=>zt(n,i.$ownerSVG):i.type==="canvas"&&(e=n=>jh(n,i));let s=!1;i.on("touchstart mouseenter",n=>{!s&&t.enter&&t.enter(),t.move&&t.move(e(n)),s=!0},{passive:!0}),i.on("pointermove",n=>{s&&t.move&&t.move(e(n))}),i.on("touchend mouseleave",()=>{s&&t.exit&&t.exit(),s=!1},{passive:!0})}function fd(i){if(i._data.scrollEvents)return;i._data.scrollEvents=!0;let t=!1,e;function s(){let h=i.scrollTop;if(h===e){t=!1;return}e=h,i.trigger("scroll",{top:e}),window.requestAnimationFrame(s)}function n(){t||window.requestAnimationFrame(s),t=!0}(i.type==="window"?window:i._el).addEventListener("scroll",n);function o(){window.addEventListener("touchmove",n),window.addEventListener("touchend",a)}function a(){window.removeEventListener("touchmove",n),window.removeEventListener("touchend",a)}i._el.addEventListener("touchstart",function(h){h.handled||o()})}function gs(i,t){let e=t.$clickTarget||i,s=0,n=!1,r=!1,o=!1;function a(){n||(t.enter&&t.enter(),n=!0)}function h(){!n||(clearTimeout(s),t.exit&&t.exit(),n=!1)}i.on("mouseover",()=>{t.preventMouseover&&t.preventMouseover()||(clearTimeout(s),s=Gi(()=>{a(),r=!0},t.delay))}),i.on("mouseout",()=>{!r||(clearTimeout(s),s=Gi(h,t.exitDelay||t.delay))}),e.on("focus",()=>{n||t.preventMouseover&&t.preventMouseover()||(clearTimeout(s),a(),o=!0)});let l=()=>{!o||(t.canFocusWithin?setTimeout(()=>{let u=w.getActiveInput();u&&u.hasParent(i)?u.one("blur",l):h()}):h())};e.on("blur",l),e.on("click",()=>{n&&!r?h():n||(a(),r=!1)}),i.on("clickOutside",h)}var hr;function md(i){for(let t of i){let e=t.isIntersecting?"enterViewport":"exitViewport";setTimeout(()=>E(t.target).trigger(e))}}function Xh(i){if(!i._data.intersectionEvents){if(i._data.intersectionEvents=!0,!window.IntersectionObserver){let t=!1;G.on("scroll",()=>{let e=i.isInViewport;t&&!e?(i.trigger("exitViewport"),t=!1):e&&!t&&(i.trigger("enterViewport"),t=!0)});return}hr||(hr=new IntersectionObserver(md)),hr.observe(i._el)}}function gd(i,t=!1){if(t&&(i._data.resizeObserver&&i._data.resizeObserver.disconnect(),i._data.resizeObserver=void 0),!i._data.resizeObserver){if(window.ResizeObserver){let e=new window.ResizeObserver(()=>i.trigger("resize"));e.observe(i._el),i._data.resizeObserver=e}else if(window.MutationObserver){let e=new MutationObserver(()=>i.trigger("resize"));e.observe(i._el,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),i._data.resizeObserver=e}}}function Yh(i){if(i._data.pointerPositionEvents)return;i._data.pointerPositionEvents=!0;let t=i.parent,e;t.on("pointerend",()=>e=void 0),t.on("pointermove",s=>{let n=e,r=pd(s);e=r.equals(i)||r.hasParent(i),n!=null&&e&&!n&&i.trigger("pointerenter",s),!e&&n&&i.trigger("pointerleave",s)})}function lr(i,t){t._data["_"+i]||(t._data["_"+i]=!0,ms?t.on(i.replace("mouse","pointer"),e=>{e.pointerType==="mouse"&&t.trigger(i,e)}):zs||t._el.addEventListener(i,e=>t.trigger(i,e)))}function wd(i){i.on("keydown",t=>{if(t.metaKey||t.ctrlKey||w.isAndroid&&t.keyCode===229)return;let e=(t.key||String.fromCharCode(t.which)).toLowerCase();i.trigger("key",{code:t.keyCode,key:e})}),w.isAndroid&&i.type==="input"&&i.on("input",t=>{let e=t.data[t.data.length-1].toLowerCase();i.trigger("key",{code:void 0,key:e}),i.value=""})}var _i={scrollwheel:"DOMMouseScroll mousewheel",pointerdown:ms?"pointerdown":zs?"touchstart":"mousedown",pointermove:ms?"pointermove":zs?"touchmove":"mousemove",pointerup:ms?"pointerup":zs?"touchend":"mouseup",pointercancel:ms?"pointercancel":"touchcancel",pointerstop:ms?"pointerup pointercancel":zs?"touchend touchcancel":"mouseup"},Hi={scroll:fd,tap:ud,clickOutside:dd,key:wd,mousedown:lr.bind(void 0,"mousedown"),mousemove:lr.bind(void 0,"mousemove"),mouseup:lr.bind(void 0,"mouseup"),pointerenter:Yh,pointerleave:Yh,enterViewport:Xh,exitViewport:Xh,resize:gd};function yd(i,t,e,s){if(t in Hi)Hi[t](i,!1);else if(t in _i){let n=Lt(_i[t]);for(let r of n)i._el.addEventListener(r,e,s)}else i._el.addEventListener(t,e,s)}function vd(i,t,e){if(t in Hi)(!i._events[t]||!i._events[t].length)&&Hi[t](i,!0);else if(e&&t in _i){let s=Lt(_i[t]);for(let n of s)i._el.removeEventListener(n,e)}else e&&i._el.removeEventListener(t,e)}function Ct(i,t){let e=new Map,s=new Map,n,r=0;function o(y){n=y;let v=y(g);return n=void 0,v}function a(y){for(let v of e.values())v.has(y)&&v.delete(y)}function h(y,v){s.has(y)&&a(s.get(y));let B=()=>{i[y]=v(g),n===B&&(n=void 0),l(y)};s.set(y,B),o(B)}function l(y){let v=e.get(y);if(v)for(let B of v)B(i)}function u(){for(let y of e.values())for(let v of y)v(i)}function d(y){Object.assign(i,y),u()}function m(){for(r+=1;"_x"+r in i;)r+=1;return"_x"+r}function $(){i={},e.clear(),s.clear(),r=0}function k(y){!t||t.watch(()=>g[y]=t[y])}let g=new Proxy(i,{get(y,v){return v==="watch"?o:v==="unwatch"?a:v==="setComputed"?h:v==="forceUpdate"?u:v==="assign"?d:v==="getKey"?m:v==="clear"?$:v==="_internal"?[i,e]:(n&&(e.has(v)||e.set(v,new Set),e.get(v).add(n)),v in i||k(v),i[v])},set(y,v,B){return i[v]===B||(i[v]=B,s.has(v)&&(a(s.get(v)),s.delete(v)),l(v)),!0},deleteProperty(y,v){return delete i[v],e.delete(v),s.delete(v),!0}});return g}var xd={A:7,C:6,H:1,L:2,M:2,Q:4,S:4,T:2,V:1,Z:0},$d=/[astvzqmhlc]([^astvzqmhlc]*)/ig,bd=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function cr(i){let t=[],e;for(let s of i.match($d)||[]){let n=s[0].toUpperCase();if(n==="Z"){t.push({type:"Z",points:[]});continue}let r=(s.slice(1).match(bd)||[]).map(a=>+a),o=n===s[0];for(let[a,h]of tr(r,xd[n]).entries()){let l=[],u=n==="M"&&a>0?"L":n,d;n==="H"?(u="L",l=[new x(h[0],o&&(e==null?void 0:e.y)||0)]):n==="V"?(u="L",l=[new x(o&&(e==null?void 0:e.x)||0,h[0])]):n==="A"?(u="A",l=[new x(h[5],h[6])],d=h.slice(0,5)):"MLCSQT".includes(n)&&(l=tr(h,2).map(m=>new x(m[0],m[1]))),!o&&e&&(l=l.map(m=>m.translate(e))),e=Rs(l),t.push({type:u,points:l,options:d})}}return t}function Re(i){return i?cr(i).map(e=>Rs(e.points)).filter(e=>!!e):[]}var Bs=class{constructor(t){this._el=t,this._data={},this._events={},this.type="default",t._view=this}get id(){return this._el.id}get data(){return this._el.dataset}get tagName(){return this._el.tagName.toUpperCase()}equals(t){return this._el===t._el}addClass(t){for(let e of Lt(t))this._el.classList.add(e)}removeClass(t){for(let e of Lt(t))this._el.classList.remove(e)}hasClass(t){return this._el.classList.contains(t)}toggleClass(t){return this._el.classList.toggle(t)}setClass(t,e){e?this.addClass(t):this.removeClass(t)}attr(t){return this._el.getAttribute(t)||""}hasAttr(t){return this._el.hasAttribute(t)}setAttr(t,e){e===void 0?this.removeAttr(t):this._el.setAttribute(t,e.toString())}removeAttr(t){this._el.removeAttribute(t)}get attributes(){return Array.from(this._el.attributes||[])}get html(){return this._el.innerHTML||""}set html(t){this._el.innerHTML=t}get text(){return this._el.textContent||""}set text(t){this._el.textContent=t}set textStr(t){this._el.textContent=""+t}blur(){this._el.blur()}focus(){this._el.focus()}getParentModel(){let t=this.parent;return t?t.model||t.getParentModel():void 0}bindModel(t,e=!0){var s;if(!this.model){if(this.model=t,this.hasAttr(":for"))return this.makeDynamicList(t);for(let{name:n,value:r}of this.attributes)this.makeDynamicAttribute(n,r,t);for(let n of this.childNodes)if(n instanceof Text){if((s=n.textContent)===null||s===void 0?void 0:s.includes("${")){let r=Bi(n.textContent);t.watch(()=>n.textContent=r(t)||"")}}else e&&n.bindModel(t)}}bindVariable(t,e){}makeDynamicAttribute(t,e,s){if(t.startsWith("@")){let n=t.slice(1),r=ot(e);this.on(n,()=>r(s))}else if(t===":show"){let n=ot(e);s.watch(()=>this.toggle(!!n(s)))}else if(t===":if"){let n=ot(e),r=E(document.createComment(""));this.insertBefore(r);let o=!0;s.watch(()=>{let a=!!n(s);a!==o&&(a&&r.insertBefore(this),a||this.detach(),o=a)})}else if(t===":html"){let n=ot(e);s.watch(()=>this.html=n(s)||"")}else if(t===":draw"){let n=ot(e);s.watch(()=>this.draw(n(s)))}else if(t===":class"){let n=ot(e),r=this.attr("class")+" ";s.watch(()=>this.setAttr("class",r+n(s)))}else if(t===":bind")this.bindVariable(s,e);else if(t.startsWith(":")){let n=ot(e),r=t.slice(1);s.watch(()=>this.setAttr(r,n(s)))}else if(e.includes("${")){let n=Bi(e);s.watch(()=>this.setAttr(t,n(s)||""))}(t.startsWith("@")||t.startsWith(":"))&&this.removeAttr(t)}makeDynamicList(t){let[e,s]=this.attr(":for").split(" in ");this.removeAttr(":for");let n=ot(s),r=E(document.createComment(""));this.insertBefore(r),this.detach();let o=[],a=0;t.watch(()=>{let h=n(t);Array.isArray(h)||(h=[]);for(let l=h.length;l<a;++l)o[l].detach();for(let l=a;l<o.length;++l)r.insertBefore(o[l]);for(let l=o.length;l<h.length;++l){let u=this.copy(!0);u.bindModel(Ct({[e]:void 0},t)),r.insertBefore(u),o.push(u)}a=h.length;for(let l=0;l<a;++l)o[l].model[e]=h[l]})}get bounds(){return this._el.getBoundingClientRect()}get boundsRect(){let t=this.bounds;return new me(new x(t.x,t.y),t.width,t.height)}contains(t){this.boundsRect.contains(t)}get isInViewport(){if(this.height===0)return!1;let t=this.bounds;return Ut(t.top,-t.height,w.height)}get topLeftPosition(){let t=this.bounds;return new x(t.left,t.top)}get boxCenter(){let t=this.bounds;return new x(t.left+t.width/2,t.top+t.height/2)}get scrollWidth(){return this._el.scrollWidth}get scrollHeight(){return this._el.scrollHeight}get scrollTop(){return this._el.scrollTop}set scrollTop(t){this._el.scrollTop=t,this.trigger("scroll",{top:t,left:this.scrollLeft})}get scrollLeft(){return this._el.scrollLeft}set scrollLeft(t){this._el.scrollLeft=t,this.trigger("scroll",{top:this.scrollTop,left:t})}scrollTo(t,e=1e3,s="cubic"){t<0&&(t=0);let n=this.scrollTop,r=t-n;this._data.scrollAnimation&&this._data.scrollAnimation.cancel(),this._data.scrollAnimation=j(o=>{let a=n+r*K(s,o);this.scrollTop=a,this.trigger("scroll",{top:a})},e)}scrollBy(t,e=1e3,s="cubic"){!t||this.scrollTo(this.scrollTop+t,e,s)}css(t,e){if(e===void 0){if(typeof t=="string")return window.getComputedStyle(this._el).getPropertyValue(t);{let s=Object.keys(t);for(let n of s)this._el.style.setProperty(n,""+t[n])}}else typeof t=="string"&&this._el.style.setProperty(t,""+e)}get transform(){return this.css("transform").replace("none","")}get transformMatrix(){let t=this.transform;if(!t)return[[1,0,0],[0,1,0]];let e=t.match(/matrix\(([0-9,.\s-]*)\)/);if(!e||!e[1])return[[1,0,0],[0,1,0]];let s=e[1].split(",");return[[+s[0],+s[2],+s[4]],[+s[1],+s[3],+s[5]]]}get scale(){let t=this.transformMatrix;return[t[0][0],t[1][1]]}setTransform(t,e=0,s=1){let n="";t&&(n+=`translate(${de(t.x,.1)}px,${de(t.y,.1)}px)`),e&&(n+=` rotate(${e}rad)`),s&&(n+=` scale(${s})`),this._el.style.transform=n}translate(t,e){this.setTransform(new x(t,e))}show(){this.hasAttr("hidden")&&this.removeAttr("hidden"),this.data.display==="visibility"?this._el.style.visibility="visible":this._el.style.display=this.data.display||"block"}hide(){this.data.display==="visibility"?this._el.style.visibility="hidden":this._el.style.display="none"}toggle(t){t?this.show():this.hide()}is(t){return this._el.matches?this._el.matches(t):Array.from(document.querySelectorAll(t)).includes(this._el)}index(){let t=0,e=this._el;for(;(e=e.previousSibling||void 0)!==void 0;)++t;return t}prepend(t){let e=this._el.childNodes;e.length?this._el.insertBefore(t._el,e[0]):this._el.appendChild(t._el)}append(t){this._el.appendChild(t instanceof Text?t:t._el)}insertBefore(t){this.parent._el.insertBefore(t._el,this._el)}insertAfter(t){let e=this._el.nextSibling;e?this.parent._el.insertBefore(t._el,e):this.parent._el.appendChild(t._el)}get next(){return E(this._el.nextSibling)}get prev(){return E(this._el.previousSibling)}$(t){return E(t,this)}$$(t){return te(t,this)}get parent(){return E(this._el.parentElement||void 0)}parents(t){let e=[],s=this.parent;for(;s;)(!t||s.is(t))&&e.push(s),s=s.parent;return e}hasParent(...t){let e=t.map(n=>n._el),s=this._el.parentNode;for(;s;){if(Le(s,...e))return!0;s=s.parentNode}return!1}get children(){return Array.from(this._el.children||[],t=>E(t))}get childNodes(){return Array.from(this._el.childNodes,t=>{if(!(t instanceof Comment))return t instanceof Text?t:E(t)}).filter(t=>t)}detach(){this._el&&this._el.parentNode&&this._el.parentNode.removeChild(this._el)}remove(){this.detach()}removeChildren(){for(;this._el.firstChild;)this._el.removeChild(this._el.firstChild)}on(t,e,s){for(let n of Lt(t))n in this._events?this._events[n].includes(e)||this._events[n].push(e):this._events[n]=[e],yd(this,n,e,s)}one(t,e,s){let n=r=>{this.off(t,n),e(r)};this.on(t,n,s)}off(t,e){for(let s of Lt(t))s in this._events&&(this._events[s]=e?this._events[s].filter(n=>n!==e):[]),vd(this,s,e)}trigger(t,e={}){for(let s of Lt(t)){if(!this._events[s])return;for(let n of this._events[s])n.call(this,e)}}onKeyDown(t,e){let s=Lt(t).map(n=>ws[n]||n);this._el.addEventListener("keydown",n=>{s.indexOf(n.keyCode)>=0&&e(n)})}onAttr(t,e){new MutationObserver(n=>{for(let r of n)r.type==="attributes"&&r.attributeName===t&&e(this.attr(t))}).observe(this._el,{attributes:!0}),e(this.attr(t),!0)}onPromise(t,e=!1){return e?Promise.resolve():new Promise(s=>this.one("solve",()=>s()))}animate(t,e=400,s=0,n="ease-in-out"){return St(this,t,e,s,n)}enter(t="fade",e=500,s=0){return Pd(this,t,e,s)}exit(t="fade",e=500,s=0,n=!1){return Md(this,t,e,s,n)}effect(t){this.one("animationend",()=>this.removeClass("effects-"+t)),this.addClass("effects-"+t)}copy(t=!0,e=!0,s){let n=E(this._el.cloneNode(t));return e&&n.copyInlineStyles(this,t,s),n}copyInlineStyles(t,e=!0,s){let n=window.getComputedStyle(t._el);for(let r of s||Array.from(n))this.css(r,n.getPropertyValue(r));if(e){let r=this.children,o=t.children;for(let a=0;a<r.length;++a)r[a].copyInlineStyles(o[a],!0,s)}}},ge=class extends Bs{get offsetTop(){return this._el.offsetTop}get offsetLeft(){return this._el.offsetLeft}get offsetParent(){return E(this._el.offsetParent||void 0)}get width(){return this._el.offsetWidth}get height(){return this._el.offsetHeight}get innerWidth(){let t=parseFloat(this.css("padding-left")),e=parseFloat(this.css("padding-right"));return this._el.clientWidth-t-e}get innerHeight(){let t=parseFloat(this.css("padding-bottom")),e=parseFloat(this.css("padding-top"));return this._el.clientHeight-t-e}get outerWidth(){let t=parseFloat(this.css("margin-left")),e=parseFloat(this.css("margin-right"));return this.width+t+e||0}get outerHeight(){let t=parseFloat(this.css("margin-bottom")),e=parseFloat(this.css("margin-top"));return this.height+t+e||0}get positionTop(){let t=this._el,e=0;for(;t;)e+=t.offsetTop,t=t.offsetParent;return e}get positionLeft(){let t=this._el,e=0;for(;t;)e+=t.offsetLeft,t=t.offsetParent;return e}offset(t){if(t._el===this._el.offsetParent){let e=this.offsetTop+t._el.clientTop,s=this.offsetLeft+t._el.clientLeft,n=e+this.height,r=s+this.width;return{top:e,left:s,bottom:n,right:r}}else{let e=t._el.getBoundingClientRect(),s=this._el.getBoundingClientRect();return{top:s.top-e.top,left:s.left-e.left,bottom:s.bottom-e.top,right:s.right-e.left}}}},Sd=["font-family","font-size","font-style","font-weight","letter-spacing","text-decoration","color","display","visibility","alignment-baseline","baseline-shift","text-anchor","clip","clip-path","clip-rule","mask","opacity","filter","fill","fill-rule","marker","marker-start","marker-mid","marker-end","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-width","text-rendering","transform"],pr=class extends Bs{constructor(){super(...arguments);this.type="svg"}get $ownerSVG(){return E(this._el.ownerSVGElement||void 0)}get width(){return this.bounds.width}get height(){return this.bounds.height}get positionLeft(){let t=this._el.getBBox().x+this._el.getCTM().e;return this.$ownerSVG.positionLeft+t}get positionTop(){let t=this._el.getBBox().y+this._el.getCTM().f;return this.$ownerSVG.positionTop+t}get inverseTransformMatrix(){let t=this._el.getScreenCTM().inverse(),e=[[t.a,t.c,t.e],[t.b,t.d,t.f]];if(w.isFirefox){let s=this.transformMatrix;e[0][2]-=s[0][2],e[1][2]-=s[1][2]}return e}setTransform(t,e=0,s=1){let n=t?`translate(${de(t.x,.1)} ${de(t.y,.1)})`:"",r=rt(e,0)?"":`rotate(${e*180/Math.PI})`,o=rt(s,1)?"":`scale(${s})`;this.setAttr("transform",[n,r,o].join(" "))}get strokeLength(){if(this._el instanceof SVGGeometryElement)return this._el.getTotalLength();{let t=this.bounds;return 2*t.height+2*t.width}}getPointAtLength(t){if(this._el instanceof SVGGeometryElement){let e=this._el.getPointAtLength(t);return new x(e.x,e.y)}else return new x(0,0)}getPointAt(t){return this.getPointAtLength(t*this.strokeLength)}get points(){return Re(this.attr("d"))}set points(t){let e=t.length?"M"+t.map(s=>s.x+","+s.y).join("L"):"";this.setAttr("d",e)}addPoint(t){let e=this.attr("d")+" L "+t.x+","+t.y;this.setAttr("d",e)}get center(){let t=+this.attr(this.tagName==="TEXT"?"x":"cx"),e=+this.attr(this.tagName==="TEXT"?"y":"cy");return new x(t,e)}setCenter(t){this.setAttr(this.tagName==="TEXT"?"x":"cx",t.x),this.setAttr(this.tagName==="TEXT"?"y":"cy",t.y)}setLine(t,e){this.setAttr("x1",t.x),this.setAttr("y1",t.y),this.setAttr("x2",e.x),this.setAttr("y2",e.y)}setRect(t){this.setAttr("x",t.p.x),this.setAttr("y",t.p.y),this.setAttr("width",t.w),this.setAttr("height",t.h)}draw(t,e={}){if(!t)return this.setAttr("d","");let s={mark:this.attr("mark"),arrows:this.attr("arrows"),size:+this.attr("size")||void 0,fill:this.hasClass("fill"),round:this.hasAttr("round")};this.setAttr("d",rr(t,Fn(e,s)))}},Jh=class extends pr{get viewBox(){return this._el.viewBox.baseVal||{width:0,height:0}}get $ownerSVG(){return this}get positionLeft(){return parseInt(this.css("margin-left"))+this.parent.positionLeft}get positionTop(){return parseInt(this.css("margin-top"))+this.parent.positionTop}get svgWidth(){return this.viewBox.width||this.width}get svgHeight(){return this.viewBox.height||this.height}drawPath(t,e={},s={}){let n=c("path",e,this);return n.draw(t,s),n}pngImage(t,e,s){return Qt(this,void 0,void 0,function*(){let n=this.copy(!0,!0,Sd);e||(e=t||this.svgHeight),t||(t=this.svgWidth),n.setAttr("width",t),n.setAttr("height",e),n.setAttr("viewBox",s||this.attr("viewBox")||`0 0 ${this.svgWidth} ${this.svgHeight}`),n.setAttr("xmlns","http://www.w3.org/2000/svg");let r=n.$$('image[href^="http"]');yield Promise.all(r.map(u=>Qt(this,void 0,void 0,function*(){let d=yield qi(u.attr("href")),m=c("canvas",{width:d.width,height:d.height});m.ctx.drawImage(d,0,0,d.width,d.height);let $=yield m.pngImage;u.setAttr("href",$)})));let o=new XMLSerializer().serializeToString(n._el),a="data:image/svg+xml;utf8,"+encodeURIComponent(o),h=c("canvas",{width:t,height:e});h.ctx.fillStyle=ft.css("background-color")||"white",h.ctx.fillRect(0,0,t,e);let l=yield qi(a);return h.ctx.drawImage(l,0,0,t,e),h.pngImage})}downloadImage(t,e,s,n){let r=w.isIOS?window.open("","_blank"):void 0;this.pngImage(e,s,n).then(o=>{if(r)return r.location.href=o;c("a",{download:t,href:o,target:"_blank"})._el.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))})}},ur=class extends ge{constructor(){super(...arguments);this.type="window"}get width(){return window.innerWidth}get height(){return window.innerHeight}get innerWidth(){return window.innerWidth}get innerHeight(){return window.innerHeight}get outerWidth(){return window.outerWidth}get outerHeight(){return window.outerHeight}get scrollWidth(){return document.body.scrollWidth}get scrollHeight(){return document.body.scrollHeight}get scrollTop(){return window.pageYOffset}set scrollTop(t){document.body.scrollTop=document.documentElement.scrollTop=t,this.trigger("scroll",{top:t,left:this.scrollLeft})}get scrollLeft(){return window.pageXOffset}set scrollLeft(t){document.body.scrollLeft=document.documentElement.scrollLeft=t,this.trigger("scroll",{top:this.scrollTop,left:t})}},Qh=class extends ge{constructor(){super(...arguments);this.type="form"}get action(){return this._el.action}get formData(){let t={};for(let e of Array.from(this._el.elements)){let s=e.name||e.id;s&&(t[s]=e.value)}return t}get isValid(){return this._el.checkValidity()}},tl=class extends ge{constructor(){super(...arguments);this.type="input"}get checked(){return this._el.checked||!1}set checked(t){this._el.checked=t}get value(){return this._el.value}set value(t){this._el.value=t}bindVariable(t,e){let s=this._el.type==="number",n=this._el.type==="checkbox";if(e in t?n?this.checked=t[e]:this.value=t[e]:this.value&&(n?t[e]=this.checked:t[e]=this.value),s){let r=this.hasAttr("min")?+this.attr("min"):-Infinity,o=this.hasAttr("max")?+this.attr("max"):Infinity;this.change(a=>t[e]=fe(+a,r,o)),this.on("blur",()=>this.value=t[e])}else n?this.on("change",()=>t[e]=this.checked):this.change(r=>t[e]=r);t.watch(()=>{n?this.checked=t[e]:this.value=t[e]})}setInputPattern(t){if(isNaN(+t))return;let e=t.match(/^[0-9]+$/);this.setAttr("inputmode",e?"numeric":"decimal"),e&&this.setAttr("pattern","[0-9]*")}change(t){let e=this.value||"";this.on("change keyup input paste",()=>{this.value!==e&&(e=this.value.trim(),t(e))})}validate(t){this.change(e=>this.setValidity(t(e)))}setValidity(t){this._el.setCustomValidity(t)}get isValid(){return this._el.checkValidity()}},el=class extends ge{constructor(){super(...arguments);this.type="canvas"}getContext(t="2d",e={}){return this._el.getContext(t,e)}get pngImage(){return this._el.toDataURL("image/png")}get canvasWidth(){return this._el.width}get canvasHeight(){return this._el.height}get ctx(){return this._ctx||(this._ctx=this.getContext()),this._ctx}draw(t,e={}){this.ctx.save(),Nh(this.ctx,t,e),this.ctx.restore()}clear(){this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight)}fill(t){this.ctx.save(),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.restore()}clearCircle(t,e){this.ctx.save(),this.ctx.globalCompositeOperation="destination-out",this.ctx.beginPath(),this.ctx.arc(t.x,t.y,e,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.restore()}downloadImage(t){let e=this.pngImage;c("a",{download:t,href:e,target:"_blank"})._el.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))}},sl=class extends ge{play(){return this._el.play()||Promise.resolve()}pause(){return this._el.pause()}},il=["path","rect","circle","ellipse","polygon","polyline","g","defs","marker","line","text","tspan","pattern","mask","svg","foreignObject","image","use"];function E(i,t){if(!i)return;let e=t?t._el:document.documentElement,s=typeof i=="string"?e.querySelector(i):i;if(!s)return;if(s._view)return s._view;let n=(s.tagName||"").toLowerCase();return n==="svg"?new Jh(s):n==="canvas"?new el(s):n==="form"?new Qh(s):n==="input"||n==="select"||n==="textarea"?new tl(s):n==="video"||n==="audio"?new sl(s):il.includes(n)?new pr(s):new ge(s)}function te(i,t){let e=t?t._el:document.documentElement,s=i?e.querySelectorAll(i):[];return Array.from(s,n=>E(n))}function c(i,t={},e){let s=il.includes(i)?document.createElementNS("http://www.w3.org/2000/svg",i):document.createElement(i);for(let[r,o]of Object.entries(t))o!==void 0&&(r==="id"?s.id=o:r==="html"?s.innerHTML=o:r==="text"?s.textContent=o:r==="path"?s.setAttribute("d",rr(o)):s.setAttribute(r,o));let n=E(s);return e&&e.append(n),n}var G=new ur(document.body),ft=new ur(document.documentElement),ws={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46},Ui="_M",ys=window.navigator.userAgent.toLowerCase(),nl={};for(let[i,t]of Object.entries(ws))nl[t]=i;var Td=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i,rl=/iphone|ipad|ipod/i,Vd=/^((?!chrome|android).)*safari/i,ol=class{constructor(){var t,e,s;this.isMobile=Td.test(ys),this.isRetina=(window.devicePixelRatio||1)>1,this.isTouch=!!window.Touch||"ontouchstart"in window,this.isChrome=!!window.chrome,this.isFirefox=ys.indexOf("firefox")>=0,this.isAndroid=ys.indexOf("android")>=0,this.isIOS=rl.test(ys),this.isSafari=rl.test(ys)||Vd.test(ys),this.loadQueue=[],this.loaded=!1,this.width=window.innerWidth,this.height=window.innerHeight,this.resizeCallbacks=[],this.theme={name:"light",isDark:!1},this.themeChangedCallbacks=[],this.themeOverride="",this.darkQuery=(t=window.matchMedia)===null||t===void 0?void 0:t.call(window,"(prefers-color-scheme: dark)"),window.onload=()=>this.afterLoad(),document.addEventListener("DOMContentLoaded",()=>this.afterLoad());let n=Xn(()=>this.applyResize());window.addEventListener("resize",n);try{(e=this.darkQuery)===null||e===void 0||e.addEventListener("change",()=>this.applyThemeChange())}catch(o){(s=this.darkQuery)===null||s===void 0||s.addListener(()=>this.applyThemeChange())}let r=this.getCookie("theme");r&&this.setTheme(r);try{this.localStorage=window.localStorage}catch(o){console.warn("Unable to access Local Storage in this context.")}}afterLoad(){if(!this.loaded){this.loaded=!0;for(let t of this.loadQueue)t();setTimeout(()=>this.resize())}}ready(t){this.loaded?t():this.loadQueue.push(t)}redraw(){document.body.offsetHeight}applyResize(){let t=window.innerWidth,e=window.innerHeight;if(!(this.width===t&&this.height===e)){this.width=t,this.height=e;for(let s of this.resizeCallbacks)s({width:this.width,height:this.height});G.trigger("scroll",{top:G.scrollTop})}}onResize(t){t({width:this.width,height:this.height}),this.resizeCallbacks.push(t)}offResize(t){let e=this.resizeCallbacks.indexOf(t);e>=0&&this.resizeCallbacks.splice(e,1)}resize(){this.applyResize()}applyThemeChange(){let t=this.theme.name,e=t==="dark"||t==="auto"&&this.darkQuery.matches;if(e!==this.theme.isDark){this.theme.isDark=e,ft.setAttr("theme",this.themeOverride||(e?"dark":"light"));for(let s of this.themeChangedCallbacks)s(this.theme)}}setTheme(t){t!==this.theme.name&&(this.theme.name=t,this.setCookie("theme",t),this.applyThemeChange())}onThemeChange(t){this.themeChangedCallbacks.push(t)}getHash(){return window.location.hash.slice(1)}setHash(t){let e=document.body.scrollTop;window.location.hash=t,document.body.scrollTop=e}setURL(t,e=""){window.history.replaceState({},e,t),e&&(window.document.title=e)}getCookies(){let t=document.cookie.split(";"),e={};for(let s=0,n=t.length;s<n;++s){let r=t[s].split("=");e[decodeURIComponent(r[0]).trim()]=decodeURIComponent(r[1])}return e}getCookie(t){let e=document.cookie.match(new RegExp(`(^|;) ?${t}=([^;]*)(;|$)`));return e?e[2]:void 0}setCookie(t,e,s=60*60*24*365){let n=window.location.hostname.replace(/^[a-z]{2}\./,"");document.cookie=`${t}=${e};path=/;max-age=${s};domain=${n}`}deleteCookie(t){this.setCookie(t,"",-1)}setStorage(t,e){var s,n;let r=(t||"").split("."),o=Yn(((s=this.localStorage)===null||s===void 0?void 0:s.getItem(Ui))||void 0),a=o;for(let h=0;h<r.length-1;++h)a[r[h]]==null&&(a[r[h]]={}),a=a[r[h]];a[r[r.length-1]]=e,(n=this.localStorage)===null||n===void 0||n.setItem(Ui,JSON.stringify(o))}getStorage(t){var e;let s=Yn(((e=this.localStorage)===null||e===void 0?void 0:e.getItem(Ui))||void 0);if(!t)return s;let n=(t||"").split("."),r=n.pop();for(let o of n){if(!(o in s))return;s=s[o]}return s[r]}deleteStorage(t){var e;t?this.setStorage(t,void 0):(e=this.localStorage)===null||e===void 0||e.setItem(Ui,"")}getActiveInput(){let t=document.activeElement;return t===document.body?void 0:E(t)}onKey(t,e,s=!1){let n=Lt(t),r=s?"keyup":"keydown";document.addEventListener(r,o=>{let a=nl[o.keyCode]||o.key;if(!n.includes(a))return;let h=this.getActiveInput();h&&h.is("input, textarea, [contenteditable]")||h&&["space","enter","tab"].includes(a)&&h.is("button, a, [tabindex]")||e(o,a)})}},w=window.BoostBrowser||new ol;window.BoostBrowser=w;var Ed=/\bTrident\/[567]\b|\bMSIE (?:9|10)\.0\b/,Ad=/\bAppleWebKit\/(\d+)\b/,Cd=/\bEdge\/12\.(\d+)\b/,kd=Ed.test(navigator.userAgent)||+(navigator.userAgent.match(Cd)||[])[1]<10547||+(navigator.userAgent.match(Ad)||[])[1]<537,dr={};function Ld(){if(!kd)return;Array.from(document.querySelectorAll("svg > use")).forEach(function(t){let e=t.getAttribute("xlink:href"),[s,n]=e.split("#");if(!s.length||!n)return;let r=t.parentNode;r.removeChild(t),s in dr||(dr[s]=fetch(s).then(a=>a.text())),dr[s].then(a=>{let h=document.implementation.createHTMLDocument("");h.documentElement.innerHTML=a;let u=h.getElementById(n).cloneNode(!0),d=document.createDocumentFragment();for(;u.childNodes.length;)d.appendChild(u.firstChild);r.appendChild(d)})})}function al(){document.addEventListener("keydown",i=>{if(i.keyCode===ws.enter||i.keyCode===ws.space){let t=w.getActiveInput();t&&t.hasAttr("tabindex")&&t.tagName!=="TEXTAREA"&&(i.preventDefault(),t.trigger("pointerdown",i),t.trigger("pointerstop",i),G.trigger("pointerstop",i),t.trigger("click",i))}})}var Wi=!1;setTimeout(()=>Wi=!0);var Od="cubic-bezier(0.175, 0.885, 0.32, 1.275)",Id="cubic-bezier(0.68, -0.275, 0.825, 0.115)",Ne={cancel:()=>{},promise:Promise.resolve()};function j(i,t){if(t===0)return i(1,0,()=>{}),Ne;let e=Date.now(),s=Kn(),n=0,r=!0,o=()=>{r=!1,s.reject()};function a(){r&&(!t||n<=t)&&window.requestAnimationFrame(a);let h=Date.now()-e;i(t?Math.min(1,h/t):h,h-n,o),t&&h>=t&&s.resolve(),n=h}return a(),{cancel:o,promise:s.promise}}function Zi(i,t=0,e=0){switch(i){case"quad":return Math.pow(t,2);case"cubic":return Math.pow(t,3);case"quart":return Math.pow(t,4);case"quint":return Math.pow(t,5);case"circ":return 1-Math.sqrt(1-Math.pow(t,2));case"sine":return 1-Math.cos(t*Math.PI/2);case"exp":return t<=0?0:Math.pow(2,10*(t-1));case"back":return e||(e=1.70158),t*t*((e+1)*t-e);case"elastic":return e||(e=.3),-Math.pow(2,10*(t-1))*Math.sin(((t-1)*2/e-.5)*Math.PI);case"swing":return .5-Math.cos(t*Math.PI)/2;case"spring":return 1-Math.cos(t*4.5*Math.PI)*Math.exp(-t*6);case"bounce":return t<1/11?1/64-7.5625*(.5/11-t)*(.5/11-t):t<3/11?1/16-7.5625*(2/11-t)*(2/11-t):t<7/11?1/4-7.5625*(5/11-t)*(5/11-t):1-7.5625*(1-t)*(1-t);default:return t}}function K(i,t=0,e=0){if(t===0)return 0;if(t===1)return 1;let[s,n]=i.split("-");return n==="in"?Zi(s,t,e):n==="out"?1-Zi(s,1-t,e):t<=.5?Zi(s,2*t,e)/2:1-Zi(s,2*(1-t),e)/2}function St(i,t,e=400,s=0,n="ease-in-out"){if(!Wi)return Object.keys(t).forEach(g=>{let y=t[g];i.css(g,Array.isArray(y)?y[1]:y)}),Ne;n==="bounce-in"&&(n=Od),n==="bounce-out"&&(n=Id);let r="";w.isSafari&&(r=i._el.style.transition,i.css("transition","none"),w.redraw());let o=i._data.animation;o&&o.cancel();let a={},h={},l=Kn(),u=window.getComputedStyle(i._el);Object.keys(t).forEach(g=>{let y=t[g],v=xh(g);h[v]=Array.isArray(y)?y[0]:u.getPropertyValue(g),a[v]=Array.isArray(y)?y[1]:y,s&&i.css(g,h[v])});let d=a.height;a.height==="auto"&&(a.height=Oe(i.children.map(g=>g.outerHeight))+"px");let m,$=!1;Gi(()=>{$||(m=i._el.animate([h,a],{duration:e,easing:n,fill:"forwards"}),m.onfinish=()=>{i._el&&Object.keys(t).forEach(g=>i.css(g,g==="height"?d:a[g])),w.isSafari&&i.css("transition",r),l.resolve(),m.cancel()})},s);let k={cancel(){$=!0,i._el&&Object.keys(t).forEach(g=>i.css(g,i.css(g))),m&&m.cancel()},promise:l.promise};return setTimeout(()=>i._data.animation=k),k}var Gd=/matrix\([0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,([0-9.\-\s]+),([0-9.\-\s]+)\)/;function Pd(i,t="fade",e=500,s=0){if(i.show(),!Wi)return Ne;let n=+i.css("opacity")||1;if(t==="fade")return St(i,{opacity:[0,n]},e,s);if(t==="pop"){let r=i.transform.replace(/scale\([0-9.]*\)/,"").replace(Gd,"translate($1px,$2px)");return St(i,{opacity:[0,n]},e,s),St(i,{transform:[r+" scale(0.5)",r+" scale(1)"]},e,s,"bounce-in")}else{if(t==="descend")return St(i,{opacity:[0,1],transform:["translateY(-50%)","none"]},e,s);if(t.startsWith("draw")){let r=i.strokeLength;i.css("stroke-dasharray",r+"px"),i.css("opacity")||i.css("opacity",1);let o=t==="draw-reverse"?2*r+"px":0,a={"stroke-dashoffset":[r+"px",o]},h=St(i,a,e,s,"linear");return h.promise.then(()=>i.css("stroke-dasharray","")),h}else if(t.startsWith("slide")){let r={opacity:[0,n],transform:["translateY(50px)","none"]};return t.includes("down")&&(r.transform[0]="translateY(-50px)"),t.includes("right")&&(r.transform[0]="translateX(-50px)"),t.includes("left")&&(r.transform[0]="translateX(50px)"),St(i,r,e,s)}else if(t.startsWith("reveal")){let r={opacity:[0,n],height:[0,"auto"]};return t.includes("left")&&(r.transform=["translateX(-50%)","none"]),t.includes("right")&&(r.transform=["translateX(50%)","none"]),St(i,r,e,s)}}return Ne}function Md(i,t="fade",e=400,s=0,n=!1){if(!i._el)return Ne;if(!Wi)return i.hide(),Ne;if(i.css("display")==="none")return Ne;let r;if(t==="fade")r=St(i,{opacity:[1,0]},e,s);else if(t==="pop"){let o=i.transform.replace(/scale\([0-9.]*\)/,"");St(i,{opacity:[1,0]},e,s),r=St(i,{transform:[o+" scale(1)",o+" scale(0.5)"]},e,s,"bounce-out")}else if(t==="ascend")r=St(i,{opacity:[1,0],transform:["none","translateY(-50%)"]},e,s);else if(t.startsWith("draw")){let o=i.strokeLength;i.css("stroke-dasharray",o);let h={"stroke-dashoffset":[t==="draw-reverse"?2*o+"px":0,o+"px"]};r=St(i,h,e,s,"linear")}else if(t.startsWith("slide")){let o={opacity:0,transform:"translateY(50px)"};t.includes("up")&&(o.transform="translateY(-50px)"),r=St(i,o,e,s)}else if(t.startsWith("reveal")){let o={opacity:0,height:0};t.includes("left")&&(o.transform="translateX(-50%)"),t.includes("right")&&(o.transform="translateX(50%)"),r=St(i,o,e,s)}return r.promise.then(()=>n?i.remove():i.hide()),r}var De=class extends Ri{constructor(t,e,s={}){super();this.$el=t,this.position=new x(0,0),this.disabled=!1,this.width=0,this.height=0,this.options=Fn(s,{moveX:!0,moveY:!0}),this.setDimensions(e);let n;Ge(t,{start:()=>{this.disabled||(n=this.position,this.trigger("start"),ft.addClass("grabbing"))},move:(r,o)=>{this.disabled||(this.setPosition(n.x+r.x-o.x,n.y+r.y-o.y),this.trigger("drag",this.position))},end:(r,o)=>{this.disabled||(this.trigger(r.equals(o)?"click":"end"),ft.removeClass("grabbing"))},accessible:!0}),w.onResize(()=>{let r=this.width,o=this.height;this.setDimensions(e),this.setPosition(this.position.x*this.width/r||0,this.position.y*this.height/o||0)})}setDimensions(t){t.type==="svg"?(this.width=this.options.width||t.svgWidth,this.height=this.options.height||t.svgHeight):(this.width=this.options.width||t.width,this.height=this.options.height||t.height)}setPosition(t,e){let s=this.options.margin||0,n=new x(this.options.moveX?t:0,this.options.moveY?e:0).clamp(new fs(0,this.width,0,this.height),s).round(this.options.snap||1);this.options.round&&(n=this.options.round(n)),!n.equals(this.position)&&(this.position=n,this.options.useTransform?this.$el.translate(n.x,n.y):(this.options.moveX&&this.$el.css("left",n.x+"px"),this.options.moveY&&this.$el.css("top",n.y+"px")),this.trigger("move",n))}},Rd="position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: #0f82f2; pointer-events: none; z-index: 9999; will-change: transform;";function hl(i,t){let e=t.regex.exec(i);if(e){e.shift();let s={};for(let[n,r]of t.params.entries())s[r]=e[n];return s}else return}function Nd(i,t,e){return Qt(this,void 0,void 0,function*(){return i.template?typeof i.template=="string"?i.template:i.template(t):(yield fetch(e+(e.indexOf("?")>=0?"&xhr=1":"?xhr=1"))).text()})}var ll=document.readyState==="complete";window.addEventListener("load",()=>setTimeout(()=>ll=!0));"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var cl=class extends Ri{constructor(){super(...arguments);this.$viewport=G,this.views=[],this.active={path:"",hash:""},this.preloaded=!1,this.transition=!1,this.noLoad=!1,this.initialise=()=>{}}setup(t={}){t.$viewport&&(this.$viewport=t.$viewport),t.initialise&&(this.initialise=t.initialise),t.preloaded&&(this.preloaded=t.preloaded),t.transition&&(this.transition=t.transition),t.noLoad&&(this.noLoad=t.noLoad),t.click&&G.on("click",e=>this.onLinkClick(e)),t.history&&window.addEventListener("popstate",e=>Qt(this,void 0,void 0,function*(){var s;if(!ll||!((s=e.state)===null||s===void 0?void 0:s.path))return;(yield this.load(e.state.path,e.state.hash))||window.history.pushState(this.active,"",this.active.path+this.active.hash)}))}view(t,{enter:e,exit:s,template:n}={}){let r=(t.match(/:\w+/g)||[]).map(m=>m.substr(1)),o=t.replace(/:\w+/g,"([\\w-]+)").replace("/","\\/")+"\\/?",a=t.includes("?")?"":"(\\?.*)?",l={regex:new RegExp("^"+o+a+"$","i"),params:r,enter:e,exit:s,template:n};this.views.push(l);let u=window.location.pathname+window.location.search,d=hl(u,l);!d||(this.active={path:u,hash:window.location.hash},window.history.replaceState(this.active,"",this.active.path+this.active.hash),w.ready(()=>{setTimeout(()=>{this.preloaded?(this.initialise(this.$viewport,d),l.enter&&l.enter(this.$viewport,d)):this.loadView(l,d)})}))}paths(...t){for(let e of t)this.view(e)}getView(t){for(let e of this.views){let s=hl(t,e);if(s)return{view:e,params:s}}}load(t,e){return Qt(this,void 0,void 0,function*(){if(t===this.active.path&&e!==this.active.hash)return this.trigger("hashChange",e.slice(1)),this.trigger("change",t+e),this.active={path:t,hash:e},!0;let s=this.getView(t);return!s||this.beforeChange&&!(yield this.beforeChange())?!1:(this.active={path:t,hash:e},this.trigger("change",t+e),window.ga&&window.ga("send","pageview",t+e),this.noLoad?s.view.enter&&s.view.enter(this.$viewport,s.params):this.loadView(s.view,s.params),!0)})}loadView(t,e={}){return Qt(this,void 0,void 0,function*(){this.showLoadingBar();let s=this.active.path,n=yield Nd(t,e,s);if(this.active.path!==s)return;yield this.$viewport.animate({opacity:0},200).promise,this.$viewport.removeChildren(),G.scrollTop=0,this.$viewport.html=n,w.resize(),Ld(),this.$viewport.animate({opacity:1},200),this.hideLoadingBar();let r=this.$viewport.$("title");r&&(document.title=r.text),this.initialise(this.$viewport,e),t.enter&&t.enter(this.$viewport,e),this.trigger("afterChange",{$viewport:this.$viewport})})}onLinkClick(t){if(t.metaKey||t.ctrlKey||t.shiftKey||t.defaultPrevented)return;let e=t.target;for(;e&&e.nodeName!=="A";)e=e.parentNode;if(!e||e.nodeName!=="A")return;let s=e;if(s.target||s.origin!==window.location.origin||s.hasAttribute("download")||s.getAttribute("rel")==="external")return;let n=s.getAttribute("href");n&&n.indexOf("mailto:")>-1||this.getView(s.pathname+s.search)&&(t.preventDefault(),this.goTo(s.pathname+s.search,s.hash))}goTo(t,e=""){return Qt(this,void 0,void 0,function*(){let s=this.active.path+this.active.hash;(yield this.load(t,e))&&s!==this.active.path+this.active.hash&&window.history.pushState(this.active,"",t+e)})}replace(t,e=""){this.active={path:t,hash:e},window.history.replaceState(this.active,"",t+e)}back(){window.history.back()}forward(){window.history.forward()}showLoadingBar(){this.$loadingBar||(this.$loadingBar=c("div",{style:Rd},G)),this.$loadingBar.css({transform:"translateX(-100%)",opacity:1}),this.$loadingBar.show(),this.animation=j(t=>{this.$loadingBar.css("transform",`translateX(-${10+90*Math.exp(-4*t)}%)`)},3e3)}hideLoadingBar(){var t,e,s;return Qt(this,void 0,void 0,function*(){(t=this.animation)===null||t===void 0||t.cancel(),yield(e=this.$loadingBar)===null||e===void 0?void 0:e.animate({transform:"none",opacity:0}).promise,(s=this.$loadingBar)===null||s===void 0||s.hide()})}},_s=new cl;function Dd(i,t){let e=Array.from(i.childNodes);i.innerHTML=t;let s={};for(let n of Array.from(i.querySelectorAll("slot")))s[n.getAttribute("name")||""]=n;for(let n of e){let r=n.getAttribute&&n.getAttribute("slot")||"",o=s[r]||s[""];o&&o.parentNode.insertBefore(n,o)}for(let n of Object.values(s))n.parentNode.removeChild(n)}function pl(i){let t=[];for(let e of Array.from(i.children))e.tagName.startsWith("X-")?t.push(e):t.push(...pl(e));return t}var ul=new Map,dl=class extends HTMLElement{constructor(){super(...arguments);this.wasConnected=!1,this.isReady=!1}connectedCallback(){return Qt(this,void 0,void 0,function*(){if(this.wasConnected){this._view.trigger("connected");return}this.wasConnected=!0,this.isReady=!1,this._view.created();let t=ul.get(this._view.tagName)||{};t.template&&Dd(this,t.template);let e=pl(this).filter(s=>!s.isReady).map(s=>new Promise(n=>s.addEventListener("ready",n)));yield Promise.all(e),this._view.ready(),this.dispatchEvent(new CustomEvent("ready")),this.isReady=!0})}disconnectedCallback(){this._view.trigger("disconnected")}},M=class extends ge{created(){}ready(){}};function P(i,t={}){return function(e){class s extends dl{constructor(){super();this._view=new e(this)}}ul.set(i.toUpperCase(),t),window.customElements.define(i,s)}}var fr=class{constructor(t){this.clipEndTime=0;this.player=new Audio(t),this.player.preload="true",this.player.addEventListener("timeupdate",()=>{this.player.currentTime>=this.clipEndTime&&this.triggerCallback(!0)}),window.addEventListener("beforeunload",()=>this.player.pause())}playClip(t,e,s){this.triggerCallback(!1),this.player.currentTime=t,this.clipEndTime=e,this.clipCallback=s,this.player.play()}triggerCallback(t){if(!this.clipCallback)return;let e=this.clipCallback;this.clipCallback=void 0,this.player.pause(),e({ended:t})}pause(){this.triggerCallback(!1)}get isPlaying(){return!!this.clipCallback}},mr=!1,gr,wr=class{constructor(t,e){this.audio=t;this.paragraphs=[];this.paragraphs=e.$$(".voice").map(s=>new fl(s,t));for(let[s,n]of this.paragraphs.entries())n.on("end",()=>{var r;if(this.paragraphs[s+1])this.paragraphs[s+1].play();else{let o=e.nextStep;o&&o.isShown&&((r=o.narration)==null||r.play())}})}play(){var t;this.audio.isPlaying||!mr||(t=this.paragraphs[0])==null||t.play()}},fl=class extends hs{constructor(t,e){super();this.$p=t;this.audio=e;this.playing=void 0;this.sentences=t.$$(".sentence[data-timings]").map(s=>new ml(s,e)),this.$button=c("button",{class:"playback-btn",title:"Play Narration"}),this.$button.on("click",()=>{this.playing?this.audio.pause():this.play(),mr=!mr,gr=void 0}),t.prepend(this.$button),t.addClass("sentence-wrap");for(let[s,n]of this.sentences.entries())n.on("end",r=>{this.playing=void 0,r&&this.sentences[s+1]?setTimeout(()=>this.play(this.sentences[s+1]),200):(this.$button.removeClass("active"),r&&setTimeout(()=>this.trigger("end"),400))})}play(t){let e=t||this.sentences[0],s=e.$reveal;if(s&&s.css("visibility")==="hidden"){this.$button.removeClass("active"),gr=s,s.one("reveal",()=>{gr===s&&!this.audio.isPlaying&&this.play(e)});return}this.playing=e,this.playing.play(),this.$button.addClass("active");let n=this.$p.parents("x-tabbox .tab")[0];if(n){let a=n.parents("x-tabbox")[0];a.makeActive(n.index());let h=a.active;a.one("change",l=>{this.playing&&l!==h&&this.audio.pause()})}let r=this.$p.bounds,o=r.top+r.height-w.height+20;o>0&&G.scrollBy(o+100),setTimeout(()=>this.$button.focus(),800)}},ml=class extends hs{constructor(t,e){super();this.$el=t;this.audio=e;let s=t.attr("data-timings").split("-");this.start=+s[0]/1e3,this.end=(+s[1]-200)/1e3}play(){this.$el.addClass("playing"),this.audio.playClip(this.start,this.end,({ended:t})=>{this.$el.removeClass("playing"),this.trigger("end",t)})}get $reveal(){return this.$el.parents(".reveal")[0]}};var qe=c("div",{class:"modal-background"},G),Fi,re,yr;function vr(){re&&re.canClose&&re.close()}qe.on("click",vr);w.onKey("escape",vr);_s.on("change",vr);qe.on("scrollwheel touchmove",i=>{i.preventDefault(),i.stopPropagation()});w.onKey("space up down pagedown pageup",i=>{re&&(i.preventDefault(),i.stopPropagation())});var xr=class extends M{constructor(){super(...arguments);this.isOpen=!1;this.canClose=!0}ready(){this.canClose=!this.hasAttr("no-close"),this.$iframe=this.$("iframe[data-src]"),this.$video=this.$("video");let t=te(`[data-modal=${this.id}]`);for(let s of t)s.on("click",()=>this.open());_s.on("afterChange",({$viewport:s})=>{let n=s.$$(`[data-modal=${this.id}]`);for(let r of n)r.on("click",()=>this.open())}),this.hasClass("open")&&!re&&this.open(!0),this.$("input")&&this.addClass("interactive");let e=this.$(".close");e&&e.on("click",()=>this.close());for(let s of this.$$(".btn"))s.on("click",()=>this.trigger("btn-click",s))}open(t=!1){if(this.isOpen)return;qe.setClass("light",this.hasClass("light")),re?re.close(!0):t?qe.show():qe.css("display")==="block"?Fi==null||Fi.cancel():qe.enter("fade",250),this.isOpen=!0,re=this,this.$iframe&&this.$iframe.setAttr("src",this.$iframe.data.src),this.$video&&this.$video.play(),t?this.show():this.enter("pop",250).promise.then(()=>this.css("transform","")),this.setAttr("role","dialog"),this.trigger("open"),yr=document.activeElement;let e=this.$('input, a, button, textarea, [tabindex="0"]');e&&e.focus()}close(t=!1,e=!1){!this.isOpen||(this.isOpen=!1,this.removeAttr("role"),re=void 0,this.$iframe&&this.$iframe.setAttr("src",""),this.$video&&this.$video.pause(),t||(Fi=qe.exit("fade",250)),this.exit("pop",250).promise.then(()=>this.css("transform","")),e||this.trigger("close"),yr&&yr.focus())}static confirm(t){return S(this,null,function*(){var n;let e=E(t);if(!e)return"";e.open();let s=yield new Promise(r=>e.one("close btn-click",r));return e.close(),((n=s==null?void 0:s.data)==null?void 0:n.prompt)||""})}};xr=b([P("x-modal")],xr);var $r=class extends M{constructor(){super(...arguments);this.$options={}}ready(){let t=this.children;this.$active=this.$(".active")||t[0],this.$active.addClass("active");for(let[e,s]of t.entries())!R(s.tagName,"A","BUTTON")&&!s.hasAttr("tabindex")&&s.setAttr("tabindex",0),s.on("click",()=>this.makeActive(s)),this.$options[s.attr("value")||e]=s;this.trigger("change",this.$active)}makeActive(t){t!==this.$active&&(this.$active.removeClass("active"),this.$active=t,t.addClass("active"),this.trigger("change",t))}bindVariable(t,e){t[e]=this.$active.attr("value"),this.on("change",s=>t[e]=s.attr("value")),t.watch(()=>{let s=this.$options[t[e]];s&&this.makeActive(s)})}};$r=b([P("x-select")],$r);var br=class extends M{constructor(){super(...arguments);this.isOpen=!1}ready(){this.animation=this.attr("animation")||"pop",this.$bubble=this.$(".popup-body"),this.$bubble.hide(),this.$(".popup-target").on("click",()=>this.toggle()),this.on("clickOutside",()=>this.close());for(let e of this.$bubble.$$("a"))e.on("click",()=>this.close());w.onKey("escape",()=>this.close())}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen||(this.isOpen=!0,this.addClass("active"),this.$bubble.enter(this.animation,150),this.$bubble.setAttr("role","dialog"),this.$bubble.focus())}close(){!this.isOpen||(this.isOpen=!1,this.removeClass("active"),this.$bubble.exit(this.animation,150),this.$bubble.removeAttr("role"))}};br=b([P("x-popup")],br);var gl=new Map,vs,qd=c("div",{class:"snackbar"},G),Pr=class extends M{ready(){var t;qd.append(this),gl.set(this.attr("key"),this),(t=this.$("button"))==null||t.on("click",()=>this.close())}open(t=2e3){return S(this,null,function*(){vs!==this&&(vs&&(yield vs.close()),vs=this,yield this.enter("pop",300).promise,this.setAttr("role","alert"),t&&setTimeout(()=>this.close(),t))})}close(){return S(this,null,function*(){vs===this&&(vs=void 0,this.removeAttr("role"),yield this.exit("pop",300).promise)})}};Pr=b([P("x-alert")],Pr);function ji(i,t=4e3){var e;return(e=gl.get(i))==null?void 0:e.open(t)}var Mr=class extends M{ready(){if(this.children.length)return;let t=+this.attr("size")||24;this.css({width:t+"px",height:t+"px"});let e=c("svg",{viewBox:"0 0 24 24"},this);e.css({width:t+"px",height:t+"px"});let s=c("use",{},e);this.onAttr("name",n=>s.setAttr("href",`/icons.e5eabefc.svg#${n}`))}};Mr=b([P("x-icon")],Mr);var Sr=12;function zd(i){return`M${i},${i/2}a${i/2},${i/2},0,0,1,0,${i}A${i/2},${i/2},0,0,1,${i},${i/2}`}function Bd(i){return`M ${i},0 C ${i/2},0,0,${i/2},0,${i}  s ${i/2},${i},${i},${i} s ${i}-${i/2},${i}-${i}     S ${i*1.5},0,${i},0 z M ${i*44.6/50},${i*76.1/50} L ${i*19.2/50},${i*48.8/50} l ${i*4/50}-${i*4.2/50}     l ${i*19.8/50},${i*11.9/50} l ${i*34.2/50}-${i*32.6/50} l ${i*3.5/50},${i*3.5/50} L ${i*44.6/50},${i*76.1/50} z`}var Tr=class extends M{constructor(){super(...arguments);this.completed=!1}ready(){this.r=+this.attr("r")||10,this.r1=this.r+Sr,this.$svg=c("svg",{width:2*this.r1,height:2*this.r1},this),this.$progress=c("path",{class:"pie",d:zd(this.r),"stroke-width":this.r},this.$svg),this.onAttr("p",t=>this.setProgress(+t,!1))}setProgress(t,e=!0){if(t>.99)return this.complete(e);let s=Math.PI*this.r;this.$progress.css("stroke",t?"currentColor":"none"),this.$progress.css("stroke-dasharray",`${t*s} ${s}`)}complete(t=!0){if(this.completed||(this.completed=!0,this.$progress.css("stroke","none"),this.$progress.css("fill","currentColor"),this.$progress.setAttr("d",Bd(this.r)),!t))return;let e=`translate(${this.r1} ${this.r1})`,s=c("g",{transform:e},this.$svg),n=z(()=>c("line",{},s),18);j(r=>{let o=this.r+Sr*K("quint-out",r),a=this.r+Sr*r;for(let h=0;h<18;++h){let l=Math.cos(Math.PI*2*h/18),u=Math.sin(Math.PI*2*h/18);n[h].setLine({x:l*o,y:u*o},{x:l*a,y:u*a})}},800).promise.then(()=>s.remove())}};Tr=b([P("x-progress")],Tr);var wl="2.4.1",Vr="i5iSjo",yl="_av",Er="_au",Ar="(not set)";var Ki=[],Xi=class{static add(t,e,s){vl(t,e).add(s)}static remove(t,e,s){vl(t,e).remove(s)}constructor(t,e){this.context=t,this.methodName=e,this.isTask=/Task$/.test(e),this.originalMethodReference=this.isTask?t.get(e):t[e],this.methodChain=[],this.boundMethodChain=[],this.wrappedMethod=(...s)=>this.boundMethodChain[this.boundMethodChain.length-1](...s),this.isTask?t.set(e,this.wrappedMethod):t[e]=this.wrappedMethod}add(t){this.methodChain.push(t),this.rebindMethodChain()}remove(t){let e=this.methodChain.indexOf(t);e>-1&&(this.methodChain.splice(e,1),this.methodChain.length>0?this.rebindMethodChain():this.destroy())}rebindMethodChain(){this.boundMethodChain=[];for(let t,e=0;t=this.methodChain[e];e++){let s=this.boundMethodChain[e-1]||this.originalMethodReference.bind(this.context);this.boundMethodChain.push(t(s))}}destroy(){let t=Ki.indexOf(this);t>-1&&(Ki.splice(t,1),this.isTask?this.context.set(this.methodName,this.originalMethodReference):this.context[this.methodName]=this.originalMethodReference)}},oe=Xi;function vl(i,t){let e=Ki.filter(s=>s.context==i&&s.methodName==t)[0];return e||(e=new Xi(i,t),Ki.push(e)),e}var xs=window.Element.prototype,Dg=xs.matches||xs.matchesSelector||xs.webkitMatchesSelector||xs.mozMatchesSelector||xs.msMatchesSelector||xs.oMatchesSelector;var Ud="80",Wd="443",Kg=RegExp(":("+Ud+"|"+Wd+")$"),Xg=document.createElement("a");function Yi(i,t,e=void 0,s=void 0,n=void 0,r=void 0){if(typeof s=="function"){let o=e.get("buildHitTask");return{buildHitTask:a=>{a.set(i,null,!0),a.set(t,null,!0),s(a,n,r),o(a)}}}else return we({},i,t)}var Cr={};function $l(i,t){let e=i.get("trackingId"),s=Cr[e]=Cr[e]||{},n=()=>{clearTimeout(s.timeout),s.send&&oe.remove(i,"send",s.send),delete Cr[e],s.queue.forEach(r=>r())};clearTimeout(s.timeout),s.timeout=setTimeout(n,0),s.queue=s.queue||[],s.queue.push(t),s.send||(s.send=r=>(...o)=>{n(),r(...o)},oe.add(i,"send",s.send))}var we=Object.assign||function(i,...t){for(let e=0,s=t.length;e<s;e++){let n=Object(t[e]);for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])}return i};function bl(i){return i.charAt(0).toUpperCase()+i.slice(1)}function Pl(i){return typeof i=="object"&&i!==null}function ye(){return+new Date}var Hs=function i(t){return t?(t^Math.random()*16>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,i)};function kr(i,t){let e=window.GoogleAnalyticsObject||"ga";window[e]=window[e]||function(...s){(window[e].q=window[e].q||[]).push(s)},window.gaDevIds=window.gaDevIds||[],window.gaDevIds.indexOf(Vr)<0&&window.gaDevIds.push(Vr),window[e]("provide",i,t),window.gaplugins=window.gaplugins||{},window.gaplugins[bl(i)]=t}var Lr=class{constructor(){this.registry_={}}on(t,e){this.getRegistry_(t).push(e)}off(t=void 0,e=void 0){if(t&&e){let s=this.getRegistry_(t),n=s.indexOf(e);n>-1&&s.splice(n,1)}else this.registry_={}}emit(t,...e){this.getRegistry_(t).forEach(s=>s(...e))}getEventCount(){let t=0;return Object.keys(this.registry_).forEach(e=>{t+=this.getRegistry_(e).length}),t}getRegistry_(t){return this.registry_[t]=this.registry_[t]||[]}},Ml=Lr;var Ji="autotrack",$s={},Or=!1,Us,Wt=class extends Ml{static getOrCreate(t,e,s){let n=[Ji,t,e].join(":");return $s[n]||($s[n]=new Wt(n,s),Or||Fd()),$s[n]}static isSupported_(){if(Us!=null)return Us;try{window.localStorage.setItem(Ji,Ji),window.localStorage.removeItem(Ji),Us=!0}catch(t){Us=!1}return Us}static get_(t){return window.localStorage.getItem(t)}static set_(t,e){window.localStorage.setItem(t,e)}static clear_(t){window.localStorage.removeItem(t)}constructor(t,e={}){super();this.key_=t,this.defaults_=e,this.cache_=null}get(){if(this.cache_)return this.cache_;if(Wt.isSupported_())try{this.cache_=Ir(Wt.get_(this.key_))}catch(t){}return this.cache_=we({},this.defaults_,this.cache_)}set(t){if(this.cache_=we({},this.defaults_,this.cache_,t),Wt.isSupported_())try{Wt.set_(this.key_,JSON.stringify(this.cache_))}catch(e){}}clear(){if(this.cache_={},Wt.isSupported_())try{Wt.clear_(this.key_)}catch(t){}}destroy(){delete $s[this.key_],Object.keys($s).length||jd()}},Qi=Wt;function Fd(){window.addEventListener("storage",Sl),Or=!0}function jd(){window.removeEventListener("storage",Sl),Or=!1}function Sl(i){let t=$s[i.key];if(t){let e=we({},t.defaults_,Ir(i.oldValue)),s=we({},t.defaults_,Ir(i.newValue));t.cache_=s,t.emit("externalSet",s,e)}}function Ir(i){let t={};if(i)try{t=JSON.parse(i)}catch(e){}return t}var Kd=1e3,Xd=60*Kd,tn={},ze=class{static getOrCreate(t,e,s){let n=t.get("trackingId");return tn[n]?tn[n]:tn[n]=new ze(t,e,s)}constructor(t,e,s){this.tracker=t,this.timeout=e||ze.DEFAULT_TIMEOUT,this.timeZone=s,this.sendHitTaskOverride=this.sendHitTaskOverride.bind(this),oe.add(t,"sendHitTask",this.sendHitTaskOverride);try{this.dateTimeFormatter=new Intl.DateTimeFormat("en-US",{timeZone:this.timeZone})}catch(r){}let n={hitTime:0,isExpired:!1};this.store=Qi.getOrCreate(t.get("trackingId"),"session",n),this.store.get().id||this.store.set({id:Hs()})}getId(){return this.store.get().id}isExpired(t=this.getId()){if(t!=this.getId())return!0;let e=this.store.get();if(e.isExpired)return!0;let s=e.hitTime;if(s){let n=new Date,r=new Date(s);if(n-r>this.timeout*Xd||this.datesAreDifferentInTimezone(n,r))return!0}return!1}datesAreDifferentInTimezone(t,e){return this.dateTimeFormatter?this.dateTimeFormatter.format(t)!=this.dateTimeFormatter.format(e):!1}sendHitTaskOverride(t){return e=>{t(e);let s=e.get("sessionControl"),n=s=="start"||this.isExpired(),r=s=="end",o=this.store.get();o.hitTime=ye(),n&&(o.isExpired=!1,o.id=Hs()),r&&(o.isExpired=!0),this.store.set(o)}}destroy(){oe.remove(this.tracker,"sendHitTask",this.sendHitTaskOverride),this.store.destroy(),delete tn[this.tracker.get("trackingId")]}},Gr=ze;ze.DEFAULT_TIMEOUT=30;var Rr={CLEAN_URL_TRACKER:1,EVENT_TRACKER:2,IMPRESSION_TRACKER:3,MEDIA_QUERY_TRACKER:4,OUTBOUND_FORM_TRACKER:5,OUTBOUND_LINK_TRACKER:6,PAGE_VISIBILITY_TRACKER:7,SOCIAL_WIDGET_TRACKER:8,URL_CHANGE_TRACKER:9,MAX_SCROLL_TRACKER:10},Tl=Object.keys(Rr).length;function Vl(i,t){Jd(i),Yd(i,t)}function Qd(i){return parseInt(i||"0",16).toString(2)}function tf(i){return parseInt(i||"0",2).toString(16)}function ef(i,t){if(i.length<t){let e=t-i.length;for(;e;)i="0"+i,e--}return i}function sf(i,t){return i.substr(0,t)+1+i.substr(t+1)}function Yd(i,t){let e=i.get("&"+Er),s=ef(Qd(e),Tl);s=sf(s,Tl-t),i.set("&"+Er,tf(s))}function Jd(i){i.set("&"+yl,wl)}var Ws="hidden",ee="visible",bs=Hs(),El=1e3,Al=class{constructor(t,e){if(Vl(t,Rr.PAGE_VISIBILITY_TRACKER),!document.visibilityState)return;let s={sessionTimeout:Gr.DEFAULT_TIMEOUT,visibleThreshold:5*El,sendInitialPageview:!1,fieldsObj:{}};this.opts=we(s,e),this.tracker=t,this.lastPageState=document.visibilityState,this.visibleThresholdTimeout_=null,this.isInitialPageviewSent_=!1,this.trackerSetOverride=this.trackerSetOverride.bind(this),this.handleChange=this.handleChange.bind(this),this.handleWindowUnload=this.handleWindowUnload.bind(this),this.handleExternalStoreSet=this.handleExternalStoreSet.bind(this),this.store=Qi.getOrCreate(t.get("trackingId"),"plugins/page-visibility-tracker"),this.store.on("externalSet",this.handleExternalStoreSet),this.session=Gr.getOrCreate(t,this.opts.sessionTimeout,this.opts.timeZone),oe.add(t,"set",this.trackerSetOverride),window.addEventListener("unload",this.handleWindowUnload),document.addEventListener("visibilitychange",this.handleChange),$l(this.tracker,()=>{document.visibilityState==ee?(this.opts.sendInitialPageview&&(this.sendPageview({isPageLoad:!0}),this.isInitialPageviewSent_=!0),this.store.set({time:ye(),state:ee,pageId:bs,sessionId:this.session.getId()})):this.opts.sendInitialPageview&&this.opts.pageLoadsMetricIndex&&this.sendPageLoad()})}handleChange(){if(!(document.visibilityState==ee||document.visibilityState==Ws))return;let t=this.getAndValidateChangeData(),e={time:ye(),state:document.visibilityState,pageId:bs,sessionId:this.session.getId()};document.visibilityState==ee&&this.opts.sendInitialPageview&&!this.isInitialPageviewSent_&&(this.sendPageview(),this.isInitialPageviewSent_=!0),document.visibilityState==Ws&&this.visibleThresholdTimeout_&&clearTimeout(this.visibleThresholdTimeout_),this.session.isExpired(t.sessionId)?(this.store.clear(),this.lastPageState==Ws&&document.visibilityState==ee&&(clearTimeout(this.visibleThresholdTimeout_),this.visibleThresholdTimeout_=setTimeout(()=>{this.store.set(e),this.sendPageview({hitTime:e.time})},this.opts.visibleThreshold))):(t.pageId==bs&&t.state==ee&&this.sendPageVisibilityEvent(t),this.store.set(e)),this.lastPageState=document.visibilityState}getAndValidateChangeData(){let t=this.store.get();return this.lastPageState==ee&&t.state==Ws&&t.pageId!=bs&&(t.state=ee,t.pageId=bs,this.store.set(t)),t}sendPageVisibilityEvent(t,{hitTime:e}={}){let s=this.getTimeSinceLastStoredChange(t,{hitTime:e});if(s&&s>=this.opts.visibleThreshold){let n=Math.round(s/El),r={transport:"beacon",nonInteraction:!0,eventCategory:"Page Visibility",eventAction:"track",eventValue:n,eventLabel:Ar};e&&(r.queueTime=ye()-e),this.opts.visibleMetricIndex&&(r["metric"+this.opts.visibleMetricIndex]=n),this.tracker.send("event",Yi(r,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}}sendPageLoad(){let t={transport:"beacon",eventCategory:"Page Visibility",eventAction:"page load",eventLabel:Ar,["metric"+this.opts.pageLoadsMetricIndex]:1,nonInteraction:!0};this.tracker.send("event",Yi(t,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}sendPageview({hitTime:t,isPageLoad:e}={}){let s={transport:"beacon"};t&&(s.queueTime=ye()-t),e&&this.opts.pageLoadsMetricIndex&&(s["metric"+this.opts.pageLoadsMetricIndex]=1),this.tracker.send("pageview",Yi(s,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}trackerSetOverride(t){return(e,s)=>{let n=Pl(e)?e:{[e]:s};n.page&&n.page!==this.tracker.get("page")&&this.lastPageState==ee&&this.handleChange(),t(e,s)}}getTimeSinceLastStoredChange(t,{hitTime:e}={}){return t.time?(e||ye())-t.time:0}handleExternalStoreSet(t,e){t.time!=e.time&&e.pageId==bs&&e.state==ee&&!this.session.isExpired(e.sessionId)&&this.sendPageVisibilityEvent(e,{hitTime:t.time})}handleWindowUnload(){this.lastPageState!=Ws&&this.handleChange()}remove(){this.store.destroy(),this.session.destroy(),oe.remove(this.tracker,"set",this.trackerSetOverride),window.removeEventListener("unload",this.handleWindowUnload),document.removeEventListener("visibilitychange",this.handleChange)}};kr("pageVisibilityTracker",Al);al();ft.addClass((w.isMobile?"is":"not")+"-mobile");w.isSafari&&ft.addClass("is-safari");setTimeout(()=>ft.addClass("ready"));window.addEventListener("keydown",i=>{i.keyCode===9&&ft.addClass("is-tabbing")});window.addEventListener("mousedown",()=>{ft.removeClass("is-tabbing")});var Cl=E(".cookie-warning");Cl&&E("#yes-to-cookies").on("click",function(){Cl.exit("pop",300),w.setCookie("cookie_consent",1)});var kl;(kl=navigator.serviceWorker)==null||kl.register("/service_worker.js",{scope:"/"}).catch(()=>console.warn("Unable to register Service Worker."));window.addEventListener("beforeinstallprompt",i=>{i.prompt()});var Ll;(Ll=E("#skip-nav"))==null||Ll.on("click",()=>{var t;(t=(E("article")||E(".panel.active")||E(".body")||G).$("input, button, a, textarea, [contenteditable], [tabindex]"))==null||t.focus()});var Nr=E("nav x-popup");if(Nr){let i=Nr.$$(".popup-body a, .popup-body button");for(let t of i)t.on("click",()=>Nr.close())}var nf=te("#language .locale-link");_s.on("change",i=>{for(let t of nf)t.setAttr("href",t.data.host+i)});var en=E("#dark-mode");en&&(en.checked=w.theme.isDark,en.on("change",()=>w.setTheme(en.checked?"dark":"light")));var Zs={},Be=E("#search"),ve=Be==null?void 0:Be.$(".form-field input"),sn=Be==null?void 0:Be.$(".search-body");Zs[""]=(sn==null?void 0:sn.html)||"";function rf(i){return i=i.trim().replace(/\s+/," ").toLowerCase().slice(0,50),i==="pi"||i.length>=3?i:""}function of(i){return S(this,null,function*(){if(i=encodeURIComponent(rf(i)),i in Zs)return Zs[i];let t=yield fetch(`/api/search?q=${i}`);return t.ok?Zs[i]=yield t.text():Zs[i]=""})}var af=0,Ol=0;function Il(i){return S(this,null,function*(){let t=af+=1,e=yield of(i);t<=Ol||(Ol=t,sn.html=e)})}ve==null||ve.change(i=>{w.setCookie("search",i,60*60*24),setTimeout(()=>{ve.value===i&&Il(i)},300)});(ve==null?void 0:ve.value)&&Be.one("open",()=>Il(ve.value));var Gl=1e-6;function T(i,t,e=Gl){return isNaN(i)||isNaN(t)?!1:Math.abs(i-t)<e}function Tt(i,t,e,s=Gl){return t>e&&([t,e]=[e,t]),i>t+s&&i<e-s}var Rl=/(\d+)(\d{3})/,hf=["","k","m","b","t","q"];function lf(i){let[t,e]=i.split(".");for(;Rl.test(t);)t=t.replace(Rl,"$1,$2");return t+(e?"."+e:"")}function cf(i,t=6){if(!t)return""+i;let e=(""+Math.abs(Math.floor(i))).length,s=i<0?1:0;if(e<=t-s)return""+$t(i,t-e-s-1);let n=Math.floor(Math.log10(Math.abs(i))/3);return $t(i/Math.pow(10,3*n),t-(e%3||3)-s-1)+hf[n]}function vt(i,t=0,e=!0){let s=cf(i,t).replace("-","\u2013");return e?lf(s):s}var pf=/^-?0,[0-9]+$/,uf=/^-?([0-9]+(,[0-9]{3})*)?\.?[0-9]*$/,df=/^-?[0-9]+(\.[0-9]{3})*,?[0-9]*$/;function Fs(i){return i=i.replace(/^–/,"-").trim(),!i||i.match(/[^0-9.,-]/)?NaN:pf.test(i)?parseFloat(i.replace(/,/,".")):uf.test(i)?parseFloat(i.replace(/,/g,"")):df.test(i)?parseFloat(i.replace(/\./g,"").replace(/,/,".")):NaN}var Dr=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],Nl=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],ff=[""," thousand"," million"," billion"," trillion"," quadrillion"," quintillion"," sextillion"];function mf(i){let[t,e,s]=i.split(""),n=t==="0"?"":" "+Dr[+t]+" hundred";return e+s==="00"?n:+e<2?n+" "+Dr[+(e+s)]:s==="0"?n+" "+Nl[+e]:n+" "+Nl[+e]+"-"+Dr[+s]}function Ps(i){if(i===0)return"zero";let t=Math.round(Math.abs(i)).toString(),e=Math.ceil(t.length/3),s=t.padStart(3*e,"0"),n="";for(let r=0;r<e;r+=1){let o=s.substr(r*3,3);o!=="000"&&(n+=mf(o)+ff[e-1-r])}return n.trim()}function $t(i,t=0){let e=Math.pow(10,t);return Math.round(i*e)/e}function Vt(i,t=1){return Math.round(i/t)*t}function L(i,t=-Infinity,e=Infinity){return Math.min(e,Math.max(t,i))}function bt(i,t,e=.5){return i+(t-i)*e}function Bt(i){return i*i}function kt(i,t){return(i%t+t)%t}function ql(i,t=0){let e=i.slice(0),s=Dl(e);return t?s.filter(n=>n.length===t):s}function Dl(i){if(i.length===1)return[[],i];let t=i.pop(),e=Dl(i),s=[];for(let n of e)s.push(n,[...n,t]);return s}var nn=(i,t)=>{let e=i<0?"\u2013":"";return Math.abs(i)===1&&t?e+t:e+Math.abs(i)+(t||"")},J=class{constructor(t=0,e=0){this.re=t,this.im=e}get modulus(){return Math.sqrt(this.re*this.re+this.im*this.im)}get argument(){return Math.atan2(this.im,this.re)}get conjugate(){return new J(this.re,-this.im)}root(t,e=0){let s=Math.pow(this.modulus,1/t),n=(this.argument+e*2*Math.PI)/t;return new J(s*Math.cos(n),s*Math.sin(n))}toString(t=2){let e=$t(this.re,t),s=$t(this.im,t);return s===0?nn(e):e===0?nn(s,"i"):[nn(e),s<0?"\u2013":"+",nn(Math.abs(s),"i")].join(" ")}add(t){return J.sum(this,t)}subtract(t){return J.difference(this,t)}multiply(t){return J.product(this,t)}divide(t){return J.quotient(this,t)}static sum(t,e){return typeof t=="number"&&(t=new J(t,0)),typeof e=="number"&&(e=new J(e,0)),new J(t.re+e.re,t.im+e.im)}static difference(t,e){return typeof t=="number"&&(t=new J(t,0)),typeof e=="number"&&(e=new J(e,0)),new J(t.re-e.re,t.im-e.im)}static product(t,e){typeof t=="number"&&(t=new J(t,0)),typeof e=="number"&&(e=new J(e,0));let s=t.re*e.re-t.im*e.im,n=t.im*e.re+t.re*e.im;return new J(s,n)}static quotient(t,e){if(typeof t=="number"&&(t=new J(t,0)),typeof e=="number"&&(e=new J(e,0)),Math.abs(e.re)<Number.EPSILON||Math.abs(e.im)<Number.EPSILON)return new J(Infinity,Infinity);let s=e.re*e.re+e.im*e.im,n=(t.re*e.re+t.im*e.im)/s,r=(t.im*e.re-t.re*e.im)/s;return new J(n,r)}static exp(t){typeof t=="number"&&(t=new J(t,0));let e=Math.exp(t.re);return new J(e*Math.cos(t.im),e*Math.sin(t.im))}};function qr(i){if(i%1!=0||i<2)return!1;if(i%2==0)return i===2;if(i%3==0)return i===3;let t=Math.sqrt(i);for(let e=5;e<=t;e+=6)if(i%e==0||i%(e+2)==0)return!1;return!0}function js(i){if(i===1)return[];if(qr(i))return[i];let t=Math.sqrt(i);for(let e=2;e<=t;++e)if(i%e==0)return js(e).concat(js(i/e));return[]}function zl(i){return Ht(js(i))}function gf(i,t,e){return Wn(i,t,e)}function wf(i=2){let t=gf(0,i,i);for(let e=0;e<i;++e)t[e][e]=1;return t}function zr(...i){let[t,...e]=i,s=e.length>1?zr(...e):e[0];if(t[0].length!==s.length)throw new Error("Matrix sizes don\u2019t match.");let n=[];for(let r=0;r<t.length;++r){let o=[];for(let a=0;a<s[0].length;++a){let h=0;for(let l=0;l<s.length;++l)h+=t[r][l]*s[l][a];o.push(h)}n.push(o)}return n}function yf(i){let t=[];for(let e=0;e<i[0].length;++e){let s=[];for(let n=0;n<i.length;++n)s.push(i[n][e]);t.push(s)}return t}function vf(i){let t=i.length;if(t!==i[0].length)throw new Error("Not a square matrix.");let e=wf(t),s=ph((n,r)=>i[n][r],t,t);for(let n=0;n<t;++n){let r=s[n][n];if(!r){for(let o=n+1;o<t;++o)if(s[o][n]!==0){for(let a=0;a<t;++a)[s[o][a],s[n][a]]=[s[n][a],s[o][a]],[e[o][a],e[n][a]]=[e[n][a],e[o][a]];break}if(r=s[n][n],!r)throw new Error("Matrix not invertible.")}for(let o=0;o<t;++o)s[n][o]=s[n][o]/r,e[n][o]=e[n][o]/r;for(let o=0;o<t;++o){if(o===n)continue;let a=s[o][n];for(let h=0;h<t;++h)s[o][h]-=a*s[n][h],e[o][h]-=a*e[n][h]}}return e}function xf(i){i=i.slice(0);for(let t=i.length-1;t>0;--t){let e=Math.floor(Math.random()*(t+1));[i[t],i[e]]=[i[e],i[t]]}return i}function $f(i,t){let e=t===void 0?0:i,s=t===void 0?i:t-i+1;return e+Math.floor(s*Math.random())}function Bl(i){let t=Math.random()*U(i),e=0;return i.findIndex(s=>(e+=s)>=t)}function bf(i){return i[Math.floor(i.length*Math.random())]}var rn=new Map;function Pf(i,t){t||(t=ch()),rn.has(t)||rn.set(t,Ae(1,i));let e=rn.get(t),s=Bl(e.map(n=>n*n));return e[s]-=1,e[s]<=0&&rn.set(t,e.map(n=>n+1)),s}function _l(i=.5){return Math.random()<i?1:0}function Mf(i=1,t=.5){let e=0;for(let s=0;s<i;++s)e+=_l(t);return e}function Sf(i=1){if(i<=0)return 0;let t=Math.exp(-i),e=1,s=0;for(;e>t;++s)e*=Math.random();return s-1}function Tf(i=0,t=1){return i+(t-i)*Math.random()}function Vf(i=0,t=1){let e=Math.random(),s=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*s)*Math.sqrt(t)+i}function Ef(i=1){return i<=0?0:-Math.log(Math.random())/i}function Af(i=.5){if(!(i<=0||i>1))return Math.floor(Math.log(Math.random())/Math.log(1-i))}function Cf(){let i,t,e;do t=2*Math.random()-1,e=2*Math.random()-1,i=t*t+e*e;while(i>=1);return t/e}function kf(i,t=1,e=0){return Math.exp(-((i-t)**2)/(2*e))/Math.sqrt(2*Math.PI*e)}var Hl=7,Ul=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];function Wl(i){if(i<.5)return Math.PI/(Math.sin(Math.PI*i)*Wl(1-i));i-=1;let t=Ul[0];for(let s=1;s<Hl+2;s++)t+=Ul[s]/(i+s);let e=i+Hl+.5;return Math.sqrt(2*Math.PI)*Math.pow(e,i+.5)*Math.exp(-e)*t}function Zl(i,t,e,s=1){let n=0;for(let r=t;r<e;r+=s)n+=i(r)*s||0;return n}function Lf(i,t){let e=Zl(s=>Math.pow(s,(t-2)/2)*Math.exp(-s/2),0,i);return 1-e/Math.pow(2,t/2)/Wl(t/2)}var pt=Object.freeze({__proto__:null,shuffle:xf,integer:$f,weighted:Bl,find:bf,smart:Pf,bernoulli:_l,binomial:Mf,poisson:Sf,uniform:Tf,normal:Vf,exponential:Ef,geometric:Af,cauchy:Cf,normalPDF:kf,integrate:Zl,chiCDF:Lf});function Of(i,t){let e=1,s=i[0];for(let n=1;n<i.length;++n)e*=t,s+=e*i[n];return s}function If(i,t=!1){let e=0,s=0,n=0,r=0,o=i.length;for(let l=0;l<o;l++)e+=i[l][0],s+=i[l][1],n+=i[l][0]*i[l][0],r+=i[l][0]*i[l][1];if(t){let l=r/n;return[0,l]}let a=(o*r-e*s)/(o*n-e*e);return[s/o-a*e/o,a]}function Gf(i){let t=[0,0,0,0,0,0];for(let r of i)t[0]+=r[0],t[1]+=r[1],t[2]+=r[0]*r[0]*r[1],t[3]+=r[1]*Math.log(r[1]),t[4]+=r[0]*r[1]*Math.log(r[1]),t[5]+=r[0]*r[1];let e=t[1]*t[2]-t[5]*t[5],s=Math.exp((t[2]*t[3]-t[5]*t[4])/e),n=(t[1]*t[4]-t[5]*t[3])/e;return[s,n]}function Rf(i){let t=[0,0,0,0],e=i.length;for(let r of i)t[0]+=Math.log(r[0]),t[1]+=r[1]*Math.log(r[0]),t[2]+=r[1],t[3]+=Math.pow(Math.log(r[0]),2);let s=(e*t[1]-t[2]*t[0])/(e*t[3]-t[0]*t[0]);return[(t[2]-s*t[0])/e,s]}function Nf(i){let t=[0,0,0,0],e=i.length;for(let r of i)t[0]+=Math.log(r[0]),t[1]+=Math.log(r[1])*Math.log(r[0]),t[2]+=Math.log(r[1]),t[3]+=Math.pow(Math.log(r[0]),2);let s=(e*t[1]-t[2]*t[0])/(e*t[3]-t[0]*t[0]);return[Math.exp((t[2]-s*t[0])/e),s]}function Fl(i,t=2){let e=i.map(h=>as(t+1).map(l=>Math.pow(h[0],l))),s=yf(e),n=i.map(h=>[h[1]]),r=zr(s,e),o=vf(r);return zr(o,s,n).map(h=>h[0])}function jl(i,t){let s=i.reduce((o,a)=>o+a[1],0)/i.length,n=i.reduce((o,a)=>o+(a[1]-s)**2,0),r=i.reduce((o,a)=>o+(a[1]-t(a[0]))**2,0);return 1-r/n}function Df(i,t=.85,e=8){if(!(i.length<=1))for(let s=1;s<e;++s){let n=Fl(i,s),r=a=>Of(n,a);if(jl(i,r)>=t)return{order:s,coefficients:n,fn:r}}}var Kl=Object.freeze({__proto__:null,linear:If,exponential:Gf,logarithmic:Rf,power:Nf,polynomial:Fl,coefficient:jl,bestPolynomial:Df});function Xl(i){return i.length?U(i)/i.length:0}var Yl='<label class="target"><input maxlength="15" autocomplete="off" aria-label="Fill in this blank"></label>';function Jl(i){if(i.match("^[0-9]+/[0-9]+$")){let t=i.split("/");return+t[0]/+t[1]}else return Fs(i)}var Br=class extends M{constructor(){super(...arguments);this.solution="";this.solutionNum=NaN;this.solutionDisplay="";this.range=0;this.input="";this.hint="";this.attempts=0;this.placeholder="???";this.done=!1}ready(){if(this.$input=this.$("input"),this.$target=this.$(".target"),this.solution=this.attr("solution"),this.solution.indexOf("\xB1")>=0){let t=this.solution.split("\xB1");this.solution=t[0].trim(),this.range=+t[1]}this.solutionNum=Jl(this.solution),this.solutionDisplay=this.solution,this.hint=this.attr("hint"),this.removeAttr("solution"),this.removeAttr("hint"),this.$input.setInputPattern(this.solution),this.hasAttr("placeholder")&&(this.placeholder=this.attr("placeholder")),this.$input.setAttr("placeholder",this.placeholder),this.removeAttr("placeholder"),this.$input.change(t=>{this.input=t,this.isCorrect&&(this.solve(),this.trigger("valid",t),this.moveCursor())}),this.$input.onKeyDown("enter",()=>this.$input.blur()),this.$input.on("focus",()=>{this.addClass("on"),this.removeClass("invalid"),this.$input.setAttr("placeholder"," ")}),this.$input.on("blur",()=>{if(this.removeClass("on"),this.setClass("invalid",!!this.input&&!this.done),this.$input.setAttr("placeholder",this.placeholder),this.input&&!this.done){this.attempts+=1;let t=this.attempts>=(this.hint?4:3)?`Hmmm\u2026 maybe try ${this.solution}?`:this.attempts>=2?this.hint:void 0;this.trigger("invalid",{hint:t})}})}setup(t,e,s){var n;this.goal=e,this.$step=t,((n=s==null?void 0:s.scores)==null?void 0:n.includes(e))&&this.solve(!0),this.one("valid",()=>{t.addHint("correct"),t.score(this.solvedBlank?this.solvedBlank.goal:e)}),this.on("invalid",r=>t.addHint(r.hint||"incorrect",{class:"incorrect"}))}get isCorrect(){if(this.done)return!0;if(this.linkedBlanks){let t=this.linkedBlanks.map(e=>e.solvedBlank);return this.solvedBlank=this.linkedBlanks.find(e=>{if(e.done&&!e.solvedBlank||t.includes(e))return!1;if(e.checkAnswer(this.input))return!0}),this.solvedBlank&&(this.solutionDisplay=this.solvedBlank.solution),!!this.solvedBlank}return this.checkAnswer(this.input)}checkAnswer(t){let e=Jl(t);return t.toLowerCase()===this.solution.toLowerCase()?!0:this.range&&Math.abs(e-this.solutionNum)<=this.range?(this.solutionDisplay=t,!0):T(e,this.solutionNum)||Ps(e)===this.solution||t===Ps(this.solutionNum)}moveCursor(){if(!this.$step)return;let t=this.$step.$blanks[this.$step.$blanks.indexOf(this)+1];!t||t.done||t.tagName==="X-BLANK-MC"||t.css("visibility")==="hidden"||!t.bounds.width||t.focus()}solve(t=!1){this.done=!0,this.$input.remove(),this.$target.html=this.solutionDisplay,this.addClass("done"),this.trigger("solve",{solution:this.solutionDisplay,restore:t})}focus(){this.$input.focus()}blur(){this.$input.blur()}};Br=b([P("x-blank",{template:Yl})],Br);var Ql='<span class="target" slot="target" tabindex="0" aria-label="Fill in this blank">???</span><div class="popup"><slot></slot></div>';var _r=class extends M{constructor(){super(...arguments);this.done=!1}ready(){this.$target=this.$(".target"),this.$popup=this.$(".popup");let t=this.$popup.$$(".choice");this.solution=t[0].html,pt.shuffle(as(t.length)).forEach(n=>{this.$popup.append(t[n]),t[n].on("click",()=>{this.removeClass("on"),t[n].blur(),n?(this.$target.html=t[n].html,this.addClass("invalid"),this.trigger("invalid")):(this.solve(),this.trigger("valid",this.solution))})});let s=this.$target.bounds.left+this.$popup.width>w.width-15;this.setClass("left",s),gs(this,{enter:()=>{if(this.done)return;this.addClass("on");let n=this.$target.bounds,r=this.$popup.width,o=this.$popup.height,a=w.width-10-n.left,h=r<a,l=n.right-r>10,u=n.top+n.height+o>w.height-10;this.setClass("left",l&&!h),this.setClass("top",u),this.$popup.css("max-width",!l&&!h?`${a}px`:"none")},exit:()=>{this.removeClass("on")},delay:100,exitDelay:400,$clickTarget:this.$target})}setup(t,e,s){var n;((n=s==null?void 0:s.scores)==null?void 0:n.includes(e))&&this.solve(!0),this.one("valid",()=>{t.addHint("correct"),t.score(e)}),this.on("invalid",r=>t.addHint(r.hint||"incorrect",{class:"incorrect"}))}solve(t=!1){this.done=!0,this.$target.html=this.solution,this.removeClass("on invalid"),this.addClass("done"),this.trigger("solve",{solution:this.solution,restore:t}),setTimeout(()=>this.$popup.remove(),250),this.$target.removeAttr("tabindex")}};_r=b([P("x-blank-mc",{template:Ql})],_r);var tc='<div class="text-area" contenteditable="true"></div><div class="toolbar"><button class="command" data-command="bold"><x-icon name="bold" size="20"></x-icon></button><button class="command" data-command="italic"><x-icon name="italic" size="20"></x-icon></button><button class="command" data-command="underline"><x-icon name="underlined" size="20"></x-icon></button><div class="space"></div><button class="btn btn-green submit"><x-icon name="check"></x-icon> Done</button></div>';var ec=40,sc="free-text",Hr=class extends M{setup(t,e,s){var l,u;let n=this.$(".text-area"),r=this.$(".toolbar .submit"),o=((l=s==null?void 0:s.data)==null?void 0:l[sc])||"";o&&(n.html=o);for(let d of this.$$(".toolbar .command")){let m=d.data.command.split(":");d.on("click",()=>document.execCommand(m[0],!1,m[1]))}let a=o,h=Oi(()=>{a!==o&&t.storeData(sc,o),a=o},5e3);n.on("change keyup input paste",()=>{o=n.html.replace(/&nbsp;/g," ").trim().slice(0,500).trim(),r.setClass("invisible",o.length<ec),h()}),((u=s==null?void 0:s.scores)==null?void 0:u.includes(e))?r.remove():(r.setClass("invisible",o.length<ec),r.on("click",()=>{h(),t.score(e),r.exit("pop"),this.trigger("submit")}))}};Hr=b([P("x-free-text",{template:tc})],Hr);var ic='<div class="wrapper"><div class="panel"><slot></slot></div></div><div class="nav"><button class="btn back" aria-label="Previous Step"><x-icon name="left"></x-icon></button><button class="btn next" aria-label="Next Step"><x-icon name="right"></x-icon></button><div class="dots"></div></div>';var Ur=class extends M{ready(){let t=this.$(".wrapper"),e=this.$(".panel"),s=e.children,n=this.$(".next"),r=this.$(".back"),o=this.$(".dots"),a=s.map(()=>c("div",{class:"dot"},o)),h=s.length,l=+this.attr("slide-width")||void 0,u=this.width,d=1,m=u,$=0,k=0,g=it=>{k=it,e.translate(it,0),this.trigger("move",it)},y=it=>{$=it;for(let[Xt,Gs]of a.entries())Gs.setClass("on",Xt>=it&&Xt<it+d);n.setClass("disabled",it===h-d),r.setClass("disabled",it===0),this.trigger("change",it)};w.onResize(()=>{u=this.width,d=l?Math.ceil(u/l):1,m=u/d;for(let it of s)it.css("width",m+"px");e.css("width",h*m+"px"),g(-$*m),y($)});let v="quad",B=500,Y,ue,Ai,Is,Bn=!1,ah=()=>{Y=Date.now()-Is,g(ue+Ai*K(v,Y/B)),!Bn&&Y<B?requestAnimationFrame(ah):this.trigger("slide-end")},_n=it=>{Bn=!1,Y=0,ue=k,Ai=-it*m-k,Is=Date.now(),y(it),ah()};n.on("click",()=>{v="quad",$<h-d&&_n($+1)}),r.on("click",()=>{v="quad",$>0&&_n($-1)});let hh,Hn,Un,Ci;Ge(t,{start:it=>{Bn=!0,hh=k,Hn=it.x,Ci=Un=Hn},move:it=>{Un=Ci,Ci=it.x;let Xt=hh-Hn+it.x,Gs=-(h-d)*m,$u=Xt>0?Xt/4:Xt<Gs?Gs+(Xt-Gs)/4:Xt;g($u),this.css("pointer-events","none")},end:()=>{let it=Ci-Un,Xt=it>12?1:it<-12?-1:0;v="quad-out",_n(L(Math.round(-k/m-Xt),0,h-d)),setTimeout(()=>this.css("pointer-events","auto"))}})}};Ur=b([P("x-gallery",{template:ic})],Ur);var Zt=2*Math.PI;function _e(i,t){let e=Math.atan2(i.y-(t?t.y:0),i.x-(t?t.x:0));return kt(e,Zt)}var p=class{constructor(t=0,e=0){this.x=t,this.y=e,this.type="point"}get unitVector(){return T(this.length,0)?new p(1,0):this.scale(1/this.length)}get length(){return Math.sqrt(this.x**2+this.y**2)}get inverse(){return new p(-this.x,-this.y)}get flip(){return new p(this.y,this.x)}get perpendicular(){return new p(-this.y,this.x)}get array(){return[this.x,this.y]}distanceFromLine(t){return p.distance(this,t.project(this))}clamp(t,e=0){let s=L(this.x,t.xMin+e,t.xMax-e),n=L(this.y,t.yMin+e,t.yMax-e);return new p(s,n)}changeCoordinates(t,e){let s=e.xMin+(this.x-t.xMin)/t.dx*e.dx,n=e.yMin+(this.y-t.yMin)/t.dy*e.dy;return new p(s,n)}add(t){return p.sum(this,t)}subtract(t){return p.difference(this,t)}round(t=1){return new p(Vt(this.x,t),Vt(this.y,t))}floor(){return new p(Math.floor(this.x),Math.floor(this.y))}mod(t,e=t){return new p(this.x%t,this.y%e)}angle(t=A){return _e(this,t)}snap(t,e=5){return T(this.x,t.x,e)?new p(t.x,this.y):T(this.y,t.y,e)?new p(this.x,t.y):this}static average(...t){let e=U(t.map(n=>n.x))/t.length,s=U(t.map(n=>n.y))/t.length;return new p(e,s)}static dot(t,e){return t.x*e.x+t.y*e.y}static sum(t,e){return new p(t.x+e.x,t.y+e.y)}static difference(t,e){return new p(t.x-e.x,t.y-e.y)}static distance(t,e){return Math.sqrt(Bt(t.x-e.x)+Bt(t.y-e.y))}static manhattan(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}static interpolate(t,e,s=.5){return new p(bt(t.x,e.x,s),bt(t.y,e.y,s))}static interpolateList(t,e=.5){let s=t.length-1,n=Math.floor(L(e,0,1)*s);return p.interpolate(t[n],t[n+1],s*e-n)}static fromPolar(t,e=1){return new p(e*Math.cos(t),e*Math.sin(t))}static random(t){let e=pt.uniform(t.xMin,t.xMax),s=pt.uniform(t.yMin,t.yMax);return new p(e,s)}transform(t){let e=t[0][0]*this.x+t[0][1]*this.y+t[0][2],s=t[1][0]*this.x+t[1][1]*this.y+t[1][2];return new p(e,s)}rotate(t,e=A){if(T(t,0))return this;let s=this.x-e.x,n=this.y-e.y,r=Math.cos(t),o=Math.sin(t),a=s*r-n*o+e.x,h=s*o+n*r+e.y;return new p(a,h)}reflect(t){let e=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y,n=this.x-t.p1.x,r=this.y-t.p1.y,o=(e*r-s*n)/(e*e+s*s),a=this.x+2*o*s,h=this.y-2*o*e;return new p(a,h)}scale(t,e=t){return new p(this.x*t,this.y*e)}shift(t,e=t){return new p(this.x+t,this.y+e)}translate(t){return this.shift(t.x,t.y)}equals(t,e){return T(this.x,t.x,e)&&T(this.y,t.y,e)}},A=new p(0,0),xe=class{constructor(t,e,s){this.c=t,this.start=e,this.angle=s,this.type="arc"}get radius(){return p.distance(this.c,this.start)}get end(){return this.start.rotate(this.angle,this.c)}get startAngle(){return _e(this.start,this.c)}contract(t){return new this.constructor(this.c,this.at(t/2),this.angle*(1-t))}get minor(){return this.angle<=Math.PI?this:new this.constructor(this.c,this.end,Zt-this.angle)}get major(){return this.angle>=Math.PI?this:new this.constructor(this.c,this.end,Zt-this.angle)}get center(){return this.at(.5)}project(t){let e=this.startAngle,s=e+this.angle,n=_e(t,this.c);return s>Zt&&n<s-Zt&&(n+=Zt),n=L(n,e,s),this.c.shift(this.radius,0).rotate(n,this.c)}at(t){return this.start.rotate(this.angle*t,this.c)}contains(t){return t.equals(this.project(t))}transform(t){return new this.constructor(this.c.transform(t),this.start.transform(t),this.angle)}rotate(t,e=A){return T(t,0)?this:new this.constructor(this.c.rotate(t,e),this.start.rotate(t,e),this.angle)}reflect(t){return new this.constructor(this.c.reflect(t),this.start.reflect(t),this.angle)}scale(t,e=t){return new this.constructor(this.c.scale(t,e),this.start.scale(t,e),this.angle)}shift(t,e=t){return new this.constructor(this.c.shift(t,e),this.start.shift(t,e),this.angle)}translate(t){return this.shift(t.x,t.y)}equals(){return!1}},$e=class extends xe{constructor(){super(...arguments);this.type="sector"}},et=class{constructor(t,e){this.p1=t,this.p2=e,this.type="line"}make(t,e){return new et(t,e)}get length(){return p.distance(this.p1,this.p2)}get lengthSquared(){return(this.p1.x-this.p2.x)**2+(this.p1.y-this.p2.y)**2}get midpoint(){return p.average(this.p1,this.p2)}get slope(){return(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)}get intercept(){return this.p1.y+this.slope*this.p1.x}get angle(){return _e(this.p2,this.p1)}get unitVector(){return this.p2.subtract(this.p1).unitVector}get perpendicularVector(){return new p(this.p2.y-this.p1.y,this.p1.x-this.p2.x).unitVector}parallel(t){let e=p.sum(t,p.difference(this.p2,this.p1));return new et(t,e)}perpendicular(t){return new et(t,p.sum(t,this.perpendicularVector))}get perpendicularBisector(){return this.perpendicular(this.midpoint)}distanceSquared(t){let e=this.project(t);return(t.x-e.x)**2+(t.y-e.y)**2}offset(t){let e=p.difference(this.p2,this.p1),s=p.difference(t,this.p1);return p.dot(e,s)/this.lengthSquared}project(t){return this.at(this.offset(t))}side(t,e){let s=p.difference(this.p2,this.p1),n=p.difference(t,this.p1),r=n.x*s.y-n.y*s.x;return T(r,0,e)?0:Math.sign(r)}contains(t,e){return this.side(t,e)===0}at(t){return p.interpolate(this.p1,this.p2,t)}transform(t){return new this.constructor(this.p1.transform(t),this.p2.transform(t))}rotate(t,e=A){return T(t,0)?this:new this.constructor(this.p1.rotate(t,e),this.p2.rotate(t,e))}reflect(t){return new this.constructor(this.p1.reflect(t),this.p2.reflect(t))}scale(t,e=t){return this.make(this.p1.scale(t,e),this.p2.scale(t,e))}shift(t,e=t){return this.make(this.p1.shift(t,e),this.p2.shift(t,e))}translate(t){return this.shift(t.x,t.y)}equals(t,e){return this.contains(t.p1,e)&&this.contains(t.p2,e)}},Ks=class extends et{constructor(){super(...arguments);this.type="ray"}make(t,e){return new Ks(t,e)}equals(t,e){return t.type!=="ray"?!1:this.p1.equals(t.p1,e)&&this.contains(t.p2,e)}},_=class extends et{constructor(){super(...arguments);this.type="segment"}contains(t,e){return et.prototype.contains.call(this,t,e)?this.p1.equals(t,e)||this.p2.equals(t,e)?!0:T(this.p1.x,this.p2.x,e)?Tt(t.y,this.p1.y,this.p2.y):Tt(t.x,this.p1.x,this.p2.x):!1}make(t,e){return new _(t,e)}project(t){let e=p.difference(this.p2,this.p1),s=p.difference(t,this.p1),n=L(p.dot(e,s)/this.lengthSquared,0,1);return p.sum(this.p1,e.scale(n))}contract(t){return new _(this.at(t),this.at(1-t))}equals(t,e,s=!1){return t.type!=="segment"?!1:this.p1.equals(t.p1,e)&&this.p2.equals(t.p2,e)||!s&&this.p1.equals(t.p2,e)&&this.p2.equals(t.p1,e)}},ww=180/Math.PI,yw=Math.PI/180;var yt=class{constructor(t,e,s){this.a=t,this.b=e,this.c=s,this.type="angle"}static fromDegrees(t){return yt.fromRadians(t*(Math.PI/180))}static fromRadians(t){let e=new p(1,0),s=e.rotate(t);return new yt(e,A,s)}get rad(){let t=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x),s=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x)-t;return s<0&&(s+=Zt),s}get deg(){return this.rad*180/Math.PI}get isRight(){return T(this.rad,Math.PI/2,Math.PI/360)}get bisector(){if(this.b.equals(this.a)||this.b.equals(this.c))return;let t=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x),e=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x),s=(t+e)/2;t>e&&(s+=Math.PI);let n=Math.cos(s)+this.b.x,r=Math.sin(s)+this.b.y;return new et(this.b,new p(n,r))}get sup(){return this.rad<Math.PI?this:new yt(this.c,this.b,this.a)}get arc(){return new xe(this.b,this.a,this.rad)}project(){return this.c}at(){return this.c}contains(){return!1}transform(t){return new yt(this.a.transform(t),this.b.transform(t),this.c.transform(t))}rotate(t,e){return T(t,0)?this:new yt(this.a.rotate(t,e),this.b.rotate(t,e),this.c.rotate(t,e))}reflect(t){return new yt(this.a.reflect(t),this.b.reflect(t),this.c.reflect(t))}scale(t,e=t){return new yt(this.a.scale(t,e),this.b.scale(t,e),this.c.scale(t,e))}shift(t,e=t){return new yt(this.a.shift(t,e),this.b.shift(t,e),this.c.shift(t,e))}translate(t){return new yt(this.a.translate(t),this.b.translate(t),this.c.translate(t))}equals(t){return!1}},H=class{constructor(t=A,e=1){this.c=t,this.r=e,this.type="circle"}get circumference(){return Zt*this.r}get area(){return Math.PI*this.r**2}get arc(){let t=this.c.shift(this.r,0);return new xe(this.c,t,Zt)}tangentAt(t){let e=this.at(t),s=this.c.rotate(Math.PI/2,e);return new et(e,s)}collision(t){let e=this.c.x<t.p.x?t.p.x:this.c.x>t.p.x+t.w?t.p.x+t.w:this.c.x,s=this.c.y<t.p.y?t.p.y:this.c.y>t.p.y+t.h?t.p.y+t.h:this.c.y;return p.distance(this.c,new p(e,s))<=this.r}project(t){let e=t.subtract(this.c).unitVector.scale(this.r);return p.sum(this.c,e)}at(t){let e=Zt*t;return this.c.shift(this.r*Math.cos(e),this.r*Math.sin(e))}contains(t){return p.distance(t,this.c)<=this.r}transform(t){let e=Math.abs(t[0][0])+Math.abs(t[1][1]);return new H(this.c.transform(t),this.r*e/2)}rotate(t,e=A){return T(t,0)?this:new H(this.c.rotate(t,e),this.r)}reflect(t){return new H(this.c.reflect(t),this.r)}scale(t,e=t){return new H(this.c.scale(t,e),this.r*(t+e)/2)}shift(t,e=t){return new H(this.c.shift(t,e),this.r)}translate(t){return this.shift(t.x,t.y)}equals(t,e){return T(this.r,t.r,e)&&this.c.equals(t.c,e)}};function be(i){return["polygon","polyline","rectangle","triangle"].includes(i.type)}function Wr(i){return["polygon","triangle"].includes(i.type)}function qf(i){return i.type==="polyline"}function Zr(i){return i.type==="rectangle"}function at(i){return["line","ray","segment"].includes(i.type)}function Fr(i){return i.type==="line"}function zf(i){return i.type==="ray"}function Xs(i){return i.type==="segment"}function st(i){return i.type==="circle"}function Ft(i){return i.type==="arc"}function ae(i){return i.type==="sector"}function jr(i){return i.type==="angle"}function ut(i){return i.type==="point"}function Bf(i,t){return T(i.p1.x,i.p2.x)?Tt(t.y,i.p1.y,i.p2.y):Tt(t.x,i.p1.x,i.p2.x)}function _f(i,t){return T(i.p1.x,i.p2.x)?(t.y-i.p1.y)/(i.p2.y-i.p1.y)>0:(t.x-i.p1.x)/(i.p2.x-i.p1.x)>0}function Hf(i,t){let e=i.p1.x-i.p2.x,s=i.p1.y-i.p2.y,n=t.p1.x-t.p2.x,r=t.p1.y-t.p2.y,o=e*r-s*n;if(T(o,0))return[];let a=i.p1.x*i.p2.y-i.p1.y*i.p2.x,h=t.p1.x*t.p2.y-t.p1.y*t.p2.x,l=a*n-e*h,u=a*r-s*h;return[new p(l/o,u/o)]}function Uf(i,t){let e=p.distance(i.c,t.c);if(e>i.r+t.r)return[];if(e<Math.abs(i.r-t.r))return[];if(T(e,0)&&T(i.r,t.r))return[];if(T(e,i.r+t.r))return[new et(i.c,t.c).midpoint];let s=(Bt(i.r)-Bt(t.r)+Bt(e))/(2*e),n=Math.sqrt(Bt(i.r)-Bt(s)),r=(t.c.x-i.c.x)*s/e+(t.c.y-i.c.y)*n/e+i.c.x,o=(t.c.y-i.c.y)*s/e-(t.c.x-i.c.x)*n/e+i.c.y,a=(t.c.x-i.c.x)*s/e-(t.c.y-i.c.y)*n/e+i.c.x,h=(t.c.y-i.c.y)*s/e+(t.c.x-i.c.x)*n/e+i.c.y;return[new p(r,o),new p(a,h)]}function nc(i,t){let e=i.p2.x-i.p1.x,s=i.p2.y-i.p1.y,n=Bt(e)+Bt(s),r=t.c.x,o=t.c.y,a=(i.p1.x-r)*(i.p2.y-o)-(i.p2.x-r)*(i.p1.y-o),h=Bt(t.r)*n-Bt(a);if(h<0)return[];let l=a*s/n,u=-a*e/n;if(T(h,0))return[t.c.shift(l,u)];let d=e*(s<0?-1:1)*Math.sqrt(h)/n,m=Math.abs(s)*Math.sqrt(h)/n;return[t.c.shift(l+d,u+m),t.c.shift(l-d,u-m)]}function Wf(i,t){let e=[];at(i)&&at(t)?e=Hf(i,t):at(i)&&st(t)?e=nc(i,t):st(i)&&at(t)?e=nc(t,i):st(i)&&st(t)&&(e=Uf(i,t));for(let s of[i,t])s.type==="segment"&&(e=e.filter(n=>Bf(s,n))),s.type==="ray"&&(e=e.filter(n=>_f(s,n)));return e}function ht(...i){if(i.length<2)return[];if(i.length>2)return Yt(ql(i,2).map(s=>ht(...s)));let[t,e]=i;if(be(e)&&([t,e]=[e,t]),be(t)){let s=at(e)?t.points.filter(n=>e.contains(n)):[];for(let n of t.edges)s.push(...ht(n,e));return s}return Wf(t,e)}var O=class{constructor(...t){this.type="polygon",this.points=t}get circumference(){if(this.points.length<=1)return 0;let t=p.distance(this.points[0],N(this.points));for(let e=1;e<this.points.length;++e)t+=p.distance(this.points[e-1],this.points[e]);return t}get signedArea(){let t=this.points,e=t.length,s=t[e-1].x*t[0].y-t[0].x*t[e-1].y;for(let n=1;n<e;++n)s+=t[n-1].x*t[n].y-t[n].x*t[n-1].y;return s/2}get area(){return Math.abs(this.signedArea)}get centroid(){let t=this.points,e=t.length,s=0;for(let r=0;r<e;++r)s+=t[r].x;let n=0;for(let r=0;r<e;++r)n+=t[r].y;return new p(s/e,n/e)}get edges(){let t=this.points,e=t.length,s=[];for(let n=0;n<e;++n)s.push(new _(t[n],t[(n+1)%e]));return s}get radius(){let t=this.centroid,e=this.points.map(s=>p.distance(s,t));return Math.max(...e)}get oriented(){if(this.signedArea>=0)return this;let t=[...this.points].reverse();return new this.constructor(...t)}cut(t){let e=[],s=[];for(let h of this.edges){let l=t.side(h.p1),u=t.side(h.p2);if(l&&u&&l!==u){let d=ht(h,t)[0];e.push(new _(h.p1,d));let m=new _(d,h.p2);m.flag=u,e.push(m),s.push(m)}else l===0&&u&&(s.push(h),h.flag=u),e.push(h)}if(s.length<2)return[this];s.sort((h,l)=>t.offset(h.p1)-t.offset(l.p1));let n=(h,l)=>{let u=e.length,d=[];l<h&&(l+=u);for(let m=h;m<=l;m++)d.push(e[m%u]);return d},r=h=>{let l=e.length,u=e[h].flag,d=h;for(;;)if(d=(d+1)%l,e[d].flag===u&&(e[d].flag=void 0,s.splice(s.indexOf(e[d]),1)),d===h||e[d].flag)return d},o=[],a=0;for(;s.length>=2;){let h=s[0],l=s[1],u=e.indexOf(h),d=e.indexOf(l),m=!1;if(r(u)===d?m=!0:([h,l]=[l,h],[u,d]=[d,u],r(u)===d&&(m=!0)),m?(a--,o.push(n(u,d)),e=n(d,u),h.flag=l.flag=void 0,s.splice(0,2),s.length<2&&o.push(e)):(a++,s.reverse()),a>1)break}return o.map(h=>new O(...h.map(l=>l.p1)))}static collision(t,e){if(t.points.some(s=>e.contains(s))||e.points.some(s=>t.contains(s)))return!0;for(let s of t.edges)for(let n of e.edges)if(ht(s,n)[0])return!0;return!1}static regular(t,e=1){let s=Zt/t,n=Math.PI/2-s/2,r=z(o=>p.fromPolar(n+s*o,e),t);return new O(...r)}static interpolate(t,e,s=.5){let n=t.points.map((r,o)=>p.interpolate(r,e.points[o],s));return new O(...n)}contains(t){let e=!1;for(let s of this.edges){if(s.p1.equals(t)||s.contains(t))return!1;if(s.p1.y>t.y==s.p2.y>t.y)continue;let n=(s.p2.x-s.p1.x)/(s.p2.y-s.p1.y);t.x<n*(t.y-s.p1.y)+s.p1.x&&(e=!e)}return e}at(t){return p.interpolateList([...this.points,this.points[0]],t)}project(t){let e,s=Infinity;for(let n of this.edges){let r=n.project(t),o=p.distance(t,r);o<s&&(e=r,s=o)}return e||this.points[0]}transform(t){return new this.constructor(...this.points.map(e=>e.transform(t)))}rotate(t,e=A){if(T(t,0))return this;let s=this.points.map(n=>n.rotate(t,e));return new this.constructor(...s)}reflect(t){let e=this.points.map(s=>s.reflect(t));return new this.constructor(...e)}scale(t,e=t){let s=this.points.map(n=>n.scale(t,e));return new this.constructor(...s)}shift(t,e=t){let s=this.points.map(n=>n.shift(t,e));return new this.constructor(...s)}translate(t){return this.shift(t.x,t.y)}equals(t){return!1}},Pe=class extends O{constructor(){super(...arguments);this.type="polyline"}get length(){let t=0;for(let e=1;e<this.points.length;++e)t+=p.distance(this.points[e-1],this.points[e]);return t}get edges(){let t=[];for(let e=0;e<this.points.length-1;++e)t.push(new _(this.points[e],this.points[e+1]));return t}},Kr=class extends O{constructor(){super(...arguments);this.type="triangle"}get circumcircle(){let[t,e,s]=this.points,n=2*(t.x*(e.y-s.y)+e.x*(s.y-t.y)+s.x*(t.y-e.y)),r=(t.x**2+t.y**2)*(e.y-s.y)+(e.x**2+e.y**2)*(s.y-t.y)+(s.x**2+s.y**2)*(t.y-e.y),o=(t.x**2+t.y**2)*(s.x-e.x)+(e.x**2+e.y**2)*(t.x-s.x)+(s.x**2+s.y**2)*(e.x-t.x),a=new p(r/n,o/n),h=p.distance(a,this.points[0]);return new H(a,h)}get incircle(){let t=this.edges,e=t.map(d=>d.length),s=e[0]+e[1]+e[2],[n,r,o]=this.points,a=e[1]*n.x+e[2]*r.x+e[0]*o.x,h=e[1]*n.y+e[2]*r.y+e[0]*o.y,l=new p(a/s,h/s),u=l.distanceFromLine(t[0]);return new H(l,u)}get orthocenter(){let[t,e,s]=this.points,n=new et(t,e).perpendicular(s),r=new et(t,s).perpendicular(e);return ht(n,r)[0]}},V=class{constructor(t,e=1,s=e){this.p=t,this.w=e,this.h=s,this.type="rectangle"}static aroundPoints(t){let e=Infinity,s=-Infinity,n=Infinity,r=-Infinity;for(let o of t)e=e<o.x?e:o.x,s=s>o.x?s:o.x,n=n<o.y?n:o.y,r=r>o.y?r:o.y;return new V(new p(e,n),s-e,r-n)}get center(){return new p(this.p.x+this.w/2,this.p.y+this.h/2)}get centroid(){return this.center}get circumference(){return 2*Math.abs(this.w)+2*Math.abs(this.h)}get area(){return Math.abs(this.w*this.h)}get edges(){return this.polygon.edges}get points(){return this.polygon.points}get polygon(){let t=new p(this.p.x+this.w,this.p.y),e=new p(this.p.x+this.w,this.p.y+this.h),s=new p(this.p.x,this.p.y+this.h);return new O(this.p,t,e,s)}collision(t){return this.p.x<t.p.x+t.w&&this.p.x+this.w>t.p.x&&this.p.y<t.p.y+t.h&&this.p.y+this.h>t.p.y}contains(t,e){return Tt(t.x,this.p.x,this.p.x+this.w,e)&&Tt(t.y,this.p.y,this.p.y+this.h,e)}project(t){let e;for(let s of this.edges){let n=s.project(t);(!e||p.distance(t,n)<p.distance(t,e))&&(e=n)}return e}at(t){return this.p}transform(t){return this.polygon.transform(t)}rotate(t,e=A){return T(t,0)?this:this.polygon.rotate(t,e)}reflect(t){return this.polygon.reflect(t)}scale(t,e=t){return new V(this.p.scale(t,e),this.w*t,this.h*e)}shift(t,e=t){return new V(this.p.shift(t,e),this.w,this.h)}translate(t){return this.shift(t.x,t.y)}equals(t){return!1}},xt=class{constructor(t,e,s,n){this.xMin=t,this.xMax=e,this.yMin=s,this.yMax=n}contains(t){return this.containsX(t)&&this.containsY(t)}containsX(t){return Tt(t.x,this.xMin,this.xMax)}containsY(t){return Tt(t.y,this.yMin,this.yMax)}resize(t,e){return new xt(this.xMin,this.xMax+t,this.yMin,this.yMax+e)}get dx(){return this.xMax-this.xMin}get dy(){return this.yMax-this.yMin}get xRange(){return[this.xMin,this.xMax]}get yRange(){return[this.yMin,this.yMax]}get rect(){return new V(new p(this.xMin,this.yMin),this.dx,this.dy)}get center(){return new p(this.xMin+this.dx/2,this.yMin+this.dy/2)}get flip(){return new xt(this.yMin,this.yMax,this.xMin,this.xMax)}};function Xr(i,t,e){let n=t.x*(e.y-i.y)+i.x*(t.y-e.y)+e.x*(i.y-t.y)>0?1:0,r=p.distance(t,i);return[i.x,i.y+"A"+r,r,0,n,1,e.x,e.y].join(",")}function Yr(i,t={}){return i.isRight&&!t.round?20:24+20*(1-L(i.rad,0,Math.PI)/Math.PI)}function Zf(i,t={}){let e=i.a,s=i.b,n=i.c,r=t.size||Yr(i,t),o=p.difference(e,s).unitVector,a=p.difference(n,s).unitVector;e=p.sum(s,o.scale(r)),n=p.sum(s,a.scale(r));let h=t.fill?`M${s.x},${s.y}L`:"M";if(i.isRight&&!t.round){let l=p.sum(e,a.scale(r));h+=`${e.x},${e.y}L${l.x},${l.y}L${n.x},${n.y}`}else h+=Xr(e,s,n);return t.fill&&(h+="Z"),h}function Gt(...i){return"M"+i.map(t=>t.x+","+t.y).join("L")}function rc(i,t){let e=i.perpendicularVector.scale(6),s=i.unitVector.scale(3),n=i.midpoint;switch(t){case"bar":return Gt(n.add(e),n.add(e.inverse));case"bar2":return Gt(n.add(s).add(e),n.add(s).add(e.inverse))+Gt(n.add(s.inverse).add(e),n.add(s.inverse).add(e.inverse));case"arrow":return Gt(n.add(s.inverse).add(e),n.add(s),n.add(s.inverse).add(e.inverse));case"arrow2":return Gt(n.add(s.scale(-2)).add(e),n,n.add(s.scale(-2)).add(e.inverse))+Gt(n.add(e),n.add(s.scale(2)),n.add(e.inverse));default:return""}}function on(i,t){if(!i||!t)return"";let e=t.perpendicular,s=i.add(t.scale(9)).add(e.scale(9)),n=i.add(t.scale(9)).add(e.scale(-9));return Gt(s,i,n)}function Ff(i,t){let e="";return R(t,"start","both")&&(e+=on(i.p1,i.unitVector)),R(t,"end","both")&&(e+=on(i.p2,i.unitVector.inverse)),e}function jf(i,t){let e="";if(R(t,"start","both")){let s=new et(i.c,i.start).perpendicularVector.inverse;e+=on(i.start,s)}if(R(t,"end","both")){let s=new et(i.c,i.end).perpendicularVector;e+=on(i.end,s)}return e}function Ys(i,t={}){if(jr(i))return Zf(i,t);if(Xs(i)){if(i.p1.equals(i.p2))return"";let e=Gt(i.p1,i.p2);return t.mark&&(e+=rc(i,t.mark)),t.arrows&&(e+=Ff(i,t.arrows)),e}if(zf(i)){if(!t.box)return"";let e=ht(i,t.box)[0];return e?Gt(i.p1,e):""}if(Fr(i)){if(!t.box)return"";let e=ht(i,t.box);if(e.length<2)return"";let s=Gt(e[0],e[1]);return t.mark&&(s+=rc(i,t.mark)),s}if(st(i))return`M ${i.c.x-i.r} ${i.c.y} a ${i.r},${i.r} 0 1 0 ${2*i.r} 0 a ${i.r} ${i.r} 0 1 0 ${-2*i.r} 0`;if(Ft(i)){let e="M"+Xr(i.start,i.c,i.end);return t.arrows&&(e+=jf(i,t.arrows)),e}return ae(i)?`M ${i.c.x} ${i.c.y} L ${Xr(i.start,i.c,i.end)} Z`:qf(i)?Gt(...i.points):Wr(i)?Gt(...i.points)+"Z":Zr(i)?Gt(...i.polygon.points)+"Z":""}var oc='<svg width="70" height="80"><path d="M20.5,7.4,27.2,24c-1.9-4.7,6-7.1,8-2.3l1.4,3.6c-1.9-4.8,6.1-7.1,8-2.3l1.3,3.1c-2-4.7,5.7-6.5,7.7-1.8,3.3,7.8,5.8,13.6,9,21.3S60.8,56.2,65,66.7L44.9,75A13.9,13.9,0,0,0,36,66.9c-7.7-2.2-11.4-8.3-18.4-14.3a44.2,44.2,0,0,0-9.5-6.5c-2.6-1.5-4.2-3.4-2.2-5.7,3.5-4.1,9.3-1.3,13.1,1.5,1.6,1.2,4.4,4.1,5.9,3.8s1.7-.8,1-2.6L12.8,10.5c-1.9-4.7,5.8-7.9,7.7-3.1Z"></path></svg>';function Jr(i,t){let e=t.positionLeft-i.positionLeft+t.width/2,s=t.positionTop-i.positionTop+t.height/2;return new p(e,s)}function ac(i){return i?new p(...i.split(",").map(t=>+t)):void 0}var Qr=class extends M{constructor(){super(...arguments);this.doAnimation=!1}created(){this.slide=ac(this.attr("slide")),this.shift=ac(this.attr("offset"))}ready(){this.$target=E(this.attr("target")),this.$target&&(this.$target.on("click pointerdown focus",()=>this.stop()),this.hasAttr("start")&&this.start())}setTarget(t,e,s){this.$target=typeof t=="string"?E(t):t,e&&(this.slide=e),s&&(this.slide=s)}start(t){this.doAnimation||!this.from&&!this.$target||(this.doAnimation=!0,t&&(this.slide=t),this.slide||this.$end?this.runSlideAnimation():this.runClickAnimation())}startSlide(t,e){this.$target=t,this.$end=e,this.start()}stop(){this.doAnimation=!1}runSlideAnimation(){return S(this,null,function*(){this.show();let t=this.from||Jr(this,this.$target);this.shift&&(t=t.add(this.shift));let e=this.slide?t.add(this.slide):Jr(this,this.$end),s=`translate(${t.x-15}px,${t.y-10}px)`,n=`translate(${e.x-15}px,${e.y-10}px)`;yield this.animate({transform:[s+" scale(2)",s],opacity:[0,1]},300).promise,yield this.animate({transform:[s,n]},1e3).promise,yield this.animate({transform:[n,n+" scale(2)"],opacity:[1,0]},300).promise,this.hide(),setTimeout(()=>{this.doAnimation&&this.runSlideAnimation()},1e3)})}runClickAnimation(){return S(this,null,function*(){this.show();let t=this.from||Jr(this,this.$target);this.shift&&(t=t.add(this.shift));let e=`translate(${t.x-15}px,${t.y-10}px)`;yield this.animate({transform:[e+" scale(2)",e],opacity:[0,1]},500).promise,yield this.animate({transform:[e,e+" scale(2)"],opacity:[1,0]},500,200).promise,this.hide(),setTimeout(()=>{this.doAnimation&&this.runClickAnimation()},1e3)})}};Qr=b([P("x-gesture",{template:oc})],Qr);var to='<span class="target" tabindex="0"><slot></slot></span><div class="popup"></div>';var Kf=JSON.parse(E("#glossary").text),Xf=JSON.parse(E("#bios").text),eo=600,an;w.onResize(()=>{an&&an.hide()});var hn=class extends M{ready(){this.xid=this.attr("xid"),this.$target=this.$(".target"),this.$popup=this.$(".popup"),this.$popup.html=this.body()||"",this.setClass("left",w.width>eo&&this.$target.bounds.left+this.$popup.width>w.width-15),gs(this,{enter:()=>this.show(),exit:()=>this.hide(),delay:100,exitDelay:200,$clickTarget:this.$target,canFocusWithin:!0,preventMouseover:()=>w.width<=eo})}show(){if(an=this,this.addClass("on"),w.width<=eo){let o=E("#glossary-modal");return o.$(".modal-body").html=this.body(),o.open()}let t=this.$target.bounds,e=this.$popup.width,s=this.$popup.height,n=t.top+t.height+s<w.height-10,r=t.top-s>54;this.setClass("top",r&&!n),this.setClass("left",t.left+e>w.width-15)}hide(){an=void 0,this.removeClass("on")}body(){let t=Kf[this.xid];if(!t)return console.warn("missing gloss:",this.xid);let e=t.text;return t.image&&(e+=`<img class="gloss-img" alt="" src="/content/shared/glossary/${t.image}"/>`),t.link&&(location.pathname===t.link.split("#")[0]||(e+=`<p><a href="${t.link}" class="btn btn-white btn-small">Learn more\u2026</a></p>`)),e}};hn=b([P("x-gloss",{template:to})],hn);var so=class extends hn{body(){let t=Xf[this.xid];if(!t)return console.warn("missing bio:",this.xid);let e=`<img class="bio-img" alt="" src="/content/shared/bios/${this.xid}.jpg"/>`,s=t.born?`<p><a href="/timeline/${this.xid}" class="btn btn-white btn-small" target="_blank">Timeline</a></p>`:"";return(t.image===!1?"":e)+t.bio+s}};so=b([P("x-bio",{template:to})],so);var hc='<div class="wrap"><img alt=""><div class="credit"></div><button class="zoom"><x-icon name="fullscreen" size="24"></x-icon></button><slot></slot></div>';var Yf=document.createElement("a").relList.supports("ar"),ln=!1,io={x:0,y:0,s:1},lc,He=c("div",{class:"lightbox-overlay"},G),he=c("div",{class:"lightbox-img"},He);function Jf(i,t,e){ln=!0,lc=i,He.show(),he.show();let s=i.bounds,n=he.bounds,r=s.left+s.width/2-n.left-n.width/2,o=s.top+s.height/2-n.top-n.height/2,a=Math.max(s.width/n.width,s.height/n.height);io={x:r,y:o,s:a},he.css("background-image",`url(${e}), url(${t})`),he.css("transform",`translate(${r}px, ${o}px) scale(${a})`),w.redraw(),he.addClass("transitions"),w.redraw(),i.css("visibility","hidden"),He.addClass("on"),he.css("transform","scale(1) translate(0,0)")}function cc(){!ln||(ln=!1,He.removeClass("on"),he.setTransform(io,0,io.s),setTimeout(()=>{lc.css("visibility","visible"),He.css("display","none"),he.css("transform","none"),he.removeClass("transitions")},400))}He.on("click touchmove",cc);w.onKey("escape",cc);He.on("scrollwheel touchmove",i=>{i.preventDefault(),i.stopPropagation()});w.onKey("space up down left right pagedown pageup",i=>{ln&&(i.preventDefault(),i.stopPropagation())});var no=class extends M{ready(){let t=this.attr("src"),e=this.$(".wrap"),s=this.attr("width"),n=this.attr("height");this.css("width",s+"px"),e.css("padding-bottom",+n/+s*100+"%");let r=e.$("img");r.setAttr("src",t),r.setAttr("alt",this.attr("alt")||""),r.setAttr("width",s),r.setAttr("height",n),t.endsWith(".gif")&&r.on("click",()=>r.setAttr("src",t));let o=e.$(".credit"),a=this.attr("credit");a?o.text=a:o.remove();let h=e.$(".zoom");if(this.hasAttr("lightbox")){this.addClass("interactive");let l=t.replace(/\.(?=[^.]*$)/,"-large.");this.on("click",()=>Jf(this,t,l))}else h.remove();if(Yf&&this.hasAttr("ar")){let l=c("a",{href:this.attr("ar"),rel:"ar"});e.prepend(l),l.append(r)}}};no=b([P("x-img",{template:hc})],no);var ro=class extends M{constructor(){super(...arguments);this.correctCount=0;this.solvedCount=0;this.isSolved=!1}setup(t,e,s){var a;let n=this.children,r=n.map(()=>!1);for(let[h,l]of n.entries()){let u=l.data.error,d=u?"incorrect":"correct";u||(this.correctCount+=1),l.one("click",()=>{r[h]||this.isSolved||(t.addHint(u||"correct",{class:d}),l.addClass(d),u||(this.solvedCount+=1,t.score("picker-"+h),this.checkSolved()))})}let o=((a=s==null?void 0:s.scores)==null?void 0:a.filter(h=>h.startsWith("picker-")))||[];for(let h of o){let l=+h.slice(7);r[l]=!0,n[l].addClass("correct")}this.solvedCount=o.length,this.checkSolved()}checkSolved(){this.solvedCount<this.correctCount||(this.addClass("solved"),this.isSolved=!0)}};ro=b([P("x-picker")],ro);var pc='<a class="btn classroom" title="Classroom" href="https://classroom.google.com/share?url=${url}&amp;title=${title}" target="_blank" rel="noopener"></a><a class="btn twitter" title="Twitter" href="https://twitter.com/intent/tweet?url=${url}&amp;text=${title}&amp;via=MathigonOrg" target="_blank" rel="noopener"><x-icon name="twitter" size="36"></x-icon></a><a class="btn facebook" title="Facebook" href="https://www.facebook.com/dialog/share?app_id=522356201246169&amp;display=page&amp;href=${url}" target="_blank" rel="noopener"><x-icon name="facebook" size="36"></x-icon></a><a class="btn pinterest" title="Pinterest" href="https://pinterest.com/pin/create/bookmarklet/?media=${img}&amp;url=${url}&amp;description=${title}" target="_blank" rel="noopener"><x-icon name="pinterest" size="36"></x-icon></a><a class="btn reddit" title="Reddit" href="https://reddit.com/submit?url=${url}&amp;title=${title}" target="_blank" rel="noopener"><x-icon name="reddit" size="36"></x-icon></a><button class="btn" title="Copy to Clipboard" :show="canCopy" @click="copy()"><x-icon name="link" size="36"></x-icon></button><x-alert class="success" key="clipboard"><x-icon name="check" size="24"></x-icon> URL copied to clipboard!</x-alert>';var oo=class extends M{ready(){this.bindModel(Ct({title:"",url:"",img:"",body:"",fbAppId:this.attr("facebook"),twitterHandle:this.attr("twitter"),canCopy:!!window.navigator.clipboard,copy:()=>this.copyUrl()}));for(let t of["title","url","img","body"])this.onAttr(t,e=>this.model[t]=encodeURIComponent(e));for(let t of this.$$("a.btn"))t.on("click",e=>{window==null||window.ga("send","event","Share",t.attr("title")),e.preventDefault();let s=window.screen.height/2-320,n=window.screen.width/2-360,r=`menubar=no,toolbar=no,width=720,height=640,top=${s},left=${n}`;window.open(t.attr("href"),"",r)})}copyUrl(){return S(this,null,function*(){let t=this.attr("url");yield window.navigator.clipboard.writeText(t),navigator.canShare&&navigator.share({title:this.attr("title"),url:t}),ji("clipboard")})}};oo=b([P("x-share",{template:pc})],oo);var uc='<button class="play" aria-label="Play Slider"><x-icon name="play" size="32"></x-icon></button><div class="bar"><div class="knob"></div></div>';var ao=class extends M{constructor(){super(...arguments);this.current=0}ready(){this.onAttr("steps",o=>this.steps=+o),this.speed=+this.attr("speed")||1;let t=this.$(".bar"),e=this.$(".knob"),s=this.$(".play");this.hasAttr("no-play")?s.remove():s.on("click",()=>this.play());let n=this.hasAttr("continuous"),r=this.hasAttr("snap")?t.width/this.steps:.001;this.drag=new De(e,t,{moveY:!1,snap:r}),this.drag.on("start",()=>{this.animation&&this.animation.cancel(),this.animation=void 0}),this.drag.on("move",o=>{let a=o.x/this.drag.width*this.steps;n||(a=Math.round(a)),!T(a,this.current)&&(this.current=a,this.trigger("move",a))}),this.drag.on("end",()=>this.trigger("slide-end"))}setup(t,e){this.bindModel(t.model),this.one("slide-end",()=>t.score(e))}set(t){T(t,this.current)||this.drag.setPosition(t*this.drag.width/this.steps,0)}play(){return S(this,null,function*(){this.current>=this.steps&&this.set(0);let t=(1-this.current/this.steps)*3e3/this.speed;this.moveTo(this.steps,t)})}moveTo(t,e=600){return S(this,null,function*(){if(this.animation||t===this.current)return;let s=this.current;this.animation=j(n=>{this.set(s+(t-s)*K("quad",n))},e),yield this.animation.promise,this.animation=void 0,this.trigger("slide-end")})}bindVariable(t,e){t[e]=0,this.on("move",s=>t[e]=s),t.watch(()=>this.set(t[e]))}};ao=b([P("x-slider",{template:uc})],ao);var dc='<slot name="stage"></slot><div class="nav"><button class="btn back disabled" aria-label="Previous Step"><x-icon name="left" size="24"></x-icon></button><button class="btn next" aria-label="Next Step"><x-icon name="right" size="24"></x-icon></button><div class="dots"></div></div><div class="legend-box"><slot></slot></div>';function Qf(i){let t=i.$$("x-blank, x-blank-mc");if(!t.length)return Promise.resolve();let e=0;return new Promise(s=>{for(let n of t)n.on("solve",()=>{e+=1,e>=t.length&&s()})})}var ho=class extends M{constructor(){super(...arguments);this.length=0;this.current=0;this.locked=!1}ready(){this.$legend=this.$(".legend-box"),this.$steps=this.$legend.children,this.$back=this.$(".back"),this.$next=this.$(".next");let t=this.$(".dots");this.$dots=this.$steps.map(()=>c("div",{class:"dot"},t)),this.length=this.$steps.length,this.current=0,this.$back.on("click",()=>this.goBack()),this.$next.on("click",()=>this.goNext()),this.blanks=this.$steps.map(e=>Qf(e)),this.reveals=this.$$("[slide]").map(e=>{let s=e.attr("slide").split("-"),n=s.length>1?[+s[0]||0,+s[1]||this.length]:[+s[0],+s[0]],r=[e.data.animation||"fade",+e.data.duration||400];return e.data.display="visibility",n[0]>=0&&!e.hasClass("reveal")&&e.hide(),[e,n,r]}),this.autoAdvance=this.attr("step")==="auto",this.$steps[0].show(),this.$dots[0].addClass("on"),this.setupSlide(0)}setup(t,e,s){var r;let n=(r=s==null?void 0:s.scores)==null?void 0:r.filter(o=>o.startsWith("slide-")).length;if(n&&n<this.$steps.length-1){this.go(n);for(let o=1;o<=n;++o)this.trigger("next",o)}this.on("next",o=>t.score("slide-"+(o-1)))}go(t){if(this.locked||t<0||t>this.length-1||t===this.current)return;this.locked=!0,setTimeout(()=>this.locked=!1,600),this.$back.setClass("disabled",t===0),this.$next.setClass("disabled",t===this.length-1),this.$dots[this.current].removeClass("on"),this.$dots[t].addClass("on"),this.$steps[t].show();let e=this.$steps[t].height+"px";this.$steps[t].hide(),this.$steps[this.current].exit("fade",300).promise.then(()=>this.$steps[t].enter("fade",300)),this.$legend.animate({height:e},600).promise.then(()=>this.$legend.css("height","auto")),this.setupSlide(t),this.current=t,this.trigger("step",t)}setupSlide(t){this.$next.setAttr("disabled","true"),this.blanks[t].then(()=>this.$next.removeAttr("disabled"));for(let[e,s,n]of this.reveals){if(e.hasClass("reveal"))continue;let r=e.css("visibility")!=="hidden",o=t>=s[0]&&t<=s[1];o&&!r&&e.enter(...n,300),!o&&r&&e.exit(...n)}}goNext(){this.locked||(this.go(this.current+1),this.trigger("next",this.current))}goBack(){this.locked||(this.go(this.current-1),this.trigger("back",this.current))}};ho=b([P("x-slideshow",{template:dc})],ho);var lo=class extends M{ready(){var $,k;($=E(".sidebar-toggle"))==null||$.on("click",()=>this.addClass("open")),(k=E(".sidebar-shadow"))==null||k.on("pointerdown",()=>this.removeClass("open"));let t=E("#feedback form"),e=E("#feedback button"),s=E("#feedback .error"),n=E("#feedback-success"),r=E('#feedback textarea[name="message"]'),o=E("x-course").id;t==null||t.on("submit",g=>{g.preventDefault(),e.setAttr("disabled","true"),s.hide(),ne(`/course/${o}/feedback`,t.formData).then(()=>{n.open(),r.value=""}).catch(()=>s.show()).then(()=>e.removeAttr("disabled"))});let a=JSON.parse(E("#glossary").text),h=E("#glossary-search"),l=h.$(".gloss-body"),u=h.$(".gloss-list"),d=h.$(".gloss-search input"),m;for(let g of Object.keys(a).sort()){let y=a[g],v=c("div",{class:"gloss-item",html:y.title,tabindex:0},u);v.on("click",()=>{m&&m.removeClass("on"),m=v,v.addClass("on"),l.html=y.text});let B=y.title.toLowerCase();d.change(Y=>v.setClass("hidden",!!Y&&B.indexOf(Y.toLowerCase())<0))}}};lo=b([P("x-course-sidebar")],lo);function co(i,t){let e=uh(i.map(s=>s.h+10));for(let[s,n]of i.entries())n.drag.height=N(e),n!==t&&n.drag.setPosition(0,e[s-1]||0)}function tm(i){return i.every((t,e)=>t.index===e)||i.every((t,e)=>t.index===i.length-e-1)}var po=class extends M{ready(){this.items=this.children.map(t=>({drag:new De(t,this,{moveX:!1,useTransform:!0}),index:+t.data.index,h:0}));for(let t of this.children)t.removeAttr("data-index");for(let t of this.items)t.drag.on("drag",()=>{this.items=Ce(this.items,e=>e.drag.position.y-(e===t?10:0)),co(this.items,t)}),t.drag.on("end",()=>{co(this.items),tm(this.items)&&this.solve()});w.onResize(()=>{for(let e of this.items)e.h=e.drag.$el.height;let t=U(this.items.map(e=>e.h));this.css("height",t+this.items.length*10-10+"px"),co(this.items)})}setup(t,e,s){var n;((n=s==null?void 0:s.scores)==null?void 0:n.includes(e))&&this.solve(),this.one("solve",()=>{t.addHint("correct"),t.score(e)})}solve(){this.trigger("solve"),this.addClass("solved");for(let t of this.items)t.drag.disabled=!0}};po=b([P("x-sortable")],po);function fc(i,t=!1){return S(this,null,function*(){if(i.css("visibility")==="visible")return;i.data.display="visibility";let e=+i.data.duration||400,s=(t?0:600)+(+i.data.delay||0);yield i.enter(i.data.animation||"fade",e,s).promise,i.css({opacity:"",transform:""}),i.trigger("reveal"),i.removeClass("reveal")})}var uo=class extends M{constructor(){super(...arguments);this.model=Ct({});this.isShown=!1;this.isCompleted=!1;this.scores=new Set}ready(){var e,s,n,r;this.$course=this.parents("x-course")[0],this.$blanks=this.$$("x-blank, x-blank-mc"),this.$components=this.$$("[goal]"),this.userData=(n=(s=(e=this.$course)==null?void 0:e.userData)==null?void 0:s.steps)==null?void 0:n[this.id],this.goals=wt(this.attr("goals")),this.$reveals=this.$$(".reveal");let t=this.$$(".check[data-when]");for(let o of[...this.$reveals,...t])this.onScore(o.data.when,()=>fc(o));this.$nextBtn=this.$$(".next-step");for(let[o,a]of this.$nextBtn.entries())this.onScore("next-"+o,()=>a.exit("pop")),a.one("click",()=>this.score("next-"+o));for(let o of this.$$(".step-target"))o.tagName!=="X-TARGET"&&gs(o,{enter:()=>{let a=this.$$('[target~="'+o.data.to+'"]');for(let h of a)h.addClass("focus");this.addClass("focus"),this.trigger("target-focus",{$targets:a})},exit:()=>{for(let a of this.$$(".focus"))a.removeClass("focus");this.removeClass("focus")}});for(let o of this.$$(".var, .var-action"))o.bindModel(this.model);((r=this.$course)==null?void 0:r.audio)&&(this.narration=new wr(this.$course.audio,this))}show(){var s,n,r;if(this.isShown)return;this.isShown=!0,(s=StepFunctions==null?void 0:StepFunctions[dh(this.id)])==null||s.call(StepFunctions,this);for(let o of this.$components)o.setup(this,o.attr("goal"),this.userData);let t=((n=this.userData)==null?void 0:n.scores)||[];for(let o of t)this.score(o,!1);let e=this.$$("x-gesture[target]");setTimeout(()=>{if(!this.isReady)for(let o of e)o.start()},2e3),(r=this.$course)==null||r.log("Step","show",this.id),this.trigger("show"),this.addClass("on"),this.narration&&setTimeout(()=>this.narration.play(),400)}complete(){if(!this.isCompleted){this.isShown||this.show(),this.isCompleted=!0;for(let t=0;t<this.$nextBtn.length;++t)this.score("next-"+t);for(let t of this.$reveals)t.parents("svg").length||fc(t,!0);this.trigger("complete")}}get isReady(){return this.goals.every(t=>this.scores.has(t))}get isPageLoaded(){return this.$course?this.$course.isReady:!0}score(t,e=!0){this.scores.has(t)||(this.scores.add(t),this.trigger("score-"+t),this.trigger("score"),this.$course&&(this.$course.trigger("score"),this.$course.saveProgress({steps:{[this.id]:{scores:[t]}}}),this.$course.log("Step","score",this.id+"/"+t)),e&&this.isReady&&this.$course&&this.$course.isReady&&setTimeout(()=>{this.$course.$activeStep===this&&this.$course.nextStep()},1200))}storeData(t,e){var s;(s=this.$course)==null||s.saveProgress({steps:{[this.id]:{data:{[t]:e}}}})}onScore(t,e){let s=wt(t);if(s.every(o=>this.scores.has(o)))return e&&e(),Promise.resolve();let n=ki(),r=()=>{!s.every(o=>this.scores.has(o))||(e&&e(),n.resolve(),this.off("score",r))};return this.on("score",r),n.promise}addHint(t,e={}){var s,n,r;return this.trigger("hint",t),((s=this.$course)==null?void 0:s.isReady)?this.isInViewport?(n=this.$course.$tutor)==null?void 0:n.showHint(t,e):(this.one("enterViewport",()=>{var o;return(o=this.$course.$tutor)==null?void 0:o.showHint(t,e)}),{text:((r=this.$course.$tutor)==null?void 0:r.hints[t])||t}):{text:t}}delayedHint(t,e=1e4){let s=setTimeout(t,e);this.on("score",()=>{clearTimeout(s),this.isCompleted||(s=setTimeout(t,e))}),this.on("complete",()=>clearTimeout(s))}get nextStep(){if(!this.$course)return;let t=this.$course.$steps.indexOf(this);return this.$course.$steps[t+1]}groupBlanks(...t){let e=t.map(s=>this.$blanks[s]);for(let s of e)s.linkedBlanks=e}};uo=b([P("x-step")],uo);var em='<div class="titles"></div><div class="body"><slot></slot></div>',fo=class extends M{constructor(){super(...arguments);this.$titles=[];this.active=0}ready(){let t=this.$(".titles");this.$body=this.$(".body"),this.$tabs=this.$$(".tab");for(let e=0;e<this.$tabs.length;++e){let s=this.$tabs[e].$("h3")||c("h3");s.setAttr("tabindex","0"),t.append(s),this.$titles.push(s),s.on("click",()=>this.makeActive(e))}this.$titles[0].addClass("active"),this.$tabs[0].show()}makeActive(t){if(this.active===t)return;this.$titles[this.active].removeClass("active"),this.$titles[t].addClass("active"),this.$tabs[t].show();let e=this.$tabs[t].outerHeight+"px";this.$tabs[t].hide(),this.$tabs[this.active].exit("fade",300).promise.then(()=>this.$tabs[t].enter("fade",300)),this.$body.animate({height:e},600).promise.then(()=>this.$body.css("height","auto")),this.active=t,this.trigger("change",t)}};fo=b([P("x-tabbox",{template:em})],fo);var mc='<defs><mask id="masking"><rect width="100%" height="100%" fill="white"></rect></mask></defs><marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="4" markerHeight="4" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z"></path></marker><rect x="0" y="0" width="100%" height="100%" mask="url(#masking)" opacity="0.8"></rect><path class="target-arrow" stroke-width="5" marker-end="url(#arrow)" opacity="0.4" stroke-linecap="round"></path>';function sm(i,t,e,s){let n=new p(i.left-15,i.top+e-15),r=new V(n,i.width+30,i.height+30),o=new p(t.left-15,t.top+s-15),a=new V(o,t.width+30,t.height+30),h=new _(r.center,a.center);return[ht(h,r)[0],ht(h,a)[0]]}function im(i,t){return Math.abs(i[0]-t[0])+Math.abs(i[1]-t[1])}var gc=te("header, x-tutor, .sidebar"),Ms=c("svg",{class:"target-body",html:mc},G),nm=Ms.$("mask"),rm=Ms.$(".target-arrow"),Ss=!1,wc=[],mo=class extends M{ready(){this.setAttr("tabindex",0);let t=this.attr("to").replace(/_/g," "),e=this.hasClass("no-margins"),s,n,r,o,a=()=>{Ss=!0;let d=te(t);if(!d.length)return;let m=d[0].hasParent(...gc);s===void 0&&(s=this.hasParent(...gc));let $=this.bounds,k=d.map(g=>g.bounds).filter(g=>g.width||g.height);if(r=0,!m){let g=Math.min(...k.map(Y=>Y.top)),y=Math.max(...k.map(Y=>Y.top+Y.height)),v=w.height-12-y,B=56-g;r=v<0?v:B>0?B:0}for(let g of wc)g.remove();wc=[$,...k].map((g,y)=>{let v=!y||e?4:10;return c("rect",{x:g.left-v,y:g.top-v+(y||!s?r:0),width:g.width+2*v,height:g.height+2*v,rx:y?4:18,ry:y?4:18},nm)}),rm.points=sm($,k[0],s?0:r,m?0:r)},h=()=>{r&&G.scrollBy(-r,300),Ms.css("display","block"),w.redraw(),os(function(){Ms.css("opacity",1)},r?300:0)},l=d=>{!Ss||d&&R(d.type,"mousemove","pointermove")&&im(n,[d.clientX,d.clientY])<40||(clearTimeout(o),Ss=!1,Ms.css("opacity",0),setTimeout(()=>{Ss||Ms.css("display","none")},300),G.off("mousewheel mousemove touchend touchmove",l),this.off("mouseleave blur",l))},u=()=>{r&&!s?G.on("mousemove",l):this.on("mouseleave",l),G.on("mousewheel touchend touchmove",l),this.on("blur",l)};this.on("mouseenter touchstart focus",d=>{n=[d.clientX,d.clientY],a(),o=window.setTimeout(h,r?50:30),u()}),this.on("click",d=>{Ss?(d.handled=!0,l(),setTimeout(()=>E(t).trigger("click mousedown"))):(Ss=!0,r=0,h(),u())})}};mo=b([P("x-target")],mo);var W=class extends Error{constructor(t,e){super(e);this.name=t}static undefinedVariable(t){return new W("EvalError",`Undefined variable \u201C${t}\u201D.`)}static undefinedFunction(t){return new W("EvalError",`Undefined function \u201C${t}\u201D.`)}static invalidCharacter(t){return new W("SyntaxError",`Unknown symbol \u201C${t}\u201D.`)}static conflictingBrackets(t){return new W("SyntaxError",`Conflicting brackets \u201C${t}\u201D.`)}static unclosedBracket(t){return new W("SyntaxError",`Unclosed bracket \u201C${t}\u201D.`)}static startOperator(t){return new W("SyntaxError",`A term cannot start with a \u201C${t}\u201D.`)}static endOperator(t){return new W("SyntaxError",`A term cannot end with a \u201C${t}\u201D.`)}static consecutiveOperators(t,e){return new W("SyntaxError",`A \u201C${t}\u201D cannot be followed by a \u201C${e}\u201D.`)}static invalidExpression(){return new W("SyntaxError","This expression is invalid.")}},go={pi:Math.PI,\u03C0:Math.PI,e:Math.E},wo={"(":")","[":"]","{":"}"},Ts={"*":"\xB7","**":"\u2217","//":"//","+-":"\xB1","\u2013":"\u2212","-":"\u2212",xx:"\xD7",sum:"\u2211",prod:"\u220F",int:"\u222B",del:"\u2202",grad:"\u2207",aleph:"\u2135",not:"\xAC",AA:"\u2200",EE:"\u2203","'":"\u2019","!=":"\u2260","<=":"\u2264",">=":"\u2265",in:"\u2208","!in":"\u2209","==":"\u2261","~=":"\u2245","~~":"\u2248",sub:"\u2282",sube:"\u2286",prop:"\u221D",oo:"\u221E",cap:"\u2229",cup:"\u222A","<-":"\u2190","->":"\u2192","=>":"\u21D2","<=>":"\u21D4","|->":"\u21A6",uarr:"\u2191",darr:"\u2193",lArr:"\u21D0"},Js={Gamma:"\u0393",Delta:"\u0394",Theta:"\u0398",Lambda:"\u039B",Xi:"\u039E",Pi:"\u03A0",Sigma:"\u03A3",Phi:"\u03A6",Psi:"\u03A8",Omega:"\u03A9",alpha:"\u03B1",beta:"\u03B2",gamma:"\u03B3",delta:"\u03B4",epsilon:"\u025B",zeta:"\u03B6",eta:"\u03B7",theta:"\u03B8",iota:"\u03B9",kappa:"\u03BA",lambda:"\u03BB",mu:"\u03BC",nu:"\u03BD",xi:"\u03BE",pi:"\u03C0",rho:"\u03C1",sigma:"\u03C3",tau:"\u03C4",upsilon:"\u03C5",phi:"\u03C6",chi:"\u03C7",psi:"\u03C8",omega:"\u03C9",CC:"\u2102",NN:"\u2115",QQ:"\u211A",RR:"\u211D",ZZ:"\u2124"},yc="abcdefghijklmnopqrstuvwxyz",om=yc.split(""),am=yc.toUpperCase().split(""),hm=Object.values(Js),lm=[...om,...am,...hm,"$"],cm="|()[]{}\xF7,!<>=*/+-\u2013\u2212~^_\u2026\xB0\u2022\u2225\u22A5'\u2220:%\u223C\u25B3",pm=Object.values(Ts),um=[...cm,...pm],dm={_:"sub","^":"sup","//":"/","\xF7":"/"},vc={"<":"&lt;",">":"&gt;"};function xc(i){return i in vc?vc[i]:i}var fm=new Set(["sin","cos","tan","sec","csc","cot","arcsin","arccos","arctan","sinh","cosh","tanh","sech","csch","coth","exp","log","ln","det","dim","mod","gcd","lcm","min","max"]);function yo(i){return fm.has(i)}var Vs={"+":"plus","\u2212":"minus","\xB7":"times","\xD7":"times","/":"over","//":"divided by","%":"percent","!":"factorial","\xB1":"plus-minus","=":"equals","\u2260":"does not equal","<":"is less than",">":"is greater than","\u2264":"is less than or equal to","\u2265":"is greater than or equal to",\u03C0:"pi","\u2245":"is congruent to","\u2225":"is parallel to","\u22A5":"is perpendicular to"};for(let i of Object.keys(Js))Vs[Js[i]]=i;var Me=class{evaluate(t={}){return NaN}substitute(t={}){return this}get simplified(){return this}get variables(){return[]}get functions(){return[]}collapse(){return this}toString(){return""}toVoice(t={}){return""}toMathML(t={}){return""}},Qs=class extends Me{constructor(t){super();this.n=t}evaluate(){return this.n}toString(){return""+this.n}toVoice(){return""+this.n}toMathML(){return`<mn>${this.n}</mn>`}},cn=class extends Me{constructor(t){super();this.i=t}evaluate(t={}){if(this.i in t)return t[this.i];if(this.i in go)return go[this.i];throw W.undefinedVariable(this.i)}toMathML(){return`<mi${yo(this.i)?' mathvariant="normal"':""}>${this.i}</mi>`}substitute(t={}){return t[this.i]||this}get variables(){return[this.i]}toString(){return this.i}toVoice(){return this.i in Vs?Vs[this.i]:this.i.length===1?`_${this.i}_`:this.i}},$c=class extends Me{constructor(t){super();this.s=t}evaluate(t={}){if(this.s in t)return t[this.s];throw W.undefinedVariable(this.s)}toString(){return'"'+this.s+'"'}toVoice(){return this.s}toMathML(){return`<mtext>${this.s}</mtext>`}},vo=class extends Me{toString(){return" "}toMathML(){return"<mspace></mspace>"}},se=class extends Me{constructor(t){super();this.o=t}toString(){return this.o.replace("//","/")}toVoice(){return Vs[this.o]||this.o}get functions(){return[this.o]}toMathML(){let t=xc(this.toString());return`<mo value="${t}">${t}</mo>`}},pn=wt("+ \u2212 * \xD7 \xB7 / \xF7 // sup sub subsup"),bc=wt("sub sup subsup"),xo='<mo value="," lspace="0">,</mo>';function Pc(i,t){return pn.includes(t)?i instanceof ti?!0:!(i instanceof Rt)||!pn.includes(i.fn)?!1:bc.includes(i.fn)&&bc.includes(t)?!0:pn.indexOf(t)>pn.indexOf(i.fn):!1}function mm(i,t,e){return Pc(i,t)?`<mfenced>${e}</mfenced>`:e}function Se(i,t){return i instanceof ti||i instanceof Rt?`<mrow>${t}</mrow>`:t}function Mc(i){return i==="2"?"squared":i==="3"?"cubed":`to the power of ${i}`}var Rt=class extends Me{constructor(t,e=[]){super();this.fn=t,this.args=e}evaluate(t={}){let e=this.args.map(s=>s.evaluate(t));if(this.fn in t)return t[this.fn](...e);switch(this.fn){case"+":return e.reduce((s,n)=>s+n,0);case"\u2212":return e.length>1?e[0]-e[1]:-e[0];case"*":case"\xB7":case"\xD7":return e.reduce((s,n)=>s*n,1);case"/":return e[0]/e[1];case"sin":return Math.sin(e[0]);case"cos":return Math.sin(e[0]);case"tan":return Math.sin(e[0]);case"log":return Math.log(e[0])/Math.log(e[1]||Math.E);case"sup":return Math.pow(e[0],e[1]);case"sqrt":return Math.sqrt(e[0]);case"root":return Math.pow(e[0],1/e[1]);case"(":return e[0]}throw W.undefinedFunction(this.fn)}substitute(t={}){return new Rt(this.fn,this.args.map(e=>e.substitute(t)))}collapse(){return this.fn==="("?this.args[0].collapse():new Rt(this.fn,this.args.map(t=>t.collapse()))}get simplified(){return this}get variables(){return Ht(Yt(this.args.map(t=>t.variables)))}get functions(){return Ht([this.fn,...Yt(this.args.map(t=>t.functions))])}toString(){let t=this.args.map(e=>Pc(e,this.fn)?"("+e.toString()+")":e.toString());return this.fn==="\u2212"?t.length>1?t.join(" \u2212 "):"\u2212"+t[0]:this.fn==="sup"?t.join("^"):this.fn==="sub"?t.join("_"):this.fn==="subsup"?`${t[0]}_${t[1]}^${t[2]}`:wt("+ * \xD7 \xB7 / = < > \u2264 \u2265 \u2248").includes(this.fn)?t.join(" "+this.fn+" "):R(this.fn,"(","[","{")?this.fn+this.args.join(", ")+wo[this.fn]:this.fn==="abs"?`|${this.args.join(", ")}|`:R(this.fn,"!","%")?t[0]+this.fn:`${this.fn}(${t.join(", ")})`}toMathML(t={}){let e=this.args.map(r=>r.toMathML(t)),s=this.args.map((r,o)=>mm(r,this.fn,e[o]));if(this.fn in t){let r=e.map((o,a)=>({toString:()=>o,val:this.args[a]}));return t[this.fn](...r)}if(this.fn==="\u2212")return s.length>1?s.join('<mo value="\u2212">\u2212</mo>'):'<mo rspace="0" value="\u2212">\u2212</mo>'+s[0];if(R(this.fn,"+","=","<",">","\u2264","\u2265","\u2248")){let r=xc(this.fn);return s.join(`<mo value="${r}">${r}</mo>`)}if(R(this.fn,"*","\xD7","\xB7")){let r=s[0];for(let o=1;o<s.length-1;++o)r+=(this.args[0]instanceof Qs&&this.args[1]instanceof Qs?'<mo value="\xD7">\xD7</mo>':"")+s[1];return r}if(this.fn==="//")return s.join('<mo value="/">/</mo>');if(this.fn==="sqrt")return`<msqrt>${s[0]}</msqrt>`;if(R(this.fn,"/","root")){let r=this.fn==="/"?"mfrac":"mroot",o=this.args.map((a,h)=>Se(a,e[h]));return`<${r}>${o.join("")}</${r}>`}if(R(this.fn,"sup","sub")){let r=[Se(this.args[0],s[0]),Se(this.args[1],e[1])];return`<m${this.fn}>${r.join("")}</m${this.fn}>`}return this.fn==="subsup"?`<msubsup>${[Se(this.args[0],s[0]),Se(this.args[1],e[1]),Se(this.args[2],e[2])].join("")}</msubsup>`:R(this.fn,"(","[","{")?`<mfenced open="${this.fn}" close="${wo[this.fn]}">${s.join(xo)}</mfenced>`:R(this.fn,"!","%")?s[0]+`<mo value="${this.fn}" lspace="0">${this.fn}</mo>`:this.fn==="abs"?`<mfenced open="|" close="|">${s.join(xo)}</mfenced>`:this.fn==="bar"?`<mover>${Se(this.args[0],s[0])}<mo value="\u203E">\u203E</mo></mover>`:this.fn==="vec"?`<mover>${Se(this.args[0],s[0])}<mo value="\u2192">\u2192</mo></mover>`:`<mi${yo(this.fn)?' mathvariant="normal"':""}>${this.fn}</mi><mfenced>${s.join(xo)}</mfenced>`}toVoice(t={}){let e=this.args.map(n=>n.toVoice(t)),s=e.join(" ");if(this.fn in t){let n=e.map((r,o)=>({toString:()=>r,val:this.args[o]}));return t[this.fn](...n)}return R(this.fn,"(","[","{")?s:this.fn==="sqrt"?`square root of ${s}`:this.fn==="%"?`${s} percent`:this.fn==="!"?`${s} factorial`:this.fn==="/"?`${e[0]} over ${e[1]}`:this.fn==="//"?`${e[0]} divided by ${e[1]}`:this.fn==="sub"?s:this.fn==="subsup"?`${e[0]} ${e[1]} ${Mc(e[2])}`:this.fn==="sup"?`${e[0]} ${Mc(e[1])}`:Vs[this.fn]?e.join(` ${Vs[this.fn]} `):yo(this.fn)?`${this.fn} ${s}`:`${this.fn} of ${s}`}},ti=class extends Me{constructor(t){super();this.items=t}evaluate(t={}){return this.collapse().evaluate(t)}substitute(t={}){return this.collapse().substitute(t)}get simplified(){return this.collapse().simplified}get variables(){return Ht(Ii(...this.items.map(t=>t.variables)))}get functions(){return this.collapse().functions}toString(){return this.items.map(t=>t.toString()).join(" ")}toMathML(t={}){return this.items.map(e=>e.toMathML(t)).join("")}toVoice(t={}){return this.items.map(e=>e.toVoice(t)).join(" ")}collapse(){return gm(this.items).collapse()}},Q;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.SPACE=1]="SPACE",i[i.STR=2]="STR",i[i.NUM=3]="NUM",i[i.VAR=4]="VAR",i[i.OP=5]="OP"})(Q||(Q={}));function $o(i,t){if(t===Q.STR)return new $c(i);if(!(!i||!t)){if(t===Q.SPACE&&i.length>1)return new vo;if(t===Q.NUM){if(isNaN(+i))throw W.invalidExpression();return new Qs(+i)}if(t===Q.VAR)return i in Js?new cn(Js[i]):i in Ts?new se(Ts[i]):new cn(i);if(t===Q.OP)return i in Ts?new se(Ts[i]):new se(i)}}function wm(i){let t=[],e="",s=Q.UNKNOWN;for(let r of i){if(r==='"'){let a=s===Q.STR?Q.UNKNOWN:Q.STR,h=$o(e,s);h&&t.push(h),e="",s=a;continue}else if(s===Q.STR){e+=r;continue}let o=r.match(/[0-9.]/)?Q.NUM:lm.includes(r)?Q.VAR:um.includes(r)?Q.OP:r.match(/\s/)?Q.SPACE:Q.UNKNOWN;if(!o)throw W.invalidCharacter(r);if(!s||s===Q.NUM&&o!==Q.NUM||s===Q.VAR&&o!==Q.VAR&&o!==Q.NUM||s===Q.OP&&!(e+r in Ts)||s===Q.SPACE&&o!==Q.SPACE){let a=$o(e,s);a&&t.push(a),e="",s=o}e+=r}let n=$o(e,s);return n&&t.push(n),t}function ym(i){return i.length>1?new ti(i):i[0]instanceof se?new ti(i):i[0]}function vm(i,t){let e=[[]];for(let s of i)t(s)?e.push([]):N(e).push(s);return e}function Et(i,t){return i instanceof se&&wt(t).includes(i.o)}function ei(i){return i instanceof Rt&&i.fn==="("?i.args[0]:i}function si(i,t){if(Et(i[0],t))throw W.startOperator(i[0]);if(Et(N(i),t))throw W.endOperator(N(i));for(let e=1;e<i.length-1;++e){if(!Et(i[e],t))continue;let s=i[e],n=i[e-1],r=i[e+1];if(n instanceof se)throw W.consecutiveOperators(n.o,s.o);if(r instanceof se)throw W.consecutiveOperators(s.o,r.o);let o=i[e+2];if(t==="^ _"&&Et(s,"_ ^")&&Et(o,"_ ^")&&s.o!==o.o){let a=i[e+3];if(a instanceof se)throw W.consecutiveOperators(o.o,a.o);let h=[ei(n),ei(r),ei(a)];s.o==="^"&&([h[1],h[2]]=[h[2],h[1]]),i.splice(e-1,5,new Rt("subsup",h)),e-=4}else{let a=dm[s.o]||s.o,h=[ei(n),ei(r)];i.splice(e-1,3,new Rt(a,h)),e-=2}}}function Sc(i){return si(i,"^ _"),si(i,"/"),ym(i)}function xm(i,t){let e=[[]],s=["\u03C0",...(t==null?void 0:t.variables)||[]];for(let n of i){let r=N(e).length?N(e)[0].o:void 0;if(Et(n,") ] }")){if(!Et(n,wo[r]))throw W.conflictingBrackets(n.o);let o=e.pop(),a=N(e),h=N(a),u=Et(n,")")&&h instanceof cn&&!s.includes(h.i)?a.pop().i:o[0].o,d=vm(o.slice(1),m=>Et(m,","));a.push(new Rt(u,d.map(Sc)))}else Et(n,"( [ {")?e.push([n]):N(e).push(n)}if(e.length>1)throw W.unclosedBracket(N(e)[0].o);return Sc(e[0])}function Tc(i,t,e=!1){let s=[],n=[],r=!1;function o(){if(r)throw W.invalidExpression();!n.length||(s.push(n.length>1?new Rt(t[0],n):n[0]),n=[])}for(let a of i)if(Et(a,t)){if(r||!n.length)throw W.invalidExpression();r=!0}else if(a instanceof se)o(),s.push(a),r=!1;else{let h=!e||a instanceof Qs;if(n.length&&!r&&h)throw W.invalidExpression();n.push(a),r=!1}return o(),s}function gm(i){if(i=i.filter(t=>!(t instanceof vo)),!i.length)throw W.invalidExpression();if(Et(i[0],"%!"))throw W.startOperator(i[0]);for(let t=0;t<i.length;++t)!Et(i[t],"%!")||(i.splice(t-1,2,new Rt(i[t].o,[i[t-1]])),t-=1);if(si(i,"= < > \u2264 \u2265"),si(i,"// \xF7"),i=Tc(i,"\xD7 * \xB7",!0),Et(i[0],"\u2212 \xB1")&&i.splice(0,2,new Rt(i[0].o,[i[1]])),si(i,"\u2212 \xB1"),Et(i[0],"+")&&(i=i.slice(1)),i=Tc(i,"+"),i.length>1)throw W.invalidExpression();return i[0]}function $m(i,t=!1,e){let s=xm(wm(i),e);return t?s.collapse():s}function bm(i,t){try{let e=Ht([...i.variables,...t.variables]),s=i.collapse(),n=t.collapse(),r=0;for(let o=0;o<5;++o){let a={};for(let u of e)a[u]=go[u]||Math.random()*5;let h=s.evaluate(a),l=n.evaluate(a);if(!(isNaN(h)||isNaN(l))){if(!T(h,l))return!1;r+=1}}return!!r}catch(e){return!1}}var Pt={numEquals:bm,parse:Li($m)};var Vc='<div class="toasts"><div class="msg-wrap"><button class="msg archie" aria-label="Virtual Tutor"><slot name="icon"></slot></button></div></div><div class="chat" data-display="flex"><div class="chat-header"><slot name="header"></slot><button class="close"><x-icon name="close" size="24"></x-icon></button></div><div class="chat-body"></div><div class="chat-footer"><div class="input" contenteditable></div><button class="hint"><x-icon name="lightbulb" size="24"></x-icon></button></div></div>';var Pm=/[0-9+\-*/()^\s]+/g,Mm=ke(pt.shuffle(["happy","spongebob","sloth","party","robot","excited","cute","highfive1","applause","highfive2"])),Sm=ke(pt.shuffle(["minions","panther","dog","snape","what","door","horrible"]));function bo(i,t,e={}){let s=c("div",{class:"msg-wrap","data-display":"flex"}),n=c("div",{class:"msg "+t},s);return e.class&&n.addClass(e.class),e.visible||s.hide(),R(t,"hint","question")?n.html=i:t==="img"?n.css("background-image",`url(${i})`):t==="video"&&c("iframe",{src:i,allowfullscreen:!0},n),s}var Po=class extends M{constructor(){super(...arguments);this.recentMessages=[];this.isOpen=!1;this.queuePromise=Promise.resolve()}ready(){var n;this.$course=this.parents("x-course")[0],this.hints=this.$course?JSON.parse(this.$course.$("#hints").text):{};let t=window.user;this.correct=ke(pt.shuffle(this.hints.correct||[])),this.incorrect=ke(pt.shuffle(this.hints.incorrect||[])),this.$toasts=this.$(".toasts"),this.$chat=this.$(".chat"),this.$chatBody=this.$(".chat-body"),this.$toasts.on("click",r=>{r.handled||this.open()}),this.$(".close").on("click",()=>this.close());let e=this.$(".chat-footer");if(this.$query=e.$(".input"),this.$query.onKeyDown("enter",r=>{r.preventDefault(),this.askQuestion(this.$query.text.trim()),this.$query.text=""}),this.$query.on("focus",()=>e.addClass("focus")),this.$query.on("blur",()=>e.removeClass("focus")),this.$(".hint").on("click",()=>{this.queue(this.hints.tutorial1),this.queue(t?this.hints.tutorial2:this.hints.account)}),this.$course&&((n=this.$course.userData)==null?void 0:n.messages))for(let r of this.$course.userData.messages)this.$chatBody.append(bo(r.content,r.kind||"hint",{visible:!0}));if(!w.getCookie("sessionWelcome")&&this.$course){w.setCookie("sessionWelcome",1,60*60*4);let r=new Date().getHours(),o=r<12?"Morning":r<18?"Afternoon":"Evening";t?setTimeout(()=>this.showHint(`welcome${o}Named`,{variables:{name:t.shortName}}),3e3):w.getCookie("welcome")?(setTimeout(()=>this.showHint(`welcome${o}`),3e3),setTimeout(()=>this.queue(this.hints.account),4500)):(w.setCookie("welcome",1),setTimeout(()=>this.queue(this.hints.welcome),3e3),setTimeout(()=>this.queue(this.hints.tutorial1),4500))}}open(){this.isOpen||(this.isOpen=!0,this.$chat.enter("slide-up",200),this.$chatBody.scrollTop=this.$chatBody.scrollHeight,this.trigger("open"))}close(){!this.isOpen||(this.isOpen=!1,this.$query.blur(),this.trigger("close"),this.$chat.exit("slide-down",200))}queue(t,e="hint",s={}){this.queuePromise=this.queuePromise.then(()=>(this.display(t,e,s),ie(500)))}display(t,e="hint",s={}){let n=s.timeout||8e3;if(w.width<640&&(n*=.7),(s.toast==null?!0:s.toast)&&!this.isOpen){let a=bo(t,e,s);a.setAttr("role","alert"),this.$toasts.append(a),a.enter("reveal-right"),setTimeout(()=>a.exit("reveal-right",400,0,!0),n),this.on("open",()=>a.exit("reveal",200,0,!0))}let o=bo(t,e,{class:s.class,visible:!this.isOpen});this.$chatBody.append(o),this.isOpen&&(o.enter("reveal",300),j(()=>this.$chatBody.scrollTop=this.$chatBody.scrollHeight,200))}showHint(t,e={}){if(R(t,"correct","incorrect")){let n=t==="correct"?this.correct():this.incorrect(),r=t==="correct"?3e3:5e3;if(this.queue(n,"hint",{class:e.class||t,timeout:r}),Math.random()<.2){let o=t==="correct"?Mm():Sm(),a="";this.queue(`${a}/images/gifs/${o}.gif`,"img",{timeout:r})}return{text:n}}let s=this.hints[t]||t;if(e.variables)for(let[n,r]of Object.entries(e.variables))s=s.replace(new RegExp("\\$"+n,"g"),r);return!e.force&&this.recentMessages.includes(t)?{text:s}:(this.recentMessages.push(t),setTimeout(()=>this.recentMessages.shift(),1e4),e.store!==!1&&this.$course&&this.$course.saveProgress({hints:[{content:s,kind:"hint"}]}),this.queue(s,"hint",{class:e.class}),{text:s})}askQuestion(t){if(!t)return;this.queue(t,"question"),this.$course&&this.$course.log("Tutor","ask",t);let e=(t.match(Pm)||[]).filter(s=>s.length>=3&&!s.match(/^[\s0-9]+$/));if(e.length)try{let s=Pt.parse(e[0],!0),n=Pt.parse("="+s.evaluate());return this.queue(`<span class="math">${s.toMathML()}${n.toMathML()}</span>`)}catch(s){console.log("Parse Error:",e[0])}this.$chatBody.addClass("loading"),ne(this.attr("api"),{query:t}).then(s=>{this.$chatBody.removeClass("loading");let n=JSON.parse(s);for(let r of n)this.queue(r.content,r.kind)}).catch(s=>{this.$chatBody.removeClass("loading"),this.queue(this.hints.serverError),console.error("Tutor Error:",s)})}};Po=b([P("x-tutor",{template:Vc})],Po);var Ec='<div class="left" tabindex="0"><x-icon name="left" size="14"></x-icon></div><div class="content"><slot></slot></div><div class="right" tabindex="0"><x-icon name="right" size="14"></x-icon></div><div class="bubble"><div class="bubble-box"><div class="progress"></div></div><div class="bubble-arrow"></div></div>';var Ac=c("div",{class:"var-overlay"},G),Mo=class extends M{constructor(){super(...arguments);this.valueChange=!1}ready(){let t=this.attr("bind");if(!t)return;let[e,s,n]=t.split("|");[this.min,this.max,this.step]=n.split(",").map(h=>+h),this.name=e,this.model=this.getParentModel(),this.$(".content").bindModel(this.model),this.$progress=this.$(".progress"),this.setValue(+s);let r=20*(w.isMobile?1.5:1)/L((this.max-this.min)/this.step/12,1,3),o=0,a=0;for(let h of this.$$(".left, .right")){let l=h.hasClass("left")?-this.step:this.step;h.on("click",()=>{this.setValue(this.value+l),this.trigger("slide-end")})}Ge(this,{start:h=>{o=h.x,a=this.value,this.addClass("on"),this.valueChange=!1,Ac.show(),ft.addClass("grabbing")},move:h=>{let l=(h.x-o)/r;this.setValue(a+$t(l)*this.step)},end:()=>{this.removeClass("on"),this.valueChange&&this.trigger("slide-end"),Ac.hide(),ft.removeClass("grabbing")}})}setup(t,e){this.one("slide-end",()=>t.score(e))}setValue(t){let e=$t(L(t,this.min,this.max),2);if(e===this.value)return;this.value=e,this.valueChange=!0,this.model&&(this.model[this.name]=e);let s=this.max-this.min;this.$progress.css("width",116*(e-this.min)/s+"px")}};Mo=b([P("x-var",{template:Ec})],Mo);var Cc='<button class="play-btn-box" aria-label="Play"><x-icon name="play" size="44"></x-icon></button>';var So=class extends M{constructor(){super(...arguments);this.visible=!0}ready(){this.on("click",()=>{this.play(),setTimeout(()=>this.trigger("play"),400)})}play(){!this.visible||(this.visible=!1,this.exit("pop",400))}reset(){this.visible||(this.visible=!0,setTimeout(()=>this.enter("pop"),400))}};So=b([P("x-play-btn",{template:Cc})],So);var To=class extends M{constructor(){super(...arguments);this.playing=!1}ready(){this.$icon=this.$("x-icon"),this.$("button").on("click",()=>this.toggle())}toggle(){this.playing?this.pause():this.play()}play(){this.playing||(this.playing=!0,this.$icon.setAttr("name","pause"),this.trigger("play"))}pause(){!this.playing||(this.playing=!1,this.$icon.setAttr("name","play"),this.trigger("pause"))}};To=b([P("x-play-toggle",{template:'<button class="icon-btn"><x-icon name="play"></x-icon></button>'})],To);var kc='<div class="video-wrap"><video preload playsinline></video></div><div class="credit"></div><x-play-btn></x-play-btn><div class="controls"><div class="shadow"></div><div class="play-pause-btn"><div class="play-icon" tabindex="0" aria-label="Play Video"><x-icon name="play" size="32"></x-icon></div><div class="pause-icon" aria-label="Pause Video"><x-icon name="pause" size="32"></x-icon></div></div><div class="timeline"><div class="bar"><div class="background"></div><div class="buffer"></div><div class="progress"></div></div><div class="handle"></div></div><div class="timecode"></div></div>';function Lc(i){let t=Math.floor(i/60),e=Math.floor(i%60);return t+":"+(e<10?"0":"")+e}var Vo=class extends M{ready(){let t=this.attr("src"),e=this.$(".video-wrap"),s=this.$("video"),n=this.attr("width"),r=this.attr("height");this.css("width",n+"px"),e.css("padding-bottom",+r/+n*100+"%"),s.setAttr("poster",this.attr("poster")||t.replace(/mp4$/,"jpg")),this.hasAttr("loop")&&(s._el.loop=!0),this.hasAttr("audio")||(s._el.muted=!0),c("source",{src:t,type:"video/mp4"},s),this.hasAttr("credit")&&(this.$(".credit").text=this.attr("credit"));let o=this.$(".bar"),a=this.$(".progress"),h=this.$(".buffer"),l=this.$(".timecode"),u=new De(this.$(".handle"),o,{moveY:!1}),d=this.video=s._el,m=this.width-110;w.onResize(()=>m=this.width-110),s.on("canplay",()=>{l.text=Lc(+d.duration)}),s.on("timeupdate",()=>{let g=d.currentTime/d.duration;a.css("width",g*100+"%"),l.text=Lc(+d.currentTime),u.setPosition(g*m,0),this.trigger("timeupdate",d.currentTime)}),s.on("progress",()=>{if(d.buffered.length<=0||d.duration<=0)return;let y=d.buffered.end(d.buffered.length-1)/d.duration*100;h.css("width",y+"%")}),s.on("ended",()=>{d.pause(),this.removeClass("playing"),this.trigger("end")});let $=()=>d.paused?this.play():this.pause(),k=g=>this.setTime(g/m*d.duration);this.hasAttr("hover")?(s.on("mouseover touchstart",()=>this.play()),s.on("mouseout touchend touchcancel",()=>this.pause())):s.on("click",$),this.hasAttr("controls")&&(this.$(".controls").show(),this.$(".play-pause-btn").on("click",$),u.on("start",()=>this.pause()),u.on("drag",g=>k(g.x)),o.on("click",g=>k(g.offsetX)))}setTime(t){this.video.currentTime=t}play(){this.video.play(),this.addClass("playing"),this.trigger("play")}pause(){this.video.pause(),this.removeClass("playing")}};Vo=b([P("x-video",{template:kc})],Vo);var Eo=class extends M{constructor(){super(...arguments);this.isCompleted=!1;this.isReady=!1}created(){this.userData=window.progressData||JSON.parse(this.$("#userdata").text)||{},this.$steps=this.$$("x-step");for(let t of this.$steps)t.on("score",()=>this.trigger("score"));this.data.audio&&(this.audio=new fr(this.data.audio))}ready(){this.$footer=this.$("footer"),this.$skipStep=this.$footer.$(".skip-step"),this.$progress=this.$(".sidebar-row.active x-progress"),this.$tutor=this.$("x-tutor"),this.$stepsWrap=this.$(".steps");let t=this.findStep(w.getHash()),e=this.findStep(this.userData.activeStep);this.$activeStep=e||this.$steps[0];for(let n of this.$steps){if(n.show(),n===this.$activeStep)break;n.complete()}if(this.userData.completed||w.getHash()==="full"||this.data.reveal)this.complete();else for(;this.$activeStep&&this.$activeStep.isReady&&!this.isCompleted;)this.nextStep();(t||e&&!this.userData.completed)&&this.goToStep(t||e,!1),this.$(".section-dev")&&this.complete();let s=this.$(".reveal-banner");setTimeout(()=>{this.isCompleted||(s.removeClass("off"),this.on("score complete",()=>s.addClass("off")))},1500),s.$(".complete").one("click",()=>this.complete()),w.onKey("space",n=>{n.preventDefault(),this.nextStep(),s.addClass("off")}),this.$footer.$(".skip").on("click",()=>this.nextStep()),this.$footer.$(".show-all").on("click",()=>this.complete()),this.isReady=!0,setTimeout(()=>this.addClass("ready"))}nextStep(){if(this.isCompleted)return;let t=this.$activeStep,e=this.$stepsWrap.height;do{if(t.complete(),t=this.$steps[this.$steps.indexOf(t)+1],!t)return this.complete(!0);t.show()}while(t.isReady);this.$stepsWrap.animate({height:[e+"px","auto"]},800),this.$activeStep=t,this.saveProgress({activeStep:t.id})}goToStep(t,e=!0){let s=this.$stepsWrap.height;for(let o of this.$steps){if(o.isShown||(this.$activeStep=o),o.show(),t.isShown&&!o.isReady)break;o.complete()}let n=t.positionTop-Math.max(50,(w.height-t.height)/2);e?(this.$stepsWrap.animate({height:[s+"px","auto"]},800),G.scrollTo(n)):G.scrollTop=n;let r=N(this.$steps);if(r.isShown&&r.isReady)return this.complete();this.$activeStep&&this.saveProgress({activeStep:this.$activeStep.id})}complete(t=!1){if(this.isCompleted)return;this.isCompleted=!0,this.$steps.forEach(s=>s.complete()),this.$activeStep=void 0;let e=this.$footer.$(".next-section");t?(this.$skipStep.exit("fade",200),e&&e.enter("pop")):(this.$skipStep.hide(),e&&e.show()),this.trigger("complete"),this.saveProgress({completed:!0}),this.log("Course","complete")}findStep(t){for(let e of this.$steps)if(e.id===t)return e}saveProgress(t){if(!this.isReady)return;let s=U(this.$steps.map(n=>n.scores.size))/+this.data.goals||0;this.$progress.setProgress(s),Hh(`/course/${this.id}/${this.data.section}`,t)}log(t,e,s){if(window.ga&&this.isReady){let n=e+(s?":"+s:"");window.ga("send","event",t,n,this.id)}}};Eo=b([P("x-course")],Eo);var Ao=class{constructor(){this.callbacks=[]}add(t){this.callbacks.push(t)}start(t=1e3){return j(s=>{for(let n of this.callbacks)n(s)},t).promise}};function Oc(i,t){return i.every((e,s)=>T(e,t[s]))}function Ic(i,t){i.scale*=t.scale,i.x=i.x*t.scale+t.x,i.y=i.y*t.scale+t.y}function Gc(i,t){return T(i.x,t.x)&&T(i.y,t.y)&&T(i.scale,t.scale)}function un(i,t,e){if(e==="adding"){let s=i.strokeLength,n=t<.5?0:K("cubic-in",t*2-1);i.css({"stroke-dasharray":s+"px","stroke-dashoffset":s*(1-n)+"px"})}else if(e==="deleting"){let s=i.strokeLength,n=t<.5?K("cubic-in",2*t):1;i.css({"stroke-dasharray":s+"px","stroke-dashoffset":s*(2-n)+"px"})}}function Rc(i,t){let e=[i],s=i.expr;for(;t.startsWith(s);){if(t===s)return e;let n=N(e).next;if(!n)return;e.push(n),s+=n.expr}}function Nc(i,t,e=1){let s=e*Math.abs(t.x-i.x)/3,n=p.average(i,t).shift(0,s);return function(r){let o=(1-r)**2*i.x+2*r*(1-r)*n.x+r*r*t.x,a=(1-r)**2*i.y+2*r*(1-r)*n.y+r*r*t.y;return{x:o,y:a}}}function ii(i,t){return t.length===1&&t[0].type==="mrow"?t[0]:new Ue(t,i)}var tt=class{constructor(t,e,s,n){this.type=t;this.equation=s;this.$element=n;this.children=[];this.status="";this.value="";this.customColor="";this.roundedMotion=!1;this.width=0;this.height=0;this.baseline=0;this.transform={x:0,y:0,scale:1};this.currentDimensions=[0,0,0];this.currentWorldTransform={x:0,y:0,scale:1};this.addChildren(e),n&&s.$row.append(n)}get expr(){return""}get log(){let t=this.children.map(e=>e.log);return`<${this.type}>${t.join("")}</${this.type}>`}get color(){return this.customColor||(this.parent?this.parent.color:"")}static create(t,e){let s=t.nodeName.toLowerCase();if(R(s,"mn","mi","mo","mtext"))return new Co(s,t,e);if(!R(s,"mrow","mfrac","mfenced","msqrt","mroot","msub","msup","msubsup"))return new Bc(t,e);if(s==="mfenced"&&t.getAttribute("open")==="["){let r=t.children.length,o=Yt(Array.from(t.children,h=>Array.from(h.children,l=>tt.create(l,e)))),a=new zc(o,e,r);return new ko([a],e)}let n=Array.from(t.children,r=>tt.create(r,e));switch(s){case"mrow":return new Ue(n,e);case"mfrac":return n=n.map(r=>ii(e,[r])),new Dc(n,e);case"mfenced":return n=[ii(e,n)],new ko(n,e);case"msqrt":return n=[ii(e,n)],new Lo(s,n,e);case"mroot":return n=n.map(r=>ii(e,[r])),new Lo(s,n,e);case"msub":case"msup":case"msubsup":return n=n.map(r=>ii(e,[r])),new qc(s,n,e)}throw new Error(`Unknown element type tag ${t.nodeName}`)}get marginLeft(){return .1}get marginRight(){return .1}setTransform(t=0,e=0,s=1){this.transform.x=t,this.transform.y=e,this.transform.scale=s}get worldTransform(){let t=this,e=Object.assign({},this.transform);for(;t=t.parent;)Ic(e,t.transform);return e}get next(){if(!this.parent)return;let t=this.parent.children.indexOf(this);return this.parent.children[t+1]}get prev(){if(!this.parent)return;let t=this.parent.children.indexOf(this);return this.parent.children[t-1]}addChildren(t,e=this.children.length){for(let s of t)s.detach(),s.parent=this;this.children.splice(e,0,...t)}insertAfter(t){let e=this.parent.children.indexOf(this);this.parent.addChildren(t,e+1)}insertBefore(t){let e=this.parent.children.indexOf(this);this.parent.addChildren(t,e)}detach(){if(this.parent){let t=this.parent.children.indexOf(this);t>=0&&this.parent.children.splice(t,1)}}deleteFromDom(){this.$element&&this.$element.remove(),this.$element=void 0;for(let t of this.children)t.deleteFromDom()}hasParent(t){let e=this;for(;e=e.parent;)if(e.type===t)return!0;return!1}measure(){for(let t of this.children)t.measure()}clean(){for(let t of this.children)t.clean()}setStatus(t){this.status=t;for(let e of this.children)e.setStatus(t)}render(t){for(let h of this.children)h.render(t);if(!this.$element)return;let e=this.currentWorldTransform,s=this.currentWorldTransform=this.worldTransform,n=this.currentDimensions,r=this.currentDimensions=[this.width,this.height,this.baseline];if(Gc(e,s)&&Oc(n,r)&&!this.status)return;if(!t){this.positionElement(s),this.drawElement(1,r[0],r[1],r[2],s.scale);return}this.status==="adding"&&this.positionElement(s);let o=s.y+this.baseline<this.equation.root.baseline?-1:1,a=this.roundedMotion?Nc(e,s,o):void 0;this.roundedMotion=!1,t.add(h=>{if(!this.$element)return;let l=K("cubic",h),u=R(this.status,"adding","deleting"),d=u?r[0]:bt(n[0],r[0],l),m=u?r[1]:bt(n[1],r[1],l),$=u?r[2]:bt(n[2],r[2],l),k=u?s.scale:bt(e.scale,s.scale,l);if(this.drawElement(h,d,m,$,k),!this.status){let g=a?a(l):p.interpolate(e,s,l);this.positionElement({x:g.x,y:g.y,scale:k})}})}positionElement(t){this.$element.setTransform(t,0,t.scale)}drawElement(t,e,s,n,r){}},Tm="acegmnopqrsuvwxyz",dn=1.1,Oo=.2,Io=["=","\u2248","<",">","\u2264","\u2265"],Vm="position: absolute; top: -100px; left: -100px",Em=c("svg",{width:0,height:0,style:Vm},G),Co=class extends tt{constructor(t,e,s){let n=c("text",{text:e.textContent},Em),r=n.width;super(t,[],s,n);this.value=e.textContent||"",this.width=r;let o=this.value.split("").every(a=>Tm.includes(a));this.height=(dn-(o?.15:0))*this.equation.fontSize,this.baseline=this.height-Oo*this.equation.fontSize,(t==="mtext"||e.getAttribute("mathvariant")==="normal")&&n.addClass("font-normal")}get expr(){return this.type==="mtext"?`"${this.value}"`:this.value}get log(){return`<${this.type}>${this.value}</${this.type}>`}get marginLeft(){if(this.type==="mo")return Io.includes(this.value)?this.equation.isDisplay?.6:.35:R(this.value,"\u2221","\u25B3","!","%","\u2019")||R(this.value,"\u2026","\xB0")&&this.prev&&this.prev.type==="mn"?0:.25;if(this.type==="mi"){if(this.prev&&this.prev.type==="mn")return .1;if(this.prev&&this.prev.type==="mi")return .05;if(this.prev&&this.prev.type==="mfrac")return .15}return 0}get marginRight(){return this.type==="mo"?this.equation.isDisplay&&Io.includes(this.value)?.6:R(this.value,"\u2221","\u25B3")?0:this.value==="\u2212"&&(!this.prev||Io.includes(this.prev.value))?.1:.25:0}positionElement(t){if(!this.$element)return;let e=(this.equation.fontSize-this.baseline)*t.scale;this.$element.setTransform({x:t.x,y:t.y-e},0,t.scale)}drawElement(t,e,s,n,r){this.status==="adding"?this.$element.setAttr("opacity",t<.5?0:K("cubic-in",t*2-1)):this.status==="deleting"&&this.$element.setAttr("opacity",t<.5?1-K("cubic-in",2*t):0),this.$element.css("stroke-width",(1-r)*1.5+"px"),this.$element.css("color",this.color||"currentColor")}},Ue=class extends tt{constructor(t,e,s,n=0){super("mrow",t,e);this.align=s;this.dx=n}addChildren(t,e=this.children.length){let s=[];for(let n of t)n.type==="mrow"?(s.push(...n.children),n.detach()):s.push(n);tt.prototype.addChildren.call(this,s,e)}get expr(){return this.children.map(t=>t.expr).join("")}measure(){if(tt.prototype.measure.call(this),!this.children.length){this.height=this.width=this.baseline=0;return}this.baseline=Math.max(...this.children.map(e=>e.baseline)),this.height=this.baseline+Math.max(...this.children.map(e=>e.height-e.baseline));let t=0;for(let[e,s]of this.children.entries())s.setTransform(t,this.baseline-s.baseline),t+=s.width,e<this.children.length-1&&(t+=Math.max(s.marginRight,this.children[e+1].marginLeft)*this.equation.fontSize);if(this.align){let e=this.children.find(s=>s.expr===this.align);e&&(this.transform.x=this.dx-e.transform.x-e.width/2)}this.width=t}},Dc=class extends tt{constructor(t,e){super("mfrac",t,e,c("line"))}get expr(){return this.children.map(t=>t.expr).join("/")}measure(){tt.prototype.measure.call(this);let t=.1*this.equation.fontSize,e=!this.equation.isDisplay||this.hasParent("mfrac")||this.hasParent("matrix")?.66:1,[s,n]=this.children;this.width=(Math.max(s.width,n.width)+2*t)*e,this.height=(s.height+n.height)*e,this.baseline=s.height*e+this.equation.fontSize*(dn/2-Oo),s.setTransform((this.width-s.width*e)/2,0,e),n.setTransform((this.width-n.width*e)/2,s.height*e,e)}drawElement(t,e,s,n){let r=n-this.equation.fontSize*(dn/2-Oo);this.$element.setLine({x:0,y:r},{x:e,y:r}),this.$element.setAttr("stroke",this.color||"currentColor"),un(this.$element,t,this.status)}},qc=class extends tt{get expr(){let t=this.children[0].expr;return this.type!=="msup"&&(t+="_"+this.children[1].expr),this.type==="msup"&&(t+="^"+this.children[1].expr),this.type==="msubsup"&&(t+="^"+this.children[2].expr),t}measure(){tt.prototype.measure.call(this);let[t,e,s]=this.children,n=this.type==="msup"?void 0:e,r=this.type==="msubsup"?s:this.type==="msup"?e:void 0,o=.05*this.equation.fontSize,a=.65,h=r?r.height*a-.4*this.equation.fontSize:0,l=n?n.height*a-.5*this.equation.fontSize:0,u=r?r.width:0,d=n?n.width:0;this.width=t.width+o+Math.max(u,d)*a,this.height=t.height+h+l,this.baseline=t.baseline+h,t.setTransform(0,this.baseline-t.baseline),r&&r.setTransform(t.width+o,0,a),n&&n.setTransform(t.width+o,this.height-n.height*a,a)}clean(){if(tt.prototype.clean.call(this),this.children=this.children.filter(t=>t.type!=="mrow"||t.children.length),this.children.length===0)return this.detach();this.children.length===1&&(this.insertAfter(this.children),this.detach())}},ko=class extends tt{constructor(t,e){super("mfenced",t,e,c("path"))}get expr(){return`(${this.children.map(t=>t.expr).join()})`}get marginLeft(){return .2}get marginRight(){return .2}measure(){tt.prototype.measure.call(this);let t=this.children[0];this.height=t.height+2,this.baseline=t.baseline+1;let e=1+this.height/this.equation.fontSize,s=.1*this.equation.fontSize;this.width=t.width+2*(e+s),t.setTransform(e+s,1)}drawElement(t,e,s){let n=Math.min(2+s/this.equation.fontSize,5),r=s-4,o=e-n,a=`M${n},2c${-2*n/3},${.15*r},${-n},${.32*r},${-n},${r/2}s${n/3},${.35*r},${n},${r/2}M${o},2c${2*n/3},${.15*r},${n},${.32*r},${n},${r/2}s${-n/3},${.35*r},${-n},${r/2}`;this.$element.setAttr("d",a),this.$element.css("stroke",this.color||"currentColor"),un(this.$element,t,this.status)}clean(){tt.prototype.clean.call(this),this.children.length||this.detach()}},Lo=class extends tt{constructor(t,e,s){super(t,e,s,c("path"))}get expr(){return`sqrt(${this.children.map(t=>t.expr).join()})`}get marginLeft(){return .2}get marginRight(){return .2}measure(){tt.prototype.measure.call(this);let t=this.children[0];this.height=t.height+2,this.baseline=t.baseline+2;let e=Math.min(16,3+5*this.height/this.equation.fontSize),s=.05*this.equation.fontSize;this.width=t.width+e+2*s,t.setTransform(e+s,2)}drawElement(t,e,s){let n=Math.min(16,3+5*s/this.equation.fontSize),r=s-2,o=`M0,${.55*r}L${.18*n},${.51*r}L${.45*n},${r}L${n},2L${e},2`;this.$element.setAttr("d",o),this.$element.css("stroke",this.color||"currentColor"),un(this.$element,t,this.status)}clean(){tt.prototype.clean.call(this),this.children.length||this.detach()}},zc=class extends tt{constructor(t,e,s){super("matrix",t,e,c("g"));this.rows=s;this.cols=Math.floor(t.length/s)}get expr(){return`${this.children.map(t=>t.expr).join(", ")}`}measure(){tt.prototype.measure.call(this);let t=.6*this.equation.fontSize,e=z(r=>Math.max(...z(o=>this.children[r*this.cols+o].height,this.cols)),this.rows),s=z(r=>Math.max(...z(o=>this.children[o*this.cols+r].width,this.rows)),this.cols);this.height=U(e)+(this.rows-1)*t/2,this.width=U(s)+this.cols*t,this.baseline=(this.height+dn*this.equation.fontSize)/2;let n=0;for(let r=0;r<this.rows;++r){let o=t/2;for(let a=0;a<this.cols;++a){let h=this.children[r*this.cols+a],l=o+(s[a]-h.width)/2,u=n+(e[r]-h.height)/2;h.setTransform(l,u),o+=s[a]+t}n+=e[r]+t/2}}},Bc=class extends tt{constructor(t,e){super("foreign",[],e,c("g"));var s;this.$body=c("div",{},e.$overlay),this.$body._el.appendChild(t),this.$measure=c("span",{text:".",style:"font-size: 0"},this.$body),this.checkForResize(),this.$body.on("resize",()=>{this.checkForResize()&&this.equation.resize()}),(s=this.$body.$("x-blank, x-blank-mc"))==null||s.on("solve",n=>{os(()=>this.replace(n.solution,"#0f82f2"),n.restore?0:200)})}deleteFromDom(){var t;(t=this.$body)==null||t.remove(),this.$body=void 0,this.$measure=void 0}replace(t,e){var o;let s=isNaN(+t)?"mtext":"mn",n=document.createElement(s);n.textContent=t;let r=new Co(s,n,this.equation);r.customColor=e,this.insertAfter([r]),(o=this.$body)==null||o.off("resize"),this.detach(),this.deleteFromDom(),this.equation.resize()}checkForResize(){var n,r;let t=this.height,e=this.width,s=this.baseline;return this.height=((n=this.$body)==null?void 0:n.height)||0,this.width=((r=this.$body)==null?void 0:r.width)||0,this.baseline=this.$measure.bounds.top-this.$body.bounds.top,!(T(t,this.height)&&T(e,this.width)&&T(s,this.baseline))}positionElement(t){this.$body.css({left:t.x+"px",top:t.y+"px"}),T(t.scale,1)||this.$body.css("transform",`scale(${t.scale})`)}get expr(){return this.$body.text}get log(){return`<foreign>${this.expr}</foreign>`}};var ni=class extends hs{constructor(t,e,s=0,n="=",r=18,o=!0){super();this.$row=t;this.$overlay=e;this.fontSize=r;this.isDisplay=o;this.isReady=!0;this.deletedNodes=new Set;this.desc=c("desc",{},t),this.root=new Ue([],this,n,s)}setValue(t){let e=Array.isArray(t)?t.map(s=>tt.create(s,this)):this.parse(t);for(let s of this.root.children)s.deleteFromDom();this.root.addChildren(e),this.updateDescription(),this.resize()}updateDescription(){this.desc.text=this.root.expr}resize(){this.root.measure(),this.root.render()}parse(t){var o;let e=new DOMParser,s=Pt.parse(t).toMathML(),n=e.parseFromString(`<math>${s}</math>`,"text/xml");if(((o=n.firstChild)==null?void 0:o.nodeName)==="parsererror")throw new Error(n.firstChild.textContent);let r=n.firstChild.childNodes;return Array.from(r,a=>tt.create(a,this))}find(t){let[e,s]=t.split("`");e=e.replace(/[–-]/g,"\u2212");let n=+s||1,r=this.root.children.slice(0),o=0;for(;r.length;){let a=r.shift(),h=a instanceof Ue?void 0:Rc(a,e);if(h&&(o+=1,o===n))return h;r.unshift(...a.children)}throw new Error(`Can't find element ${e}.`)}animate(t=1200){return S(this,null,function*(){this.isReady=!1,this.root.clean(),this.root.measure();let e=new Ao;this.root.render(e),this.trigger("resize",{height:this.root.height});for(let s of this.deletedNodes)s.render(e);yield e.start(t);for(let s of this.deletedNodes)s.deleteFromDom();this.root.setStatus(""),this.deletedNodes.clear(),this.isReady=!0})}addTermAfter(t,e){let s=N(e?this.find(e):this.root.children),n=this.parse(t);s.insertAfter(n);for(let r of n)r.setStatus("adding");this.updateDescription()}addTermBefore(t,e){let s=e?this.find(e)[0]:this.root.children[0],n=this.parse(t);s.insertBefore(n);for(let r of n)r.setStatus("adding");this.updateDescription()}deleteTerm(t){for(let e of this.find(t))e.setStatus("deleting"),e.detach(),this.deletedNodes.add(e);this.updateDescription()}replaceTerm(t,e){let s=this.find(t),n=this.parse(e);s[0].insertBefore(n);for(let r of n)r.setStatus("adding");for(let r of s)r.setStatus("deleting"),r.detach(),this.deletedNodes.add(r);this.updateDescription()}moveTermAfter(t,e){let s=this.find(t);for(let r of s)r.roundedMotion=!0;N(e?this.find(e):this.root.children).insertAfter(s),this.updateDescription()}moveTermBefore(t,e){let s=this.find(t);for(let r of s)r.roundedMotion=!0;(e?this.find(e)[0]:this.root.children[0]).insertBefore(s),this.updateDescription()}moveTermToStart(t){let e=this.find(t);for(let s of e)s.roundedMotion=!0;this.root.children[0].insertBefore(e),this.updateDescription()}wrapTerms(t,...e){let s=e.map(r=>this.find(r));for(let r of s)for(let o of r)o.roundedMotion=!0;let n=this.parse(t);for(let r of n)r.setStatus("adding");s[0][0].insertBefore(n);for(let[r,o]of s.entries()){let a=this.find("$"+(r+1))[0];a.insertAfter(o),a.detach(),a.deleteFromDom()}this.updateDescription()}unwrapTerm(t,e=1){let s=this.find(t),n=s[0],r=1;for(;r<=e;)n=n.parent,n instanceof Ue&&(n=n.parent),r+=1;n.insertAfter(s),n.setStatus("deleting"),n.detach(),this.deletedNodes.add(n),this.updateDescription()}get leftSide(){let t=this.root.children.findIndex(e=>e.expr==="=");return this.root.children.slice(0,t-1)}get rightSide(){let t=this.root.children.findIndex(e=>e.expr==="=");return this.root.children.slice(t+1)}};var _c='<svg class="equation"><g></g></svg><div class="overlay"></div><div class="nav"><div class="btn back hide"><x-icon name="left"></x-icon></div><div class="btn next"><x-icon name="right"></x-icon></div></div><div class="legend-box"><slot></slot></div>';var Hc=1200,Am=400,Uc=1200,Es=600,ri=16,Go=class extends M{constructor(){super(...arguments);this.rows=[];this.isReady=!0;this.topOffset=4;this.currentHeight=0;this.currentStep=0;this.nextEvents={};this.backEvents={}}ready(){this.$svg=this.$("svg"),this.$lastRow=this.$svg.$("g"),this.$overlay=this.$(".overlay"),this.$legend=this.$(".legend-box"),this.$steps=this.$legend.$$("li"),this.$back=this.$(".back"),this.$next=this.$(".next");let t=+this.attr("dx")||0;this.equation=new ni(this.$lastRow,this.$overlay,t);let e=this.$(".math"),s=e?Array.from(e._el.children):[];this.equation.setValue(this.attr("expr")||s),this.currentHeight=this.topOffset+this.$lastRow.height+16,this.$svg.css("height",this.currentHeight+"px"),this.equation.on("resize",({height:r})=>{let o=this.topOffset+r+ri;Math.abs(o-this.currentHeight)<ri/2||(this.currentHeight=o,this.$svg.animate({height:o+"px"},Uc))}),this.$back.on("click",()=>this.goBack()),this.$next.on("click",()=>this.goNext()),this.$steps[0].show(),w.onResize(()=>{let r=this.$svg.width/2;for(let o of[this.$lastRow,this.$overlay])o.css("transform",`translate(${r}px, ${this.topOffset}px)`);for(let o of this.rows)o.$el.css("transform",`translate(${r}px, ${o.top}px)`)});let n=this.$overlay.$$("x-blank, x-blank-mc");n.length&&(this.$next.addClass("hide"),Promise.all(n.map(r=>r.onPromise("solve"))).then(()=>setTimeout(()=>this.goNext(),Hc)))}setup(t){this.one("next",({step:e})=>t.score("algebra-flow-"+(e-1)))}newRow(){return S(this,null,function*(){let t=this.$lastRow.copy(!0,!1),e=this.equation.root.height;this.rows.push({$el:t,height:e,top:this.topOffset}),this.$lastRow.insertBefore(t),w.redraw(),this.topOffset+=e+ri,this.currentHeight=this.topOffset+e+ri;for(let s of[this.$lastRow,this.$overlay])s.animate({transform:`translate(${this.$svg.width/2}px, ${this.topOffset}px)`},Es);yield this.$svg.animate({height:this.currentHeight+"px"},Es).promise})}hideLastRow(){return S(this,null,function*(){if(!this.rows.length)return;let t=this.rows.pop();this.topOffset=t.top;for(let e of[this.$lastRow,this.$overlay])e.animate({transform:`translate(${this.$svg.width/2}px, ${t.top}px)`},Es);this.currentHeight=t.top+this.$lastRow.height+ri,this.$svg.animate({height:this.currentHeight+"px"},Es),yield t.$el.exit("fade",Es/2,Es/2).promise,t.$el.remove()})}onNextStep(t){this.nextEvents=t}onBackStep(t){this.backEvents=t}goNext(){return S(this,null,function*(){if(!this.isReady||!this.equation.isReady||this.currentStep>=this.$steps.length-1)return;this.isReady=!1;let t=this.currentStep+1;this.$steps[t].hasClass("new-row")&&(yield this.newRow(),yield ie(Am)),t in this.nextEvents&&(yield this.nextEvents[t](this.equation),yield this.equation.animate(Uc),yield ie(Hc)),yield this.go(t),this.trigger("next",{step:t}),this.isReady=!0})}goBack(){return S(this,null,function*(){if(!this.isReady||!this.equation.isReady||this.currentStep<=0)return;let t=this.currentStep-1;this.isReady=!1,this.currentStep in this.backEvents&&(yield this.backEvents[this.currentStep](this.equation),yield this.equation.animate()),this.$steps[this.currentStep].hasClass("new-row")&&this.hideLastRow(),yield this.go(t),this.trigger("back",{step:t}),this.isReady=!0})}go(t){return S(this,null,function*(){this.$steps[t].show();let e=this.$steps[t].height+"px";this.$steps[t].hide(),this.$legend.animate({height:e},800).promise.then(()=>this.$legend.css("height","auto"));let s=this.currentStep;this.currentStep=t,this.trigger("step",t),yield this.$steps[s].exit("fade",400).promise,this.$back.setClass("hide",t<=0),this.$next.setClass("hide",t>=this.$steps.length-1),yield this.$steps[t].enter("fade",400).promise})}};Go=b([P("x-algebra-flow",{template:_c})],Go);var Wc='<div class="input"><textarea></textarea></div><div class="math empty"><span class="cursor">&#8203;</span></div><div class="keys"><!-- TODO Make these buttons tabbable--><div class="btn" data-type="+">+</div><div class="btn" data-type="\u2212">\u2212</div><div class="btn" data-type="\xD7">\xD7</div><div class="btn" data-type="\xF7">\xF7</div><div class="btn i" data-type="\u03C0">\u03C0</div><div class="btn" data-type="frac"><x-icon name="fraction"></x-icon></div><div class="btn" data-type="sup"><x-icon name="power"></x-icon></div><div class="btn" data-type="sqrt"><x-icon name="sqrt"></x-icon></div><div class="btn" data-type="brackets"><x-icon name="brackets"></x-icon></div></div><div class="error"><x-icon name="warning"></x-icon></div><div class="error-message"></div>';var Te=ws;function Zc(i){let t=i.prev;t&&R(t.tagName,"MO","MI","MN")?t.insertBefore(i):t?N(t.children).append(i):i.parent.hasClass("math")||(i.parent.prev?i.parent.prev.append(i):i.parent.parent.insertBefore(i))}function Cm(i){let t=i.next;if(t&&R(t.tagName,"MO","MI","MN"))return t.insertAfter(i);t?t.children[0].prepend(i):i.parent.hasClass("math")||(i.parent.next?i.parent.next.prepend(i):i.parent.parent.insertAfter(i))}function km(i){let t=i.parent;for(;t.parent.tagName!=="MFRAC"||!t.prev;){if(t.hasClass("math"))return;t=t.parent}t.prev.append(i)}function Lm(i){let t=i.parent;for(;t.parent.tagName!=="MFRAC"||!t.next;){if(t.hasClass("math"))return;t=t.parent}t.next.prepend(i)}function Om(i){let t=i.prev,e=i.parent;if(t&&R(t.tagName,"MO","MI","MN"))t.remove(),e.children.length<=1&&e.addClass("empty");else if(!t&&!e.prev&&!e.hasClass("math")){let s=e.parent;s.insertBefore(i);for(let n of s.children)for(let r of n.children)s.insertBefore(r);s.remove(),i.parent.children.length<=1&&i.parent.addClass("empty")}else Zc(i)}function We(i,t){t.insertBefore(i),t.parent.removeClass("empty"),i.children.length&&i.children[0].append(t)}function Fc(i,t){"abcdefghijklmnopqrstuvwxyz\u03C0".includes(t)?We(c("mi",{text:t}),i):"0123456789.".includes(t)?We(c("mn",{text:t}),i):"+\u2212\xB1\xD7\xF7<>\u2264\u2265=%!".includes(t)?We(c("mo",{text:t,value:t}),i):t==="frac"?We(c("mfrac",{html:'<mrow class="empty"></mrow><mrow class="empty"></mrow>'}),i):t==="sqrt"?We(c("msqrt",{html:'<mrow class="empty"></mrow>'}),i):R(t,"^","sup")?We(c("msup",{html:'<mrow class="empty"></mrow>'}),i):t==="brackets"||"([{|".includes(t)?We(c("mfenced",{html:'<mrow class="empty"></mrow>',type:"("}),i):")]}".includes(t)&&!i.next&&i.parent.parent.tagName==="MFENCED"&&i.parent.parent.insertAfter(i)}function jc(i,t){let e=i.$$(`${t}:first-child, *:not(${t}) + ${t}`);for(let s of e)if(s.parent.tagName!=="MFRAC")for(;s.next&&s.next.tagName===t.toUpperCase();)s.text+=s.next.text,s.next.remove()}var Im="This is not a valid mathematical expression.",Gm="Fill in all empty placeholders in the expression.",Rm={"+":"addition","\xD7":"multiplication","/":"fractions or division","\u2212":"subtraction",sqrt:"square roots","^":"powers"};function Ze(i,t){if(i instanceof Text)return i.textContent||"";if(i.hasClass("cursor"))return"";let e=i.childNodes;return i.tagName==="MI"?i.text+(t?" ":""):i.tagName==="MFENCED"?"("+Ze(e[0],t)+")":i.tagName==="MSUP"?"^("+Ze(e[0],t)+")":i.tagName==="MFRAC"?`(${Ze(e[0],t)})/(${Ze(e[1],t)})`:i.tagName==="MSQRT"?"sqrt("+Ze(e[0],t)+")":e.map(s=>Ze(s,t)).join("")}function Nm(i,t){try{return{expr:Pt.parse(i,!0,{variables:t})}}catch(e){return{error:e instanceof W?e.message:Im}}}function Dm(i,t,e){let s=i.variables;if(t.length){let n=s.find(o=>!t.includes(o));if(n){let o=fh(n,e||t);return o?`Did you mean \u201C<em>${o}</em>\u201D instead of \u201C<em>${n}</em>\u201D?`:`There shouldn\u2019t be a variable called \u201C<em>${n}</em>\u201D.`}let r=t.find(o=>!s.includes(o));if(r)return`Your expression should contain \u201C<em>${r}</em>\u201D.`}}function qm(i,t){if(t.length){let e=i.functions.find(s=>!t.includes(s));if(e)return`This expression should not contain ${Rm[e]||"\u201C"+e+"\u201D"}.`}}function zm(i,t,e=.001){try{return T(i.evaluate(),t.evaluate(),e)}catch(s){return!1}}var Ro=class extends M{constructor(){super(...arguments);this.isDone=!1;this.shortVar=!1;this.lastAttempt="";this.errorCount=0;this.hints=[];this.fns=[];this.vars=[];this.validate=void 0}ready(){if(this.$math=this.$(".math"),this.$textarea=this.$("textarea"),this.$cursor=this.$(".cursor"),this.$error=this.$(".error-message"),this.solution=Pt.parse(this.attr("solution")),this.hasAttr("numeric")&&(this.numeric=+this.attr("precision")||.01),this.vars=this.hasAttr("vars")?wt(this.attr("vars")):this.solution?this.solution.variables:[],this.hasAttr("fns")&&(this.fns=wt(this.attr("fns"))),this.solution&&this.fns.push(...this.solution.functions),this.fns.includes("/")&&!this.fns.includes("\xD7")&&this.fns.push("\xD7"),this.hasAttr("hints")&&(this.hints=wt(this.attr("hints"))),this.hasAttr("substitutions")){this.substitutions={},this.autocomplete=this.vars.slice(0);for(let s of this.attr("substitutions").split("|"))if(s.trim()){let[n,r]=s.split(":");this.autocomplete.push(n.trim()),this.substitutions[n.trim()]=Pt.parse(r)}}for(let s of["solution","precision","vars","fns","vars-required","substitutions"])this.removeAttr(s);this.shortVar=this.hasAttr("short-var");let t=wt(this.attr("keys")||"+ \u2212 \xD7 \xF7 frac sup sqrt brackets"),e=this.$(".keys");for(let s of e.children)t.includes(s.data.type)?(s.on("pointerdown",n=>n.preventDefault()),s.on("pointerup",()=>{Fc(this.$cursor,s.data.type),this.check()})):s.remove();this.on("pointerdown",s=>this.onPointerdown(s)),this.$textarea.on("focus",()=>this.onPointerdown()),this.$textarea.on("blur",()=>this.onBlur()),this.$textarea.on("key",s=>this.onKey(s))}setup(t,e,s){var n;this.$step=t,((n=s==null?void 0:s.scores)==null?void 0:n.includes(e))&&this.solve(),this.on("solve",()=>{t.addHint("correct"),t.score(e)})}focus(){this.trigger("pointerdown")}onPointerdown(t){if(this.isDone)return;t&&t.preventDefault&&t.preventDefault(),this.addClass("active"),this.$textarea.focus();let e=t&&t.target?E(t.target):this;if(e.tagName==="X-EQUATION"||e.hasClass("math")){let s=this.$math.children,n=U(s.map(o=>o.outerWidth))/2;(t?It(t).x<this.$math.bounds.left+n:!0)?this.$math.prepend(this.$cursor):this.$math.append(this.$cursor)}else if(e.tagName[0]==="M"){let s=It(t).x<e.boxCenter.x;e.tagName==="MROW"?s?e.prepend(this.$cursor):e.append(this.$cursor):s?e.insertBefore(this.$cursor):e.insertAfter(this.$cursor)}}onKey(t){if(R(t.code,Te.enter,Te.escape))this.$textarea.blur();else if(t.code===Te.left)Zc(this.$cursor);else if(t.code===Te.right)Cm(this.$cursor);else if(t.code===Te.up)km(this.$cursor);else if(t.code===Te.down)Lm(this.$cursor);else if(R(t.code,Te.backspace,Te.delete))Om(this.$cursor),this.check();else{let e=t.key.replace("*","\xD7").replace("/","\xF7").replace("-","\u2212");Fc(this.$cursor,e),this.check()}}onBlur(){if(this.isDone)return;if(!this.value)return this.removeClass("active has-error");if(this.removeClass("active"),this.addClass("has-error"),this.value===this.lastAttempt||(this.lastAttempt=this.value,!this.$step))return;let t=this.error||(this.hints||[]).shift()||"incorrect",e=this.$step.addHint(t,{class:"incorrect"});this.$error.html=(e==null?void 0:e.text)||"",this.errorCount+=1,this.trigger("error",{count:this.errorCount,msg:t}),this.errorCount>=5&&this.$step.addHint(`Hmmm\u2026 maybe try ${this.solution.toMathML()}?`)}check(){if(this.error=void 0,this.value=Ze(this.$math,this.shortVar).trim(),!this.value)return;if(this.$math.$(".empty"))return this.error=Gm;let t=Nm(this.value,this.vars);if(t.error)return this.error=t.error;let e=this.substitutions?t.expr.substitute(this.substitutions):t.expr;if(this.numeric&&zm(this.solution,e,this.numeric))return this.solve();if(this.validate){let r=this.validate(t.expr)||{};if(r.isCorrect)return this.complete(t.expr);if(r.error)return this.error=r.error}if(this.solution&&Pt.numEquals(this.solution,e))return this.complete(t.expr);let s=Dm(e,this.vars,this.autocomplete);if(s)return this.error=s;let n=qm(e,this.fns);if(n)return this.error=n}complete(t){this.isDone||(this.isDone=!0,this.removeClass("has-error active"),this.addClass("done"),this.$textarea.blur(),this.shortVar||jc(this.$math,"mi"),jc(this.$math,"mn"),this.trigger("solve",{expr:t}))}solve(){this.$math.removeClass("empty"),this.$math.html=this.solution.toMathML(),this.complete(this.solution)}};Ro=b([P("x-equation",{template:Wc})],Ro);var Bm={opacity:[0,1],transform:["translateX(-50px)","none"]},_m={error:"You\u2019ve already had this expression before. Try simplifying it."},Hm="You have to fully simplify this expression. The correct solution is $0.",No=class extends M{constructor(){super(...arguments);this.rowCount=1;this.previousAnswers=[];this.isSolved=!1;this.maxRows=6;this.steps=[];this.hints=[]}created(){this.$table=this.$("table tbody"),this.lastRowContent=this.$table.$("tr:last-child").html}ready(){this.hasAttr("max-rows")&&(this.maxRows=+this.attr("max-rows")),this.hasAttr("steps")&&(this.steps=this.attr("steps").split("|")),this.hasAttr("hints")&&(this.hints=this.attr("hints").split("|")),this.removeAttr("steps"),this.removeAttr("hints"),this.setupEquation(this.$("x-equation"))}setup(t,e,s){var n;((n=s==null?void 0:s.scores)==null?void 0:n.includes(e))&&this.solve(),this.on("solve",()=>{t.addHint("correct"),t.score(e)}),this.on("hint",r=>t.addHint(r))}setupEquation(t){this.$equation=t,t.one("solve",e=>this.onSolveRow(e.expr)),t.hints=this.hints,t.validate=e=>{let s=this.previousAnswers.includes(e.toString());return(this.validate?this.validate(e,s):void 0)||(s?_m:{})}}onSolveRow(t){if(this.trigger("solve-row",{expr:t,$math:this.$equation.$math}),this.isFinal&&this.isFinal(t))return this.trigger("solve");if(this.isSolved)return;if(this.rowCount+=1,this.previousAnswers.push(t.toString()),this.rowCount>this.maxRows){let s=this.$equation.solution.toMathML();this.trigger("hint",Hm.replace("$0",s)),this.trigger("solve")}let e=c("tr",{html:this.lastRowContent},this.$table);e.animate(Bm,400,500),this.setupEquation(e.$("x-equation")),setTimeout(()=>this.$equation.focus(),1200)}solve(){if(this.isSolved=!0,this.steps.length){let t=this.$table.$("tr:last-child"),e=this.lastRowContent.replace(/<x-equation.*<\/x-equation>/,'<span class="math fill"></span>');for(let s of this.steps){let n=c("tr",{html:e},this.$table),r=n.$(".math.fill"),o=Pt.parse(s);r.html=o.toMathML(),t.insertBefore(n),this.trigger("solve-row",{expr:o,$math:r})}}this.$equation.solve()}};No=b([P("x-equation-system")],No);var Um=80,Wm=[5,2,1];function Do(i){let t=Math.min(...i.map(s=>Math.min(...s.map(n=>n.y)))),e=Math.max(...i.map(s=>Math.max(...s.map(n=>n.y))));return[t,e]}function At(i,t,e){return i.hasAttr(t)?i.attr(t)!=="no":e}function Kc(i){let t=wt(i).map(e=>+e);return t.length===1?[t[0],t[0],t[0],t[0]]:t.length===2?[t[0],t[1],t[0],t[1]]:t.length===3?[t[0],t[1],t[2],t[1]]:t}function Xc(i){let t=i.split(",");return[t[0]!=="no",(t.length>1?t[1]:t[0])!=="no"]}function qo(i,t,e){let s=i?i.split(","):[];if(s.length===3)return s.map(d=>+d);let n=s.length>0?+s[0]:e?e[0]:0,r=s.length>1?+s[1]:e?e[1]:t;if(T(n,r))return[n-1,r+1,1];r+=.01*(r-n);let o=Math.floor(Math.abs(t)/Um),a=(r-n)/o,h=Math.floor(Math.log10(a)),l=Math.pow(10,h),u=Wm.find(d=>l*d<=a)*l;return r=u*Math.ceil(r/u),n=u*Math.floor(n/u),[n,r,u]}var oi={hasGeoModel:!0,pi:Math.PI,point:(i,t)=>i!==void 0&&t!==void 0?new p(i,t):void 0,angle:(i,t,e)=>i&&t&&e?new yt(i,t,e):void 0,line:(i,t)=>i&&t&&!i.equals(t)?new et(i,t):void 0,ray:(i,t)=>i&&t&&!i.equals(t)?new Ks(i,t):void 0,segment:(i,t)=>i&&t&&!i.equals(t)?new _(i,t):void 0,circle:(i,t)=>i&&t?new H(i,t):void 0,arc:(i,t,e)=>i&&t&&e?new xe(i,t,e):void 0,sector:(i,t,e)=>i&&t&&e?new $e(i,t,e):void 0,polygon:(...i)=>i.every(t=>t)?new O(...i):void 0,polyline:(...i)=>i.every(t=>t)?new Pe(...i):void 0,triangle:(i,t,e)=>i&&t&&e?new Kr(i,t,e):void 0,rectangle:(i,t,e)=>i?new V(i,t,e):void 0,distance:p.distance,round:(i,t=0)=>$t(i,t),sqrt:Math.sqrt,floor:Math.floor,ceil:Math.ceil,intersections:ht};function fn(i,t,e){let s=e,n;for(let r of i){let o=t(r);o!==void 0&&o<s&&(s=o,n=r)}return n}function Yc(i,t){t.clear();for(let e of i)if(!(e.isHidden||!e.value))for(let s of i){if(e.isHidden||!s.value||e===s)continue;let n=ht(e.value,s.value);for(let[r,o]of n.entries())t.add({path1:e,path2:s,posn:o,index:r})}}function Fe(i,t){return at(i)?i.offset(t):st(i)?new et(i.c,t).angle/2/Math.PI:Ft(i)?new yt(i.start,i.c,t).rad/i.angle:.5}var Jc="M100,50h0l-5.2-4.9L52.6,10.2v-9C52.6.6,51.4,0,50,0s-2.6.6-2.6,1.2v9L5.2,45.1,0,50H0l6.6-3L35,25.9H65L93.4,47ZM38.4,23.5,50,14.8l11.6,8.7Z",Qc="M0,0V8H100V0ZM7,6A2,2,0,1,1,9,4,2,2,0,0,1,7,6Z";function je(i,t,e,s){return`translate(${i.x}px, ${i.y-t}px) scale(${s/100}) rotate(${e}rad)`}var tp=4,Zm=`<marker id="axis-arrow" refX="3" refY="3" markerWidth="6"
    markerHeight="6" orient="auto"><path d="M 0 0 L 6 3 L 0 6 z"/></marker>`,Ke=class extends M{constructor(){super(...arguments);this.labelSuffix=["",""];this.gridSize=[1,1];this.showGrid=!1;this.showXAxis=!1;this.showYAxis=!1;this.showLabels=!1}setupCoordinates(t,e={}){this.$svg=t,t.addClass("canvas"),this.proportional=!!e.proportional,this.padding=Kc(this.attr("padding")||e.padding||"0"),At(this,"grid",e.showGrid||!1)&&(this.$grid=c("g",{class:"grid"}),t.prepend(this.$grid),this.showGrid=!0);let s=this.attr("axes")||(e.showAxes?"yes":"no");[this.showXAxis,this.showYAxis]=Xc(s),(this.showXAxis||this.showYAxis)&&(c("defs",{html:Zm},t),this.$axes=c("g",{class:"axes"}),t.prepend(this.$axes),this.axisNames=(this.attr("axis-names")||",").split(",")),this.$axes&&At(this,"labels",!0)&&(this.labelSuffix=(this.attr("label-suffix")||",").split(","),this.showLabels=!0),(this.showLabels||this.axisNames)&&(this.$labels=c("g",{class:"labels"},t)),this.resize()}resize(){this.css("max-width","none");let t=+this.attr("width")||this.width,e=+this.attr("height")||(this.hasAttr("width")?t:this.height);this.css("max-width",t+"px"),this.$svg.setAttr("width",t),this.$svg.setAttr("height",e),this.$svg.setAttr("viewBox",`0 0 ${t} ${e}`);let s=this.padding;this.viewportBounds=new xt(s[3],t-s[1],s[0],e-s[2]),this.updatePlotBounds(),this.positionElements(t,e)}updatePlotBounds(t){let[e,s,n]=qo(this.attr("x-axis"),this.viewportBounds.dx,t==null?void 0:t.xRange),[r,o,a]=qo(this.attr("y-axis"),this.viewportBounds.dy,t==null?void 0:t.yRange),h=Math.abs(this.viewportBounds.dx/(s-e)),l=Math.abs(this.viewportBounds.dy/(o-r)),u=Math.min(h,l),d=this.proportional?h/u:1,m=this.proportional?l/u:1;this.plotBounds=new xt(d*e,d*s,m*o,m*r),this.plotScale=this.proportional?u:(h+l)/2,this.gridSize=[n,a];let[$,k]=[this.plotBounds,this.viewportBounds];this.plotToViewportMatrix=[[k.dx/$.dx,0,k.xMin-$.xMin/$.dx*k.dx],[0,k.dy/$.dy,k.yMin-$.yMin/$.dy*k.dy]];let g=e>0?d*e:s<0?d*s:0,y=r>0?m*r:o<0?m*o:0;this.plotOrigin=new p(g,y),this.drawAxes()}drawAxes(){let[t,e]=[this.plotBounds,this.viewportBounds],s=this.toViewportCoords(this.plotOrigin),[n,r]=this.gridSize;if(this.$grid&&this.$grid.removeChildren(),this.$axes&&this.$axes.removeChildren(),this.$labels&&this.$labels.removeChildren(),this.showGrid||this.showXAxis){let o=n*Math.trunc(t.xMin/n+.01);for(let a=o;a<t.xMax;a+=n){if(this.showYAxis&&a===this.plotOrigin.x)continue;let h=this.toViewportCoords(new p(a,0)).x;this.showGrid&&c("line",{x1:h,y1:e.yMin,x2:h,y2:e.yMax},this.$grid),this.showLabels&&this.makeLabel(0,a,h,s)}}if(this.showGrid||this.showYAxis){let[o,a]=t.yMin<t.yMax?[t.yMin,t.yMax]:[t.yMax,t.yMin],h=r*Math.trunc(o/r+.01);for(let l=h;l<a;l+=r){if(this.showXAxis&&l===this.plotOrigin.y)continue;let u=this.toViewportCoords(new p(0,l)).y;this.showGrid&&c("line",{x1:e.xMin,y1:u,x2:e.xMax,y2:u},this.$grid),this.showLabels&&this.makeLabel(1,l,u,s)}}this.showXAxis&&(this.$xAxis=c("line",{x1:e.xMin,x2:e.xMax,y1:s.y,y2:s.y},this.$axes)),this.showYAxis&&(this.$yAxis=c("line",{x1:s.x,x2:s.x,y1:e.yMax,y2:e.yMin},this.$axes)),this.showLabels&&this.showXAxis&&this.showYAxis&&(t.xMin===0&&t.yMax===0&&!this.labelSuffix[0]&&!this.labelSuffix[1]?c("text",{text:0,x:s.x-5,y:s.y+15,"text-anchor":"end"},this.$labels):t.yMax===this.plotOrigin.y?this.makeLabel(0,this.plotOrigin.x,s.x,s):this.makeLabel(1,this.plotOrigin.y,s.y,s)),this.axisNames&&(this.axisNames[0]&&c("text",{text:this.axisNames[0],x:this.viewportBounds.xMax-2,y:s.y-12,"text-anchor":"end"},this.$labels),this.axisNames[1]&&c("text",{text:this.axisNames[1],x:s.x+10,y:this.viewportBounds.yMin+5},this.$labels))}makeLabel(t,e,s,n){let r=this.labelSuffix[t],o=r==="i"?new J(0,e).toString():vt(e,4)+r;c("text",{text:o,x:t?n.x-8:s,y:t?s+4:n.y+18,"text-anchor":t?"end":"middle"},this.$labels),c("line",{class:"tick",x1:t?n.x:s,y1:t?s:n.y,x2:t?n.x-tp:s,y2:t?s:n.y+tp},this.$axes)}positionElements(t,e){for(let s of this.$$("[data-bounds]")){let n=s.data.bounds.split(","),r=this.toViewportCoords(new p(+n[3],+n[0])),o=this.toViewportCoords(new p(+n[1],+n[2]));s.css({left:`${r.x/t*100}%`,top:`${r.y/e*100}%`,width:`${(o.x-r.x)/t*100}%`,height:`${(o.y-r.y)/e*100}%`})}}toPlotCoords(t){return t.changeCoordinates(this.viewportBounds,this.plotBounds)}toViewportCoords(t){return t.transform(this.plotToViewportMatrix)}};var zo=class extends Ke{constructor(){super(...arguments);this.steps=400}ready(){let t=c("svg",{},this),e=c("g",{class:"plot"},t);this.$path=c("path",{},e),this.setupCoordinates(t,{showGrid:!0,showAxes:!0,padding:"20"}),this.clear();let s=this.viewportBounds,n=this.steps/s.dx,r;Ge(t,{start:()=>r=void 0,move:o=>{let a=L(Math.round((o.x-s.xMin)*n),0,this.steps-1);this.points[a]=this.toPlotCoords(new p(s.xMin+a/n,o.y)),r&&this.interpolate(r,a),r=a,this.redraw()},end:()=>this.snap()})}interpolate(t,e){e<t&&([t,e]=[e,t]);let s=this.points[t],n=this.points[e];for(let r=t+1;r<e;++r)this.points[r]=p.interpolate(s,n,(r-t)/(e-t))}redraw(){let t="",e=!0;for(let s of this.points){if(s){let n=this.toViewportCoords(s);t+=(e?"M":"L")+`${n.x},${n.y}`}e=!s}this.$path.setAttr("d",t)}snap(){let t=this.points.filter(s=>s).map(s=>[s.x,s.y]),e=Kl.bestPolynomial(t);if(!!e){for(let s=0;s<this.steps;++s){if(!this.points[s])continue;let n=this.plotBounds.xMin+s/this.steps*this.plotBounds.dx;this.points[s]=new p(n,e.fn(n))}this.redraw(),this.trigger("snap",{regression:e})}}clear(){this.points=Ae(void 0,this.steps),this.$path.setAttr("d","")}};zo=b([P("x-coordinate-sketch")],zo);var Fm=2,ep=5e3,Bo=class extends Ke{constructor(){super(...arguments);this.isAnimated=this.hasAttr("animate");this.crosshairGrid=10;this.getCrosshairPosn=t=>t}ready(){let t=c("svg",{},this);if(this.$plot=c("g",{class:"plot"},t),this.$overlay=c("g",{class:"overlay"},t),this.setupCoordinates(t,{showGrid:!0,showAxes:!0,padding:"20"}),this.hasAttr("fn")){let e=Pt.parse(this.attr("fn"),!0);this.setFunctions(s=>e.evaluate({x:s}))}At(this,"crosshairs",!0)&&(this.crosshairGrid=+this.attr("crosshair-grid")||10,this.setupCrosshairs(t))}setPoints(t,e=1){let s=t.map((n,r)=>new p(r+e,n));this.setSeries(s)}setSeries(...t){let e=Math.max(...t.map(r=>N(r).x)),[s,n]=Do(t);this.updatePlotBounds(new xt(0,e,s,n)),this.$plot.removeChildren();for(let r of t)this.drawLinePlot(r);this.getCrosshairPosn=r=>t[0].reduce((o,a)=>Math.abs(a.x-r.x)<=Math.abs(o.x-r.x)?a:o)}setFunctions(...t){let[e,s]=[this.plotBounds,this.viewportBounds],n=t.map(h=>{let l=[];for(let u=s.xMin;u<s.xMax;u+=Fm){let d=this.toPlotCoords(new p(u,0)).x;l.push(new p(d,h(d)))}return l}),[r,o]=Do(n);this.updatePlotBounds(new xt(e.xMin,e.xMax,r,o)),this.$plot.removeChildren();for(let h of n)this.drawLinePlot(h);let a=this.gridSize[0]/this.crosshairGrid;this.getCrosshairPosn=h=>{let l=Vt(L(h.x,e.xMin,e.xMax),a);return new p(l,t[0](l))}}drawLinePlot(t){let e=c("g",{},this.$plot),s=c("path",{},e),n=this.plotBounds;t=t.filter(o=>o.y>=n.yMax&&o.y<=n.yMin);let r=t.map(o=>this.toViewportCoords(o));this.isAnimated?j(o=>{let a=t.findIndex(h=>h.x>n.xMin+o*n.dx);s.points=r.slice(0,a)},ep):s.points=r}drawPoints(t){let e=c("g",{},this.$plot),s=this.plotBounds;for(let n of t){let r=this.toViewportCoords(n),o=c("circle",{r:4,cx:r.x,cy:r.y},e);if(this.isAnimated){o.hide();let a=ep*(n.x-s.xMin)/(s.xMax-s.xMin);setTimeout(()=>o.show(),a)}}}setupCrosshairs(t){let e=c("g",{class:"crosshair"},t),s=c("path",{},e),n=c("circle",{r:4},e),r=c("text",{},e),o=0,a=h=>{let l=this.getCrosshairPosn(this.toPlotCoords(h));if(T(l.x,o))return;o=l.x;let u=this.toViewportCoords(l),d=this.toViewportCoords(this.plotOrigin);n.setCenter(u),s.points=[new p(d.x,u.y),u,new p(u.x,d.y)],r.text=`(${vt(l.x,5,!1)}, ${vt(l.y,5,!1)})`;let m=r.width,$=u.x+8+m<this.viewportBounds.dx;r.setAttr("x",$?u.x+5:u.x-m-5),r.setAttr("y",u.y>20?u.y-7:u.y+18)};Kh(t,{enter:()=>e.show(),move:h=>a(h),exit:()=>e.hide()})}};Bo=b([P("x-coordinate-system")],Bo);var ai=class{constructor(t,e){this.$canvas=t;this.defaultCallbacks=e;this.callbacks=new WeakMap;this.isMoving=!1;this.shiftKey=!1;this.altKey=!1;this.cancelled=!1;setTimeout(()=>{document.addEventListener("keydown",s=>{this.shiftKey=s.shiftKey,this.altKey=s.altKey}),document.addEventListener("keyup",s=>{this.shiftKey=s.shiftKey,this.altKey=s.altKey}),document.addEventListener("visibilitychange",()=>{this.shiftKey=this.altKey=!1})},2e3),t.css("touch-action","none"),t.on("pointerdown",s=>this.startEvent(s)),t.on("contextmenu",s=>s.preventDefault()),e.hover&&t.on("pointermove",s=>{this.isMoving||e.hover({posn:zt(s,t),event:s})})}listen(t,e){this.callbacks.set(t._el,e),t.hasParent(this.$canvas)||(t.css("touch-action","none"),t.on("pointerdown",s=>this.startEvent(s)))}startEvent(t){if(t.handled)return;this.isMoving=!0,this.cancelled=!1,t.preventDefault();let e=w.getActiveInput();e&&e.blur();let s=t.pointerId,n=this.getCallbacks(t.target);"shiftKey"in t&&(this.shiftKey=t.shiftKey);let r=zt(t,this.$canvas),o=r,a=!1,h=u=>{if(u.pointerId&&u.pointerId!==s)return;if(u.preventDefault(),this.cancelled)return l(u);let d=zt(u,this.$canvas);p.distance(d,o)<.5||(!a&&n.start&&n.start({posn:r,event:u}),n.move&&n.move({posn:d,startPosn:r,lastPosn:o,event:u}),!a&&n.cursor!==!1&&ft.addClass("grabbing"),o=d,a=!0)},l=u=>{u.pointerId&&u.pointerId!==s||(u.preventDefault(),G.off("pointermove",h),G.off("pointerstop",l),a&&n.end&&n.end({posn:o,lastPosn:o,startPosn:r,event:u}),!a&&!this.cancelled&&n.click&&n.click({posn:r,event:u}),ft.removeClass("grabbing"),this.isMoving=!1)};n.down&&n.down({posn:r,event:t}),G.on("pointermove",h),G.on("pointerstop",l)}getCallbacks(t){for(;t;){let e=this.callbacks.get(t);if(e&&(!e.checkIfActive||e.checkIfActive()))return e;t=t.parentNode||void 0}return this.defaultCallbacks}cancel(){this.cancelled=!0}};function jm(i,t){if(typeof i=="string"){let e=ot(i);return s=>{var n;return(n=e(t))==null?void 0:n.equals(s)}}return typeof i=="function"?i:e=>i.equals(e)}function _o(i,t,e){let s=t.map($=>jm($,i.model)),n=Ae(void 0,t.length),r=ki(),o=[],a=({point:$})=>o.push($),h=e.maxErrors||4,l=0,u=({path:$})=>{e.onBegin&&e.onBegin($)},d=()=>{n.every($=>$)&&(e.onComplete&&e.onComplete(!0),i.off("add:path",m),i.off("begin:path",u),i.off("add:point",a),r.resolve(n))},m=({path:$})=>{let k=$.value;if(!!k){for(let[g,y]of s.entries())if(!n[g]&&y(k))return n[g]=$,e.onCorrect&&e.onCorrect($,g),l=0,o=[],d();$.delete();for(let g of o)g.delete();if(o=[],!(at(k)&&k.length<1))if(l+=1,l>=h){let g=n.findIndex(v=>!v),y=t[g];if(typeof y!="function"){let v=i.drawPath(y,{animated:1e3});n[g]=v,e.onHint&&e.onHint(v,g),l=0,d()}}else e.onIncorrect&&e.onIncorrect($)}};return i.on("begin:path",u),i.on("add:path",m),i.on("add:point",a),r.promise}function sp(i,t){return c("text",{target:i.attr("target")||void 0,class:i.attr("label-class")||i.attr("class")||void 0,"data-when":i.data.when,style:t?`color: ${t}`:void 0,"text-anchor":"middle"})}function ip(i,t){let e=[];for(let s of t.paths)s!==i&&s.value&&e.push(s.value.transform(t.plotToViewportMatrix));return e}var Km=new H(new p(0,-9),12);function np(i,t,e){for(let s of e)if(t.every(n=>!ht(Km.translate(s),n).length))return s;return e[0]}function rp(i,t){let e=i.value.transform(t.plotToViewportMatrix),s=i.$el;if(at(e)){let n=e.perpendicularVector,r=e.angle;n.y>=0&&(n=n.scale(-1),r+=Math.PI);let o=[];for(let l of[.5,.35,.65])for(let u of[-15,5])o.push(e.at(l).add(n.scale(u)));if(!t.labelPositioning)return[o[0],r];let a=ip(i,t),h=np(e,a,o);return s.hasAttr("mark")&&(h=h.add(e.unitVector.scale(12))),[h,r]}if(ae(e))return[e.at(.5).subtract(e.c).scale(.6).add(e.c).shift(0,5)];if(Ft(e)){let n=new et(e.start,e.end),r=n.perpendicularVector.y>=0,o=n.angle+(r?Math.PI:0);return[e.at(.5).add(n.perpendicularVector.scale(r?14:5)),o]}if(jr(e)){let n=(+s.attr("size")||Yr(e,{round:s.hasAttr("round")}))+8;return[e.b.add(e.bisector.unitVector.scale(n+5)).shift(0,3)]}if(ut(e)){let n=s.hasClass("move")?10:8,r=[e.shift(n,-n),e.shift(-n,-n),e.shift(n,10+n),e.shift(-n,10+n)];if(!t.labelPositioning)return[r[0]];let o=ip(i,t);return[np(e,o,r)]}return be(e)?[e.centroid.shift(0,5)]:st(e)?[e.c.shift(0,5)]:[]}var Ho=class{constructor(t,e,s,n){this.$parent=t;this.$el=s;this.color="";this.label="";this.isPending=!1;this.isLocked=!1;this.components=[];this.dependencies=[];this.fixedLabel=!1;this.name=n||t.model.getKey(),t.shapes.set(this.name,this),t.model.watch(r=>{let o=r[this.name];this.$el.css("display",o?"block":"none"),this.$label&&this.$label.css("display",o?"block":"none"),o&&this.redraw(o),t.queueLabelPositioning()}),this.color=s.css("color")||"",this.setValue(e),s.hasAttr("label")&&this.setLabel(s.attr("label"))}get value(){return this.$parent.model[this.name]}get type(){var t;return(t=this.value)==null?void 0:t.type}get locked(){return this.isLocked}get isHidden(){return this.isPending||this.$el.hasAttr("hidden")||this.$el.hasClass("transparent")}setValue(t){t instanceof Function?this.$parent.model.setComputed(this.name,t):this.$parent.model[this.name]=t}setLabel(t,e,s){this.$label||(this.$label=sp(this.$el,e),this.$parent.$objLabels.append(this.$label));let n=Bi(t);if(this.$parent.model.watch(r=>this.$label.text=n(r)||""),this.fixedLabel=!!s,s){let r=ot(s);this.$parent.model.watch(o=>{this.$label.setTransform(r(o).shift(0,5))})}this.updateLabelPosition()}setColor(t){this.color=t,this.$el.css("color",t);for(let e of this.dependencies)e.setColor(t);this.$label&&this.$label.css("color",t)}updateLabelPosition(){if(!this.$label||!this.value||this.fixedLabel)return;let[t,e]=rp(this,this.$parent);this.$label.setTransform(t,e)}select(){this.$el.addClass("selected"),this.$el.parent.append(this.$el);for(let t of this.dependencies)t.select()}deselect(){this.$el.removeClass("selected");for(let t of this.dependencies)t.deselect()}hover(t=!1){if(!t){if(this.$parent.hovering===this)return;this.$parent.hovering&&this.$parent.hovering.unhover(),this.$parent.hovering=this}this.$el.addClass("hover");for(let e of this.dependencies)e.hover(!0)}unhover(t=!1){if(!t){if(this.$parent.hovering!==this)return;this.$parent.hovering=void 0}this.$el.removeClass("hover");for(let e of this.dependencies)e.unhover(!0)}delete(t=300){return S(this,null,function*(){this.$parent.shapes.delete(this.name);for(let e of this.components)e.deselect();this.$label&&this.$label.exit("fade",t,0,!0),yield this.removeElement(t),this.$parent.model[this.name]=void 0})}},le=class extends Ho{constructor(t,e,s,n,r=!1){n||(n=c("circle",{})),super(t,e,n,s),this.$parent.hidePoints||t.$points.append(this.$el),t.points.add(this),this.projectionId=t.model.getKey(),this.projectionOffset=void 0,t.model.watch(o=>{this.projection=o[this.projectionId],this.projection&&(this.projectionOffset===void 0&&(this.projectionOffset=Fe(this.projection,this.$parent.model[this.name])),this.$parent.model[this.name]=this.projection.at(this.projectionOffset))}),this.lock(r)}setValue(t){t instanceof Function?(this.project(void 0),this.$parent.model.setComputed(this.name,t)):(t&&this.projection&&(t=this.projection.project(t),this.projectionOffset=Fe(this.projection,t)),this.$parent.model[this.name]=t)}redraw(t){let e=t.transform(this.$parent.plotToViewportMatrix);this.$el.setCenter(e),this.$halo&&this.$halo.setCenter(e),this.$pulse&&this.$pulse.setCenter(e)}removeElement(t){return S(this,null,function*(){this.$parent.points.delete(this),yield this.$el.exit("pop",t,0,!0).promise})}distance(t){return this.value?p.distance(t,this.value):Infinity}lock(t=!0){this.isLocked=t,this.$el.setClass("move",!t),t?this.$el.removeAttr("tabindex"):this.$el.setAttr("tabindex",0)}project(t){if(this.projectionOffset=void 0,typeof t=="string"){let e=ot(t);this.$parent.model.setComputed(this.projectionId,e)}else t?this.$parent.model.setComputed(this.projectionId,()=>t.value):this.$parent.model[this.projectionId]=void 0}makeIntersection({path1:t,path2:e,index:s}){this.setValue(n=>{if(!n[t.name]||!n[e.name])return;let r=ht(n[t.name],n[e.name]);return r[Math.min(s,r.length-1)]}),this.lock()}addHalo(){this.$halo=c("circle",{class:"halo",r:18},this.$parent.$pulses),this.$halo.setCenter(this.$el.center),this.$halo.enter("pop")}removeHalo(){return S(this,null,function*(){!this.$halo||(this.$halo.exit("pop",500,0,!0),this.$halo=void 0)})}pulsate(){this.$pulse=c("circle",{class:"pulse",r:8},this.$parent.$pulses),this.$pulse.setCenter(this.$el.center),this.$el.one("mouseover pointerdown focus",()=>{this.$pulse&&this.$pulse.remove(),this.$pulse=void 0})}},Ve=class extends Ho{constructor(t,e,s,n){super(t,e,n||c("path"),s);t.$paths.append(this.$el),t.paths.add(this)}get locked(){return this.isLocked||!this.components.length||this.components.every(t=>t.locked)}redraw(t){let e=t.transform(this.$parent.plotToViewportMatrix);this.$el.draw(e,{box:this.$parent.viewportRect})}distance(t){return this.value?p.distance(t,this.value.project(t)):Infinity}removeElement(t){return S(this,null,function*(){this.$parent.paths.delete(this),yield this.$el.exit("draw",t,0,!0).promise})}setComponents(t,e){this.components=this.dependencies=t,this.setValue(()=>{let s=t.map(n=>n.value);if(!s.some(n=>n===void 0))return e(...s)})}};var mn=class{constructor(t){this.$parent=t}enable(){}down(t){}start(t){}move(t,e){}end(t){}hover(t){}click(t){}cancel(){}snapToGrid(t){return this.$parent.snapToGrid?t.round(this.$parent.snapToGrid):t}snapToPoint(t,e){if(this.snapPoint=this.$parent.getPointAt(e),this.snapPoint)return t.$el.setClass("move",!this.snapPoint.locked),t.setValue(this.snapPoint.value);if(this.snapIntersect=this.$parent.getIntersectionAt(e),this.snapIntersect)return t.$el.removeClass("move"),t.setValue(this.snapIntersect.posn);if(!this.$parent.snapToGrid&&(this.snapPath=this.$parent.getPathAt(e),this.snapPath))return t.setValue(this.snapPath.value.project(e));t.$el.addClass("move"),t.setValue(this.snapToGrid(e))}getOrMakePointAt(t){let e=this.$parent.getPointAt(t);if(!e){e=new le(this.$parent,this.snapToGrid(t));let s=this.$parent.getIntersectionAt(t);if(s)e.makeIntersection(s);else if(!this.$parent.snapToGrid){let n=this.$parent.getPathAt(t);n&&e.project(n)}this.$parent.trigger("add:point",{point:e})}return e}showPendingPointAt(t){var n,r,o;let e=((n=this.$parent.getIntersectionAt(t))==null?void 0:n.posn)||((o=(r=this.$parent.getPathAt(t))==null?void 0:r.value)==null?void 0:o.project(t)),s=!!e;if(this.$parent.$pendingPoint.toggle(s),s){let a=this.$parent.toViewportCoords(e||t);this.$parent.$pendingPoint.setCenter(a)}}},gn=class extends mn{constructor(){super(...arguments);this.isMoving=!1}enable(){}down(t){this.obj=this.$parent.getPointAt(t)||this.$parent.getPathAt(t),this.obj||this.$parent.deselect();let e=this.$parent.selection;e!==this.obj&&(e&&e.components.includes(this.obj)||this.$parent.select(this.obj))}start(){!this.obj||(this.isMoving=!0,this.obj.isPending=!0,this.$parent.updateIntersections(),this.$parent.trigger("move",{obj:this.obj}))}move(t,e){if(!(!this.obj||this.obj.locked||this.$parent.locked))if(this.obj instanceof Ve){let s=t.subtract(e);for(let n of this.obj.components)n.locked||n.setValue(n.value.add(s))}else this.obj instanceof le&&this.obj.setValue(this.snapToGrid(t))}end(){!this.obj||(this.isMoving=!1,this.obj.isPending=!1,this.snapPoint||(this.snapIntersect?this.obj.makeIntersection(this.snapIntersect):this.snapPath&&this.obj.project(this.snapPath)),this.$parent.trigger("moveEnd",{path:this.obj}),this.obj=void 0,this.$parent.updateIntersections())}hover(t){if(this.isMoving)return;let e=this.$parent.getPointAt(t)||this.$parent.getPathAt(t),s=e&&!this.$parent.locked&&!e.locked,n=e&&this.$parent.canSelect;this.$parent.setCursor(s?"grab":n?"pointer":"default"),s||n?e.hover():this.$parent.hovering&&this.$parent.hovering.unhover()}},Uo=class extends gn{down(t){this.$parent.deselect(),this.obj=this.getOrMakePointAt(t),this.$parent.select(this.obj)}hover(t){let e=this.$parent.getPointAt(t);if(e)return this.$parent.setCursor(this.$parent.locked||e.locked?"default":"grab"),this.$parent.$pendingPoint.hide(),e.hover();this.$parent.hovering&&this.$parent.hovering.unhover(),this.$parent.setCursor("crosshair"),this.showPendingPointAt(t)}},hi=class extends mn{enable(){this.$parent.setCursor("crosshair")}down(t){this.$parent.deselect(),this.startPoint=this.getOrMakePointAt(t)}start(t){!this.startPoint||(this.$parent.$pendingPoint.hide(),this.endPoint=new le(this.$parent,t),this.endPoint.isPending=!0,this.endPoint.$el.addClass("pending"),this.path=new Ve(this.$parent,void 0),this.path.setComponents([this.startPoint,this.endPoint],this.expr),this.path.isPending=!0,this.$parent.updateIntersections(),this.$parent.trigger("begin:path",{path:this.path,start:this.startPoint}))}move(t){if(!this.startPoint||!this.path||!this.endPoint)return;if(p.distance(t,this.startPoint.value)<20/this.$parent.plotScale)return this.endPoint.setValue(this.snapToGrid(t));this.snapToPoint(this.endPoint,t)}end(){if(!this.startPoint||!this.path||!this.endPoint)return;this.path.isPending=!1,this.endPoint.isPending=!1,this.startPoint.value.equals(this.endPoint.value)?(this.endPoint.delete(),this.path.delete(),this.path=this.endPoint=void 0):this.snapPoint?(this.path.setComponents([this.startPoint,this.snapPoint],this.expr),this.endPoint.delete(),this.endPoint=void 0):this.snapIntersect?this.endPoint.makeIntersection(this.snapIntersect):this.snapPath&&this.endPoint.project(this.snapPath),this.endPoint&&(this.$parent.trigger("add:point",{point:this.endPoint}),this.endPoint.$el.removeClass("pending"));let t=this.path;this.startPoint=this.endPoint=this.path=void 0,t&&(this.$parent.trigger("add:path",{path:t}),this.$parent.updateIntersections())}hover(t){let e=this.$parent.getPointAt(t);if(e)return this.$parent.$pendingPoint.hide(),e.hover();this.$parent.hovering&&this.$parent.hovering.unhover(),this.showPendingPointAt(t)}cancel(){this.endPoint&&this.endPoint.delete(),this.path&&this.path.delete(),this.$parent.$pendingPoint.hide(),this.startPoint=this.endPoint=this.path=void 0}},Wo=class extends hi{expr(t,e){return new _(t,e)}},Zo=class extends hi{expr(t,e){return new H(t,p.distance(t,e))}},Fo=class extends hi{expr(t,e){return new V(t,e.x-t.x,e.y-t.y)}},jo=class extends hi{expr(t,e){return new _(t,e).perpendicularBisector}},op=(i,t,e)=>new yt(i,t,e).bisector,Ko=class extends mn{enable(){}down(t){if(this.$parent.deselect(),!this.firstPoint)this.firstPoint=this.getOrMakePointAt(t),this.firstPoint&&this.firstPoint.addHalo();else if(this.secondPoint){this.path.isPending=this.thirdPoint.isPending=!1,this.thirdPoint.$el.removeClass("pending"),this.firstPoint.removeHalo(),this.secondPoint.removeHalo(),this.snapPoint?(this.path.setComponents([this.firstPoint,this.secondPoint,this.snapPoint],op),this.thirdPoint.delete(),this.thirdPoint=void 0):this.snapIntersect?this.thirdPoint.makeIntersection(this.snapIntersect):this.snapPath&&this.thirdPoint.project(this.snapPath);let e=this.path,s=this.thirdPoint;this.firstPoint=this.secondPoint=this.thirdPoint=this.path=void 0,s&&this.$parent.trigger("add:point",{point:s}),this.$parent.trigger("add:path",{path:e}),this.$parent.updateIntersections()}else{if(this.secondPoint=this.getOrMakePointAt(t),!this.secondPoint)return;this.secondPoint.addHalo(),this.thirdPoint=new le(this.$parent,this.secondPoint.value),this.thirdPoint.$el.addClass("pending"),this.path=new Ve(this.$parent,void 0),this.path.setComponents([this.firstPoint,this.secondPoint,this.thirdPoint],op),this.path.isPending=this.thirdPoint.isPending=!0}}hover(t){if(this.$parent.$pendingPoint.hide(),this.thirdPoint){this.snapToPoint(this.thirdPoint,t),this.$parent.setCursor(this.snapPoint?"pointer":"crosshair");return}let e=this.$parent.getPointAt(t);if(e)return this.$parent.setCursor("pointer"),e.hover();this.$parent.hovering&&this.$parent.hovering.unhover(),this.$parent.setCursor("crosshair"),this.showPendingPointAt(t)}cancel(){this.firstPoint&&this.firstPoint.removeHalo(),this.secondPoint&&this.secondPoint.removeHalo(),this.thirdPoint&&this.thirdPoint.delete(),this.path&&this.path.delete(),this.firstPoint=this.secondPoint=this.thirdPoint=this.path=void 0}};var ap='<x-select class="tools"><div class="tool" data-tool="move"><x-icon name="hand" size="28"></x-icon></div><div class="tool" data-tool="point"><x-icon name="geo-point" size="28"></x-icon></div><div class="tool" data-tool="line"><x-icon name="geo-line" size="28"></x-icon></div><div class="tool" data-tool="rectangle"><x-icon name="geo-rectangle" size="28"></x-icon></div><div class="tool" data-tool="circle"><x-icon name="geo-circle" size="28"></x-icon></div><div class="tool" data-tool="perpBisector"><x-icon name="geo-perp-bisector" size="28"></x-icon></div><div class="tool" data-tool="angleBisector"><x-icon name="geo-angle-bisector" size="28"></x-icon></div></x-select><slot></slot>';var Xo=class extends Ke{constructor(){super(...arguments);this.shapes=new Map;this.points=new Set;this.paths=new Set;this.intersections=new Set;this.snapToGrid=0;this.locked=!1;this.hidePoints=!1;this.canSelect=!1;this.canIntersect=!1;this.canProject=!0;this.labelPositioning=!1;this.cursor="default"}ready(){let t=this.children.filter(a=>a.tagName==="SVG")[0];if(this.hasAttr("complex")&&(this.setAttr("label-suffix",",i"),this.setAttr("axis-names","Real, Imaginary"),this.setAttr("axes","true"),this.setAttr("grid","true")),!this.hasAttr("x-axis")&&!this.hasAttr("y-axis")){let a=+this.attr("grid"),h=+this.attr("width")||this.width,l=+this.attr("height")||h;this.setAttr("x-axis",a?`-0.5,${h/a-.5},1`:`0,${h},1`),this.setAttr("y-axis",a?`${l/a-.5},-0.5,1`:`${l},0,1`),a&&this.setAttr("snap",1)}this.setupCoordinates(t,{proportional:!0}),this.viewportRect=this.viewportBounds.rect,this.model=this.getParentModel()||Ct({}),this.model.hasGeoModel||this.model.assign(oi),this.$paths=c("g",{class:"paths"},t),this.$pulses=c("g",{class:"pulses"},t),this.$points=c("g",{class:"points"},t),this.$objLabels=c("g",{class:"labels"},t),this.snapToGrid=this.hasAttr("snap")?+this.attr("snap")||1:0,this.hidePoints=this.hasAttr("no-points"),this.canIntersect=At(this,"intersections",!1),this.canProject=At(this,"projections",!0),this.canSelect=At(this,"selectable",!1),this.labelPositioning=At(this,"label-positioning",!0),this.hasClass("sticky")&&this.css("top",`calc(50vh - ${this.height/2}px)`),this.queueLabelPositioning=Oi(()=>{for(let a of this.shapes.values())a.updateLabelPosition()},0,!0);let e=t.$$("path[x], path[\\:d], circle");for(let a of e){let h=a.hasAttr("x")?ot(a.attr("x")):void 0,l=a.attr("name");if(a.hasAttr(":d"))this.$paths.append(a),a.bindModel(this.model);else if(a.tagName==="PATH")this.$paths.append(a),new Ve(this,h,l,a);else{this.$points.append(a);let u=!a.hasClass("move"),d=h||a.center,m=new le(this,d,l,a,u);a.hasAttr("project")&&m.project(a.attr("project")),a.hasClass("pulsate")&&m.pulsate()}}this.$pendingPoint=c("circle",{class:"pending"},this.$points),this.$pendingPoint.hide(),this.updateIntersections();let s={move:new gn(this),point:new Uo(this),line:new Wo(this),circle:new Zo(this),perpBisector:new jo(this),angleBisector:new Ko(this),rectangle:new Fo(this)};this.$tools=this.$(".tools");let n=s[this.$tools.$active.data.tool];n.enable();let r=()=>this.toolOverride||n;this.$tools.on("change",a=>{r().cancel(),this.toolOverride=void 0,n=s[a.data.tool],this.hovering&&this.hovering.unhover(),this.$pendingPoint.hide(),this.hovering=void 0,this.deselect(),n.enable()});let o=(a,h=!1)=>this.toPlotCoords(h?a.clamp(this.viewportBounds,8):a);new ai(t,{down:a=>r().down(o(a.posn)),start:a=>r().start(o(a.posn)),move:a=>r().move(o(a.posn,!0),o(a.lastPosn,!0)),end:a=>r().end(o(a.posn,!0)),click:a=>r().click(o(a.posn)),hover:a=>r().hover(o(a.posn))}),w.onKey("escape",()=>r().cancel()),w.onKey("backspace delete",()=>this.delete()),document.addEventListener("keydown",a=>{if([37,38,39,40].indexOf(a.keyCode)<0)return;let l=w.getActiveInput();if(!(!l||!l.hasParent(this))){a.preventDefault();for(let u of this.points){if(u.$el!==l||!u.value)continue;let d=15/this.plotScale,m=this.plotBounds.yMin>this.plotBounds.yMax?-1:1,$=a.keyCode===37?-d:a.keyCode===39?d:0,k=a.keyCode===38?-m*d:a.keyCode===40?m*d:0;u.setValue(u.value.shift($,k));return}}})}switchTool(t){this.$tools.makeActive(this.$(`.tool[data-tool="${t}"]`))}setCursor(t="default"){t!==this.cursor&&(this.cursor=t,this.$svg.css("cursor",t))}select(t){!this.canSelect||(this.deselect(),t&&(this.selection=t,t.select()),this.trigger("select",{shape:t}))}deselect(){!this.selection||(this.selection.deselect(),this.selection=void 0,this.trigger("select",{shape:void 0}))}delete(){this.hovering&&this.hovering.unhover(),this.selection&&this.selection.delete(),this.trigger("select",{shape:void 0})}redraw(){this.resize(),this.viewportRect=this.viewportBounds.rect,this.model.forceUpdate()}getPointAt(t,e=20){if(this.hidePoints)return;let s=n=>n.isHidden?void 0:n.distance(t);return fn(this.points,s,e/this.plotScale)}getPathAt(t,e=10){if(this.hidePoints||!this.canProject)return;let s=n=>n.isHidden?void 0:n.distance(t);return fn(this.paths,s,e/this.plotScale)}getIntersectionAt(t,e=20){if(!this.canIntersect)return;let s=n=>p.distance(t,n.posn);return fn(this.intersections,s,e/this.plotScale)}updateIntersections(){!this.canIntersect||this.hidePoints||Yc(this.paths,this.intersections)}drawPath(t,e={}){typeof t=="string"&&(t=ot(t));let s=new Ve(this,t,e.name);e.classes&&s.$el.addClass(e.classes),e.target&&s.$el.setAttr("target",e.target);let n=s.$el.hasClass("fill")?"fade":"draw";return e.animated&&s.$el.enter(n,e.animated),s}drawPoint(t,e={}){typeof t=="string"&&(t=ot(t));let s=new le(this,t,e.name,void 0,e.interactive===!1);return e.classes&&s.$el.addClass(e.classes),e.target&&s.$el.setAttr("target",e.target),e.animated!==0&&s.$el.enter("pop",e.animated||500),s}animatePoint(t,e,s=400){let n=this.shapes.get(t),r=new _(this.model[t],e);return j(o=>n.setValue(r.at(K("quad",o))),s)}animateConstruction(t,e=2e3){return S(this,null,function*(){let s=this.shapes.get(t),n=s.value;if(st(n)&&(n=n.arc),at(n)){this.$ruler||(this.$ruler=c("path",{d:Qc,class:"sketch"},this.$svg));let r=je(n.at(-.1),12,n.angle-.3,n.length*1.2),o=je(n.at(-.1),12,n.angle,n.length*1.2);this.$ruler.show(),s.$el.hide(),yield this.$ruler.animate({opacity:[0,1],transform:[r,o]},500).promise,yield s.$el.enter("draw",e).promise,yield this.$ruler.animate({opacity:[1,0],transform:[o,r]},500).promise}else if(Ft(n)){this.$compass||(this.$compass=c("path",{d:Jc,class:"sketch"},this.$svg));let r=je(n.c,50,n.startAngle,n.radius*1.5),o=je(n.c,50,n.startAngle,n.radius),a=je(n.c,50,n.startAngle+n.angle,n.radius),h=je(n.c,50,n.startAngle+n.angle,n.radius*1.5);this.$compass.show(),s.$el.hide(),yield this.$compass.animate({opacity:[0,1],transform:[r,o]},500).promise,s.$el.enter("draw",e),yield this.$compass.animate({transform:[o,a]},e,0,"linear").promise,yield this.$compass.animate({opacity:[1,0],transform:[a,h]},500).promise}})}showGesture(t,e){this.$gesture||(this.$gesture=c("x-gesture",{},this)),this.$gesture.stop();let s=this.toViewportCoords(ot(t)(this.model));if(this.$gesture.from=s,e){let n=this.toViewportCoords(ot(e)(this.model));this.$gesture.start(n.subtract(s))}else this.$gesture.start();this.one("click mouseover pointerdown",()=>this.$gesture.stop())}waitForPoint(){return S(this,null,function*(){return new Promise(t=>{this.one("add:point",({point:e})=>t(e))})})}waitForPath(s){return S(this,arguments,function*(t,e={}){return(yield _o(this,[t],e))[0]})}waitForPaths(t,e={}){return _o(this,t,e)}};Xo=b([P("x-geopad",{template:ap})],Xo);var hp='<div class="image"></div><div class="content"><slot></slot></div>';var Yo=class extends M{ready(){let t=this.$(".image"),e=this.positionTop<50,s,n;t.css({"background-image":`url("${this.attr("background")}")`,height:e?"100%":"150%"});let r=({height:a})=>{let h=this.positionTop;s=Math.max(0,h-a),n=h+this.height};function o(a){if(a.top<s||a.top>n)return;let h=(a.top-s)/(n-s)*(e?50:33);t.css("transform",`translateY(${h}%)`)}w.onResize(r),G.on("scroll",o)}};Yo=b([P("x-parallax",{template:hp})],Yo);function wn(i,t,e,s){let n,r;t:for(let[o,a]of e)for(let h of t){let l=(s?s(o,h):o).subtract(h),u=l.length;if(u<i&&(i=u,n=l,r=a,u<1))break t}return n?{shift:n,target:r}:void 0}function lp(i){if(ut(i))return[i];if(be(i))return i.points;if(Xs(i))return[i.p1,i.p2];if(st(i))return[i.c.shift(i.r,0),i.c.shift(-i.r,0),i.c.shift(0,i.r),i.c.shift(0,-i.r)];if(ae(i)||Ft(i)){let t=[i.start,i.end];ae(i)&&t.push(i.c);let e=i.radius;for(let[s,n]of[[e,0],[0,e],[-e,0],[0,-e]]){let r=i.c.shift(s,n);i.contains(r)&&t.push(r)}return t}return[]}function Xe(...i){return V.aroundPoints(function*(){for(let t of i)for(let e of lp(t))yield e}())}function yn(i,t,e=0){if(!i.size&&!t.size)return new xt(0,100,0,100);let s=V.aroundPoints(function*(){for(let n of i)if(n.transformed)for(let r of lp(n.transformed))yield r;for(let n of t){yield n.segments[0].p1;for(let r of n.segments)yield r.p2}}());return new xt(s.p.x-e,s.p.x+s.w+e,s.p.y-e,s.p.y+s.h+e)}function li(i,t,e){if(ut(t))return i.contains(t);if(Wr(t))return O.collision(i.polygon,t);if(Zr(t))return t.collision(i);if(at(t))return ht(t,i).length>0||i.contains(t.p1);if(st(t))return e==="geo"?ht(t,i).length>0||i.contains(t.at(0)):t.collision(i);if(ae(t)){let s=new O(t.c,t.start,t.at(.25),t.at(.5),t.at(.75),t.end);return O.collision(i.polygon,s)}return!1}var Jo=new Map;function D(i){if(!i||!w.theme.isDark)return i;if(Jo.has(i))return Jo.get(i);let t=q.fromHex(i).hsl;Tt(t[2],20,80)||(t[2]=100-t[2]);let e=q.fromHsl(...t).hex;return Jo.set(i,e),e}var _t=180/Math.PI,lt=Math.PI/180,f={grey:"#cccccc",darkGrey:"#242436",red:"#cd0e66",orange:"#eb4726",yellow:"#fd8c00",lime:"#bfc212",green:"#22ab24",teal:"#009ea6",blue:"#0f82f2",purple:"#6d3bbf"},Xm="M12.5,0H0V25H12.5a12.5,12.5,0,0,0,0-25Z",Ym="M0,0V12.5a12.5,12.5,0,0,0,25,0V0Z",vn=new Map,I=class{constructor(t,e){this.$parent=t;this.type="tile";this.options="";this.colour="";this.posn=A;this.rot=0;this.flipped=!1;this.locked=!1;this.isActive=!1;this.snapAngles=[0,90];this.rotateAroundOrigin=!1;this.showSelectionOutline=!1;this.hideSelectionOutline=!1;this.canDragToSelect=!0;this.keepOnTop=!1;this.canRotate=!0;this.canMove=!0;this.$el=e||c("g",{class:"tile"},t.$tiles),t.tiles.add(this),vn.set(this.$el._el,this)}makeHandle(t,e,s){let r=c(t==="c"?"circle":"path",{class:"handle"},this.$el);t==="h"&&r.setAttr("d",Xm),t==="v"&&r.setAttr("d",Ym),t==="c"&&r.setAttr("r",10);let o="",a;return this.$parent.events.listen(r,{start:()=>{this.$parent.selection.add(this,!0),o=this.options,a=this.size},move:({posn:h})=>e(this.relativePosn(h),h),click:()=>s==null?void 0:s(),end:()=>{(this.options!==o||this.size!==a)&&this.$parent.change()}}),r}setColour(t){this.colour=t}setSize(t){this.size=t}flip(t){this.flipped=!this.flipped}click(t){}select(){this.isActive=!0,this.$parent.$activeTiles.append(this.$el)}deselect(){this.isActive=!1,this.$parent.$tiles.append(this.$el)}moveStart(){this.startPosn=this.posn}move(t,e){t&&(this.posn=this.startPosn.add(t),this.transform(!0))}moveEnd(){}transform(t=!1){let e=this.rot*lt;this.$el.setTransform(this.posn,e),this.customTransform(this.posn,e),!t&&this.path&&(this.transformed=this.path.rotate(e).translate(this.posn),this.snapPoints=this.getSnapPoints().map(s=>s.rotate(e).translate(this.posn)),this.snapLines=this.getSnapLines().map(s=>s.rotate(e).translate(this.posn)))}customTransform(t,e){}setTransform(t,e=this.rot){this.posn=t,this.rot=kt(e,360),this.transform()}static makeThumbnail(t,e,s,n){}getSnapPoints(){return this.path?ut(this.path)?[this.path]:be(this.path)?this.path.points:at(this.path)?[this.path.p1,this.path.p2]:st(this.path)?[this.path.c,this.path.c.shift(0,this.path.r),this.path.c.shift(0,-this.path.r),this.path.c.shift(this.path.r,0),this.path.c.shift(-this.path.r,0)]:ae(this.path)?[this.path.c,this.path.start,this.path.end]:Ft(this.path)?[this.path.start,this.path.end]:[]:[]}getSnapLines(){return[]}delete(){this.$parent.selection.remove(this),this.$parent.tiles.delete(this),vn.delete(this.$el._el),this.$el.remove()}copy(t={},e=25){let s=new this.constructor(this.options,this.$parent);return this.colour&&s.setColour(this.colour),this.flipped&&s.flip(),s.setTransform(this.posn.shift(e,e),this.rot),this.size&&s.setSize(this.size),s}relativePosn(t){return t.subtract(this.posn).rotate(-this.rot*lt)}get center(){return this.path?Xe(this.path).center:A}get ariaDescription(){return`${this.type}: ${this.options}`}static action(t,e,s,n){}toJSON(){return{name:this.type,options:this.options,x:this.posn.x,y:this.posn.y,rot:this.rot,size:this.size,flipped:this.flipped,locked:this.locked,colour:this.colour}}static unSerialize(t,e){if(!t.name)return;let s=e.newTile(t.name,t.options||"");return t.flipped&&s.flip(),s.setTransform(new p(t.x,t.y),t.rot),t.colour&&s.setColour(t.colour),t.size&&s.setSize(t.size),s}};var jt=Ct({});jt.assign(oi);var Ye=new Map,ci=new Map,Jm=/^_x[0-9]+\.at\([0-9-.e]+\)$/,Qm=/^intersections\(|\.midpoint$|\.centroid$/,ct=class extends I{constructor(t,e){super(e,c("path",{class:"geo-path"},e.$geoPaths));this.$parent=e;this.type="geo";this.hideSelectionOutline=!0;this.isProjection=!1;this.parentIDs=[];this.deleted=!1;this.onDraw=()=>this.draw();this.$shadow=c("path",{class:"geo-shadow"},e.$geoShadows),this.options=t;let[s,n]=t.split("=");n||(n=s,s=jt.getKey()),this.id=s,Ye.set(s,this),this.snapPoints=this.snapLines=this.snapAngles=[],this.setExpr(n),jt.watch(this.onDraw),this.setColour(e.penColour)}setExpr(t,e=!1){let s=ot(t);jt.setComputed(this.id,s),!e&&(this.options=`${this.id}=${t}`,this.expr=t,this.setParentIDs(t.match(/_x[0-9]+/g)||[]),this.isProjection=Jm.test(t),this.locked=Qm.test(t),this.$el.setClass("locked",this.locked))}draw(){let t=jt[this.id];if(t===this.path)return;this.path=t,this.$el.toggle(!!t),this.isActive&&!t&&this.$shadow.hide();let e=t==null?void 0:t.type;e!==this.geoType&&(this.$el.setClass("geo-point",e==="point"),this.$el.setClass("geo-path",e!=="point"),(e==="point"?this.$parent.$geoPoints:this.$parent.$geoPaths).append(this.$el),this.geoType=e),!!t&&(e==="point"&&(t=new H(t,this.locked?3.5:6)),this.$el.draw(t,{box:this.$parent.canvasBounds.rect}),this.$shadow.setAttr("d",this.$el.attr("d")),this.transform())}setParentIDs(t){var e;for(let s of this.parentIDs)(e=ci.get(s))==null||e.delete(this.id);this.parentIDs=t;for(let s of t)ci.has(s)||ci.set(s,new Set),ci.get(s).add(this.id)}get parents(){return this.parentIDs.map(t=>Ye.get(t)).filter(t=>t)}get children(){let t=ci.get(this.id);return t?Array.from(t).map(e=>Ye.get(e)).filter(e=>e):[]}get ariaDescription(){var t;return`${(t=this.path)==null?void 0:t.type} ${this.id}: ${this.expr}`}select(){var t;this.isActive=!0,this.path&&this.$shadow.show(),(t=this.$el.parent)==null||t.append(this.$el)}deselect(){this.isActive=!1,this.$shadow.hide()}hover(t=!0){this.isActive||!this.path||(t?this.$shadow.show():this.$shadow.hide())}transform(){this.transformed=this.path,this.pending||(this.snapPoints=this.path&&ut(this.path)?[this.path]:[],this.snapLines=!this.path||ut(this.path)?[]:[this.path])}setTransform(){this.transform()}setColour(t){var e,s;this.colour=t,(e=this.$el)==null||e.css("color",D(t)),(s=this.$shadow)==null||s.css("color",D(t))}copy(t={}){if(!this.path)return;if(t[this.id])return t[this.id];let e=this.expr;if(ut(this.path))e=`point(${this.path.x+25},${this.path.y+25})`;else for(let s of this.parents){let n=t[s.id]||s.copy(t);e=e.replace(s.id,n.id)}return t[this.id]=new ct(e,this.$parent)}delete(){this.deleted=!0,super.delete(),jt.unwatch(this.onDraw),jt[this.id]=void 0,Ye.delete(this.id),this.$shadow.remove();for(let t of this.parents)t.geoType==="point"&&!t.deleted&&!t.parentIDs.length&&!t.children.length&&t.delete();for(let t of this.children)t.delete()}setPending(t=!0){this.pending=t,t||this.transform();for(let e of this.children)e.setPending(t)}moveStart(){if(!(this.locked||!this.path)){if(this.isProjection){if(this.$parent.selection.size>1)return;this.setParentIDs([])}this.setPending(!0);for(let t of this.parents)t.moveStart();this.moveStartValue=this.transformed}}move(t,e){if(!(!t||!this.path||!this.moveStartValue))if(ut(this.path))this.snapTarget=e,this.$el.setClass("locked",this.locked||!!(e==null?void 0:e.intersection)),jt[this.id]=this.moveStartValue.translate(t);else for(let s of this.parents)s.move(t)}moveEnd(){var t,e,s,n;if(!!this.moveStartValue){for(let r of this.parents)r.moveEnd();if(this.setPending(!1),(t=this.snapTarget)==null?void 0:t.intersection)this.setExpr(this.snapTarget.intersection.expr);else if(((s=(e=this.snapTarget)==null?void 0:e.tile)==null?void 0:s.type)==="geo"){let r=(n=this.snapTarget)==null?void 0:n.tile;if(r.path&&ut(r.path)){for(let o of this.children)o.setExpr(o.expr.replace(this.id,r.id));return this.$parent.selection.add(r),this.delete()}else if(r.path){let o=Fe(r.path,jt[this.id]);this.setExpr(`${r.id}.at(${o})`)}}}}static computeIntersections(t){t.intersections.clear();let e=Array.from(Ye.values()).filter(n=>n.path&&!ut(n.path)),s=e.length;for(let n=0;n<s;++n)for(let r=n+1;r<s;++r){let o=ht(e[n].path,e[r].path);for(let[a,h]of o.entries())t.intersections.add({value:h,expr:`intersections(${e[n].id},${e[r].id})[${a}]`})}}static getInferredShape(t){let e=t.filter(a=>a.type==="geo"&&a.path);if(!e.length)return;if(e.length===1)return{type:e[0].path.type,expr:e[0].id};let s=e.filter(a=>ut(a.path)),n=e.filter(a=>at(a.path)||st(a.path));if(n.length===1&&s.length===e.length-1){let a=n[0].path;if(s.every(h=>a.contains(h.path)))return{type:a.type,expr:n[0].id}}let r=n.filter(a=>at(a.path));if(s.length+r.length!==e.length)return;for(let a of r)if(Xs(a.path)){let h=a.parentIDs.map(l=>Ye.get(l));for(let l of h)s.includes(l)||s.push(l)}else if(s.filter(h=>a.path.contains(h.path)).length<2)return;let o=s.map(a=>a.id).join(",");return s.length===2?{type:"segment",expr:`segment(${o})`}:s.length===3?{type:"triangle",expr:`triangle(${o})`}:{type:"polygon",expr:`polygon(${o})`}}static construct(t,e,s){if(t=t.replace(/\$0/g,e||""),t.includes("$1"))s.tools.geoPending.enable(t);else{let n=new ct(t,s);s.selection.add(n,!0);let r=ut(n.path)?"pop":"draw";n.$el.enter(r,400),n.$shadow.enter(r,400),ct.computeIntersections(s)}}static redrawLines(t){for(let e of Ye.values())e.path&&Fr(e.path)&&(e.$el.draw(e.path,{box:t}),e.$shadow.setAttr("d",e.$el.attr("d")))}static clearModel(){jt.clear(),jt.assign(oi)}};var t0=3,e0=.15;function cp(i,t,e,s=!1){let n=t||i,r=e||i,o=Math.atan2(r.y-n.y,r.x-n.x)+(s?Math.PI:0),a=p.distance(n,r)*e0;return i.shift(Math.cos(o)*a,Math.sin(o)*a)}function s0(i){return i.length<=2?Ys(new Pe(...i)):i.map((t,e)=>{if(e===0)return`M${t.x} ${t.y}`;if(p.distance(i[e-1],t)<4)return`L${t.x},${t.y}`;let s=cp(i[e-1],i[e-2],t),n=cp(t,i[e-1],i[e+1],!0);return`C${s.x},${s.y} ${n.x},${n.y} ${t.x},${t.y}`}).join("")}var Je=class{constructor(t,e,s,n){this.$parent=t;this.brush=n;this.path="";this.$el=c("path",{class:`stroke ${n}`},t.$strokes),this.setColor(s),t.strokes.add(this),e.length===1&&e.push(e[0].shift(.01)),this.draw(e)}setColor(t){this.color=t,this.$el.setAttr("stroke",D(t))}addPoint(t){this.segments.push(new _(N(this.segments).p2,t)),this.path+=`L${t.x},${t.y}`,this.$el.setAttr("d",this.path)}setLine(t){this.segments=[t],this.path=Ys(t),this.$el.setAttr("d",this.path)}makeSnapPoints(){this.snapPoints=Ii(...this.segments.map(t=>[t.p1,t.p2])),this.snapLines=this.segments}simplify(){let t=this.segments.map(n=>n.p1);t.push(N(this.segments).p2);let e=[t[0]],s=0;for(let n=2;n<t.length;++n){let r=new _(N(e),t[n]);t.slice(s+1,n).every(a=>r.contains(a,t0))||(e.push(t[n-1]),s=n-1)}e.push(N(t)),this.draw(e)}draw(t){this.path=s0(t),this.segments=new Pe(...t).edges,this.$el.setAttr("d",this.path)}hitTest(t,e){let s=e**2;return this.segments.some(n=>n.distanceSquared(t)<s)}delete(){this.$parent.strokes.delete(this),this.$el.remove()}serialize(){return{points:this.path.slice(0,16e3),colour:this.color,brush:this.brush}}static unSerialize(t,e){let s=Re(t.points),n=new Je(e,s,t.colour||"#000",t.brush||"");return s.length===2&&n.makeSnapPoints(),n}};function Qe(i){let t=Math.cos(2*Math.PI/i);return 1/Math.sqrt(2-2*t)}var Qo=i=>kt(Math.round(i.angle*_t),180),Mt=i=>i.map(t=>`${$t(t.x,3)} ${$t(t.y,3)}`).join(",");function xn(i,t){let e=new p(-i/2,-t/2);return Mt(new V(e,i,t).points)}var C=50,X=Math.sqrt(3)/4*C,ta=new et(A,new p(0,1)),pp={"equ-triangle":new O(new p(-C/2,X),new p(C/2,X),new p(0,-X)),square:O.regular(4,C*Qe(4)),"reg-pentagon":O.regular(5,C*Qe(5)),"reg-hexagon":O.regular(6,C*Qe(6)),"reg-heptagon":O.regular(7,C*Qe(7)),"reg-octagon":O.regular(8,C*Qe(8)),"reg-decagon":O.regular(10,C*Qe(10)),"reg-dodecagon":O.regular(12,C*Qe(12)),rectangle:new V(new p(-C,-C/2),2*C,C).polygon,trapezium:new O(new p(-C,X),new p(C,X),new p(C/2,-X),new p(-C/2,-X)),rhombus:new O(new p(-C*3/4,X),new p(C/4,X),new p(C*3/4,-X),new p(-C/4,-X)),"right-triangle":new O(new p(-C/2,-C/2),new p(C/2,-C/2),new p(-C/2,C/2)),"rhombus-2":new O(new p(C/2-X,C/4),new p(-X-C/2,C/4),new p(X-C/2,-C/4),new p(X+C/2,-C/4)),chevron:new O(new p(-.75*C,2*X),new p(.25*C,2*X),new p(.75*C,0),new p(.25*C,-2*X),new p(-.75*C,-2*X),new p(-.25*C,0)),"right-triangle-2":new O(new p(-2*X,-C/2),new p(-2*X,C/2),new p(2*X,-C/2)),kite:new O(new p(0,-C),new p(2*X,-C/2),new p(0,C),new p(-2*X,-C/2)),dart:new O(new p(2*X,.75*C),new p(0,-.75*C),new p(-2*X,.75*C),new p(0,.25*C))},up=["","","",f.yellow,f.blue,f.green,f.red,f.teal,f.purple,"",f.lime,"",f.orange],dp={trapezium:f.red,"right-triangle":f.green,"rhombus-2":f.orange,chevron:f.orange,kite:f.purple,dart:f.teal},fp={"equ-triangle":f.green,square:f.yellow,"reg-pentagon":f.blue,"reg-hexagon":"#ffd615","reg-decagon":f.red,rectangle:f.yellow,trapezium:"#cc1030",rhombus:f.blue,"rhombus-2":"#e6e2c6",chevron:"#cc1030","right-triangle-2":"#ffd615",kite:"#134791",dart:f.purple};function $n(i){if(i in pp)return pp[i];if(i.match(/^[0-9.,\-\s]+$/)){let t=i.split(",").map(e=>new p(...e.split(" ").map(s=>+s)));return new O(...t)}throw new Error("Unknown polygon type.")}var i0=["trapezium","rhombus","rhombus-2","rectangle","right-triangle","right-triangle-2"],n0=["equ-triangle","square","reg-pentagon","reg-hexagon","reg-heptagon","reg-octagon","reg-decagon","reg-dodecagon","rectangle","trapezium","kite","dart"],Z=class extends I{constructor(t,e){super(e);this.type="polygon";this.options=t,this.path=$n(t),this.snapAngles=Ht(this.path.edges.map(Qo)),this.symmetric=n0.includes(t);let s=e.options.altColors?fp:dp;this.colour=s[t]||up[this.path.points.length];let n=V.aroundPoints(this.path.points),r=new p(n.center.x,n.p.y);this.showSelectionOutline=p.distance(r,this.path.project(r))>5;let o={class:"polygon-tile",path:this.path,fill:this.colour};this.$path=c("path",o,this.$el),this.$outline=c("path",{class:"outline",path:this.path},this.$el)}static makeThumbnail(t,e,s,n){let r=i0.includes(t)?30:40,o=$n(t),a=Math.max(...o.points.map(u=>u.length));o=o.scale(36/a).shift(40,r);let h=c("svg",{width:80,height:2*r},e),l=c("path",{class:"polygon-tile",path:o},h);s.options.watch(u=>{let d=u.altColors?fp:dp,m=n||d[t]||up[o.points.length];l.setAttr("fill",m)})}setColour(t){super.setColour(t),this.$path.setAttr("fill",D(this.colour))}flip(t){t&&(this.posn=new p(2*t.x-this.posn.x,this.posn.y)),this.rot=-this.rot,this.flipped=!this.flipped,this.symmetric||(this.path=this.path.reflect(ta),this.$path.draw(this.path),this.$outline.draw(this.path)),this.transform()}static action(t,e,s){if(t==="flip"){for(let n of e)n.flip(s);e.values().next().value.$parent.selection.update()}}};var r0=[[0,-.2],[1.2,-1],[.6,1],[-.6,1],[-1.2,-.2]],mp=r0.map(i=>new p(i[0]*50,i[1]*50)),ea=class extends Z{constructor(t,e){super(t||Mt(mp),e);this.type="custom-polygon";this.$handles=[];this.showSelectionOutline=!0;for(let[n,r]of this.path.points.entries())this.makeVertex(r,n);this.updatePath();let s;this.$parent.events.listen(this.$outline,{down:({posn:n})=>{n=this.relativePosn(n);let r=this.path.edges.findIndex(o=>n.distanceFromLine(o)<5);s=this.makeVertex(n,(r+1)%this.$handles.length),this.updatePath()},move:({posn:n})=>{s&&this.moveVertex(s,n)},end:()=>{s&&this.$parent.change()}}),this.$outline.css("cursor","crosshair")}makeVertex(t,e){if(this.$handles.length>=24)return;let s=this.makeHandle("c",(n,r)=>this.moveVertex(s,r),()=>this.deleteVertex(s));return s.setCenter(t),s.setAttr("r",8),s.css("cursor","move"),this.$handles.splice(e,0,s),s}deleteVertex(t){t.remove(),this.$handles.splice(this.$handles.indexOf(t),1),this.updatePath()}moveVertex(t,e){var n;let s=(n=this.$parent.snap([e]))==null?void 0:n.shift;t.setCenter(this.relativePosn(s?e.add(s):e)),this.updatePath()}updatePath(){let t=this.$handles.map(e=>e.center);this.path=new O(...t),this.$path.draw(this.path),this.$outline.draw(this.path),this.transform(),this.snapAngles=Ht(this.path.edges.map(Qo)),this.options=Mt(t),this.$parent.selection.update()}flip(t){t&&(this.posn=new p(2*t.x-this.posn.x,this.posn.y)),this.rot=-this.rot,this.transform();for(let e of this.$handles)e.setCenter(e.center.reflect(ta));this.updatePath()}lock(){let t=new Z(this.options,this.$parent);t.setColour(this.colour),t.setTransform(this.posn,this.rot),this.$parent.selection.add(t),this.delete()}static makeThumbnail(t,e){let s=new O(...mp).scale(.5).shift(40),n=c("svg",{width:80,height:80},e);c("path",{class:"polygon-tile",path:s,fill:f.green},n);for(let r of s.points)c("circle",{cx:r.x,cy:r.y,r:3,fill:"white"},n)}static action(t,e){if(t==="lock")for(let s of Array.from(e))s.lock()}};var sa=25/2,gp=[[[0,2],[0,-4],[-2,-4],[-2,4],[2,4],[2,2],[0,2]],[[0,0],[0,-4],[-2,-4],[-2,2],[0,2],[0,4],[2,4],[2,0],[0,0]],[[-5,-1],[5,-1],[5,1],[-5,1]],[[-3,-2],[-3,2],[1,2],[1,0],[3,0],[3,-2],[-3,-2]],[[3,-2],[3,0],[1,0],[1,-2],[-1,-2],[-1,2],[5,2],[5,-2],[3,-2]],[[-1,-3],[-1,-1],[-3,-1],[-3,3],[-1,3],[-1,1],[1,1],[1,-1],[3,-1],[3,-3],[-1,-3]],[[1,1],[1,-3],[-1,-3],[-1,1],[-3,1],[-3,3],[3,3],[3,1],[1,1]],[[1,-1],[1,-3],[-1,-3],[-1,-1],[-3,-1],[-3,1],[-1,1],[-1,3],[1,3],[1,1],[3,1],[3,-1],[1,-1]],[[-1,-3],[-1,-1],[-3,-1],[-3,1],[-1,1],[-1,3],[1,3],[1,-1],[3,-1],[3,-3],[-1,-3]],[[-4,-2],[-4,0],[-2,0],[-2,2],[0,2],[0,0],[4,0],[4,-2],[-4,-2]],[[-1,-3],[-1,1],[-3,1],[-3,3],[1,3],[1,-1],[3,-1],[3,-3],[-1,-3]],[[-1,-3],[-1,1],[-5,1],[-5,3],[1,3],[1,-3],[-1,-3]],[[-1,2],[1,2],[1,0],[3,0],[3,-2],[-3,-2],[-3,0],[-1,0]],[[-3,2],[-3,0],[-1,0],[-1,-2],[3,-2],[3,0],[1,0],[1,2]],[[-3,2],[-3,-2],[3,-2],[3,0],[-1,0],[-1,2]],[[-2,2],[2,2],[2,-2],[-2,-2]],[[-4,1],[4,1],[4,-1],[-4,-1]]].map(i=>i.map(t=>new p(t[0]*sa,t[1]*sa))),o0=[[2,4],[4,4],[5,9],[7,2],[7,6],[11,3],[13,7],[15,3],[17,7],[20,2],[21,5],[23,7],[3,2],[7,2],[5,6],[10,4],[8,7]],wp=[...q.rainbow(12).map(i=>i.hex),f.red,f.blue,f.green,f.yellow,f.purple],ia=class extends Z{constructor(t,e){super(Mt(gp[+t]),e);this.type="pentomino";this.options=t,this.setColour(wp[+t])}static makeThumbnail(t,e){let s=o0[+t],n=new O(...gp[+t]).scale(10/sa);e.draw(n.shift(10*s[0],10*s[1]).shift(1,1)),e.setAttr("fill",wp[+t])}};var yp=[[[-4,-2],[0,2],[4,-2]],[[-4,-2],[0,2],[4,-2]],[[-2,0],[0,-2],[2,0],[0,2]],[[-3,1],[1,1],[3,-1],[-1,-1]],[[0,-1],[2,1],[-2,1]],[[0,-1],[2,1],[-2,1]],[[-2,-2],[2,-2],[2,2]]],vp=[f.red,f.blue,f.green,f.yellow,f.orange,f.teal,f.purple],a0=[[2,4],[4,2],[6,4],[3,7],[7,2],[4,5],[6,6]],xp=[-90,0,0,0,-90,0,90],h0=25,na=class extends Z{constructor(t,e){super(Mt(yp[+t].map(s=>new p(...s).scale(h0))),e);this.type="tangram";this.snapAngles=[0,45,90,135];this.options=t,this.setColour(vp[+t]),this.rot=xp[+t],this.transform()}static makeThumbnail(t,e,s,n){let r=a0[+t],o=yp[+t].map(h=>new p(...h).rotate(xp[+t]*lt).shift(...r).scale(18).shift(2,2)),a=new O(...o);e.draw(a),e.setAttr("fill",n||vp[+t])}getSnapLines(){return this.path.edges}};var $p=25,pi=(1+Math.sqrt(5))/2*$p,bn=Math.sqrt((5+Math.sqrt(5))/2)*$p,ui=pi*(Math.sqrt(5)-1)/2,bp=[`0 ${-pi},${bn} ${-ui},0 ${pi},${-bn} ${-ui}`,`0 ${2*ui-pi},${bn} ${ui},0 ${-pi},${-bn} ${ui}`],Pp=[["M29.4-30.9C25.3-18.2,13.4-9.5,0-9.5c-13.4,0-25.3-8.6-29.4-21.4","M29.4,0C20.8-6.2,10.6-9.5,0-9.5c-10.6,0-20.8,3.3-29.4,9.5"],["M18.2,15.5C20.1,9.6,19,3.3,15.5-1.7C11.9-6.6,6.1-9.5,0-9.5c-6.1,0-11.9,2.9-15.5,7.9c-3.6,4.9-4.6,11.3-2.7,17.1","M18.2-15.5C12.9-11.6,6.5-9.5,0-9.5c-6.5,0-12.9-2.1-18.2-5.9"]],Mp=[f.red,f.blue],ra=class extends Z{constructor(t,e){super(bp[+t],e);this.type="penrose";this.setColour(Mp[+t]),this.options=t;let s=c("g",{class:"penrose-circles"});this.$path.insertAfter(s);for(let n of Pp[+t])c("path",{d:n},s)}static makeThumbnail(t,e,s,n){let r=+t,o=c("svg",{width:80,height:80,viewBox:"-50 -50 100 100"},e),a=n||Mp[r];c("polygon",{points:bp[r],class:"polygon-tile",fill:a},o);let h=c("g",{class:"penrose-circles"},o);for(let l of Pp[r])c("path",{d:l},h)}};var Sp=["M13.9-13.9,2.8-25H-2.8L-25-2.8V2.8L-2.8,25H2.8L13.9,13.9C21.6,6.6,21.6-6.6,13.9-13.9Zm-2.8,25L0,22.2-22.2,0,0-22.2,11.1-11.1A15.8,15.8,0,0,1,11.1,11.1Z","M25-2.8,13.9-13.9c-7.3-7.7-20.5-7.7-27.8,0L-25-2.8V2.8l11.1,11.1c7.3,7.7,20.5,7.7,27.8,0L25,2.8ZM11.1,11.1a15.8,15.8,0,0,1-22.2,0L-22.2,0l11.1-11.1a15.8,15.8,0,0,1,22.2,0L22.2,0Z","M-25-2.8V2.8l11.1,11.1c7.3,7.6,20.5,7.6,27.8,0s7.6-20.5,0-27.8L2.8-25H-2.8ZM15.7,0a15.9,15.9,0,0,1-4.6,11.1,15.8,15.8,0,0,1-22.2,0L-22.2,0,0-22.2,11.1-11.1A15.9,15.9,0,0,1,15.7,0Z","M-25-2.8V2.8L-2.8,25H2.8L25,2.8V-2.8L2.8-25H-2.8Zm25,25L-22.2,0,0-22.2,22.2,0Z","M0-19.7a19.5,19.5,0,0,0-13.9,5.8c-7.6,7.3-7.6,20.5,0,27.8s20.5,7.6,27.8,0C26.3,1.6,17.5-19.7,0-19.7ZM11.1,11.1c-5.8,6.1-16.3,6.1-22.2,0a15.8,15.8,0,0,1,0-22.2,15.8,15.8,0,0,1,22.2,0A15.8,15.8,0,0,1,11.1,11.1Z","M0-19.7a19.5,19.5,0,0,0-13.9,5.8L-25-2.8V2.8l11.1,11.1c7.3,7.6,20.5,7.6,27.8,0C26.3,1.6,17.5-19.7,0-19.7ZM11.1,11.1a15.8,15.8,0,0,1-22.2,0L-22.2,0l11.1-11.1c5.9-6.1,16.4-6.1,22.2,0A15.8,15.8,0,0,1,11.1,11.1Z"],oa=class extends Z{constructor(t,e){super("square",e);this.type="kolam";this.setColour(f.orange),this.options=t,c("path",{d:Sp[+t],fill:"white"},this.$el),c("circle",{r:3,fill:"white"},this.$el),this.$el.append(this.$outline),this.$path.css("stroke-width",".5px")}static makeThumbnail(t,e){let s=c("svg",{width:60,height:60},e);c("rect",{class:"polygon-tile",fill:f.orange,x:5,y:5,width:50,height:50},s),c("path",{d:Sp[+t],fill:"white",transform:"translate(30 30)"},s),c("circle",{r:3,cx:30,cy:30,fill:"white"},s)}};var As=["M-32.3,6.5,0,84.3H0L32.3,6.5A80.4,80.4,0,0,0,0,0,86.6,86.6,0,0,0-32.3,6.5Z","M-32.3,6.5,0,84.3H0L32.3,6.5A80.4,80.4,0,0,0,0,0,86.6,86.6,0,0,0-32.3,6.5Z","M-42.1,0A288.5,288.5,0,0,0-20.2,110.2a287.6,287.6,0,0,0,62.3,93.3V0Z","M-42.1,0V203.5a289.5,289.5,0,0,0,62.4-93.3A286.5,286.5,0,0,0,42.1,0Z","M0 0L-101.7 101.7L101.7 101.7Z","M0 0L-101.7 101.7L101.7 101.7Z","M0 0L-59.6 59.6L59.6 59.6Z","M42.1.1H-42.2l-59.5,59.6A143.4,143.4,0,0,0,0,101.8,143,143,0,0,0,101.7,59.7Z","M42.1.1H-42.2l-59.5,59.6A143.4,143.4,0,0,0,0,101.8,143,143,0,0,0,101.7,59.7Z"],Tp=[[66,-17.5,-22.5],[82,-17.5,22.5],[23,-36.5,45],[125,-36.5,-45],[56,47.3,135],[92,47.3,-135],[74,101,180],[41,98,45],[107,98,-45]],l0={0:1,1:1,2:3,3:2,7:8,8:7},Vp=[f.lime,f.teal,f.blue,f.red,f.yellow,f.green,f.grey,f.orange,f.purple],aa=class extends Z{constructor(t,e){super(Mt(Re(As[+t])),e);this.type="egg";this.snapAngles=[0,45,90,135];this.options=t,this.$path.setAttr("d",As[+t]),this.$outline.setAttr("d",As[+t]),this.setColour(Vp[+t]),this.rot=Tp[+t][2],this.transform(),+t<=1&&this.snapAngles.push(22.5,67.5,112.5,157.5)}flip(t){super.flip(t);let e=this.flipped?l0[this.options]||this.options:this.options;this.$path.setAttr("d",As[+e]),this.$outline.setAttr("d",As[+e])}static makeThumbnail(t,e){e.setAttr("d",As[+t]);let s=Tp[+t];e.css("transform",`translate(${s[0]}px, ${s[1]}px) rotate(${s[2]}deg) scale(0.5)`),e.setAttr("fill",Vp[+t]),e.css("stroke-width","2px")}};var ha=1/Math.sqrt(3),c0=50/ha,Ep=[f.blue,f.purple,f.red,f.orange,f.yellow],Cs=O.regular(6,c0).rotate(Math.PI/6).points;Cs.splice(3,1);Cs.splice(2,0,new p(2*Cs[1].x,Cs[0].y));var la=class extends Z{constructor(t,e){super(Mt(Cs.map(s=>s.scale(ha**+t))),e);this.type="fractal";this.setColour(Ep[+t]),this.options=t}static makeThumbnail(t,e){let s=new O(...Cs).scale(.6*ha**+t),n=V.aroundPoints(s.points),r=c("svg",{width:20+n.w,height:20+n.h},e);s=s.shift(10-n.center.x+n.w/2,10-n.center.y+n.h/2),c("path",{class:"polygon-tile",path:s,fill:Ep[+t]},r)}};var ts=50,Pn=class extends I{constructor(t,e){super(e);this.canRotate=!1;this.canDragToSelect=!1;this.$el.addClass("utensil"),this.width=+t,this.absoluteEnd=new p(this.width,0),this.setup(),this.$handles=[0,1].map(s=>this.makeHandle("c",(n,r)=>{var h;let o=s?this.posn:this.absoluteEnd,a=(h=this.$parent.snap([r]))==null?void 0:h.shift;r=a?r.add(a):r.snap(o,10),p.distance(r,o)<75&&(r=new H(o,75).project(r)),s?this.absoluteEnd=r:this.posn=r,this.rot=this.absoluteEnd.angle(this.posn)*_t,this.width=this.absoluteEnd.subtract(this.posn).length,this.update(),this.transform()})),this.update()}moveEnd(){this.absoluteEnd=new p(this.width,0).rotate(this.rot).add(this.posn)}update(){this.options=""+this.width,this.$handles[1].setCenter({x:this.width,y:0})}},p0=["ruler","protractor"];function Ap(i){return p0.includes(i.type)}var ca=class extends Pn{constructor(){super(...arguments);this.type="ruler"}setup(){this.$glass=c("rect",{x:-20,height:60,class:"glass",rx:5},this.$el),this.$ticks=c("path",{class:"ticks"},this.$el),this.$labels=z(t=>c("text",{text:t,x:ts*t,y:31},this.$el),21)}update(){this.path=new _(A,new p(this.width,0));let t=this.path.length+.1;this.$glass.setAttr("width",t+40);let e="";for(let s=0;s<=t;s+=ts/10){let n=s%ts?s%(ts/2)?0:1:2;e+=`M${s} 0L${s} ${[10,15,20][n]}`}this.$ticks.setAttr("d",e);for(let[s,n]of this.$labels.entries())n.toggle(s<=t/ts);super.update()}getSnapPoints(){let t=this.path.length;return z(e=>this.path.at(e*ts/t),t/ts)}getSnapLines(){return[this.path]}};function u0(i){return`M0-${i}A${i},${i},0,0,0-${i},0V3a5,5,0,0,0,5,5H${i-5}a5,5,0,0,0,5-5V0A${i},${i},0,0,0,0-${i}Z`}var pa=class extends Pn{constructor(){super(...arguments);this.type="protractor"}setup(){this.$glass=c("path",{d:"",class:"glass"},this.$el),this.$ticks=c("path",{class:"ticks"},this.$el),this.$labels=z(t=>c("text",{text:t*10,transform:`rotate(${90-10*t})`},this.$el),19)}update(){let t=this.width;this.path=new xe(A,new p(-this.width,0),Math.PI),this.$glass.setAttr("d",u0(t));let e="",s=this.width<100?5:1;for(let n=0;n<=180;n+=s){let r=!(n%10),o=p.fromPolar(-n*lt),a=t-(r?30:20);e+=`M${o.x*t} ${o.y*t}L${o.x*a} ${o.y*a}`,r&&(e+=`M${o.x*8} ${o.y*8}L${o.x*(t-50)} ${o.y*(t-50)}`)}this.$ticks.setAttr("d",e);for(let[n,r]of this.$labels.entries()){let o=t>160||!(n%3);r.toggle(o),o&&r.setAttr("y",44-t)}super.update()}getSnapPoints(){return[A,this.path.start,this.path.at(.5),this.path.end]}getSnapLines(){return[]}},ua=class extends Pn{constructor(){super(...arguments);this.type="compass"}setup(){}update(){}getSnapPoints(){return[]}getSnapLines(){return[]}};var Mn=["M-25,34.4a81.3,81.3,0,0,1,50,0h0A81.1,81.1,0,0,0,40.4-13.1h.1A81.5,81.5,0,0,1,0-42.5H0A81.5,81.5,0,0,1-40.5-13.2h.1A81.1,81.1,0,0,0-25,34.4Z","M-15.4-21.3A80.5,80.5,0,0,1,0-68.8,80.5,80.5,0,0,1,15.4-21.3a80.6,80.6,0,0,1,50,0A80.3,80.3,0,0,1,25,8.1,80.4,80.4,0,0,1,40.4,55.7,80.2,80.2,0,0,1,0,26.3,80.2,80.2,0,0,1-40.4,55.7,80.4,80.4,0,0,1-25,8.1,80.3,80.3,0,0,1-65.4-21.3,80.6,80.6,0,0,1-15.4-21.3Z","M65.4-21.3A80.5,80.5,0,0,1,0,12.1,80.5,80.5,0,0,1-65.4-21.3a80.6,80.6,0,0,1,50,0A80.5,80.5,0,0,1,0-68.8,80.5,80.5,0,0,1,15.4-21.3,80.6,80.6,0,0,1,65.4-21.3Z","M80.9-47.5h0A81.5,81.5,0,0,1,40.4-76.9,80.4,80.4,0,0,0,0-47.5,80.2,80.2,0,0,0-40.5-76.9h0A80.8,80.8,0,0,1-80.9-47.6h0A80.3,80.3,0,0,1-65.5,0,80.3,80.3,0,0,1-80.9,47.5h0A80.8,80.8,0,0,1-40.5,76.9h0A80.2,80.2,0,0,0,0,47.5,80.4,80.4,0,0,0,40.4,76.9,81.5,81.5,0,0,1,80.9,47.6h0A80.3,80.3,0,0,1,65.5,0,80.3,80.3,0,0,1,80.9-47.5Z","M0-47.5A80.3,80.3,0,0,1,15.5,0,80.3,80.3,0,0,1,0,47.5,80.3,80.3,0,0,1-15.5,0,80.3,80.3,0,0,1,0-47.5Z","M130.9,153.8a80.5,80.5,0,0,1,15.4-47.5,80.2,80.2,0,0,1-40.4-29.4A80.1,80.1,0,0,1,90.5,29.4a80.6,80.6,0,0,1-50,0A80.6,80.6,0,0,1,0,0,80.3,80.3,0,0,1-40.4,29.4a80.9,80.9,0,0,1-50.1,0,80.8,80.8,0,0,1-15.4,47.5,80.9,80.9,0,0,1-40.5,29.4,79.9,79.9,0,0,1,15.5,47.5,81.3,81.3,0,0,1,50,0A80.9,80.9,0,0,1,0,72.9a80.9,80.9,0,0,1,80.9,80.9A81.3,81.3,0,0,1,130.9,153.8Z","M40.4-13.2A80.4,80.4,0,0,0,0-42.5,80.7,80.7,0,0,0-40.4-13.1,80.9,80.9,0,0,0-25,34.4a80.6,80.6,0,0,0,50,0A81.2,81.2,0,0,0,40.4-13.2Z","M40.4-13.1A82,82,0,0,1,0-42.5,81.1,81.1,0,0,1-40.5-13.2,81.3,81.3,0,0,1-25,34.4a81.3,81.3,0,0,1,50,0A81.6,81.6,0,0,1,40.4-13.1Z"],Cp=["M16.2-.3a5.5,5.5,0,0,1-4.4,6.4A5.3,5.3,0,0,1,5.5,1.8,5.4,5.4,0,0,1,9.8-4.6,5.5,5.5,0,0,1,16.2-.3Zm8-8A3.8,3.8,0,0,0,28-4.5a3.7,3.7,0,0,0,3.7-3.8A3.6,3.6,0,0,0,28-12,3.7,3.7,0,0,0,24.2-8.3ZM19,23.4a4.9,4.9,0,0,0,4.8-4.8A4.8,4.8,0,0,0,19,13.9a4.7,4.7,0,0,0-4.7,4.7A4.8,4.8,0,0,0,19,23.4ZM-11.7,6.1A5.3,5.3,0,0,0-5.4,1.8,5.4,5.4,0,0,0-9.7-4.6,5.5,5.5,0,0,0-16.1-.3,5.5,5.5,0,0,0-11.7,6.1ZM-27.9-4.5a3.8,3.8,0,0,0,3.8-3.8A3.7,3.7,0,0,0-27.9-12a3.6,3.6,0,0,0-3.7,3.7A3.7,3.7,0,0,0-27.9-4.5ZM20.9-22A139.9,139.9,0,0,1,3-19.5a1.1,1.1,0,0,1-.1.5L1-15.2V30H-1V-15.2L-2.9-19a1.1,1.1,0,0,1-.1-.5,127,127,0,0,1-17.8-2.6A80.8,80.8,0,0,0,0-41.7,83.3,83.3,0,0,0,20.9-22ZM-3.8-26.7A3.2,3.2,0,0,0-7-30a3.3,3.3,0,0,0-3.3,3.3A3.2,3.2,0,0,0-7-23.5,3.2,3.2,0,0,0-3.8-26.7ZM6.5-30a3.2,3.2,0,0,0-3.2,3.3,3.2,3.2,0,0,0,3.2,3.2,3.2,3.2,0,0,0,3.3-3.2A3.3,3.3,0,0,0,6.5-30ZM-23.7,18.6a4.9,4.9,0,0,0,4.8,4.8,4.8,4.8,0,0,0,4.7-4.8,4.7,4.7,0,0,0-4.7-4.7A4.8,4.8,0,0,0-23.7,18.6Z","M-16.9-4.7l-17.7-6.1a.8.8,0,0,1-.5-.9.8.8,0,0,1,.9-.5L-16.5-6a.7.7,0,0,1,.5.9.7.7,0,0,1-.7.4ZM-24.6-13l9.7,5.4h.3a.9.9,0,0,0,.7-.3.9.9,0,0,0-.3-1l-9.7-5.4a.8.8,0,0,0-1,.2A.8.8,0,0,0-24.6-13ZM-7.8-4.9l5.9,1.2h.5c.2-.1.3-.2.3-.4l.3-1.4a.6.6,0,0,0-.5-.8L-7.2-7.7h-.6l-.3.4-.3,1.4A.8.8,0,0,0-7.8-4.9ZM2.8-2.5a.9.9,0,0,0,.7.6h.2l1.6-.3a1,1,0,0,0,.5-.4.7.7,0,0,0,.1-.5l-1.4-6a.8.8,0,0,0-.9-.6L2-9.4l-.5.3a1.3,1.3,0,0,0-.1.6ZM10.9.4a.7.7,0,0,0-.1-.5L10-1.3a.8.8,0,0,0-1-.2L4,1.9c-.2.1-.3.2-.3.4a.7.7,0,0,0,.1.5L4.6,4a.6.6,0,0,0,.6.3h.4l5-3.4ZM-4.5-1l-1.4-.3a.4.4,0,0,0-.5.1c-.2.1-.3.2-.3.4L-8.2,5.1a.7.7,0,0,0,.5.8l1.4.4h.5a.5.5,0,0,0,.3-.5L-4-.1A.7.7,0,0,0-4.5-1Zm-12.1-.6a.7.7,0,0,0,.7-.6c.1-.4-.2-.7-.6-.8l-11-1.7a.8.8,0,0,0-.8.6c0,.4.2.8.6.8l11,1.7Zm16.1,6H-1c-.2,0-.3.1-.5.3l-.8,1.1a.8.8,0,0,0,.1,1l4.9,3.6.4.2h.1l.4-.3.9-1.1c.2-.4.2-.8-.1-1Zm-9.4,8.8a.7.7,0,0,0-1,.1L-22.2,28.2a.7.7,0,0,0,.1,1l.4.2a.9.9,0,0,0,.6-.3l11.3-15A.6.6,0,0,0-9.9,13.2Zm-11.2,5.6c.2.2.3.3.5.3l.5-.2,8.2-7.6a.7.7,0,0,0,0-1,.8.8,0,0,0-1,0L-21,17.8A.7.7,0,0,0-21.1,18.8Zm14-4.9a.8.8,0,0,0-1,.4L-13,24.2a.6.6,0,0,0,.3.9h.3a.6.6,0,0,0,.6-.4l5-9.9A.8.8,0,0,0-7.1,13.9Zm17.4-.7a.8.8,0,0,0-1-.2.8.8,0,0,0-.2,1L19.9,29.4a.5.5,0,0,0,.5.3h.4a.7.7,0,0,0,.2-1ZM7,14.4A.7.7,0,0,0,6,14a.7.7,0,0,0-.3.9L10.3,25a.8.8,0,0,0,.7.4h.3a.8.8,0,0,0,.3-1Zm4-2.8,7.8,7.8.5.2.5-.2a.7.7,0,0,0,0-1L12,10.6a.7.7,0,0,0-1,1ZM34.4-11.2a.7.7,0,0,0-.8-.5l-18,5.5a.7.7,0,0,0-.4.9.6.6,0,0,0,.6.5c.1,0,.2,0,.2-.1l18-5.4A.7.7,0,0,0,34.4-11.2ZM26.7-4l-11,1.3a.6.6,0,0,0-.6.8.7.7,0,0,0,.7.6h.1l11-1.3c.4,0,.6-.4.6-.8S27.1-4,26.7-4ZM14-7.3h.3l9.8-5.1a.7.7,0,0,0,.3-1,.7.7,0,0,0-.9-.3L13.6-8.6a.8.8,0,0,0-.3,1A.8.8,0,0,0,14-7.3ZM-.5-16.6h0a.7.7,0,0,0,.7-.6L.6-36a.7.7,0,0,0-.7-.7.7.7,0,0,0-.7.7l-.4,18.7A.7.7,0,0,0-.5-16.6Zm3.2,1.2h.2a.7.7,0,0,0,.7-.6L5.7-26.9a.7.7,0,0,0-.5-.8.8.8,0,0,0-.9.6L2.2-16.3A.7.7,0,0,0,2.7-15.4Zm-6.1-.1h.1c.4-.1.7-.5.6-.8l-1.8-11c0-.4-.4-.6-.8-.6a.8.8,0,0,0-.6.8l1.8,11A.9.9,0,0,0-3.4-15.5Z","M60.8-16.2l-3.6-2.5,1.4-3.9-.9-.3-1.3,3.5h0l-9.5,3,2.8-7.8h-1l-3,8.3-9.5,3.1,4.4-11.8H39.5L35-12.5,25.5-9.4l5-14.7H29.4L24.3-9.1l-9.1,3,6-16.3-1.2.3L14-5.7l-1.8.5a50.6,50.6,0,0,0,5.3-16.2l-1.9.6-.4.2L1-9.8v-10L14.4-30.3c0-.4-.1-.8-.1-1.2L1-21.1v-10l11.7-9.1-.3-1.1L1-32.4v-10l8.9-6.9a3,3,0,0,0-.4-1L1-43.7v-10l5.2-4a4.1,4.1,0,0,0-.5-.9l-5.2,4h-1l-5.2-4a4.1,4.1,0,0,0-.5.9l5.2,4v10l-8.5-6.6a3,3,0,0,0-.4,1L-1-42.4v10l-11.4-8.9-.3,1.1L-1-31.1v10L-14.3-31.5c0,.4-.1.8-.1,1.2L-1-19.8v10L-15.2-20.6l-.4-.2-1.9-.6A50.6,50.6,0,0,0-12.2-5.2L-14-5.7l-6-16.4-1.2-.3,6,16.3-9.1-3L-29.4-24h-1.1l5,14.7L-35-12.5l-4.5-12.2h-1.1l4.4,11.8L-45.7-16l-3-8.3h-1l2.8,7.8-9.5-3h0l-1.3-3.5-.9.3,1.4,3.9-3.6,2.5.7.7,3.1-2.2v.2l9.4,3-6.8,4.8.7.7,7.3-5.1,9.6,3.1L-47.3-3.8l.9.6,10.8-7.4,9.5,3.1-13,8.9,1,.5,13.2-9,9.6,3-14.4,10,1.2.4,14.3-9.9h.4l3,1C-9.8-1-8.9.5-7.9,1.9L-18.4,9.4l1.3.3,9.8-7a64.2,64.2,0,0,0,6.6,8H.7a64.2,64.2,0,0,0,6.6-8l9.8,7,1.3-.3L7.9,1.9C8.9.5,9.8-1,10.8-2.6l3-1h.4L28.5,6.3l1.2-.4L15.3-4.1l9.6-3,13.2,9,1-.5-13-8.9,9.5-3.1L46.4-3.2l.9-.6L36.8-11l9.6-3.1L53.7-9l.7-.7-6.8-4.8,9.4-3v-.2l3.1,2.2Zm-76-3.2L-1-8.5V.6l-9.7-7.4A45.9,45.9,0,0,1-15.2-19.4ZM0,8.5A66.6,66.6,0,0,1-9.6-4.7L-1,1.8V6.3a1,1,0,0,0,1,1,1,1,0,0,0,1-1V1.8L9.6-4.7A71,71,0,0,1,0,8.5ZM10.7-6.8,1,.6V-8.5L15.2-19.4A45.9,45.9,0,0,1,10.7-6.8Z","M65-1V1.1A81.6,81.6,0,0,1,40,5c-8.9,0-12.7-.4-20.6-2.9A1,1,0,0,1,18.8.8.9.9,0,0,1,20,.2C27.7,2.7,31.2,3,40,3A79.7,79.7,0,0,0,64.7-.9ZM-64.6,1.1A82.4,82.4,0,0,0-39.4,5c8.8,0,12.6-.4,20.5-2.9A1.2,1.2,0,0,0-18.2.8,1,1,0,0,0-19.5.2C-27.2,2.7-30.7,3-39.4,3A79.9,79.9,0,0,1-64.2-.9H-65V1ZM-45.8,36a6.7,6.7,0,0,1,6.7-6.7A6.7,6.7,0,0,1-32.4,36a6.7,6.7,0,0,1-6.7,6.7A6.7,6.7,0,0,1-45.8,36Zm2,0a4.7,4.7,0,0,0,4.7,4.7A4.7,4.7,0,0,0-34.4,36a4.7,4.7,0,0,0-4.7-4.7A4.7,4.7,0,0,0-43.8,36Zm10.4-71.4a5.7,5.7,0,0,0-5.7-5.7,5.6,5.6,0,0,0-5.7,5.7,5.7,5.7,0,0,0,5.7,5.7A5.8,5.8,0,0,0-33.4-35.4ZM4.9-37.1a2.2,2.2,0,0,0,2.2,2.2,2.2,2.2,0,0,0,2.2-2.2,2.2,2.2,0,0,0-2.2-2.2A2.2,2.2,0,0,0,4.9-37.1ZM38.7,42.7h0A6.8,6.8,0,0,1,32,36a6.7,6.7,0,1,1,6.7,6.7ZM43.4,36a4.7,4.7,0,1,0-4.7,4.7h0A4.7,4.7,0,0,0,43.4,36ZM0,42.9c4.1.7,8.7-9.6,11.4-17.9A78.6,78.6,0,0,0,15.3.3c0-6.7-1.3-13.7-3.2-21.6-.6-1.6-3.4-4.2-5.8-5.1,2.2-2,1.8-2.9,2.3-3.7s.1-3.3,0-3.8c-4.5,1.1-6.3-2.7-4.3-5.5C9-44,19.3-53.3,29-55.2a6.4,6.4,0,0,0,1,1.3,3.1,3.1,0,0,0,1.8.5,2.9,2.9,0,0,0,2.4-1.2h0a3,3,0,0,0-.6-4.2,2.9,2.9,0,0,0-4.2.7,2.6,2.6,0,0,0-.5.9C19-55.4,8.7-46.5,3.6-41.5A33.5,33.5,0,0,1-.2-42.6l-3.7,1.2c-5-4.9-15.3-13.9-25.4-15.8a2.7,2.7,0,0,0-.5-1.1,3,3,0,0,0-4.2-.6,3,3,0,0,0-.6,4.2h0a3,3,0,0,0,2.4,1.2,3.2,3.2,0,0,0,1.8-.6,3.1,3.1,0,0,0,.9-1.1c10.1,2,20.8,11.8,25.2,16.3,1.3,2.5-.4,5.8-4.2,5-.1.6-.5,3,0,4s.6,1.5,2.3,3.5c-2.4.7-6,4-6.3,5.3-1.6,7-3,15.5-3,21.4a78.8,78.8,0,0,0,4,24.7C-8.8,33.3-3.5,43.8,0,42.9Zm-5.2-80a2.2,2.2,0,0,0-2.2-2.2,2.2,2.2,0,0,0-2.2,2.2,2.2,2.2,0,0,0,2.2,2.2A2.2,2.2,0,0,0-5.2-37.1ZM33-35.4a5.8,5.8,0,0,0,5.7,5.7,5.7,5.7,0,0,0,5.7-5.7,5.6,5.6,0,0,0-5.7-5.7A5.7,5.7,0,0,0,33-35.4Z","M.9,33.4v-9l12.7-9.9.3-1.4L.9,23.2v-10l14-10.9V1L.9,12V2L14.5-8.6c0-.3-.1-.7-.1-1.1L.9.8v-10l11.9-9.3a3.6,3.6,0,0,1-.2-1L.9-10.4v-10l9.2-7.1a4.2,4.2,0,0,0-.4-1L.9-21.6v-9.9h0l5.6-4.3L6-36.8.4-32.4H-.4L-6-36.8l-.5.9L-1-31.6a.1.1,0,0,0-.1.1v9.8l-8.6-6.8a4.2,4.2,0,0,0-.4,1l9,7v10l-11.5-9a3.6,3.6,0,0,1-.2,1L-1.1-9.3V.7L-14.4-9.7c0,.4-.1.8-.1,1.1L-1.1,1.9v10L-14.9,1V2.3L-1.1,13.1v10l-12.8-10,.3,1.4,12.5,9.8v9l-9.6-7.5.6,1.8,9,7v4.1a1,1,0,0,0,1,1,.9.9,0,0,0,1-1v-4l9.2-7.1.6-1.7Z","M0,.8A76.2,76.2,0,0,0,7.8,9.9c-1.6,1.9-5.4,7.6-6.6,21.6h-2C-2,17.1-6,11.4-7.6,9.7A72.7,72.7,0,0,0,0,.8ZM124.3,117.2c-6.5,4.7-6.3,16,.5,25.4a30,30,0,0,0,5.8,6,81.7,81.7,0,0,1,8.3-31.1C133.6,114.7,128.1,114.4,124.3,117.2ZM-82.6,86.3A82.8,82.8,0,0,0-104,75l-1.2,1.7A81,81,0,0,1-83.8,87.9a79.9,79.9,0,0,1,17.6,17.7l.3.5,1.3-1.7A81.3,81.3,0,0,0-82.6,86.3Zm47.3-33.1a80,80,0,0,1-3.9-23.7l-1.1.4-.9.2a83.5,83.5,0,0,0,4,23.7A79.9,79.9,0,0,0-25.8,76.6l2-.6-.3-.4A78.4,78.4,0,0,1-35.3,53.2Zm-81,62.7.6-1.9c-11.9-5.1-16.5-10-18.1-12.4a81.4,81.4,0,0,1-11.8,4.9,85.1,85.1,0,0,1,5.8,9.4C-138.6,115.3-132.2,112.1-116.3,115.9ZM-90,30.1a81.7,81.7,0,0,1-.8,11.1c2,.4,8.7,2.3,18.5,13.8l1.7-1.2c-6.9-11.4-7.6-18.1-7.4-20.9A99.4,99.4,0,0,1-90,30.1ZM38,53.8a85.2,85.2,0,0,0,4.1-23.4l-1.8-.5h-.2a81.5,81.5,0,0,1-4,23.4A81.4,81.4,0,0,1,24.6,75.5l-.4.6,2,.7h0A83,83,0,0,0,38,53.8Zm68.4,24.7-.9-1.3-.3-.4a82,82,0,0,1-17.3,17,82,82,0,0,1-22.5,11.3h-.2l1.2,1.7A85.2,85.2,0,0,0,89.1,95.4,81.6,81.6,0,0,0,106.4,78.5ZM70.8,54.6l1.6,1.2c9.9-11.4,16.5-13.4,18.5-13.7a80.8,80.8,0,0,1-.9-12,97.8,97.8,0,0,1-11.9,2.8C78.4,35.1,78.4,42.1,70.8,54.6ZM126.3,152a28,28,0,0,0-3.9-7.7,26.3,26.3,0,0,0-11.9-9.5c-4.6-1.6-8.8-1.3-12,1s-5.5,8.3-4.3,14.4A82.6,82.6,0,0,1,126.3,152Z","M0,4L5,6.6L4,1.1L8.1,-2.9L2.5,-3.7L0,-8.8L-2.5,-3.7L-8.1,-2.9L-4,1.1L-5,6.6Z","M0,4L5,6.6L4,1.1L8.1,-2.9L2.5,-3.7L0,-8.8L-2.5,-3.7L-8.1,-2.9L-4,1.1L-5,6.6Z"],kp=[f.red,f.blue,f.green,f.yellow,f.green,f.teal,f.orange,f.purple],d0=["-30 -35 60 60","-35 -42 70 70","-35 -60 70 70","-45 -45 90 90","-15 -30 30 60","-75 28 150 100","-30 -35 60 60","-30 -35 60 60"],Lp=[.7,.6,.3,.6,.3,.6,.7,.7],da=class extends Z{constructor(t,e){super(Mt(Re(Mn[+t])),e);this.type="garden";this.options=t;let s=+t;this.$path.setAttr("d",Mn[s]),this.$outline.setAttr("d",Mn[s]);let n=c("path",{d:Cp[s],fill:"black",opacity:Lp[s]});this.$path.insertAfter(n),this.symmetric=!0,this.setColour(kp[s])}static makeThumbnail(t,e){let s=+t,r=c("svg",{width:s===4?40:s===5?120:80,height:80,viewBox:d0[s]},e),o=c("g",{transform:"scale(0.5)"},r);c("path",{d:Mn[s],fill:kp[s],class:"polygon-tile"},o),c("path",{d:Cp[s],fill:"black",opacity:Lp[s]},o)}};var f0=["M34,0a16,16,0,0,1,6.3-12.7l-9-15.7A34.1,34.1,0,0,0,16,0,34.1,34.1,0,0,0,31.3,28.4l9-15.7A16,16,0,0,1,34,0Z","M-25,9.3a33.7,33.7,0,0,0-15.2,3.6l9,15.7A14.4,14.4,0,0,1-25,27.3a16.1,16.1,0,0,1,15.9,14h18A34,34,0,0,0-25,9.3Z","M-25-9.3a33.7,33.7,0,0,1-15.2-3.6l9-15.7A14.4,14.4,0,0,0-25-27.3a16.1,16.1,0,0,0,15.9-14h18A34,34,0,0,1-25-9.3Z","M-8.9,41.3h18A16.1,16.1,0,0,1,25,27.3a14.4,14.4,0,0,1,6.2,1.3l9-15.7A33.9,33.9,0,0,0-8.9,41.3Z","M-31.3-28.4l-9,15.6A65.9,65.9,0,0,1-9.1,41.3h18A83.7,83.7,0,0,0-31.3-28.4Z","M-8.9,41.3h18A65.9,65.9,0,0,1,40.3-12.8l-9-15.6A83.7,83.7,0,0,0-8.9,41.3Z","M-40.3 12.9L-31.3 28.4L40.3 -12.9L31.3 -28.4Z","M-40.2,12.9l9,15.6A65.7,65.7,0,0,1,0,20.6a65.7,65.7,0,0,1,31.2,7.9l9-15.6A82.6,82.6,0,0,0,0,2.6,82.6,82.6,0,0,0-40.2,12.9Z","M31.3,28.4l9-15.6A65.9,65.9,0,0,1,9.1-41.3h-18A83.7,83.7,0,0,0,31.3,28.4Z"],m0=[[6,3,2],[6,4,8],[7,2,5],[7,5,2],[2,6,3],[8,6,4],[5,7,2],[2,7,5],[3,2,6],[4,8,6],[2,5,7],[5,2,7],[0,1,2],[0,2,1]],di="#242436",g0=[f.red,f.green,f.yellow];function Op(i,t){let e=m0[i].map((s,n)=>[s,n]).sort((s,n)=>n[0]-s[0]);for(let[s,n]of e)c("path",{d:f0[s],class:"tantrix","stroke-width":2.8,stroke:di,fill:g0[n]},t)}var fa=class extends Z{constructor(t,e){super("reg-hexagon",e);this.type="tantrix";this.options=t,this.setColour(di),Op(+t,this.$el)}setColour(t){super.setColour(t||di);for(let e of this.$el.$$(".tantrix"))e.setAttr("stroke",t||di)}static makeThumbnail(t,e){let s=c("svg",{width:60,height:60,viewBox:"-54 -54 108 108"},e);c("path",{class:"polygon-tile",path:$n("reg-hexagon"),fill:di},s),Op(+t,s)}};var mt=25,Ip={100:f.yellow,10:f.blue};function w0(i,t,e,s){let n=s.shift(i*e,0),r=n.shift(0,Math.floor(t/i)*e),o=s.shift(0,Math.ceil(t/i)*e),a=o.shift(t%i*e,0),h=a.shift(0,t%i?-e:0);return new O(s,n,r,h,a,o)}function Gp(i,t,e){return c("rect",{class:"number-tile",width:i,height:i,fill:e},t)}function Rp(i,t,e,s,n,r){i.setAttr("x",n+t%e*s),i.setAttr("y",r+Math.floor(t/e)*s)}var Sn=class extends I{constructor(t,e){super(e);this.type="number-tile";this.options=t;let[s,n]=t.split(":").map(r=>+r);this.count=n,this.colour=Ip[n]||f.red,this.$tiles=z(()=>Gp(mt,this.$el,this.colour),n),this.$outline=c("path",{class:"outline"},this.$el),n>1&&(this.$handle=this.makeHandle("h",r=>this.setWidth(Math.round(r.x/mt)))),this.setWidth(s,!0)}setWidth(t,e=!1){var s;if(t=L(t,1,this.count),t!==this.width){this.value=this.count,this.width=t,this.options=`${t}:${this.count}`;for(let n=0;n<this.count;++n)Rp(this.$tiles[n],n,t,mt,-mt/2,-mt/2);this.path=w0(t,this.count,mt,new p(-mt/2,-mt/2)),this.$outline.draw(this.path),(s=this.$handle)==null||s.setTransform(new p((t-.5)*mt,-mt/2)),this.transform(),e||this.$parent.selection.update()}}setColour(t){this.colour=t;for(let e of this.$tiles)e.setAttr("fill",D(t))}static makeThumbnail(t,e){let[s,n]=t.split(":").map(l=>+l);s=Math.min(s,n);let r=c("svg",{width:n===1?40:80,height:80},e),o=(n===1?20:40)-s/2*7,a=40-Math.ceil(n/s)/2*7,h=Ip[n]||f.red;for(let l=0;l<n;++l)Rp(Gp(7,r,h),l,s,7,o,a)}getSnapPoints(){let t=new p(-mt/2,-mt/2),e=[t];for(let n=1;n<=this.width;++n)e.push(t.shift(n*mt,0));let s=Math.ceil(this.count/this.width);for(let n=1;n<=s;++n)e.push(t.shift(0,n*mt));for(let n=0;n<this.count;++n)e.push(t.shift((n%this.width+1)*mt,Math.floor(n/this.width+1)*mt));return e}split(){if(this.count===1)return;let t=z(e=>{let s=e%this.width*mt,n=Math.floor(e/this.width)*mt,r=this.posn.shift(s,n).rotate(this.rot*lt,this.posn);return Np(1,1,this.$parent,r,this.rot,this.colour)},this.count);this.$parent.selection.select(t),this.delete()}static action(t,e){if(t==="split")for(let s of e)s.split();else if(t==="merge"){let s=Array.from(e),n=U(s.map(d=>d.count)),r=N(Ce(s,d=>d.count)),o=r.$parent,a=Math.min(...s.map(d=>d.posn.x)),h=Math.min(...s.map(d=>d.posn.y)),l=Math.max(...s.map(d=>Math.ceil((d.posn.x-a)/mt)+d.width)),u=Np(n,l,o,new p(a,h),r.rot,r.colour);for(let d of e)d.delete();o.selection.add(u)}}};function Np(i,t,e,s,n,r){let o=new Sn(`${t}:${i}`,e);return o.setColour(r),o.setTransform(s,n),o}var Dp=[f.yellow,"#f15e19","#e1343b",f.red,"#8d2ca1","#4e53d0",f.blue,f.teal,f.green,f.lime],qp=["#e6e2c6","#cc1030",f.green,f.red,"#ffd615",f.teal,"#181824","#9a2e13",f.blue,f.yellow],zp=25,ma=class extends Z{constructor(t,e){super(xn(+t*zp,zp),e);this.type="number-bar";this.options=t,this.value=+t,this.$text=c("text",{text:t,class:"polygon-label",y:6},this.$el),this.setColour((e.options.altColors?qp:Dp)[+t-1])}customTransform(){this.$text.css("transform",`rotate(${-this.rot}deg)`)}static makeThumbnail(t,e,s){let n=+t,r=new V(new p(1,1),n*20,20),o=c("svg",{width:n*20+2,height:22},e),a=c("path",{class:"polygon-tile",path:r},o);c("text",{html:t,class:"polygon-label",x:n*10+1,y:16},o),s.options.watch(h=>a.setAttr("fill",(h.altColors?qp:Dp)[n-1]))}};var Bp='<h3>Number Line</h3><label class="row"><div class="label">Start:</div><input class="input-field" type="number" :bind="start"></label><label class="row"><div class="label">Step Size:</div><input class="input-field" type="number" :bind="step" min="0"></label><label class="row"><div class="label">Width:</div><input class="input-field" type="number" :bind="size" min="1" max="25"></label><label class="row"><div class="label">Divisions:</div><input class="input-field" type="number" :bind="minor" min="1" max="25"></label>';var fi=25,ga=class extends I{constructor(t,e){super(e);this.type="number-line";this.$el.addClass("number-line"),this.$fill=c("path",{fill:"transparent"},this.$el),this.$lines=c("path",{class:"number-line-ticks"},this.$el),this.$labels=c("g",{},this.$el),this.setColour(f.darkGrey);let[s,n,r,o,a]=t.split(":").map(u=>+u),h={start:s,step:n,width:r,size:o,minor:a},l=e.bindSettingsPanel(this,Bp,h);this.$start=this.makeHandle("h",u=>{let d=Math.round(u.x/fi/l.size);!d||(this.setTransform(this.posn.shift(d*fi*l.size,0),this.rot),l.width-=d,l.start=$t(l.start+d*l.step,5))}),this.$start.setTransform({x:-fi,y:-2.5},Math.PI),this.$end=this.makeHandle("h",u=>{let d=u.x/fi/l.size;l.width=L(Math.round(d),1,100)}),l.watch(()=>{l.start=$t(l.start,4),l.step=$t(l.step,4),l.size=Math.round(l.size),l.minor=Math.round(l.minor),this.setDimensions(l)})}setDimensions({start:t,step:e,width:s,size:n,minor:r}){let o=`${t}:${e}:${s}:${n}:${r}`;if(o===this.options)return;this.options=o,this.$labels.removeChildren(),n*=fi;let a=`M0 10L${s*n} 10`;for(let h=0;h<=s*r;h+=1){let l=h*n/r,u=!(h%r),d=vt(t+h*e/r,4);a+=`M${l} ${u?0:5}L${l} ${u?20:15}`,u&&c("text",{text:d,x:l,y:40},this.$labels)}this.$lines.setAttr("d",a),this.$end.setTransform({x:s*n,y:-2.5}),this.linePoints=z(h=>new p(h*n,10),s+1),this.line=new _(new p(0,10),new p(s*n,10)),this.path=new V(A,s*n,44),this.$fill.draw(this.path),this.transform(),this.$parent.selection.update(),this.$parent.change()}getSnapPoints(){return this.linePoints}getSnapLines(){return[this.line]}customTransform(){for(let t of this.$labels.children)t.css("transform",`rotate(${-this.rot}deg)`)}setColour(t){super.setColour(t),this.$lines.setAttr("stroke",D(t)),this.$labels.setAttr("fill",D(t))}static makeThumbnail(t,e){let s=c("svg",{width:240,height:40,class:"number-line"},e),n="M20 10L220 10";for(let r=0;r<=10;r+=1){let o=20+r*20;n+=`M${o} 5L${o} 15`,c("text",{text:r,x:o,y:30},s)}c("path",{d:n,class:"number-line-ticks"},s)}};var _p=2*Math.PI;var mi=50,Hp={1:f.grey,2:f.yellow,3:f.green,5:f.blue,7:f.purple},y0="M0-xAx,x,0,0,0-x,0,x,x,0,0,0,0,x,x,x,0,0,0,x,0,x,x,0,0,0,0-xZM0,yAz,z,0,0,1-y,0,z,z,0,0,1,0-y,z,z,0,0,1,y,0,z,z,0,0,1,0,yZ";function Up(i,t,e=1){let s=i.y*t.x-i.x*t.y>0?e:1-e;return[i.x,i.y+"A"+i.length,i.length,0,s,e,t.x,t.y].join(",")}function Wp(i,t,e=mi){if(t===1)return y0.replace(/x/g,""+e).replace(/y/g,""+.4*e).replace(/z/g,""+(.4*e+.1));let s=_p/t,n=-Math.PI/2-s/2,r=p.fromPolar(n+s*i,e),o=p.fromPolar(n+s*(i+1),e);return`M${Up(r,o)}L${Up(o.scale(.4),r.scale(.4),0)}Z`}function Zp(i){return i===1?[1]:js(i).reverse()}var wa=class extends I{constructor(t,e){super(e);this.type="prime-disk";this.$segments=[];this.factors=[];this.path=new H(A,mi),c("circle",{class:"prime-background",r:mi},this.$el),this.$segmentWrap=c("g",{},this.$el),this.$label=c("text",{class:"prime-label",y:5},this.$el),this.$outline=c("path",{class:"outline",path:this.path},this.$el),this.setValue(+t)}setValue(t){t=this.value=L(Math.round(t),1,9999999),this.options=this.$label.text=""+t,this.factors=Zp(t);let e=this.factors.length;for(let s=0;s<e;++s){let n=this.getSegment(s);n.setAttr("fill",Hp[this.factors[s]]||f.red),n.setAttr("d",Wp(s,e)),n.show()}for(let s=e;s<this.$segments.length;++s)this.$segments[s].hide()}multiply(t){this.setValue(+this.options*t)}getSegment(t){if(this.$segments[t])return this.$segments[t];let e=c("path",{class:"polygon-tile"},this.$segmentWrap);return this.$parent.events.listen(e,{down:()=>{this.locked||this.$parent.selection.add(this,!this.$parent.events.shiftKey)},start:()=>{!this.isActive||(this.$parent.selection.add(this,!0),e.addClass("prime-move"),this.$parent.$activeTiles.append(e))},move:s=>{!this.isActive||(e.setTransform(this.posn.add(s.posn).subtract(s.startPosn)),this.setCollision(this.findNearbyTile(s.posn)))},end:s=>{if(!this.isActive)return;e.removeClass("prime-move"),e.setTransform(),this.$segmentWrap.append(e);let n=s.lastPosn.subtract(s.startPosn);if(n.length>mi){if(this.collision)this.collision.multiply(this.factors[t]),this.$parent.selection.add(this.collision,!0),this.setCollision();else{let r=this.$parent.newTile("prime-disk",""+this.factors[t]);r.setTransform(this.posn.add(n)),this.$parent.selection.add(r,!0)}this.setValue(+this.options/this.factors[t]),this.$parent.change()}},checkIfActive:()=>this.factors.length>1}),this.$segments[t]=e,e}setColour(t){if(this.colour=t,t)for(let e of this.$segments)e.setAttr("fill",D(this.colour))}findNearbyTile(t){for(let e of this.$parent.tiles)if(e!==this&&e.type==="prime-disk"&&p.distance(e.posn,t)<mi)return e}setCollision(t){this.collision&&t!==this.collision&&this.collision.$outline.removeClass("active"),this.collision=t,t&&t.$outline.addClass("active")}move(t){super.move(t),!(this.$parent.selection.tiles.size>1)&&this.setCollision(this.findNearbyTile(this.posn))}moveEnd(){this.collision&&(this.collision.multiply(+this.options),this.$parent.selection.add(this.collision,!0),this.setCollision(),this.delete())}static makeThumbnail(t,e){let s=c("svg",{width:54,height:54},e),n=c("g",{transform:"translate(27 27)"},s),r=o=>{n.removeChildren();let a=Zp(o);for(let h=0;h<a.length;++h){let l=Hp[a[h]]||f.red,u=Wp(h,a.length,25);c("path",{fill:l,d:u,class:"polygon-tile"},n),c("text",{text:o,y:4,fill:"white",style:"font-size: 11px; text-anchor: middle"},n)}};e.onAttr("data-options",o=>r(Math.round(+o)))}};var dt=25,ya=class extends I{constructor(t,e){super(e);this.type="decimal-grid";this.$handles=[];this.$tiles=c("g",{},this.$el),this.$outline=c("path",{class:"outline"},this.$el),this.$handles[0]=this.makeHandle("h",o=>this.setDimensions(o.x/dt,this.height,this.size)),this.$handles[1]=this.makeHandle("v",o=>this.setDimensions(this.width,o.y/dt,this.size)),this.$handles[2]=this.makeHandle("c",o=>this.setDimensions(this.width,this.height,(o.x+o.y)/2/dt)),this.$handles[1].css("cursor","ns-resize"),this.$handles[2].css("cursor","nwse-resize");let[s,n,r]=t.split(":");this.setDimensions(+s,+n,+r)}setDimensions(t,e,s){t=this.width=L(Math.round(t),1,100),e=this.height=L(Math.round(e),1,100),s=this.size=L(Math.round(s),2,Math.max(t,e));let n=[t,e,s].join(":");if(n===this.options)return;this.options=n,this.$tiles.removeChildren();let r=Math.floor(t/s)*s,o=Math.floor(e/s)*s,a=s*dt;for(let h=0;h<r;h+=s)for(let l=0;l<o;l+=s)this.drawRect(h*dt,l*dt,a,a,f.yellow);for(let h=r;h<t;++h)for(let l=0;l<o;l+=s)this.drawRect(h*dt,l*dt,dt,a,f.blue);for(let h=0;h<r;h+=s)for(let l=o;l<e;++l)this.drawRect(h*dt,l*dt,a,dt,f.blue);for(let h=r;h<t;++h)for(let l=o;l<e;++l)this.drawRect(h*dt,l*dt,dt,dt,f.red);this.$handles[0].setTransform({x:t*dt,y:0}),this.$handles[1].setTransform({x:0,y:e*dt}),this.$handles[2].setTransform({x:a,y:a}),this.path=new V(A,t*dt,e*dt),this.$outline.draw(this.path),this.$parent.selection.update(),this.transform()}drawRect(t,e,s,n,r){c("rect",{x:t,y:e,width:s,height:n,fill:this.colour||r,class:"polygon-tile"},this.$tiles)}setColour(t){this.colour=t;for(let e of this.$tiles.children)e.setAttr("fill",D(t))}static makeThumbnail(t,e){let s=c("svg",{width:140,height:80},e),n=(r,o,a,h,l)=>c("rect",{x:5+r,y:5+o,width:a,height:h,fill:l,class:"polygon-tile"},s);for(let r=0;r<2;++r)n(50*r,0,50,50,f.yellow);for(let r=0;r<3;++r)n(100+10*r,0,10,50,f.blue);for(let r=0;r<2;++r)for(let o=0;o<2;++o)n(50*r,50+o*10,50,10,f.blue);for(let r=0;r<3;++r)for(let o=0;o<2;++o)n(100+r*10,50+o*10,10,10,f.red)}};var Fp='<h3>Dot Machine</h3><label class="row"><div class="label">Base:</div><input class="input-field" type="number" :bind="base" min="2" max="25"></label><label class="row"><div class="label">Boxes:</div><input class="input-field" type="number" :bind="boxes" min="1" max="10"></label>';var va=class extends I{constructor(t,e){super(e);this.type="dot-machine";this.canRotate=!1;this.canDragToSelect=!1;this.cells=[];this.isAnimating=!1;let[s,n]=t.split(":").map(o=>+o),r={base:s,boxes:n};this.model=e.bindSettingsPanel(this,Fp,r),this.$outline=c("rect",{class:"outline",rx:12},this.$el),this.model.watch(()=>this.draw(this.model)),this.setColour(f.purple),this.onMove=()=>{let o=Array.from(e.selection.tiles).filter(a=>a.type==="dot");for(let a of this.cells)a.hover(o.some(h=>a.contains(h.posn)))},this.onMoveEnd=()=>{for(let o of this.cells)o.hover(!1)},e.on("move-selection",this.onMove),e.on("move-end",this.onMoveEnd),this.onChange=()=>this.rearrangeDots(),setTimeout(()=>{this.rearrangeDots(),e.on("change",this.onChange)})}delete(){this.$parent.off("move-selection",this.onMove),this.$parent.off("move-end",this.onMoveEnd),this.$parent.off("change",this.onChange),super.delete()}select(){this.isActive=!0,this.$outline.show();for(let t of this.cells)t.hover()}deselect(){this.isActive=!1,this.$outline.hide();for(let t of this.cells)t.hover(!1);this.$parent.$tiles.prepend(this.$el)}draw(t){let e=Math.round(t.base),s=Math.round(t.boxes);if(this.options=`${e}:${s}`,this.cells.length>s)for(let r=s;r<this.cells.length;++r)this.cells[r].delete(),this.cells=this.cells.slice(0,s);else if(this.cells.length<s)for(let r=this.cells.length;r<s;++r){let o=new jp(this,r);this.cells.push(o),o.setColour(this.colour)}for(let r of this.cells)r.setBase(e);let n=150*(s-1)+10;this.path=new V(new p(-n,-10),n+160,170),this.$outline.setRect(this.path),this.transform(),this.$parent.selection.update()}getSnapPoints(){return[]}setColour(t){super.setColour(t);for(let e of this.cells)e.setColour(t)}moveEnd(){super.moveEnd();for(let t of this.cells)for(let e of[...t.dots,...t.antiDots])e.cell=void 0}rearrangeDots(){if(!this.isAnimating){for(let t of this.cells)t.clear();for(let t of this.$parent.tiles)if(!(t.type!=="dot"||t.deleted))for(let e of this.cells)(t.cell===e||!t.cell&&e.contains(t.posn))&&e.addDot(t);for(let t of this.cells)t.rearrange()}}static makeThumbnail(t,e){let s=c("svg",{width:160,height:60},e);for(let n of[105,55,5])c("rect",{x:n,y:5,width:50,height:50,class:"dot-cell",stroke:"#eee",style:"stroke-width: 6px"},s),c("circle",{cx:n+25,cy:5,r:2},s),c("circle",{cx:n+25,cy:55,r:2},s)}static action(t,e){return S(this,null,function*(){if(t==="explode")for(let s of e)s.isAnimating||s.cells[0].explode();else if(t==="annihilate")for(let s of e)s.isAnimating||s.cells[0].annihilate()})}},jp=class{constructor(t,e=0){this.machine=t;this.index=e;this.dots=[];this.antiDots=[];let s=-150*e;this.$el=c("rect",{class:"dot-cell",width:150,height:150,x:s}),this.$label=c("text",{class:"dot-label",x:75+s,y:154,"font-size":"12px"},t.$el),this.$value=c("text",{class:"dot-label",x:75+s,y:6,text:0,"font-size":"18px"},t.$el),this.bounds=new V(new p(s,0),150,150),t.$el.prepend(this.$el)}setBase(t){this.$label.text=vt(Math.pow(t,this.index))}delete(){this.$el.remove(),this.$label.remove(),this.$value.remove()}setColour(t){this.$el.setAttr("stroke",t),this.machine.isActive&&this.$el.css("fill",t)}hover(t=!0){this.machine.isActive&&!t||this.$el.css("fill",t?this.machine.colour:"none")}contains(t){return this.bounds.translate(this.machine.posn).contains(t)}clear(){this.dots=[],this.antiDots=[]}addDot(t){(t.options==="1"?this.dots:this.antiDots).push(t),t.cell=this}rearrange(){this.$value.text=vt(this.dots.length-this.antiDots.length);let t=[...this.dots,...this.antiDots];if(!t.length)return;let e=Math.ceil(Math.sqrt(t.length)),s=Math.ceil(t.length/e),n=t.length<=16?30:t.length<=25?25:20,r=this.bounds.center.add(this.machine.posn).shift(-n*(e-1)/2,-n*(s-1)/2),o=z(a=>r.shift(a%e*n,Math.floor(a/e)*n),t.length);return this.animatePoints(t,o)}animatePoints(t,e){let s=t.map(n=>n.posn);for(let[n,r]of t.entries())r.setTransform(e[n]);return j(n=>{var r;for(let[o,a]of t.entries()){let h=p.interpolate(s[o],e[o],K("quad",n));a.$el.setTransform(h),a.transformed=(r=a.path)==null?void 0:r.translate(h)}this.machine.$parent.selection.update()},240).promise}getDotsToExplode(){let t=this.machine.model.base;if(this.dots.length>=t)return this.dots.splice(0,t);if(this.antiDots.length>=t)return this.antiDots.splice(0,t)}explode(){return S(this,null,function*(){let t=this.machine.cells[this.index+1];if(!t){this.machine.isAnimating=!1,this.machine.$parent.change();return}this.machine.isAnimating=!0;let e=this.getDotsToExplode();if(!e)return t.explode();t.addDot(e[0]);for(let s of e.slice(1))s.popOut();return t.rearrange(),yield ie(400),this.rearrange(),yield ie(400),this.explode()})}annihilate(){return S(this,null,function*(){this.machine.isAnimating=!0;let t=Math.min(this.dots.length,this.antiDots.length);if(t){let s=this.dots.splice(0,t),n=this.antiDots.splice(0,t);for(let r of[...s,...n])r.popOut();this.rearrange(),yield ie(600)}let e=this.machine.cells[this.index+1];if(e)return e.annihilate();this.machine.isAnimating=!1,this.machine.$parent.change()})}};var Tn=25/2,gi=class extends I{constructor(t,e){super(e);this.type="dot";this.deleted=!1;this.options=t,this.$path=c("circle",{r:Tn,class:"polygon-tile"},this.$el),this.$outline=c("circle",{r:Tn,class:"outline"},this.$el),this.path=new H(A,Tn),this.setColour(f.blue)}setColour(t){this.colour=t,this.$path.setAttr("fill",this.options==="-1"?f.red:this.colour)}getSnapPoints(){return[]}getCell(){for(let t of this.$parent.tiles)if(!(t.type!=="dot-machine"||t.isActive)){for(let e of t.cells)if(e.contains(this.posn))return e}}moveEnd(){let t=this.cell,e=this.cell=this.getCell();if(!t||!e||t===e||t.machine!==e.machine)return;let s=Math.abs(t.index-e.index),n=t.machine.model.base**s;if(t.index<e.index){let r=this.options==="1"?t.dots:t.antiDots;if(r.length<n)return this.cell=t;for(let o of r.filter(a=>!a.isActive).slice(0,n-1))o.popOut()}else for(let r=0;r<n-1;++r){let o=new gi(this.options,this.$parent);o.posn=this.posn,o.cell=e}}static makeThumbnail(t,e){let s=t==="1"?f.blue:f.red,n=c("svg",{width:40,height:40},e);c("circle",{class:"polygon-tile",cx:20,cy:20,r:Tn,fill:s},n)}negate(){this.options=this.options==="-1"?"1":"-1",this.setColour(f.blue)}popOut(){return S(this,null,function*(){this.deleted=!0,yield this.$path.exit("pop").promise,this.delete()})}static action(t,e){if(t==="negate")for(let s of e)s.negate()}};function Kp(i){return i===0?f.grey:i>0?i%2?f.orange:f.blue:i%2?f.red:f.teal}function Xp(i){return+i.replace("\u2013","-")}function Yp(i,t,e=40,s=50){t=L(Math.round(t),-9999,9999);let r=(i.text=vt(t)).length;return i.css("font-size",(r>=6?.625:r>=4?.75:1)*e+"px"),i.setAttr("y",(r>=6?.9:r>=4?.94:1)*s),t}var xa=class extends I{constructor(t,e){super(e);this.type="number-card";this.path=new V(A,75),this.$path=c("rect",{class:"polygon-tile",rx:10,width:75,height:75},this.$el),this.$label=c("text",{x:75/2,fill:"white",style:"text-anchor: middle"},this.$el),this.$outline=c("rect",{class:"outline",rx:10,width:75,height:75},this.$el),this.setValue(Xp(t))}setValue(t){this.value=Yp(this.$label,t),this.options=""+this.value,this.setColour()}setColour(t){super.setColour(t||Kp(this.value)),this.$path.setAttr("fill",D(this.colour))}findNearbyTile(t){for(let e of this.$parent.tiles)if(e!==this&&e.type==="number-card"&&p.distance(e.posn,t)<40&&Tt(e.value+this.value,-9999,9999))return e}setCollision(t){this.collision&&t!==this.collision&&this.collision.$outline.removeClass("active"),this.collision=t,t&&t.$outline.addClass("active")}move(t){super.move(t),!(this.$parent.selection.tiles.size>1)&&this.setCollision(this.findNearbyTile(this.posn))}moveEnd(){this.collision&&(this.collision.setValue(this.collision.value+this.value),this.$parent.selection.add(this.collision,!0),this.setCollision(),this.delete())}static makeThumbnail(t,e){let s=c("svg",{width:60,height:60},e),n=c("rect",{x:5,y:5,width:50,height:50,class:"polygon-tile",rx:5},s),r=c("text",{fill:"white",x:30,style:"text-anchor: middle"},s);e.onAttr("data-options",o=>{let a=Yp(r,Xp(o),30,39);n.setAttr("fill",Kp(a))})}};var Kt=50,wi=[f.yellow,"#f15e19","#e1343b",f.red,"#8d2ca1","#4e53d0",f.blue,"#0595bf","#0ba27b",f.green,"#8bba18","#dbc607"];function Vn(i,t,e,s,n=0){let r=c("g",{class:"fraction"},s);c("text",{text:1,x:t,y:.42*e+n},r),c("text",{text:i,x:t,y:2.5+.77*e+n},r);let o=i>=10?.2:.14;return c("line",{x1:t-o*e,y1:e/2+n,x2:t+o*e,y2:e/2+n},r),r}function Jp(i,t,e,s,n,r,o=-t/2,a=-t/2){let h=`translate(${i*s+o} ${a})`,l=c("g",{transform:h},n),u=c("rect",{width:i,height:t,fill:r,class:"polygon-tile"},l),d=Vn(e,i/2,t,l);return[l,u,d]}var ks=class extends I{constructor(t,e){super(e);this.type="fraction-bar";this.count=0;this.$parts=[];this.options=t;let[s,n]=t.split(":").map(r=>+r);this.denominator=s,this.tileWidth=10*Kt/s,this.colour=wi[s-1],this.$fraction=c("g",{},this.$el),this.$outline=c("path",{class:"outline"},this.$el),this.$handle=this.makeHandle("h",r=>this.setCount(Math.round(r.x/this.tileWidth))),this.setCount(n)}setCount(t){if(t=L(t,1,20),t!==this.count){if(this.value=t/this.denominator,t<this.count){for(let e=t;e<this.count;e+=1)this.$parts[e][0].remove();this.$parts=this.$parts.slice(0,t)}else for(let e=this.count;e<t;e+=1)this.$parts.push(Jp(this.tileWidth,Kt,this.denominator,e,this.$fraction,this.colour));this.count=t,this.options=`${this.denominator}:${t}`,this.path=new V(new p(-Kt/2,-Kt/2),t*this.tileWidth,Kt),this.$outline.draw(this.path),this.$handle.setTransform(new p(t*this.tileWidth-Kt/2,-Kt/2)),this.transform(),this.$parent.selection.update()}}setColour(t){this.colour=t;for(let e of this.$parts)e[1].setAttr("fill",D(t))}customTransform(){for(let t of this.$parts)t[2].css("transform",`rotate(${-this.rot}deg)`)}static makeThumbnail(t,e){let[s,n]=t.split(":").map(h=>+h),r=c("svg",{width:222,height:22},e),o=wi[s-1],a=220/s;for(let h=0;h<n;++h)Jp(a,20,s,h,r,o,1,1)}getSnapPoints(){let t=[];for(let e=0;e<=this.count;e+=1)t.push(new p(e*this.tileWidth-Kt/2,-Kt/2)),t.push(new p(e*this.tileWidth-Kt/2,Kt/2));return t}split(){if(this.count===1)return;let t=z(e=>{let s=this.posn.shift(e*this.tileWidth,0).rotate(this.rot*lt,this.posn),n=new ks(`${this.denominator}:${1}`,this.$parent);return n.setTransform(s,this.rot),n.setColour(this.colour),n},this.count);this.$parent.selection.select(t),this.delete()}static action(t,e){if(t==="split")for(let s of e)s.split();else if(t==="merge"){let s=Array.from(e),n=Math.min(...s.map(l=>l.posn.x)),r=Math.min(...s.map(l=>l.posn.y)),o=s.map(l=>l.count),a=U(o),h=new ks(`${s[0].denominator}:${a}`,s[0].$parent);h.setColour(q.mixMany(s.map(l=>q.from(l.colour)),o).hex),h.setTransform(new p(n,r),s[0].rot);for(let l of e)l.delete();s[0].$parent.selection.add(h)}}};var $a=100,ba=class extends I{constructor(t,e){super(e);this.type="fraction-circle";this.rotateAroundOrigin=!0;this.options=t;let s={class:"polygon-tile",path:this.path,fill:this.colour};this.$path=c("path",s,this.$el),this.$outline=c("path",{class:"outline",path:this.path},this.$el);let n=+t;if(this.value=1/n,n>1){let r=new p(0,-$a).rotate(-Math.PI/n),o=this.path=new $e(A,r,2*Math.PI/n);this.snapAngles=[0,_e(r)*_t,_e(o.end)*_t]}else this.path=new H(A,$a);if(this.$path.draw(this.path),this.$outline.draw(this.path),n>1){let r=-$a/2-25-(n-2)*2.5;this.$label=Vn(n,0,50,this.$el,r)}this.colour=wi[n-1],this.$path.setAttr("fill",this.colour)}customTransform(){var t;(t=this.$label)==null||t.css("transform",`rotate(${-this.rot}deg)`)}setColour(t){this.colour=t,this.$path.setAttr("fill",D(t))}static makeThumbnail(t,e){let s=+t,n=c("svg",{width:80,height:44},e),r=c("path",{class:"polygon-tile"},n),o=new p(40,2).rotate(-Math.PI/s,new p(40,42)),a=s>1?new $e(new p(40,42),o,2*Math.PI/s):new H(new p(40,22),20);if(r.draw(a),r.setAttr("fill",wi[s-1]),s>1){let h=c("g",{class:"fraction"},n);h.translate(40,12-s),Vn(s,0,25,h)}}};var v0={1:f.yellow,x:f.green,x2:f.blue},Qp={1:1,x:5,x2:25,"-1":-1,"-x":-5,"-x2":-25},yi=25,tu=yi*5.4,x0="#ddd";function En(i){return i.replace("-","\u2013").replace("2","\xB2")}function Pa(i){return i[0]==="-"?f.red:v0[i]}function $0(i){let t=R(i,"x2","-x2")?tu:yi,e=R(i,"1","-1")?yi:tu;return xn(t,e)}function b0(i){return i.type==="algebra-tile"}var Ma=class extends Z{constructor(t,e){super($0(t.toLowerCase()),e);this.type="algebra-tile";this.options=t.toLowerCase(),this.value=Qp[this.options],this.$text=c("text",{text:En(this.options),class:"polygon-label",y:6},this.$el),this.setColour(Pa(this.options))}setColour(t=this.colour){super.setColour(t),this.$path.setAttr("fill",D(this.collision?x0:this.colour)),this.$text.text=this.collision?"0":En(this.options)}customTransform(){this.$text.css("transform",`rotate(${-this.rot}deg)`)}setCollision(t){this.collision=t,this.setColour()}move(t){if(super.move(t),this.collision){if(p.distance(this.posn,this.collision.posn)<.95*yi)return;this.collision.setCollision(),this.setCollision()}let e=this.options[0]==="-"?this.options.slice(1):"-"+this.options;for(let s of this.$parent.tiles)if(!(!b0(s)||s.collision||s===this)&&s.options===e&&!(p.distance(this.posn,s.posn)>=.95*yi)){this.setCollision(s),s.setCollision(this);return}}static makeThumbnail(t,e){let s=R(t,"x2","-x2")?78:20,n=R(t,"1","-1")?20:78,r=R(t,"x2","-x2")?80:54,o=new V(new p((r-s)/2,40-n/2),s,n),a=c("svg",{width:r,height:80},e);c("path",{class:"polygon-tile",path:o,fill:Pa(t)},a),c("text",{text:En(t),class:"polygon-label",x:r/2,y:45},a)}negate(){this.options.startsWith("-")?this.options=this.options.slice(1):this.options="-"+this.options,this.value=Qp[this.options],this.setColour(Pa(this.options)),this.$text.text=En(this.options)}static action(t,e){if(t==="negate")for(let s of e)s.negate()}};var ce=25;function Sa(i,t,e,s,n){return new O(new p(-n,-n),new p(-n,i),new p(n,i),new p(n,-n),new p(t,-n),new p(t,n),new p(n,n),new p(n,e),new p(-n,e),new p(-n,n),new p(s,n),new p(s,-n))}var Ta=class extends I{constructor(t,e){super(e);this.type="grid";this.showSelectionOutline=!0;this.canDragToSelect=!1;this.options=t,this.dimensions=new p,this.$axes=z(()=>c("line",{class:"grid-axis",stroke:"#777"},this.$el),2),this.$fill=c("path",{fill:"transparent"},this.$el),this.$handles=[0,1].map(n=>this.makeHandle("c",r=>{let o=n?this.dimensions.x:Math.round(r.x/ce-1),a=n?Math.round(r.y/ce-1):this.dimensions.y;this.setDimensions(o,a)})),this.$handles[1].css("cursor","ns-resize");let s=t.split(":");this.setDimensions(+s[0],+s[1])}setDimensions(t,e){t=L(t,1,100),e=L(e,1,100),!(t===this.dimensions.x&&e===this.dimensions.y)&&(this.dimensions=new p(t,e),this.options=`${t}:${e}`,this.path=Sa(-1.5,t+1,e+1,-1.5,.5).scale(ce),this.$axes[0].setLine({x:-1.5*ce,y:0},{x:(t+1)*ce,y:0}),this.$axes[1].setLine({x:0,y:-1.5*ce},{x:0,y:(e+1)*ce}),this.$handles[0].setCenter({x:(t+1)*ce,y:0}),this.$handles[1].setCenter({x:0,y:(e+1)*ce}),this.$fill.draw(this.path),this.transform(),this.$parent.selection.update())}setColour(t){this.colour=t;for(let e of this.$axes)e.setAttr("stroke",D(t))}static makeThumbnail(t,e){let s=c("svg",{width:80,height:80},e);c("line",{x1:20,y1:0,x2:20,y2:80,stroke:"white","stroke-width":2},s),c("line",{x1:0,y1:20,x2:80,y2:20,stroke:"white","stroke-width":2},s)}};var An=new Map,Va=i=>i.type+i.options+i.colour,Ea=i=>{var t,e;return(e=(t=i.value)!=null?t:An.get(Va(i)))!=null?e:1};function P0(i,t){let e={},s=0,n=(h,l=1)=>{s+=l*Ea(h),h.value===void 0&&(e[Va(h)]=(e[Va(h)]||0)+l)};for(let h of i)n(h,1);for(let h of t)n(h,-1);if(T(s,0))return;let r=Object.keys(e).filter(h=>e[h]),o=r.filter(h=>!An.has(h))[0]||N(r);if(!o)return!0;let a=An.get(o)||1;An.set(o,a-s/e[o])}var Cn="M120,0C120,16,66.3,20,0,20S-120,16-120,0Z",eu="M0,26A18.1,18.1,0,0,0-18,44V72H18V44A18.1,18.1,0,0,0,0,26Z",su=["text","grid","number-line","spinner","decimal-grid","custom-spinner","ruler","protractor","compass","geo","dot-machine","axes"],kn=new V(new p(0,-180),240,180),es=15;function iu(i,t){var s;let e=i.posn.shift(0,t);i.$el.setTransform(e,i.rot*lt),i.transformed=(s=i.path)==null?void 0:s.rotate(i.rot).translate(e)}var Aa=class extends I{constructor(t,e){super(e);this.type="balance";this.canRotate=!1;this.canDragToSelect=!1;this.level=0;this.left=[];this.right=[];this.isAnimating=!1;this.level=+t||0,this.options=t||"0",this.$beam=c("path",{class:"balance-beam"},this.$el),this.$left=c("path",{d:Cn,class:"balance"},this.$el),this.$right=c("path",{d:Cn,class:"balance"},this.$el),this.$base=c("path",{d:eu,class:"balance"},this.$el),this.setColour("#bbb"),this.customTransform(),this.draw();let s=c("path",{path:kn,class:"balance-target"},this.$el),n=c("path",{path:kn,class:"balance-target"},this.$el);this.onMoveStart=()=>{if(!gh(e.selection.tiles,r=>su.includes(r.type))){s.setTransform({x:-280,y:this.level*es}),n.setTransform({x:40,y:-this.level*es});for(let r of[s,n])r.show()}},this.onMoveEnd=()=>{for(let r of[s,n])r.hide()},this.onChange=()=>{this.checkTileOverlaps(),this.rebalance()},e.on("move-start",this.onMoveStart),e.on("move-end",this.onMoveEnd),setTimeout(()=>{this.checkTileOverlaps(),e.on("change",this.onChange)})}delete(){this.$parent.off("move-start",this.onMoveStart),this.$parent.off("move-end",this.onMoveEnd),this.$parent.off("change",this.onChange),super.delete()}checkTileOverlaps(){let t=kn.translate(this.posn).shift(-280,this.level*es),e=kn.translate(this.posn).shift(40,-this.level*es);this.left=[],this.right=[];for(let s of this.$parent.tiles)!s.transformed||s.type==="balance"||su.includes(s.type)||(li(t,s.transformed)?this.left.push(s):li(e,s.transformed)&&this.right.push(s))}draw(t=this.level){let e=new p(-160,t*15),s=new p(160,-t*15);this.$beam.draw(new Pe(e.shift(0,10),e.shift(0,44),s.shift(0,44),s.shift(0,10))),this.$left.setTransform(e),this.$right.setTransform(s)}rebalance(t=400){return S(this,null,function*(){let e=U(this.left.map(a=>Ea(a))),s=U(this.right.map(a=>Ea(a))),n=T(e,s)?0:e<s?-1:1;if(n===this.level||this.isAnimating)return;let r=this.level,o=(n-r)*es;this.level=n,this.options=n.toString();for(let a of this.left)a.setTransform(a.posn.shift(0,o));for(let a of this.right)a.setTransform(a.posn.shift(0,-o));this.isAnimating=!0,yield j(a=>{this.draw(bt(r,n,a));for(let h of this.left)iu(h,(a-1)*o);for(let h of this.right)iu(h,(1-a)*o);this.$parent.selection.update()},t).promise,this.isAnimating=!1,this.transform(),this.$parent.selection.update()})}customTransform(){let t=this.level*es;this.path=new O(new p(-280,t),new p(-40,t),new p(-40,25),new p(40,25),new p(40,-t),new p(280,-t),new p(280,-t+48),new p(40,-t+48),new p(40,72),new p(-40,72),new p(-40,t+48),new p(-280,t+48))}getSnapPoints(){return[]}getSnapLines(){let t=this.level*es;return[new _(new p(-280,t),new p(-40,t)),new _(new p(40,-t),new p(280,-t))]}setColour(t){this.colour=t,this.$beam.css("stroke",t);for(let e of[this.$base,this.$left,this.$right])e.css("fill",D(t))}static makeThumbnail(t,e){let s=c("svg",{width:250,height:50,viewBox:"-290 -10 580 82",class:"scale"},e);c("path",{d:"M-160 10v34h320v-34",fill:"transparent",stroke:"#bbb","stroke-width":10},s),c("path",{d:Cn,transform:"translate(-160 0)",fill:"#bbb"},s),c("path",{d:Cn,transform:"translate(160 0)",fill:"#bbb"},s),c("path",{d:eu,fill:"#bbb"},s)}static action(t,e){return S(this,null,function*(){if(t==="balance")for(let s of e)P0(s.left,s.right)&&ji("balance-error"),s.rebalance()})}};var Ca={circle:"M -25 0a25,25 0 1 0 50 0a25 25 0 1 0 -50 0",square:"M0 -25L25 0L0 25L-25 0Z",cross:"M25 -9L9 -9L9 -25L-9 -25L-9 -9L-25 -9L-25 9L-9 9L-9 25L9 25L9 9L25 9L25 -9Z",weight:"M24.3,22.1,17.7-6.1A4,4,0,0,0,14-9H8a10.3,10.3,0,0,0,2-6A10,10,0,0,0,0-25,10,10,0,0,0-10-15,10.3,10.3,0,0,0-8-9h-6a4,4,0,0,0-3.7,2.9l-6.6,28.2A2.2,2.2,0,0,0-22,25H22A2.2,2.2,0,0,0,24.3,22.1ZM0-11a4,4,0,0,1-4-4,4,4,0,0,1,4-4,4,4,0,0,1,4,4A4,4,0,0,1,0-11Z",star:"M0 15.7L15.5 23.8L12.5 6.6L25 -5.6L7.7 -8.1L0 -23.8L-7.7 -8.1L-25 -5.6L-12.5 6.6L-15.5 23.8L0 15.7Z",heart:"M3.4,20.8a4.9,4.9,0,0,1-6.7-.1l-.3-.2C-16.7,8.6-25.3.8-25-8.9a13.7,13.7,0,0,1,5.9-10.7A14.4,14.4,0,0,1,0-16.8a14.4,14.4,0,0,1,19.1-2.8A13.7,13.7,0,0,1,25-8.9C25.3.8,16.7,8.6,3.6,20.5Z"},M0={weight:"M24.3,22.1,17.7-6.1A4,4,0,0,0,14-9H8a10.3,10.3,0,0,0,2-6A10,10,0,0,0,0-25,10,10,0,0,0-10-15,10.3,10.3,0,0,0-8-9h-6a4,4,0,0,0-3.7,2.9l-6.6,28.2A2.2,2.2,0,0,0-22,25H22A2.2,2.2,0,0,0,24.3,22.1Z"},nu={circle:f.orange,square:f.purple,cross:f.green,weight:f.blue,star:f.yellow,heart:f.red},ka=class extends Z{constructor(t,e){super("square",e);this.type="token";this.options=t,this.$path.setAttr("d",Ca[t]),this.$outline.setAttr("d",M0[t]||Ca[t]),this.setColour(nu[t])}static makeThumbnail(t,e){let s=c("svg",{width:36,height:36},e),n=c("path",{d:Ca[t],class:"polygon-tile"},s);n.setTransform({x:18,y:18},0,.6),n.setAttr("fill",nu[t])}};var ru='<h3>Coordinate System</h3><label class="row"><div class="label">X Step:</div><input class="input-field" type="number" :bind="xStep" min="0"></label><label class="row"><div class="label">Y Step:</div><input class="input-field" type="number" :bind="yStep" min="0"></label>';var gt=50,La=class extends I{constructor(t,e){super(e);this.type="axes";this.canRotate=!1;this.canDragToSelect=!1;this.functions=[];this.$fill=c("path",{fill:"transparent"},this.$el),this.$grid=c("path",{class:"axis-gridlines"},this.$el),this.$axes=c("path",{class:"grid-axis"},this.$el),this.$functions=c("g",{},this.$el),this.$labels=c("g",{class:"axis-labels"},this.$el),this.setColour(f.darkGrey),e.options.watch(d=>this.$grid.toggle(d.grid==="none"));let[s,n,r,o,a,h]=t.split(":").map(d=>+d),l={xMin:s,xMax:r,xStep:n,yMin:o,yMax:h,yStep:a},u=this.model=e.bindSettingsPanel(this,ru,l);this.$handles=[this.makeHandle("c",d=>u.xMin=L(Math.round(d.x/gt),-20,0)),this.makeHandle("c",d=>u.xMax=L(Math.round(d.x/gt),0,20)),this.makeHandle("c",d=>u.yMin=L(Math.round(-d.y/gt),-20,0)),this.makeHandle("c",d=>u.yMax=L(Math.round(-d.y/gt),0,20))];for(let d of[2,3])this.$handles[d].css("cursor","ns-resize");u.watch(()=>this.setSizes(u))}setSizes({xMin:t,xMax:e,yMin:s,yMax:n,xStep:r,yStep:o}){let a=`${t}:${r}:${e}:${s}:${o}:${n}`;if(a===this.options)return;this.options=a;let h=gt;this.$handles[0].setCenter({x:t*h,y:0}),this.$handles[1].setCenter({x:e*h,y:0}),this.$handles[2].setCenter({x:0,y:-s*h}),this.$handles[3].setCenter({x:0,y:-n*h}),this.$labels.removeChildren();let l="",u=`M${t*h} 0L${e*h} 0M0 ${-s*h}L0 ${-n*h}`;u+=`M0 ${-n*h-3}l5 8h-10ZM${e*h+3} 0l-8 5v-10Z`;for(let d=t+1;d<e;++d)!d||(u+=`M${d*h} 0L${d*h} 5`,l+=`M${d*h} ${-s*h}L${d*h} ${-n*h}`,c("text",{text:vt(d*r,4),x:d*h,y:21,"text-anchor":"middle"},this.$labels));for(let d=s+1;d<n;++d)!d||(u+=`M0 ${-d*h}L-5 ${-d*h}`,l+=`M${t*h} ${-d*h}L${e*h} ${-d*h}`,c("text",{text:vt(d*o,4),x:-10,y:-d*h+5,"text-anchor":"end"},this.$labels));this.$axes.setAttr("d",u),this.$grid.setAttr("d",l),this.path=Sa(-n*gt,e*gt,-s*gt,t*gt,15),this.$fill.draw(this.path);for(let d of this.functions)this.drawFunctions(d);this.transform(),this.$parent.selection.update(),this.$parent.change()}addFunction(t){this.functions.push(Pt.parse(t))}drawFunctions(t){let{xMin:e,xMax:s,yMin:n,yMax:r,xStep:o,yStep:a}=this.model,h=t.variables[0]||"x",l="",u=!1;for(let d=e;d<s;d+=.05){let m=d*gt,$=t.evaluate({[h]:d*o})/a*gt,k=Tt($,n*gt-.01,r*gt+.01);k&&(l+=(u?"L":"M")+`${m},${-$}`),u=k}c("path",{d:l,class:"geo-path",style:"color:red"},this.$labels)}getSnapPoints(){let{xMin:t,xMax:e,yMin:s,yMax:n}=this.model,r=[];for(let o=t;o<=e;++o)for(let a=s;a<=n;++a)r.push(new p(o*gt,-a*gt));return r}getSnapLines(){let{xMin:t,xMax:e,yMin:s,yMax:n}=this.model;return[new _(new p(t*gt,0),new p(e*gt,0)),new _(new p(0,-s*gt),new p(0,-n*gt))]}setColour(t){super.setColour(t);for(let e of[this.$axes,this.$labels])e.setAttr("fill",D(t));for(let e of[this.$axes,this.$grid])e.setAttr("stroke",D(t))}static makeThumbnail(t,e){let s=c("svg",{width:180,height:180},e);c("path",{d:"M30 10v160M60 10v160M120 10v160M150 10v160M10 30h160M10 60h160M10 120h160M10 150h160",class:"axis-gridlines",stroke:"white"},s),c("path",{d:"M10 90h160M90 10v160M90 8l4 6h-8ZM172 90l-6 4v-8Z",class:"grid-axis",fill:"white"},s)}};var S0=2*Math.PI,Oa=class{constructor(){this.translation=new Ee(0,0,0);this.rotation=new Ee(0,0,0);this.scale=new Ee(1,1,1)}},Ee=class{constructor(t,e,s){this.x=t;this.y=e;this.z=s}rotate(t){this.rotateProperty(t.z,"x","y"),this.rotateProperty(t.y,"x","z"),this.rotateProperty(t.x,"y","z")}rotateProperty(t,e,s){if(!t||T(t%S0,0))return;let n=Math.cos(t),r=Math.sin(t),o=this[e],a=this[s];this[e]=o*n-a*r,this[s]=a*n+o*r}equals(t){return T(this.x,t.x)&&T(this.y,t.y)&&T(this.z,t.z)}add(t){return this.x+=t.x||0,this.y+=t.y||0,this.z+=t.z||0,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}transform(t){return this.multiply(t.scale),this.rotate(t.rotation),this.add(t.translation),this}lerp(t,e){return new Ee(bt(this.x,t.x||0,e),bt(this.y,t.y||0,e),bt(this.z,t.z||0,e))}};var T0=new q(0,0,0);function V0(i){let t=i.r,e=i.c.x,s=i.c.y,n=.5523*t;return`M${e} ${s-t}C${e+n} ${s-t} ${e+t} ${s-n} ${e+t} ${s}C${e+t} ${s+n} ${e+n} ${s+t} ${e} ${s+t}C${e-n} ${s+t} ${e-t} ${s+n} ${e-t} ${s}C${e-t} ${s-n} ${e-n} ${s-t} ${e} ${s-t}`}var Ia=class{constructor(){this.transform=new Oa;this.visible=!0}},ss=class extends Ia{constructor(t,e={},s){super();this.children=[];this.sorting=!1;this.$el=c("g",e,s);for(let n of t)this.addChild(n)}addChild(t){t.parent&&t.parent.removeChild(t),this.children.push(t),this.$el&&t.$el&&this.$el.append(t.$el),t.parent=this}removeChild(t){let e=this.children.indexOf(t);e>=0&&this.children.splice(e,1),t.$el&&t.$el.remove(),t.parent=void 0}render(){if(!!this.visible){if(this.sorting)for(let t of Ce(this.children,e=>e.zIndex))this.$el.append(t.$el);for(let t of this.children)t.render()}}get zIndex(){return Xl(this.children.map(t=>t.zIndex))}},Ln=class extends Ia{constructor(t,e={}){super();this.path=t;this.backface=!0;this.perspective=120;this.commands=cr(t),this.$el=c("path",e)}getTransformed(t,e=0,s=!1){let n=new Ee(t.x,t.y,e),r=this;do s?n.rotate(r.transform.rotation):n.transform(r.transform);while(r=r.parent);return n}project(t){let e=Math.exp(t.z/this.perspective);return t.x*e+","+t.y*e}render(){if(!this.visible)return;if(!this.backface){let e=this.getTransformed(A,1).z>this.zIndex;if(this.$el.toggle(e),!e)return}if(this.color){let e=this.getTransformed(A,1,!0).z,s=q.mix(this.color,T0,(e+1)/2);this.$el.setAttr("fill",s),this.$el.setAttr("stroke",s)}let t=this.commands.map(e=>e.type+e.points.map(s=>this.project(this.getTransformed(s))).join(",")).join("");this.$el.setAttr("d",t)}get zIndex(){return this.getTransformed(A).z}},Ls=class extends Ln{constructor(t,e={}){super(st(t)?V0(t):Ys(t),e)}};var Nt=19,Ga=[[],[[0,0]],[[-.9,-.9],[.9,.9]],[[-1,-1],[0,0],[1,1]],[[-.9,-.9],[.9,-.9],[.9,.9],[-.9,.9]],[[-1,-1],[1,-1],[1,1],[-1,1],[0,0]],[[-.9,-1.1],[-.9,0],[-.9,1.1],[.9,-1.1],[.9,0],[.9,1.1]],[[0,-1.2],[0,0],[0,1.2],[1,-.6],[1,.6],[-1,-.6],[-1,.6]],[[0,-1.1],[0,1.1],[-1.1,-1.1],[-1.1,0],[-1.1,1.1],[1.1,-1.1],[1.1,0],[1.1,1.1]],[[0,-1.1],[0,0],[0,1.1],[-1.1,-1.1],[-1.1,0],[-1.1,1.1],[1.1,-1.1],[1.1,0],[1.1,1.1]]],E0=new V(new p(-Nt,-Nt),2*Nt,2*Nt),vi=[[0,0],[Math.PI/2,0],[Math.PI,0],[-Math.PI/2,0],[0,Math.PI/2],[0,-Math.PI/2]],Ra=["#656073",f.teal,f.blue,f.purple,f.red,f.orange,f.yellow,f.lime,f.green,f.teal],Na=class extends I{constructor(t,e){super(e);this.type="dice";this.isAnimating=!1;this.options=t;let[s,n]=t.split(":");this.faces=n||"1,2,3,4,5,6";let r=this.faces.split(",").map(o=>{let a=new Ls(E0,{class:"dice-face",fill:Ra[+o],stroke:Ra[+o]}),h=Ga[+o].map(l=>new Ls(new H(new p(l[0]*Nt/2,l[1]*Nt/2),4),{class:"dice-dot"}));for(let l of h)l.transform.translation.z=2;return new ss([a,...h])});r[0].transform.translation.z=Nt,r[1].transform.translation.x=-Nt,r[1].transform.rotation.y=Math.PI/2,r[2].transform.translation.y=Nt,r[2].transform.rotation.x=-Math.PI/2,r[3].transform.translation.y=-Nt,r[3].transform.rotation.x=Math.PI/2,r[4].transform.translation.x=Nt,r[4].transform.rotation.y=-Math.PI/2,r[5].transform.translation.z=-Nt,r[5].transform.rotation.y=Math.PI,this.die=new ss(r,{},this.$el),this.die.sorting=!0,this.setValue(+s||pt.integer(1,6)),this.path=new V(new p(-25,-25),50,50),this.$outline=c("path",{class:"outline",path:this.path},this.$el)}setColour(t){this.colour=t==="#000"||t==="#000000"?"":t;for(let e of this.die.children)e.children[0].color=D(this.colour);this.die.render()}setValue(t){this.value!==t&&(this.value=t,this.options=`${t}:${this.faces}`,this.die.transform.rotation.x=vi[t-1][0],this.die.transform.rotation.y=vi[t-1][1],this.die.render())}roll(t=2e3){return S(this,null,function*(){if(this.isAnimating)return;this.isAnimating=!0;let e=pt.integer(1,6),s=vi[this.value-1],n=4*Math.PI+vi[e-1][0]-s[0],r=4*Math.PI+vi[e-1][1]-s[1];yield j(o=>{let a=K("sine",o);this.die.transform.translation.z=4*a*(1-a)*Nt,this.die.transform.rotation.x=s[0]+a*n,this.die.transform.rotation.y=s[1]+a*r,this.die.render()},t).promise,this.setValue(e),this.isAnimating=!1})}static makeThumbnail(t,e){if(e.data.thumb==="net"){let s=c("svg",{width:58,height:76},e),n=t.split(":")[1].split(",").map(a=>+a),r=e.data.colour,o=[new p(20,2),new p(20,20),new p(20,38),new p(20,56),new p(2,20),new p(38,20)];for(let[a,h]of o.entries()){let l=r||Ra[+n[a]];c("path",{path:new V(h,18,18),class:"polygon-tile",fill:l},s);for(let u of Ga[n[a]])c("circle",{cx:h.x+9+u[0]*4.5,cy:h.y+9+u[1]*4.5,r:1.8,class:"dice-dot"},s)}}else{let s=c("svg",{width:60,height:60},e);c("rect",{x:6,y:6,width:48,height:48,rx:4,class:"polygon-tile",fill:f.orange},s);for(let n of Ga[5])c("circle",{cx:30+n[0]*12,cy:30+n[1]*12,r:4,class:"dice-dot"},s)}}static action(t,e,s,n){return S(this,null,function*(){if(t==="roll"){let r=Array.from(e);n.selection.clear(),yield Promise.all(r.map(o=>o.roll())),n.selection.select(r)}n.change()})}};var A0="M0 7.4L8.6 12L7 2.4L13.9 -4.4L4.3 -5.8L0 -14.5L-4.3 -5.8L-13.9 -4.4L-7 2.4L-8.6 12L0 7.4",ou="M12.9,9.7C13.9,3,4,5.3,4,1.2H4C9.4-3.7,7.6-14,.1-14.3S-9.3-3.9-4,1.3c-.1,3.8-9.8,1.9-8.9,8.4h0C-5.5,13.2,5.2,13.2,12.9,9.7Z",au=23,C0=[f.red,f.blue],k0=[A0,ou],Da=class extends I{constructor(t,e){super(e);this.type="coin";this.isAnimating=!1;let s=new H(A,au),n=C0.map((r,o)=>{let a=new Ls(s,{class:"dice-face",fill:r,stroke:r}),h=new Ln(k0[o],{class:"dice-dot"});return h.transform.translation.z=1,new ss([a,h])});n[0].transform.translation.z=.5,n[1].transform.rotation.x=Math.PI,n[1].transform.translation.z=-.5,this.coin=new ss(n,{},this.$el),this.coin.sorting=!0,this.setValue(t?+t:pt.integer(0,1)),this.path=new H(A,25),this.$outline=c("path",{class:"outline",path:this.path},this.$el)}setValue(t){this.value!==t&&(this.value=t,this.options=""+t,this.coin.transform.rotation.x=t?Math.PI:0,this.coin.render())}setColour(t){this.colour=t}roll(t=2e3){return S(this,null,function*(){if(this.isAnimating)return;this.isAnimating=!0;let e=pt.integer(0,1),s=this.value?Math.PI:0,n=6*Math.PI+(e?Math.PI:0)-s;yield j(r=>{let o=K("sine",r);this.coin.transform.translation.z=4*o*(1-o)*au,this.coin.transform.rotation.x=s+o*n,this.coin.transform.rotation.y=.4*Math.sin(o*8*Math.PI),this.coin.render()},t).promise,this.setValue(e),this.isAnimating=!1})}static makeThumbnail(t,e){let s=c("svg",{width:60,height:60},e);c("circle",{cx:30,cy:30,r:28,class:"polygon-tile",fill:f.blue},s),c("path",{d:ou,class:"dice-dot"},s).setTransform({x:30,y:30},0,1.2)}};var qa=75,xi=2*Math.PI,$i=Math.PI/2,On="M9.8-39.1,0-63-9.8-39.1-3-43V60a2.9,2.9,0,0,0,3,3,2.9,2.9,0,0,0,3-3V-43Z";function bi(i,t,e,s=qa,n=A){let r=e?q.shades(e,t.length):q.rainbow(t.length);i.removeChildren();for(let[o,a]of t.entries()){let h=t[o+1]?t[o+1]-a:xi-a+t[0],l=new $e(n,p.fromPolar(a-$i,s).add(n),h),u=r[o];c("path",{path:l,class:"polygon-tile",fill:u},i)}}var Pi=class extends I{constructor(t,e){super(e);this.type="spinner";this.angle=0;this.isAnimating=!1;this.path=new H(A,qa),this.$sectors=c("g",{},this.$el),this.$arrow=c("path",{d:On,class:"spinner"},this.$el),this.$outline=c("path",{class:"outline",path:this.path},this.$el),this.setupHandles(),c("circle",{r:4,class:"spinner"},this.$el),e.events.listen(this.$arrow,{move:({posn:r})=>{let o=this.relativePosn(r).angle()+$i;this.$arrow.setTransform(void 0,o)},end:({lastPosn:r})=>{let o=this.relativePosn(r).angle()+$i;this.setValue(o*_t)},click:()=>this.roll()}),this.$arrow.css("cursor","pointer");let[s,n]=t.split(":");this.drawSectors(+n),this.setValue(+s||0)}setupHandles(){this.$handle=this.makeHandle("c",t=>{let e=(t.angle()+$i)%xi;this.drawSectors(xi/e)}),this.$handle.css("cursor","move")}drawSectors(t){let e=L(Math.round(t),2,16);if(e===this.sectors)return;this.sectors=e,this.options=`${this.angle}:${e}`;let s=xi/e;bi(this.$sectors,z(n=>s*n,e),this.colour),this.$handle.setCenter(p.fromPolar(s-$i,qa))}setColour(t){this.colour=t;let e=this.$sectors.children,s=q.shades(t,e.length);for(let[n,r]of e.entries())r.setAttr("fill",s[n])}setValue(t){t=kt(Math.round(t),360),this.angle!==t&&(this.angle=t,this.options=`${t}:${this.sectors}`,this.$arrow.setTransform(void 0,this.angle*lt))}roll(t=2e3){return S(this,null,function*(){if(this.isAnimating)return;this.isAnimating=!0;let e=this.angle,s=(4+Math.random())*360;yield j(n=>{let r=bt(e,s,K("sine",n));this.$arrow.setTransform(void 0,r*lt)},t).promise,this.setValue(s),this.isAnimating=!1})}static makeThumbnail(t,e){let s=c("svg",{width:80,height:80},e),n=new p(40,40);bi(s,z(o=>xi/5*o,5),"",36,n),c("path",{d:On,class:"spinner"},s).setTransform(n,-.8,.5)}};var L0=2*Math.PI,za=Math.PI/2,Ba=75,_a=class extends Pi{constructor(t,e){super(`${t.split(":")[0]}:1`,e);this.type="custom-spinner";this.$handles=[];for(let s of t.split(":")[1].split(","))this.makeVertex(p.fromPolar(+s*lt-za,Ba))}setupHandles(){let t;this.$parent.events.listen(this.$outline,{down:({posn:e})=>t=this.makeVertex(this.relativePosn(e)),move:({posn:e})=>this.moveVertex(this.relativePosn(e),t),end:()=>this.$parent.change()}),this.$outline.css("cursor","crosshair")}drawSectors(){if(!this.$handles||this.$handles.length<2)return;let t=this.$handles.map(s=>(s.center.angle()+za)%L0).sort();this.sectors=t.map(s=>Math.round(s*_t)).join(",");let e=`${this.angle}:${this.sectors}`;e!==this.options&&(this.options=e,bi(this.$sectors,t,this.colour))}makeVertex(t){if(this.$handles.length>=24)return;let e=this.makeHandle("c",s=>{!e||(s.length>2*Ba?(this.deleteVertex(e),e=void 0):this.moveVertex(s,e))},()=>{e&&this.deleteVertex(e)});return e.setAttr("r",8),e.css("cursor","move"),this.$handles.push(e),this.moveVertex(t,e),e}deleteVertex(t){this.$handles.length<=2||(t.remove(),this.$handles.splice(this.$handles.indexOf(t),1),this.drawSectors())}moveVertex(t,e){if(!e)return;let s=Vt(t.angle()*_t,10)*lt;e.setCenter(p.fromPolar(s,Ba)),this.drawSectors()}static makeThumbnail(t,e){let s=c("svg",{width:80,height:80},e),n=new p(40,40),r=t.split(":")[1].split(",").map(a=>+a*lt);bi(s,r,"",36,n),c("path",{d:On,class:"spinner"},s).setTransform(n,.4,.5);for(let a of r){let h=p.fromPolar(a-za,36).add(n);c("circle",{cx:h.x,cy:h.y,r:3,fill:"white"},s)}}};var O0=ke(["#cd0e66","#0f82f2","#22ab24","#fd8c00"]),hu=class{constructor(t){this.index=t;this.color=O0();this.tilt=Math.floor(Math.random()*10)-10;this.tiltAngleIncrement=Math.random()*.07+.05;this.tiltAngle=0;this.x=Math.random()*w.width;this.y=(Math.random()-1)*w.height;this.r=pt.uniform(10,30)}draw(t){t.beginPath(),t.lineWidth=this.r/2,t.strokeStyle=this.color,t.moveTo(this.x+this.tilt+this.r/4,this.y),t.lineTo(this.x+this.tilt,this.y+this.tilt+this.r/4),t.stroke()}update(t,e){this.tiltAngle+=this.tiltAngleIncrement,this.y+=(Math.cos(t)+3+this.r/2)/2,this.x+=Math.sin(t),this.tilt=Math.sin(this.tiltAngle-this.index/3)*15,this.x<-20?(this.x=-20,this.y=Math.random()*w.height,this.tilt=Math.floor(Math.random()*10)-20):this.x>w.width+20?(this.x=w.width+20,this.y=Math.random()*w.height,this.tilt=Math.floor(Math.random()*10)-20):e&&this.y>w.height&&(this.x=Math.random()*w.width,this.y=-10,this.tilt=Math.floor(Math.random()*10)-20)}},I0="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999",is;function ns(i=2e3,t=150){is||(is=c("canvas",{style:I0},G)),is.setAttr("width",w.width),is.setAttr("height",w.height),is.show();let e=is.ctx,s=z(r=>new hu(r),t),n=j(r=>{e.clearRect(0,0,w.width,w.height);let o=r<i,a=0;for(let h of s)h.draw(e),h.update(r,o),h.y<w.height&&(a+=1);a||(n.cancel(),is.hide())})}var G0="M7,4,2.3-.3,6.6-5a1.2,1.2,0,0,0,0-1.5l-.4-.3a1,1,0,0,0-1.4,0L0-2.5-4.8-6.8a1,1,0,0,0-1.4,0l-.4.3A1.2,1.2,0,0,0-6.6-5L-2.3-.3-7,4a1.1,1.1,0,0,0-.1,1.4l1.5,1.4a.9.9,0,0,0,1.3,0L0,2.1,4.3,6.8a.9.9,0,0,0,1.3,0L7.1,5.4A1.1,1.1,0,0,0,7,4Z",lu="M7.7-5.7l-.2-.4-.3-.2c-.1-.1-.3,0-.4,0A36.6,36.6,0,0,0-3,2.1,36.1,36.1,0,0,0-7.8-.8h-.5l-1,.9a.4.4,0,0,0-.1.3c0,.2,0,.3.1.4a72.1,72.1,0,0,1,6.6,7h.4l.4-.2C1.9,1,3.8-1.8,7.5-5.2,7.7-5.3,7.7-5.5,7.7-5.7Z",cu={fill:"none",style:"touch-action: none",stroke:f.green},pu=class{constructor(t){this.$el=c("g",{});this.$ring=c("circle",lh({opacity:.6},cu),this.$el);this.$burst=c("path",cu,this.$el);this.$mark=c("g",{class:"problem-marker"},this.$el);this.$circle=c("circle",{r:13},this.$mark);this.$cross=c("path",{d:G0,fill:"white"},this.$mark);this.$check=c("path",{d:lu,fill:"white"},this.$mark);this.isAnimating=!1;t.append(this.$el)}show(t=!1,e=!0){this.$cross.toggle(!t),this.$check.toggle(t),this.$circle.setAttr("fill",t?f.green:f.red),this.$mark.addClass("show"),e&&t&&this.burst()}hide(){this.$mark.removeClass("show")}burst(t=1e3,e=60,s=20){return S(this,null,function*(){this.isAnimating||(this.isAnimating=!0,yield j(n=>{let r=K("sine-out",n);this.$ring.setAttr("r",.6*r*e),this.$ring.setAttr("stroke-width",.25*(1-r)*e);let o=K("exp-out",n),a=(.4+.6*o)*e,h=(.1+.9*o)*e,l="";for(let u=0;u<s;++u){let d=Math.cos(Math.PI*2*u/s),m=Math.sin(Math.PI*2*u/s);l+=`M${d*h} ${m*h}L${d*a} ${m*a}`}this.$burst.setAttr("d",l)},t).promise,this.isAnimating=!1)})}},Mi=class extends I{constructor(t,e){super(e);this.type="question-blank";this.size=100;this.canRotate=!1;this.keepOnTop=!0;this.solution="";this.submitted="";this.attempts=0;this.correct=!1;this.focussed=!1;this.colour=e.penColour,this.options=t||"Pw::0";let[s,n,r]=this.options.split(":");this.solution=atob(s),this.submitted=n,this.attempts=+r||0,this.$box=c("rect",{class:"problem-box",rx:6},this.$el),this.$text=c("text",{class:"problem-text",text:this.text,y:36},this.$el),this.mark=new pu(this.$el),this.$input=c("input",{class:"problem-text"},e.$html),this.$input.onKeyDown("enter",()=>this.$input.blur()),this.$input.on("blur",()=>this.blur()),this.$parent.options.canEditQuestions?(this.$handle=this.makeHandle("c",o=>this.setSize(o.x)),this.$handle.css("cursor","ew-resize")):(this.$input.setInputPattern(this.solution),this.checkAnswer(!1),this.canMove=!1),this.setSize(100)}setSize(t){var e;super.setSize(Vt(L(t,50,400),25)),this.path=new V(A,this.size,50),this.$input.css({width:this.size+"px",height:"50px"}),this.$box.setRect(this.path),this.$text.setAttr("x",this.size/2),this.mark.$el.setTransform({x:this.size,y:0}),(e=this.$handle)==null||e.setCenter({x:this.size,y:50}),this.transform()}delete(){super.delete(),this.$input.remove()}get text(){return(this.$parent.options.canEditQuestions?this.solution:this.submitted)||"?"}click(){this.focussed||this.$parent.events.shiftKey||this.correct&&!this.$parent.options.canEditQuestions||(this.focussed=!0,this.$parent.selection.add(this,!0),setTimeout(()=>{this.$el.removeClass("correct incorrect"),this.mark.hide()}),this.$input.css({top:this.posn.y+"px",left:this.posn.x+"px"}),this.$input.value=this.text,this.$text.hide(),this.$input.show(),this.$input.focus(),document.execCommand("selectAll",!1))}blur(){if(!this.focussed)return;this.focussed=!1,this.$input.hide(),this.$text.show();let t=this.text,e=this.$input.value.trim();this.$parent.options.canEditQuestions?(this.solution=e,this.options=`${btoa(e)}::0`):(e&&e!==this.submitted&&(this.attempts+=1),this.submitted=e==="?"?"":e,this.options=`${btoa(this.solution)}:${e}:${this.attempts}`,setTimeout(()=>{this.checkAnswer(),Mi.gradeWorksheet(this.$parent)})),this.$text.text=this.text,this.text!==t&&this.$parent.change()}isCorrect(){if(!this.submitted||!this.solution)return!1;if(this.submitted.toLowerCase()===this.solution.toLowerCase())return!0;let t=Fs(this.solution),e=Fs(this.submitted);return T(e,t)||Ps(t)===this.submitted||this.solution===Ps(e)}checkAnswer(t=!0){this.correct=this.isCorrect(),this.submitted&&this.mark.show(this.correct,t),this.$el.setClass("correct",this.correct),this.$el.setClass("incorrect",!!this.submitted&&!this.correct)}static gradeWorksheet(t){let e=[0,0,0,0];for(let s of t.tiles)s.type==="question-blank"&&(e[0]+=1,!!s.submitted&&(e[s.correct?s.attempts<=1?1:2:3]+=1));e[0]===e[1]+e[2]&&ns()}static makeThumbnail(t,e){let s=c("svg",{width:130,height:70},e);c("rect",{x:15,y:15,width:100,height:50,class:"problem-box",rx:6},s),c("text",{x:65,y:50,text:"?",class:"problem-text"},s),c("circle",{cx:115,cy:15,r:13,fill:f.blue},s),c("path",{d:lu,fill:"white",transform:"translate(115 15)"},s)}};var uu=Li(qi),Ha=class extends I{constructor(t,e){super(e);this.type="image";this.path=new V(A,0,0);this.aspectRatio=1;this.options=t,this.$image=c("image",{href:t,crossorigin:"anonymous"},this.$el),this.$outline=c("path",{class:"outline"},this.$el),uu(t).then(s=>{this.aspectRatio=s.height/s.width,this.setSize(this.size||s.width)}),this.$handle=this.makeHandle("c",s=>this.setSize(s.x)),this.$handle.css("cursor","nwse-resize")}setHref(t){this.options=t,this.$image.setAttr("href",t),uu(t)}setSize(t){let e=Math.max(50,50*this.aspectRatio),s=Math.min(1e3,1e3/this.aspectRatio);this.size=L(t,e,s),this.$image.setAttr("width",this.size),this.$image.setAttr("height",this.aspectRatio*this.size),this.path=new V(A,this.size,this.aspectRatio*this.size),this.$outline.draw(this.path),this.$handle.setCenter({x:this.size,y:this.aspectRatio*this.size}),this.transform(),this.$parent.selection.update()}};var Ua=class extends I{constructor(t,e){super(e);this.type="text";this.size=0;this.keepOnTop=!0;this.focussed=!1;this.timeout=0;this.$box=c("rect",{fill:"transparent"},this.$el),this.$text=c("text",{class:"text-tile"},this.$el),this.$outline=c("path",{class:"outline"},this.$el),this.setColour(e.penColour),this.updateText(t||"Text"),this.$parent.$textEdit.on("blur",()=>this.blur())}setSize(t){super.setSize(L(t,-5,10)),this.$text.css("font-size",this.fontSize),this.updateOutline(),this.transform()}get fontSize(){return 20*1.2**this.size}static action(t,e,s,n){return S(this,null,function*(){if(t==="larger")for(let r of e)r.setSize(r.size+1);else if(t==="smaller")for(let r of e)r.setSize(r.size-1);n.selection.update(),n.change()})}getSnapPoints(){return[]}click(){let t=Date.now();t-this.timeout<500&&this.focus(),this.timeout=t}updateOutline(){let t=this.$text.children,e=t.map(o=>o._el.getComputedTextLength()),s=Math.ceil(Math.max(...e)),n=1.4*this.fontSize,r=n*t.length;for(let[o,a]of t.entries())a.setAttr("dy",n-(o?0:(this.fontSize-5)/3));this.path=new V(A,s+16,r+4),this.$box.setRect(this.path),this.$outline.draw(this.path)}updateText(t){this.options=t,this.$text.removeChildren();for(let e of t.split(`
`))c("tspan",{x:8,text:e},this.$text);this.updateOutline(),this.transform()}setColour(t){this.colour=t,this.$text.setAttr("fill",D(this.colour))}focus(){if(this.focussed)return;this.focussed=!0,this.$parent.selection.clear();let t=this.posn.subtract(this.$parent.origin).scale(this.$parent.zoom);this.$parent.$textEdit.setTransform(t,this.rot*lt,this.$parent.zoom),this.$parent.$textEdit.text=this.options||"",this.$parent.$textEdit.css("color",this.colour),this.$parent.$textEdit.css("font-size",this.fontSize+"px"),this.$text.hide(),this.$parent.$textEdit.show(),this.$parent.$textEdit.focus(),document.execCommand("selectAll",!1)}blur(){if(!this.focussed)return;this.focussed=!1,this.$parent.$textEdit.hide();let t=this.$parent.$textEdit.text.trim(),e=this.options!==t;t?(this.$text.show(),this.updateText(t),this.$parent.selection.add(this)):this.delete(),e&&this.$parent.change()}};var Wa=class extends I{constructor(t,e){super(e);this.type="equation";this.focussed=!1}};function Si(i){switch(i){case"number-bar":return ma;case"number-tile":return Sn;case"polygon":return Z;case"pentomino":return ia;case"tangram":return na;case"fraction-bar":return ks;case"fraction-circle":return ba;case"text":return Ua;case"algebra-tile":return Ma;case"grid":return Ta;case"custom-polygon":return ea;case"image":return Ha;case"dice":return Na;case"coin":return Da;case"number-line":return ga;case"penrose":return ra;case"kolam":return oa;case"prime-disk":return wa;case"balance":return Aa;case"decimal-grid":return ya;case"spinner":return Pi;case"custom-spinner":return _a;case"token":return ka;case"egg":return aa;case"geo":return ct;case"fractal":return la;case"ruler":return ca;case"protractor":return pa;case"compass":return ua;case"dot-machine":return va;case"dot":return gi;case"garden":return da;case"tantrix":return fa;case"axes":return La;case"question-blank":return Mi;case"equation":return Wa;case"number-card":return xa}throw Error(`Unknown tile type: ${i}`)}var Ti=Math.PI/180,du,fu,In=new Set,Za=new Set;function R0(i,t,e){let s=kt(i-t,e);return s>e/2?s-e:s}function N0(i,t){for(let e of i)if(t(e))return!0;return!1}var Fa=class{constructor(t){this.$parent=t;this.angle=0;this.startAngle=0;this.hasChanged=!1;this.isMoving=!1;this.tiles=new Set;this.$tools=t.$(".transform-tools"),this.$rect=this.$tools.$(".group-outline"),this.$rotateBar=this.$tools.$(".rotate-bar"),this.$rotateCircle=this.$tools.$(".rotate-circle"),t.events.listen(this.$rotateCircle,{start:()=>{this.startAngle=this.angle,this.rotateStart()},move:({startPosn:e,posn:s})=>{this.rotate(this.startAngle-new yt(s,this.center,e).deg)},end:()=>this.rotateEnd()}),w.onKey("up down left right r R",(e,s)=>{if(!this.tiles.size)return;if(s==="r"||s==="R"){if(Array.from(this.tiles).some(l=>!l.canRotate))return;this.rotateStart(),this.rotate(this.angle+(s==="R"?-15:15)),this.rotateEnd();return}let n=A,r=this.$parent.events.shiftKey?5:25,o=s==="left"?-r:s==="right"?r:0,a=s==="up"?-r:s==="down"?r:0,h=n.shift(o,a);this.moveStart(),this.move({posn:h,startPosn:n}),this.moveEnd()}),w.onKey("escape",()=>this.clear())}get size(){return this.tiles.size}add(t,e=!1,s=!1){e&&this.clear(),t.isActive||this.select([t],s)}select(t,e=!1){for(let s of t)s.isActive||(this.tiles.add(s),s.select(),this.hasChanged=!0);e||this.update(!0)}remove(t,e=!1){!t.isActive||(t.deselect(),this.hasChanged=!0,this.tiles.delete(t),e||this.update(!0))}copy(t=!1,e=25){if(!this.$parent.options.canCopy||!this.tiles.size)return;let s={},n=Array.from(this.tiles).map(r=>r.copy(s,e));this.clear();for(let r of n)this.add(r);t||this.$parent.change()}delete(){if(!(!this.$parent.options.canDelete||!this.tiles.size)){for(let t of this.tiles)t.delete();ct.computeIntersections(this.$parent),this.$parent.change(),this.$parent.newTileShift=0}}clear(){for(let t of this.tiles)t.deselect();this.tiles.size&&(this.hasChanged=!0),this.tiles.clear(),this.update(!0)}getTileProperty(t){if(!this.size)return;let e=Array.from(this.tiles),s=t(e[0]);return e.slice(1).some(r=>t(r)!==s)?void 0:s}update(t=!1){if(t&&!this.hasChanged)return;if(this.hasChanged=!1,!this.size){this.$tools.hide(),this.$parent.trigger("change-selection",{tiles:[],color:void 0});return}let e=Array.from(this.tiles);this.angle=this.getTileProperty(h=>h.rot)||0;let s=Xe(...e.map(h=>h.transformed.rotate(-this.angle*Ti))),n=s.p.shift(s.w/2,s.h/2).rotate(this.angle*Ti).shift(-s.w/2,-s.h/2);this.rect=new V(n,s.w,s.h),this.center=this.rect.center;let r=!!this.$parent.options.canRotate&&e.every(h=>h.canRotate);if(e.length===1&&st(e[0].transformed)&&(r=!1),r&&this.getTileProperty(h=>h.rotateAroundOrigin)){let h=e[0].posn;e.slice(1).every(l=>l.posn.equals(h))&&(this.center=h,this.angle&&e.length===1&&(this.rect=Xe(e[0].transformed.rotate(-this.angle*Ti,h))))}this.$rotateBar.toggle(r),this.$rotateCircle.toggle(r);let o=this.getTileProperty(h=>h.hideSelectionOutline);o||this.positionTools(),this.$rect.toggle(this.size>1||e[0].showSelectionOutline),this.$tools.toggle(!o);let a=this.getTileProperty(h=>h.colour);this.$parent.trigger("change-selection",{tiles:e,color:a})}positionTools(){this.$rect.draw(this.rect.rotate(this.angle*Ti,this.center));let t=new p(this.center.x,this.rect.p.y),e=new _(t,t.shift(0,-28)).rotate(this.angle*Ti,this.center);this.$rotateBar.setLine(e.p1,e.p2),this.$rotateCircle.setCenter(e.p2)}moveStart(){for(let t of this.tiles)if(!t.canMove)return;this.isMoving=!0;for(let t of this.tiles)t.moveStart();this.startSnapPoints=[];for(let t of this.tiles)for(let e of t.snapPoints)this.startSnapPoints.some(s=>e.equals(s))||this.startSnapPoints.push(e);fu=this.rect,du=this.center,this.$parent.newTileShift=0,this.$parent.trigger("move-start")}move({posn:t,startPosn:e}){if(!this.isMoving)return;let s=t.subtract(e),n=this.startSnapPoints.map(a=>a.add(s)),r=this.$parent.snap(n);r&&(s=s.add(r.shift));let o=this.tiles.size===1?r==null?void 0:r.target:void 0;for(let a of this.tiles)a.move(s,o);this.rect=fu.translate(s),this.center=du.add(s),this.positionTools(),this.$parent.trigger("move-selection")}moveEnd(){if(!!this.isMoving){for(let t of this.tiles)t.transform(),t.moveEnd();ct.computeIntersections(this.$parent),this.$parent.trigger("move-end"),this.$parent.change(),this.isMoving=!1}}rotateStart(){Za.clear();for(let t of this.tiles)for(let e of t.snapAngles)Za.add(kt(e+t.rot,180));In.clear(),In.add(0);for(let t of this.$parent.tiles)if(!t.isActive&&!!N0(this.tiles,e=>p.distance(e.posn,t.posn)<140))for(let e of t.snapAngles)In.add(kt(e+t.rot,180));this.$parent.newTileShift=0}rotate(t){if(t=Vt(t,3),t===this.angle)return;let e=Infinity;for(let n of Za)for(let r of In){let o=R0(r,n+t-this.startAngle,180);Math.abs(o)<Math.abs(e)&&(e=o)}if(Math.abs(e)<8&&(t+=e),t===this.angle)return;let s=t-this.angle;this.angle=t;for(let n of this.tiles)n.posn=n.posn.rotate(s*Math.PI/180,this.center),n.rot=kt(n.rot+s,360),n.transform(!0);this.positionTools(),this.$parent.trigger("rotate-selection")}rotateEnd(){for(let t of this.tiles)t.transform();this.$parent.change()}action(t,e){if(e==="copy")return this.copy();if(e==="delete")return this.delete();Si(t.split(" ")[0]).action(e,this.tiles,this.center,this.$parent),this.$parent.change()}};var D0=5,rs=class{constructor(t){this.$parent=t}getTileAt(t,e=!0){var r,o;let s=this.$parent.snap([t.posn],e,!0,"geo");if(((o=(r=s==null?void 0:s.target)==null?void 0:r.tile)==null?void 0:o.type)==="geo")return s.target.tile;let n=t.event.target;for(;n;){let a=vn.get(n);if(a&&!a.locked&&a.type!=="geo")return a;if(n=n.parentNode||void 0,n===this.$parent._el)return}}hoverGeoTile(t){var e;this.hoveringTile!==t&&((e=this.hoveringTile)==null||e.hover(!1)),t==null||t.hover(),this.hoveringTile=t}down(t){}start(t){}move(t){}end(t){}click(t){}hover(t){}cancel(){}},ja=class extends rs{constructor(){super(...arguments);this.name="move"}down(t){let e=this.activeTile=this.getTileAt(t,!1);this.previousSelection=void 0,e?(e.isActive&&this.$parent.events.shiftKey?this.$parent.selection.remove(e):(this.$parent.events.shiftKey||!e.isActive)&&this.$parent.selection.add(e,!this.$parent.events.shiftKey),ft.addClass("grabbing")):this.$parent.events.shiftKey?this.previousSelection=new Set(this.$parent.selection.tiles):this.$parent.selection.clear()}start(){this.activeTile?(this.$parent.events.altKey&&this.$parent.selection.copy(!0,0),this.$parent.selection.moveStart()):this.$parent.$selection.show()}move(t){var s;if(this.activeTile){this.$parent.selection.move(t);return}let e=V.aroundPoints([t.startPosn,t.posn]);this.$parent.$selection.setRect(e);for(let n of this.$parent.tiles){if(n.locked||!n.canDragToSelect||!n.transformed)continue;let r=li(e,n.transformed,n.type);(this.$parent.events.shiftKey&&((s=this.previousSelection)==null?void 0:s.has(n))?!r:r)?this.$parent.selection.add(n,!1,!0):this.$parent.selection.remove(n,!0)}this.$parent.selection.update(!0)}end(){this.activeTile?this.$parent.selection.moveEnd():this.$parent.$selection.hide(),ft.removeClass("grabbing")}click(t){this.activeTile?this.activeTile.click(t):this.$parent.selection.clear()}hover(t){let e=this.getTileAt(t,!1);this.hoverGeoTile((e==null?void 0:e.type)==="geo"?e:void 0),this.$parent.$svg.css("cursor",(e==null?void 0:e.locked)?"pointer":e?"grab":"")}},Ka=class extends rs{constructor(){super(...arguments);this.erased=0;this.name="eraser"}down({posn:t}){this.erase(t)}move({posn:t,lastPosn:e}){let s=p.distance(t,e)/4;for(let n=0;n<s;++n)this.erase(p.interpolate(t,e,n/s))}shouldErase(t,e,s){return ut(e)?p.distance(e,t)<10:at(e)?e.distanceSquared(t)<100:st(e)&&s==="geo"?Math.abs(p.distance(t,e.c)-e.r)<10:e.contains(t)}erase(t){for(let e of this.$parent.tiles)if(!(!e.transformed||!e.canDragToSelect)&&this.shouldErase(t,e.transformed,e.type)){e.delete(),this.erased+=1;return}for(let e of this.$parent.strokes)if(e.hitTest(t,10)){e.delete(),this.erased+=1;return}}end(){this.erased&&this.$parent.change(),this.erased=0}},Xa=class extends rs{constructor(){super(...arguments);this.name="text"}down({posn:t}){let e=this.$parent.newTile("text","");e.setTransform(t.shift(-10,-15)),this.$parent.trigger("add-tile",{tile:e}),e.focus()}},Ya=class extends rs{constructor(){super(...arguments);this.name="pan"}enable(){this.previousTool=this.$parent.activeTool.name,this.$parent.setActiveTool("pan")}down(t){this.initialOrigin=this.$parent.origin,this.startPosn=It(t.event)}move(t){let e=It(t.event).subtract(this.startPosn),s=this.initialOrigin.subtract(e.scale(1/this.$parent.zoom));this.$parent.setViewport(s,this.$parent.zoom)}end(){this.$parent.setActiveTool(this.previousTool)}click(){this.end()}},Gn=class extends rs{constructor(){super(...arguments);this.name="pen";this.brush="pen"}getUtensil(t){for(let e of this.$parent.tiles.values()){if(!e.transformed||!Ap(e))continue;let s=e.transformed.project(t);if(p.distance(t,s)<30)return e.transformed}}getPoint(t){if(this.brush==="straight"){let e=this.$parent.snap([t]);return e?t.add(e.shift):this.startPoint?t.snap(this.startPoint,D0):t}else return this.utensil?this.utensil.project(t):t}down({posn:t}){this.utensil=this.getUtensil(t),this.startPoint=this.getPoint(t),this.stroke=new Je(this.$parent,[this.startPoint],this.$parent.penColour,this.brush)}move({posn:t}){let e=this.getPoint(t);this.brush==="straight"?this.stroke.setLine(new _(this.startPoint,e)):this.stroke.addPoint(this.getPoint(e))}end(){var t;this.brush==="straight"?(t=this.stroke)==null||t.makeSnapPoints():this.stroke.simplify(),this.stroke=this.startPoint=this.utensil=void 0,this.$parent.change()}},Rn=class extends rs{constructor(){super(...arguments);this.name="geo";this.type="line"}expr(t,e){switch(this.type){case"line":return`segment(${t},${e})`;case"circle":return`circle(${t},distance(${t},${e}))`;case"rect":return`rectangle(${t},${e}.x-${t}.x,${e}.y-${t}.y)`}}snapPoint(t){var r,o,a,h;let e=this.$parent.snap([t]);e&&(t=t.add(e.shift));let s="",n=((o=(r=e==null?void 0:e.target)==null?void 0:r.tile)==null?void 0:o.type)==="geo"?(a=e==null?void 0:e.target)==null?void 0:a.tile:void 0;return(n==null?void 0:n.path)&&ut(n.path)&&(s=n.id),((h=e==null?void 0:e.target)==null?void 0:h.intersection)&&(s=e.target.intersection.expr),{point:t,tile:n,expr:s||`point(${t.x},${t.y})`}}getOrMakePointTile(t){var s,n;if(((s=t==null?void 0:t.tile)==null?void 0:s.path)&&ut(t.tile.path))return t.tile;if((n=t==null?void 0:t.tile)==null?void 0:n.path){let r=Fe(t.tile.path,t.point),o=new ct(`${t.tile.id}.at(${r})`,this.$parent);return this.$parent.trigger("add-tile",{tile:o}),o}let e=new ct(t.expr,this.$parent);return this.$parent.trigger("add-tile",{tile:e}),e}drawPendingPoint(t){var n,r;let e=((r=(n=t.tile)==null?void 0:n.path)==null?void 0:r.type)==="point",s=t.expr.startsWith("intersection");this.$parent.$pendingPoint.toggle(!e),e||(this.$parent.$pendingPoint.setCenter(t.point),this.$parent.$pendingPoint.setClass("locked",s),this.$parent.$pendingPoint.setAttr("r",s?3.5:6))}down({posn:t}){let e=this.snapPoint(t);this.startPoint=this.getOrMakePointTile(e),this.createdNewStart=!e.tile}start(){var t;this.path=new ct("",this.$parent),this.startPoint.pending=this.path.pending=!0,(t=this.$parent.$pendingPoint)==null||t.show(),this.hoverGeoTile(void 0)}move({posn:t}){var e;this.endSnap=this.snapPoint(t),this.path.setExpr(this.expr(this.startPoint.id,this.endSnap.expr),!0),this.drawPendingPoint(this.endSnap),this.hoverGeoTile((e=this.endSnap)==null?void 0:e.tile)}end(){var e;let t=p.distance(this.startPoint.path,this.endSnap.point)<8;if(t)this.path.delete();else{let s=this.getOrMakePointTile(this.endSnap);this.path.setExpr(this.expr(this.startPoint.id,s.id)),this.path.setPending(!1),this.$parent.trigger("add-tile",{tile:this.path})}this.startPoint.setPending(!1),this.startPoint=this.path=this.endSnap=void 0,(e=this.$parent.$pendingPoint)==null||e.hide(),this.hoverGeoTile(void 0),ct.computeIntersections(this.$parent),(this.createdNewStart||!t)&&this.$parent.change()}click(){this.createdNewStart&&this.$parent.change()}hover(t){var s;let e=this.snapPoint(t.posn);this.drawPendingPoint(e),this.hoverGeoTile(((s=e==null?void 0:e.tile)==null?void 0:s.type)==="geo"?e.tile:void 0)}cancel(){this.$parent.$pendingPoint.hide(),this.path&&this.path.delete(),this.startPoint=this.path=this.endSnap=void 0}},Ja=class extends Rn{constructor(){super(...arguments);this.name="geoPending";this.startId="";this.expression=""}enable(t){var e;this.expression=t,this.$parent.selection.clear(),this.$parent.setActiveTool("geoPending"),((e=window.event)==null?void 0:e.clientX)&&this.hover({posn:zt(window.event,this.$parent.$svg)})}makePath(){return this.path=new ct("",this.$parent),this.path.$el.css("opacity",.5),this.path.pending=!0,this.path}down(t){if(!this.expression)return;super.down(t);let e=this.path||this.makePath();e.$el.css("opacity",1),e.setExpr(this.expression.replace(/\$1/g,this.startPoint.id)),e.pending=!1,this.path=void 0,this.$parent.setActiveTool("move"),this.$parent.selection.add(e,!0),this.$parent.change(),ct.computeIntersections(this.$parent),this.$parent.trigger("add-tile",{tile:e})}hover({posn:t}){var s;if(!this.expression)return;let e=this.snapPoint(t);this.drawPendingPoint(e),this.hoverGeoTile(((s=e==null?void 0:e.tile)==null?void 0:s.type)==="geo"?e.tile:void 0),this.path||this.makePath(),this.path.setExpr(this.expression.replace(/\$1/g,e.expr))}cancel(){super.cancel(),this.expression=""}},Qa=class extends Gn{constructor(){super(...arguments);this.name="cutPolygon";this.brush="straight"}enable(t){this.tiles=t;for(let e of this.tiles)e.$outline.addClass("active");this.$parent.selection.clear(),this.$parent.setActiveTool("cutPolygon")}down(){}start({posn:t}){!this.tiles||(this.utensil=this.getUtensil(t),this.startPoint=this.getPoint(t),this.$stroke=c("line",{class:"stroke cut"},this.$parent.$strokes))}move({posn:t}){var e;this.lastPoint=this.getPoint(t),(e=this.$stroke)==null||e.setLine(this.startPoint,this.lastPoint)}end(){var s;let t=new et(this.startPoint,this.lastPoint),e=!1;for(let n of this.tiles||[]){let o=n.transformed.cut(t);if(o.length>1){for(let a of o){let h=new Z(Mt(a.points),this.$parent);h.setColour(n.colour),h.transform()}n.delete(),e=!0}else n.$outline.removeClass("active")}e&&this.$parent.change(),(s=this.$stroke)==null||s.remove(),this.$stroke=this.tiles=this.startPoint=this.lastPoint=void 0,this.$parent.setActiveTool("move")}click(){this.cancel()}cancel(){var t;for(let e of this.tiles||[])e.$outline.removeClass("active");(t=this.$stroke)==null||t.remove(),this.$stroke=this.tiles=this.startPoint=this.lastPoint=void 0,setTimeout(()=>this.$parent.setActiveTool("move"))}};var mu='<svg class="canvas" tabindex="0"><defs><pattern class="grid-pattern" id="square2-grid" x="0" y="0" width="50" height="50" patternUnits="userSpaceOnUse"><rect x="0" y="0" width="50" height="50" opacity="0.1"></rect></pattern><pattern class="grid-pattern" id="square-dots" x="-4" y="-4" width="25" height="25" patternUnits="userSpaceOnUse"><circle cx="4" cy="4" r="2" opacity="0.15"></circle></pattern><pattern class="grid-pattern" id="square-grid" x="0" y="0" width="125" height="125" patternUnits="userSpaceOnUse"><g opacity="0.1"><line x1="25" y1="0" x2="25" y2="125"></line><line x1="0" y1="25" x2="125" y2="25"></line><line x1="50" y1="0" x2="50" y2="125"></line><line x1="0" y1="50" x2="125" y2="50"></line><line x1="75" y1="0" x2="75" y2="125"></line><line x1="0" y1="75" x2="125" y2="75"></line><line x1="100" y1="0" x2="100" y2="125"></line><line x1="0" y1="100" x2="125" y2="100"></line></g><rect x="0" y="0" width="125" height="125" opacity="0.25"></rect></pattern><pattern class="grid-pattern" id="tri-dots" x="0" y="-4" width="25" height="43.30127018922193" patternUnits="userSpaceOnUse"><circle cx="0" cy="4" r="2" opacity="0.15"></circle><circle cx="25" cy="4" r="2" opacity="0.15"></circle><circle cx="12.5" cy="25.650635094610966" r="2" opacity="0.15"></circle></pattern><pattern class="grid-pattern" id="tri-grid" x="0" y="0" width="25" height="43.30127018922193" patternUnits="userSpaceOnUse"><g opacity="0.1"><line x1="0" y1="0" x2="25" y2="0"></line><line x1="0" y1="21.650635094610966" x2="25" y2="21.650635094610966"></line><line x1="0" y1="43.30127018922193" x2="25" y2="43.30127018922193"></line><line x1="0" y1="0" x2="25" y2="43.30127018922193"></line><line x1="25" y1="0" x2="0" y2="43.30127018922193"></line></g></pattern><pattern class="grid-pattern" id="tri2-dots" x="-4" y="0" width="43.30127018922193" height="25" patternUnits="userSpaceOnUse"><circle cx="4" cy="0" r="2" opacity="0.15"></circle><circle cx="4" cy="25" r="2" opacity="0.15"></circle><circle cx="25.650635094610966" cy="12.5" r="2" opacity="0.15"></circle></pattern><pattern class="grid-pattern" id="tri2-grid" x="0" y="0" width="43.30127018922193" height="25" patternUnits="userSpaceOnUse"><g opacity="0.1"><line x1="0" y1="0" x2="0" y2="25"></line><line x1="21.650635094610966" y1="0" x2="21.650635094610966" y2="25"></line><line x1="43.30127018922193" y1="0" x2="43.30127018922193" y2="25"></line><line x1="0" y1="0" x2="43.30127018922193" y2="25"></line><line x1="0" y1="25" x2="43.30127018922193" y2="0"></line></g></pattern><pattern class="grid-pattern" id="square-checked" x="0" y="0" width="50" height="50" patternUnits="userSpaceOnUse"><rect class="filled" x="0" y="0" width="25" height="25" opacity="0.1"></rect><rect class="filled" x="25" y="25" width="25" height="25" opacity="0.1"></rect></pattern><marker id="axis-arrow" refX="3" refY="3" markerWidth="6" markerHeight="6" orient="auto"><path d="M 0 0 L 6 3 L 0 6 z"></path></marker><filter id="handdrawn" x="-20%" y="-20%" width="140%" height="140%"><feTurbulence type="fractalNoise" basefrequency="0.004 0.004" numoctaves="26" stitchtiles="stitch" result="turbulence"></feTurbulence><feDisplacementMap in="SourceGraphic" in2="turbulence" scale="20" xchannelselector="R" ychannelselector="G" result="displacementMap"></feDisplacementMap></filter><filter id="pencil" x="-10%" y="-10%" width="110%" height="110%" filterUnits="objectBoundingBox"><feTurbulence type="fractalNoise" baseFrequency="1.2" numOctaves="3" result="noise"></feTurbulence><feDisplacementMap xChannelSelector="R" yChannelSelector="G" scale="2" in="SourceGraphic" result="newSource"></feDisplacementMap></filter></defs><rect class="grid"></rect><g class="tiles"></g><g class="transform-tools" hidden><path class="group-outline"></path><line class="rotate-bar"></line><circle class="rotate-circle" r="10"></circle></g><g class="tiles active"></g><g class="strokes"></g><g class="geo-shadows"></g><g class="geo-paths"></g><g class="geo-points"></g><rect class="selection"></rect></svg><div class="html-overlay"></div><div class="text-edit" hidden contenteditable></div><div class="panels"></div><slot></slot>';var th=3,q0=new xt(-2e3,4e3,-2e3,4e3),pe=25,eh=pe*Math.sqrt(3)/2,Nn=i=>`${i.xMin} ${i.yMin} ${i.dx} ${i.dy}`,sh=class extends M{constructor(){super(...arguments);this.tiles=new Set;this.strokes=new Set;this.penColour="#242436";this.initial={};this.intersections=new Set;this.margins=[20,20,20,20];this.origin=A;this.zoom=1;this.newTileShift=0;this.options=Ct({grid:"none",canEdit:!0,changeCount:0});this.canPinchPan=!1;this.setup=!1;this.undoStack=[];this.redoStack=[]}ready(){this.$svg=this.$("svg.canvas"),this.$tiles=this.$svg.$(".tiles:not(.active)"),this.$activeTiles=this.$svg.$(".tiles.active"),this.$selection=this.$svg.$(".selection"),this.$strokes=this.$svg.$(".strokes"),this.$grid=this.$svg.$(".grid"),this.$html=this.$(".html-overlay"),this.$panels=this.$(".panels"),this.$geoShadows=this.$svg.$(".geo-shadows"),this.$geoPaths=this.$svg.$(".geo-paths"),this.$geoPoints=this.$svg.$(".geo-points"),this.$pendingPoint=c("circle",{class:"geo-point pending",hidden:!0},this.$geoPoints),this.$textEdit=this.$(".text-edit"),this.$textEdit.onKeyDown("escape",e=>{e.stopPropagation(),this.$textEdit.blur()}),this.tools={move:new ja(this),pen:new Gn(this),geo:new Rn(this),geoPending:new Ja(this),eraser:new Ka(this),text:new Xa(this),pan:new Ya(this),cutPolygon:new Qa(this)},this.activeTool=this.tools.move,this.setAttr("data-tool","move"),this.events=new ai(this.$svg,{down:e=>this.activeTool.down(e),start:e=>this.activeTool.start(e),move:e=>this.activeTool.move(e),end:e=>this.activeTool.end(e),click:e=>this.activeTool.click(e),hover:e=>this.activeTool.hover(e),cursor:!1});let t=this.options;this.$svg.copy=function(e=!0,s=!0,n){let r=Bs.prototype.copy.call(this,e,s,n);if(t.canEditQuestions)for(let o of r.$$(".problem-text"))o.text="?";return r},this.selection=new Fa(this),this.isTeacher=this.attr("user-type")==="teacher",this.options.canEditQuestions=this.isTeacher,this.options.canRotate=At(this,"rotate",!0),this.options.canDelete=At(this,"delete",!0),this.options.canCopy=At(this,"copy",!0),this.options.grid=this.attr("grid")||"none",this.setViewport(A,1),this.options.watch(e=>{this.$grid.setAttr("fill",e.grid!=="none"?`url(#${e.grid})`:"none"),this.$grid.setRect(this.canvasBounds.rect)}),At(this,"pan",!1)&&this.enablePinchPan(),w.onKey("backspace",()=>this.selection.delete()),this.$svg.on("focusin",()=>{let e=Array.from(this.tiles);this.focusTile(this.events.shiftKey?N(e):e[0])}),this.$svg.on("focusout",()=>this.focussed=void 0),G.on("keydown",e=>{if(e.keyCode!==9||!this.focussed)return;let s=Array.from(this.tiles);this.focusTile(s[s.indexOf(this.focussed)+(e.shiftKey?-1:1)]),this.focussed&&e.preventDefault()}),w.onThemeChange(()=>{for(let e of this.tiles)e.setColour(e.colour);for(let e of this.strokes)e.setColor(e.color)})}focusTile(t){this.focussed=t,this.$svg.setAttr("aria-description",t?t.ariaDescription:"Empty Canvas"),t&&this.selection.add(t,!0)}*snapPoints(t,e){for(let s of this.tiles)if(!(t&&s.isActive||s.pending||e&&s.type!==e))for(let n of s.snapPoints)yield[n,{tile:s}];for(let s of this.strokes)if(!!s.snapPoints)for(let n of s.snapPoints)yield[n,{stroke:s}];for(let s of this.intersections)yield[s.value,{intersection:s}]}*gridPoints(t){if(this.options.grid==="none")return;let e=this.options.grid.split("-")[0],s=V.aroundPoints(t),n=new xt(s.p.x-pe,s.p.x+s.w+2*pe,s.p.y-pe,s.p.y+s.h+2*pe);if(e.startsWith("square")){let r=(e==="square2"?2:1)*pe,o=Vt(n.xMin,r);for(let a=Vt(n.yMin,r);a<n.yMax;a+=r)for(let h=o;h<n.xMax;h+=r)yield[new p(h,a),{}]}else if(e.startsWith("tri")){let r=e==="tri2";r&&(n=n.flip);let o=Vt(n.xMin,pe);for(let a=Math.floor(n.yMin/eh);a*eh<n.yMax;++a)for(let h=o+(a%2?pe/2:0);h<n.xMax;h+=pe){let l=new p(h,a*eh);yield[r?l.flip:l,{}]}}}*snapLines(t,e){for(let s of this.tiles)if(!(t&&s.isActive||s.pending||e&&s.type!==e))for(let n of s.snapLines)yield[n,{tile:s}];for(let s of this.strokes)if(!!s.snapLines)for(let n of s.snapLines)yield[n,{stroke:s}]}snap(t,e=!0,s=!1,n){return wn(8,t,this.snapPoints(e,n))||!s&&wn(18,t,this.gridPoints(t))||wn(6,t,this.snapLines(e,n),(r,o)=>r.project(o))}enablePinchPan(){this.canPinchPan=!0,this.on("wheel",s=>{if(s.preventDefault(),s.ctrlKey){let n=this.zoom*(1-s.deltaY/100);this.setViewport(this.origin,n,zt(s,this.$svg))}else{let n=this.origin.shift(s.deltaX/this.zoom,s.deltaY/this.zoom);this.setViewport(n,this.zoom)}});let t=0,e=this.origin;this.on("gesturestart",s=>{s.preventDefault(),e=new p(s.pageX,s.pageY).subtract(this.origin),t=this.zoom,this.events.cancel()}),this.on("gesturechange",s=>{s.preventDefault();let n=t*s.scale,r=new p(s.pageX,s.pageY).subtract(e);this.setViewport(r,n,zt(s,this.$svg))}),this.on("gestureend",s=>s.preventDefault())}enableImageDrop(t,e){let s=c("div",{class:"image-drop"},this);this.on("dragenter dragover dragleave drop",r=>r.preventDefault()),this.on("dragenter dragover",()=>s.show()),this.on("dragleave drop",()=>s.hide());let n=(r,o)=>S(this,null,function*(){let h=Array.from((r==null?void 0:r.files)||[]).slice(0,10).map((l,u)=>this.newImage(l,o.shift(u*25),t));yield Promise.all(h),this.change()});this.on("drop",r=>n(r.dataTransfer,zt(r,this.$svg))),e==null||e.on("change",()=>S(this,null,function*(){yield n(e._el,this.canvasBounds.center),e.value=""}))}bindSettingsPanel(t,e,s){let n=c("div",{class:"polypad-settings",html:e},this.$panels);this.on("change-selection",({tiles:o})=>{n.toggle(o.length===1&&o[0]===t)});let r=Ct(s);return n.bindModel(r),r}enableHotkeys(){w.onKey("z",t=>{(t.ctrlKey||t.metaKey)&&(t.preventDefault(),t.shiftKey?this.redo():this.undo())}),w.onKey("y",t=>{(t.ctrlKey||t.metaKey)&&(t.preventDefault(),this.redo())}),w.onKey("c",t=>{w.getActiveInput()||t.ctrlKey||t.metaKey||this.selection.copy()}),G.on("cut copy",t=>{var s;if(w.getActiveInput()||!this.selection.tiles.size)return;let e=Array.from(this.selection.tiles).map(n=>n.toJSON());(s=window.navigator.clipboard)==null||s.writeText(JSON.stringify(e)),t.type==="cut"&&this.selection.delete()}),G.on("paste",()=>S(this,null,function*(){var e;if(w.getActiveInput())return;let t=yield(e=window.navigator.clipboard)==null?void 0:e.readText();if(!!t)try{let s=JSON.parse(t);if(!s.length)return;let n=s.map(a=>I.unSerialize(a,this)).filter(a=>a);this.selection.clear();let r=Xe(...n.map(a=>a.transformed)).center,o=this.canvasBounds.center.subtract(r).shift(this.newTileShift*25);for(let a of n)a.setTransform(a.posn.add(o)),this.selection.add(a);this.change(),this.newTileShift+=1}catch(n){let s=this.newTile("text",t);s.setTransform(this.canvasBounds.center.subtract(s.center)),this.selection.add(s,!0),this.change()}}))}newImage(t,e,s){return S(this,null,function*(){let n=new FileReader;n.readAsDataURL(t),yield new Promise(o=>n.onloadend=o);let r=this.newTile("image",(n.result||"").toString());return r.setTransform(e),this.selection.add(r,!0),s==null?void 0:s(t,r)})}newTile(t,e){return new(Si(t))(e,this)}setViewport(t,e=1,s){if(e=L(e,1/th,th),s){let a=this.zoom/e;t=s.subtract(s.subtract(this.origin).scale(a))}let n=this.width/e,r=this.height/e;this.zoom=e,this.origin=t.clamp(q0.resize(-n,-r)),this.canvasBounds=new xt(this.origin.x,this.origin.x+n,this.origin.y,this.origin.y+r),this.$svg.setAttr("viewBox",this.attr("viewBox")||Nn(this.canvasBounds)),this.$html.setTransform(this.origin.inverse.scale(this.zoom),0,this.zoom);let o=this.canvasBounds.rect;this.options.grid!=="none"&&this.$grid.setRect(o),ct.redrawLines(o)}resetViewport(){if(!this.tiles.size&&!this.strokes.size)return this.setViewport(A,1);let t=yn(this.tiles,this.strokes,0),[e,s,n,r]=this.margins,o=(this.width-r-s)/t.dx,a=(this.height-e-n)/t.dy,h=L(Math.min(o,a),1/th,1),l=new p(this.width+r-s,this.height+e-n),u=t.center.subtract(l.scale(1/2/h));this.setViewport(u,h)}bindSource(t,e,s,n,r){Si(e).makeThumbnail(s,t,this,r);let o,a=n==null?void 0:n.$(".tiles.active");this.events.listen(t,{down:()=>this.trigger("add-tile-start"),start:({posn:h})=>{o=this.newTile(e,t.data.options||s),r&&o.setColour(r),o.setTransform(h),this.selection.add(o,!0),this.selection.moveStart(),n&&this.canPinchPan&&n.setAttr("viewBox",Nn(this.canvasBounds)),(a||this.$tiles).append(o.$el),this.trigger("add-tile",{tile:o})},move:h=>this.selection.move(h),end:()=>{this.$activeTiles.append(o.$el),this.selection.moveEnd()},click:()=>{let h=this.newTile(e,t.data.options||s);h.setTransform(this.canvasBounds.center.subtract(h.center).shift(this.newTileShift*25)),r&&h.setColour(r),this.selection.add(h,!0),h.moveEnd(),this.trigger("add-tile",{tile:h}),this.change(),this.newTileShift+=1}})}setColour(t="#242436"){this.penColour=t,this.$pendingPoint.css("color",D(t));for(let e of this.selection.tiles)e.setColour(t||"");this.selection.tiles.size&&this.change()}setActiveTool(t){this.activeTool.cancel(),this.activeTool=this.tools[t],this.setAttr("data-tool",t),this.selection.clear()}clear(t=!0){this.selection.clear();for(let e of this.tiles)e.delete();for(let e of this.strokes)e.delete();t&&this.setViewport(A,1),this.change()}thumbnail(t,e){let s=yn(this.tiles,this.strokes,50);return this.$svg.pngImage(t,e,Nn(s))}downloadImage(t){var n;this.selection.clear();let e=t||((n=this.options.title)==null?void 0:n.replace(/\s/g,"-").replace(/[^\w-]/g,"").toLowerCase())||"polypad",s=yn(this.tiles,this.strokes,50);this.$svg.downloadImage(`${e}.png`,s.dx,s.dy,Nn(s))}change(){this.setup||(this.trigger("change"),this.undoStack.push(this.serialize()),this.undoStack.length>20&&this.undoStack.shift(),this.redoStack=[],this.options.canUndo=!0,this.options.changeCount+=1)}undo(){!this.undoStack.length||(this.redoStack.push(this.undoStack.pop()),this.unSerialize(N(this.undoStack)||this.initial),this.trigger("change"),this.options.canUndo=!!this.undoStack.length,this.options.changeCount-=1)}redo(){!this.redoStack.length||(this.undoStack.push(this.redoStack.pop()),this.unSerialize(N(this.undoStack)||this.initial),this.trigger("change"),this.options.canUndo=!0,this.options.changeCount+=1)}serialize(){var t;return{title:(t=this.options.title)==null?void 0:t.slice(0,30),grid:this.options.grid||"none",background:this.options.background,noLabels:this.options.noLabels,tiles:Array.from(this.tiles).slice(0,2e3).map(e=>e.toJSON()),strokes:Array.from(this.strokes).slice(0,1e3).map(e=>e.serialize())}}unSerialize(t){if(!!t){this.setup=!0,this.clear(!1),ct.clearModel();for(let e of t.tiles||[])I.unSerialize(e,this);for(let e of t.strokes||[])Je.unSerialize(e,this);ct.computeIntersections(this);for(let e of this.tiles)e.move();this.setup=!1}}load(t){var e,s,n;this.initial=t,this.options.canEditQuestions=this.isTeacher&&((e=t.canEdit)!=null?e:!0),this.unSerialize(t),this.undoStack=this.redoStack=[],this.options.key=t.key,this.options.grid=t.grid||"none",this.options.thumbnail=t.thumbnail,this.options.title=t.title||"Untitled",this.options.canEdit=(s=t.canEdit)!=null?s:!0,this.options.noLabels=(n=t.noLabels)!=null?n:this.options.noLabels||!1,this.options.canUndo=!1,this.options.changeCount=0,this.resetViewport()}};sh=b([P("x-polypad",{template:mu})],sh);var gu=`<div class="factris-panel-left"><div class="keys-play"><button @click="app.reset()" title="Restart Game"><x-icon name="restart" size="36"></x-icon></button><button @click="app.toggle()" :title="playing ? 'Pause' : 'Play'"><span :show="playing"><x-icon name="pause" size="36"></x-icon></span><span :show="!playing"><x-icon name="play" size="36"></x-icon></span></button><button class="highscore-btn" @click="app.showHighscore()" title="Highscore"><x-icon name="trophy" size="36"></x-icon></button></div><div class="panel-item"><div class="text-large" :class="points &gt; 999999 ? 'narrow' : ''">\${numberFormat(points)}</div><div class="text-small">Points</div></div><div class="panel-item"><div class="text-large margin"><span :show="min(time)" data-display="inline">\${min(time)}m</span> \${time % 60}s</div><div class="text-small">Time</div></div><hr :show="highscore.length"><div class="highscore-panel" :show="highscore.length"><div class="highscore-title">Highscore</div><table><tr><td>\${highscore[0].name.slice(0, 4)}</td><td>\${numberFormat(highscore[0].score)}</td></tr><tr><td>\${highscore[1].name.slice(0, 4)}</td><td>\${numberFormat(highscore[1].score)}</td></tr><tr><td>\${highscore[2].name.slice(0, 4)}</td><td>\${numberFormat(highscore[2].score)}</td></tr><tr><td>\${highscore[3].name.slice(0, 4)}</td><td>\${numberFormat(highscore[3].score)}</td></tr><tr><td colspan="2"><a @click="app.showHighscore()">View more\u2026</a></td></tr></table></div><div class="corner"><svg width="13" height="17"><path class="dark" d="M0,0V5A12,12,0,0,1,12,17h1V0Z"></path><path d="M0,0V1A12,12,0,0,1,12,13v4h1V0Z"></path></svg></div></div><div class="factris-panel-right"><div class="panel-item"><div class="text-small">Next blocks:</div><div class="text-large">\${next[0]}</div><div class="text-large">\${next[1]}</div><div class="text-large">\${next[2]}</div><div class="text-large">\${next[3]}</div><div class="text-large">\${next[4]}</div></div><hr><div class="text-small discharge-label">Discharge:</div><button class="discharge" :show="!discardCounter" data-display="inline-block" @click="app.discharge()" title="Discard Tile"><x-icon name="delete" size="36"></x-icon></button><svg class="discharge-count" :show="discardCounter" data-display="inline-block" width="74" height="74" viewBox="0 0 74 74"><circle cx="37" cy="37" r="32" style="strokeDashoffset:\${201*discardCounter/5}px"></circle><text class="large" x="37" y="38">\${discardCounter}</text><text class="small" x="37" y="51">needed</text></svg><div class="corner"><svg width="13" height="17"><path class="dark" d="M0,0V17H1A12,12,0,0,1,13,5V0Z"></path><path d="M0,0V17H1V13A12,12,0,0,1,13,1V0Z"></path></svg></div></div><div class="factris-body"><svg class="factris-board" :show="(playing || lost) &amp;&amp; !showHighscore &amp;&amp; !initial" data-display="visibility"><defs><linearGradient id="shadow" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color: white; stop-opacity: 0.2"></stop><stop offset="100%" style="stop-color: white; stop-opacity: 0.05"></stop></linearGradient></defs><rect class="shadow" fill="url(#shadow)"></rect><g class="tiles"></g><g class="grid"><g class="faint-grid"></g></g><g class="scores"></g></svg><div class="logo" :class="initial &amp;&amp; !showHighscore ? 'show' : ''"><svg viewBox="0 0 200 60" xmlns="http://www.w3.org/2000/svg"><g fill="#ffffff"><path d="m1.5039 59.1143v-57.9034h24.7227v7.8077h-16.4278v17.5659h14.313v7.8071h-14.313v24.7227z"/><path d="m23.7871 59.1143 12.9307-57.9034h6.9122l12.931 57.9034h-8.2954l-2.4394-12.4429h-11.3042l-2.44 12.4429zm20.4937-20.25-4.066-20.9815h-.1626l-4.0664 20.9815z"/><path d="m86.9766 42.6055v3.5781a12.9 12.9 0 0 1 -1.0166 5.083 14.0881 14.0881 0 0 1 -2.8057 4.27 13.5323 13.5323 0 0 1 -4.1885 2.9683 12.2636 12.2636 0 0 1 -5.164 1.0977 18.5964 18.5964 0 0 1 -4.7984-.65 11.3307 11.3307 0 0 1 -4.3911-2.2774 12.5723 12.5723 0 0 1 -3.2123-4.1889 14.814 14.814 0 0 1 -1.2608-6.5463v-31.8795a14.0993 14.0993 0 0 1 .976-5.2861 12.4357 12.4357 0 0 1 2.7648-4.229 12.863 12.863 0 0 1 4.27-2.8054 14.35 14.35 0 0 1 5.4892-1.0169 12.5807 12.5807 0 0 1 9.5151 3.8223 13.6266 13.6266 0 0 1 2.8057 4.4321 14.9842 14.9842 0 0 1 1.0166 5.5708v3.253h-8.2954v-2.7652a6.7153 6.7153 0 0 0 -1.3824-4.2285 4.4819 4.4819 0 0 0 -3.7412-1.789q-3.0915 0-4.1064 1.9111a10.23 10.23 0 0 0 -1.0166 4.8384v29.6025a7.6635 7.6635 0 0 0 1.0976 4.2285q1.098 1.7081 3.9444 1.708a6.0109 6.0109 0 0 0 1.7485-.2846 5.2115 5.2115 0 0 0 1.7485-.9351 4.953 4.953 0 0 0 1.22-1.79 7.2474 7.2474 0 0 0 .4878-2.8462v-2.8457z"/><path d="m99.1748 59.1143v-50.0957h-9.5967v-7.8077h27.4878v7.8077h-9.5959v50.0957z"/><path d="m120.7246 59.1143v-57.9034h13.3369q14.6385 0 14.6385 16.9971a21.4218 21.4218 0 0 1 -1.5859 8.7017 12.2983 12.2983 0 0 1 -5.5708 5.7739l8.9458 26.4307h-8.7832l-7.7256-24.7227h-4.9603v24.7227zm8.2954-50.0957v18.0537h4.7168a8.348 8.348 0 0 0 3.4971-.61 4.7555 4.7555 0 0 0 2.0332-1.7485 7.9534 7.9534 0 0 0 .8945-2.8057 26.9748 26.9748 0 0 0 .2437-3.8628 26.99 26.99 0 0 0 -.2437-3.8628 7.7387 7.7387 0 0 0 -.976-2.8872q-1.5467-2.2753-5.8556-2.2767z"/><path d="m155.6123 59.1143v-57.9034h8.2954v57.9034z"/><path d="m198.7954 17.8828h-8.2949v-1.8706a8.8535 8.8535 0 0 0 -1.3423-4.92 4.962 4.962 0 0 0 -4.5132-2.0737 5.2227 5.2227 0 0 0 -2.7651.65 5.4612 5.4612 0 0 0 -1.708 1.6265 6.8624 6.8624 0 0 0 -.8946 2.3989 15.6706 15.6706 0 0 0 -.2436 2.8057 27.5758 27.5758 0 0 0 .1216 2.8467 5.3954 5.3954 0 0 0 .61 2.0332 4.5014 4.5014 0 0 0 1.4229 1.5449 12.9606 12.9606 0 0 0 2.562 1.3013l6.3433 2.521a15.7628 15.7628 0 0 1 4.4726 2.48 10.7272 10.7272 0 0 1 2.6839 3.2943 15.4228 15.4228 0 0 1 1.22 4.4321 44.0689 44.0689 0 0 1 .3252 5.6524 29.8066 29.8066 0 0 1 -.7319 6.7905 14.3039 14.3039 0 0 1 -2.3584 5.3267 11.699 11.699 0 0 1 -4.4727 3.5781 15.7942 15.7942 0 0 1 -6.75 1.3013 14.7745 14.7745 0 0 1 -5.6113-1.0572 13.31 13.31 0 0 1 -4.4732-2.9277 14.2235 14.2235 0 0 1 -2.9682-4.3506 13.2116 13.2116 0 0 1 -1.0982-5.4082v-3.09h8.2955v2.6025a6.7761 6.7761 0 0 0 1.3418 4.1069q1.3418 1.83 4.5136 1.83a7.2794 7.2794 0 0 0 3.2935-.61 4.3859 4.3859 0 0 0 1.83-1.7486 6.4244 6.4244 0 0 0 .7729-2.7246q.1216-1.5856.1221-3.5376a35.0565 35.0565 0 0 0 -.1631-3.7407 6.4528 6.4528 0 0 0 -.65-2.3584 4.59 4.59 0 0 0 -1.5044-1.4639 19.57 19.57 0 0 0 -2.4805-1.22l-5.9365-2.44q-5.3679-2.1958-7.1972-5.8145a19.9948 19.9948 0 0 1 -1.83-9.0679 21.0112 21.0112 0 0 1 .8945-6.1806 14.0506 14.0506 0 0 1 2.6841-5.042 12.3042 12.3042 0 0 1 4.3506-3.375 14.5257 14.5257 0 0 1 6.3018-1.2609 13.7661 13.7661 0 0 1 5.6519 1.1387 14.5927 14.5927 0 0 1 4.4326 3.0088 12.5712 12.5712 0 0 1 3.7407 8.9458z"/></g></svg></div><x-icon class="play" :class="initial &amp;&amp; !showHighscore ? 'show' : ''" @click="app.play()" name="play" size="80"></x-icon><div class="overlay lost" :class="lost &amp;&amp; !showHighscore ? 'show' : ''">Game over!</div><div class="overlay paused" :class="playing || lost || initial || showHighscore ? '' : 'show'">Paused</div><div class="highscore" :show="showHighscore"><div class="text-large"><x-icon name="trophy" size="36"></x-icon> Highscore</div><table><tr><td>\${highscore[0].name}</td><td>\${numberFormat(highscore[0].score)}</td></tr><tr><td>\${highscore[1].name}</td><td>\${numberFormat(highscore[1].score)}</td></tr><tr><td>\${highscore[2].name}</td><td>\${numberFormat(highscore[2].score)}</td></tr><tr><td>\${highscore[3].name}</td><td>\${numberFormat(highscore[3].score)}</td></tr><tr><td>\${highscore[4].name}</td><td>\${numberFormat(highscore[4].score)}</td></tr><tr><td>\${highscore[5].name}</td><td>\${numberFormat(highscore[5].score)}</td></tr><tr><td>\${highscore[6].name}</td><td>\${numberFormat(highscore[6].score)}</td></tr><tr><td>\${highscore[7].name}</td><td>\${numberFormat(highscore[7].score)}</td></tr><tr><td>\${highscore[8].name}</td><td>\${numberFormat(highscore[8].score)}</td></tr><tr><td>\${highscore[9].name}</td><td>\${numberFormat(highscore[9].score)}</td></tr><tr><td>\${highscore[10].name}</td><td>\${numberFormat(highscore[10].score)}</td></tr></table></div></div><div class="factris-keys"><button class="key-left" :class="key === 'left' ? 'active' : ''" title="Left" @pointerdown="app.keyPress('left')"><x-icon name="left" size="36"></x-icon></button><div class="keys-center"><button class="key-up" :class="key === 'up' ? 'active' : ''" title="Resize" @pointerdown="app.keyPress('up')"><svg class="icon" width="54" height="36" viewBox="0 0 54 36" xmlns="http://www.w3.org/2000/svg"><path d="m41.1973 11 1.5975-1.635a.75.75 0 0 1 1.2751.5325v.495a6 6 0 0 1 5.2501 5.8575.75.75 0 0 1 -1.5 0 4.5 4.5 0 0 0 -3.75-4.3426v1.1475a.75.75 0 0 1 -1.2751.5326l-1.5975-1.56a.7676.7676 0 0 1 -.0001-1.0275z"/><path d="m12.8027 11-1.5975-1.635a.75.75 0 0 0 -1.2752.5324v.495a6 6 0 0 0 -5.25 5.8576.75.75 0 0 0 1.5 0 4.5 4.5 0 0 1 3.75-4.3426v1.1475a.75.75 0 0 0 1.2751.5326l1.5975-1.56a.7676.7676 0 0 0 .0001-1.0275z"/><rect height="11" rx="2" width="11" x="15" y="6"/><rect height="11" rx="2" width="11" x="28" y="6"/><rect height="11" rx="2" width="11" x="15" y="19"/><rect height="11" rx="2" width="11" x="28" y="19"/><path d="m50 21v7h-7v-7zm0-2h-7a2 2 0 0 0 -2 2v7a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-7a2 2 0 0 0 -2-2z"/><path d="m11 21v7h-7v-7zm0-2h-7a2 2 0 0 0 -2 2v7a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-7a2 2 0 0 0 -2-2z"/></svg>
</button><button class="key-down" :class="key === 'down' ? 'active' : ''" title="Down" @pointerdown="app.keyPress('down')"><x-icon name="down" size="36"></x-icon></button></div><button class="key-right" :class="key === 'right' ? 'active' : ''" title="Right" @pointerdown="app.keyPress('right')"><x-icon name="right" size="36"></x-icon></button></div><div class="factris-panel-top" :class="showHighscore ? 'hide' : ''"><div class="text-small">Block size:</div><div class="text-large">\${active[0] || '?' } = \${active[2]|| '?'} \xD7 \${active[1]|| '?'}</div><div class="corner left"><svg width="13" height="13"><path d="M12,0A12,12,0,0,1,0,12v1H13V0Z"></path></svg></div><div class="corner right"><svg width="13" height="13"><path d="M1,0A12,12,0,0,0,13,12v1H0V0Z"></path></svg></div></div>`;var z0=1e3,F=L(+qh(location.search).size||16,8,24),B0=5,Os=Math.ceil(F/2),Dn=F+Os,qn=[];for(let i=2;i<=F*1.5;i+=1){let t=qr(i);t&&i>.75*F||i>F&&zl(i)[0]>F/2||(t&&i>F/2||i>1.25*F?qn.push(i):qn.push(i,i))}var Vi=()=>qn[pt.integer(qn.length)],_0=as(1,F),H0=F*10,wu=z(i=>H0*2**i,F),yu=class{constructor(t,e,s){this.$el=c("rect",{width:20,height:20},s),this.setPosition(t,e)}setPosition(t,e){this.x=t,this.y=e,this.$el.setTransform({x:10+20*this.x,y:10+20*this.y})}go(t,e,s){this.setPosition(this.x+s-e,this.y+t)}canSet(t,e,s){return!s.find(n=>n.x===t&&n.y===e)}canGo(t,e,s,n){let r=this.x+s-e,o=this.y+t;return o>=Dn||r<0||r>=F?!1:this.canSet(r,o,n)}canGoDown(t){return this.canGo(1,0,0,t)}goDown(t=1){if(t!==0)return this.go(t,0,0)}},ih=class extends M{constructor(){super(...arguments);this.interval=void 0;this.tiles=[];this.activeTiles=[];this.activeSize=[0,0,0];this.activeFactors=[];this.isDown=!1;this.keyLock=!1;this.requestQueue=Promise.resolve("");this.highscore=!0}ready(){this.$svg=this.$(".factris-board"),this.$tiles=this.$svg.$(".tiles"),this.$shadow=this.$svg.$(".shadow"),this.attr("highscore")==="no"&&(this.highscore=!1);let t=this.$svg.$(".scores");this.$scores=wu.map((e,s)=>{let n=c("g",{},t);return c("text",{text:"+"+e,class:`s${s+1}`},n),n}),this.bindModel(Ct({time:0,points:0,playing:!1,lost:!1,initial:!0,key:void 0,discardCounter:0,next:[],active:[],highscore:[],showHighscore:!1,min:e=>Math.floor(e/60),numberFormat:vt,app:this}));for(let e of this.$$("button, .play"))e.on("contextmenu",s=>s.preventDefault());w.onKey("left up right down",(e,s)=>{!this.model.playing||(e.preventDefault(),this.isDown=!0,this.model.key=s,this.keyPress(s))}),w.onKey("left up right down",()=>{!this.model.playing||(this.isDown=this.keyLock=!1,this.model.key=void 0)},!0),this.setupSVG(),this.updateHighscore()}setupSVG(){this.$svg.setAttr("viewBox",`0 0 ${(F+1)*20} ${(Dn+1)*20}`);let t=this.$svg.$(".grid"),e=t.$(".faint-grid");for(let s=0;s<=F;s+=1){let n=10+s*20,r=10+(Os+s)*20,o=!(s%4)||s===F?t:e,a=!(s%2)||s===F?"thick":"";c("line",{x1:10,y1:r,x2:10+F*20,y2:r,class:a},o),c("line",{x1:n,y1:10+Os*20,x2:n,y2:Dn*20+10,class:a},o)}}drawShadow(){!this.activeTiles.length||(this.$shadow.setAttr("x",10+20*this.activeSize[0]),this.$shadow.setAttr("y",10+20*this.activeSize[1]),this.$shadow.setAttr("width",20*this.activeSize[2]),this.$shadow.setAttr("height",20*(Dn-this.activeSize[1])))}newRect(){let t=this.getNewTileSize();this.activeFactors=_0.filter(n=>t%n==0);let e=this.activeFactors.pop(),s=Math.floor((F-e)/2);this.activeTiles=z(n=>new yu(s+n%e,Math.floor(n/e),this.$tiles),t),this.model.active=[t,e,t/e],this.activeSize=[s,t/e,e],this.drawShadow(),this.isDown&&(this.keyLock=!0)}reset(){this.pause(),this.model.time=0,this.model.points=0,this.model.discardCounter=0,this.model.showHighscore=!1,this.model.lost=!1,this.model.next=[Vi(),Vi(),Vi(),Vi()];for(let t of this.tiles)t.$el.remove();for(let t of this.activeTiles)t.$el.remove();this.tiles=[],this.newRect(),this.play(),this.requestQueue=Promise.resolve("")}toggle(){this.model.lost?this.reset():this.model.playing?this.pause():this.play()}pause(){this.model.playing=!1,clearInterval(this.interval)}play(){if(this.model.showHighscore=!1,window==null||window.ga("send","event","Factris","play"),this.model.initial||this.model.lost)return this.model.initial=!1,this.reset();this.model.playing=!0,this.interval=window.setInterval(()=>this.tick(),z0)}getNewTileSize(){let t=F*F-this.tiles.length;if(this.model.next[0]>t)return t>F?t-F:F;this.model.discardCounter>0&&(this.model.discardCounter-=1);let e=this.model.next[0];return this.model.next=[...this.model.next.slice(1),Vi()],e}tick(){if(this.model.time+=1,this.activeTiles.every(r=>r.canGoDown(this.tiles))){for(let r of this.activeTiles)r.goDown();this.activeSize[1]+=1,this.drawShadow();return}this.tiles.push(...this.activeTiles);for(let r of this.activeTiles)r.$el.addClass("fixed");if(this.tiles.some(r=>r.y<Os))return this.gameOver();this.activeTiles=[];let e=this.getFullRows();if(!e.length)return this.newRect();this.model.points+=U(wu.slice(0,e.length)),e.length>=6&&ns(10,150*e.length/F),this.removeRows(e);let s=this.model.points,n=(s+F)%13+(s-F)%87;this.requestQueue=this.requestQueue.then(r=>ne("/factris-verify",{token:r,size:F,score:s,check:n})),this.trigger("score",{points:s})}getFullRows(){return z(t=>this.tiles.filter(e=>e.y===t+Os),F).filter(t=>t.length===F)}removeRows(t){let e=Yt(t);this.tiles=this.tiles.filter(r=>!e.includes(r)),this.$tiles.addClass("animated"),w.redraw();for(let r of e)r.$el.addClass("removing");let s=t.map(r=>r[0].y);for(let r of this.tiles)r.goDown(s.filter(o=>o>r.y).length);let n=400/t.length;for(let[r,o]of s.reverse().entries())this.$scores[r].setTransform({x:10+Os*20,y:27+o*20}),os(()=>this.$scores[r].addClass("visible"),r*n);return setTimeout(()=>{for(let r of this.$scores)r.removeClass("visible")},600),setTimeout(()=>{for(let r of e)r.$el.remove();this.$tiles.removeClass("animated"),this.newRect()},1e3),!1}gameOver(){this.model.lost=!0;for(let t of this.activeTiles)t.$el.addClass("error");this.pause(),this.requestQueue.then(t=>{t&&this.trigger("game-over",{token:t,points:this.model.points})})}discharge(){if(!!this.model.playing){for(let t of this.activeTiles)t.$el.remove();this.newRect(),this.model.discardCounter=B0}}keyPress(t,e=!0){if(!!this.model.playing&&!this.keyLock){if(t==="up"){if(!this.activeFactors.length)return;let s=this.activeFactors.pop(),n=this.activeSize[0]+Math.floor((this.activeSize[2]-s)/2),r=this.activeSize[1];if(this.activeTiles.some((h,l)=>!h.canSet(n+l%s,r-1-Math.floor(l/s),this.tiles)))return;for(let[h,l]of this.activeTiles.entries())l.setPosition(n+h%s,r-1-Math.floor(h/s));let a=this.model.active[0];this.model.active=[a,s,a/s],this.activeSize=[n,r,s]}else{let s=t==="down"?1:0,n=t==="left"?1:0,r=t==="right"?1:0;if(this.activeTiles.every(o=>o.canGo(s,n,r,this.tiles))){for(let o of this.activeTiles)o.go(s,n,r);this.activeSize[0]+=r-n,this.activeSize[1]+=s}e&&t==="down"&&setTimeout(()=>this.keyPress("down",!1),100)}this.drawShadow()}}showHighscore(){!this.highscore||(this.pause(),this.model.showHighscore=!0)}updateHighscore(){return S(this,null,function*(){if(!this.highscore)return;let t=yield fetch(`/factris-highscore?size=${F}`);this.model.highscore=yield t.json()})}};ih=b([P("x-factris",{template:gu})],ih);var nh=class extends M{ready(){let t=Array.from(this._el.children);this.removeChildren();let e=c("svg",{class:"equation"},this),s=c("g",{transform:"translate(2 0)"},e),n=c("div",{class:"overlay"},this),r=parseFloat(this.css("font-size")),o=this.parents(".text-center").length||this.hasClass("display"),a=new ni(s,n,0,"",r,!!o);a.setValue(this.attr("expr")||t),this.css({width:a.root.width+4+"px",height:a.root.height+"px","vertical-align":`-${a.root.height-a.root.baseline}px`})}};nh=b([P("x-math")],nh);window.$=E;window.$$=te;window.Browser=w;var zn=E("x-modal#privacy");zn&&zn.$("form").on("submit",i=>{i.preventDefault();let t=zn.$('input[name="newsletter"]');ne("/settings/privacy",{policies:"on",newsletter:t.checked?"on":"off"}),zn.close()});var vu="";function rh(){return fetch("/joke").then(i=>i.text()).then(i=>vu=i),vu}var oh=E(".error-box");oh&&oh.on("click",()=>oh.html=rh());rh();window.tellMeAJoke=function(){return rh().replace(/<p>/g,"").replace(/<\/p>/g,`
`).trim()};console.log("%cWelcome to Mathigon!","color: #cd0e66; font-weight: bold; font-size: 18px;");console.log("%cYou can see Mathigon\u2019s source code at https://github.com/mathigon","color: #0f82f2; font-weight: bold;");console.log("%cIf you want to contribute, please visit https://mathigon.io","color: #22ab24; font-weight: bold;");console.log("%cJust here for fun? Run tellMeAJoke()","color: #fd8c00; font-weight: bold;");var xu=[38,38,40,40,37,39,37,39,66,65],Ei=0;document.addEventListener("keydown",i=>{i.keyCode===xu[Ei]?(Ei+=1,Ei===xu.length&&(ns(),Ei=0)):Ei=0});})();